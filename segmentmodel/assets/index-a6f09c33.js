var Rp=Object.defineProperty;var Mp=(t,e,n)=>e in t?Rp(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;var fe=(t,e,n)=>(Mp(t,typeof e!="symbol"?e+"":e,n),n),jo=(t,e,n)=>{if(!e.has(t))throw TypeError("Cannot "+n)};var S=(t,e,n)=>(jo(t,e,"read from private field"),n?n.call(t):e.get(t)),M=(t,e,n)=>{if(e.has(t))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(t):e.set(t,n)},he=(t,e,n,r)=>(jo(t,e,"write to private field"),r?r.call(t,n):e.set(t,n),n);var Ou=(t,e,n,r)=>({set _(i){he(t,e,i,n)},get _(){return S(t,e,r)}}),I=(t,e,n)=>(jo(t,e,"access private method"),n);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))r(i);new MutationObserver(i=>{for(const s of i)if(s.type==="childList")for(const o of s.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function n(i){const s={};return i.integrity&&(s.integrity=i.integrity),i.referrerPolicy&&(s.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?s.credentials="include":i.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function r(i){if(i.ep)return;i.ep=!0;const s=n(i);fetch(i.href,s)}})();/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const Pr=globalThis,Cs=Pr.trustedTypes,Pu=Cs?Cs.createPolicy("lit-html",{createHTML:t=>t}):void 0,Bf="$lit$",_t=`lit$${(Math.random()+"").slice(9)}$`,kf="?"+_t,Bp=`<${kf}>`,Cn=document,Hr=()=>Cn.createComment(""),qr=t=>t===null||typeof t!="object"&&typeof t!="function",Of=Array.isArray,kp=t=>Of(t)||typeof(t==null?void 0:t[Symbol.iterator])=="function",Yo=`[ 	
\f\r]`,Sr=/<(?:(!--|\/[^a-zA-Z])|(\/?[a-zA-Z][^>\s]*)|(\/?$))/g,Lu=/-->/g,Nu=/>/g,Qt=RegExp(`>|${Yo}(?:([^\\s"'>=/]+)(${Yo}*=${Yo}*(?:[^ 	
\f\r"'\`<>=]|("|')|))|$)`,"g"),zu=/'/g,Uu=/"/g,Pf=/^(?:script|style|textarea|title)$/i,Op=t=>(e,...n)=>({_$litType$:t,strings:e,values:n}),te=Op(1),ir=Symbol.for("lit-noChange"),J=Symbol.for("lit-nothing"),$u=new WeakMap,on=Cn.createTreeWalker(Cn,129);function Lf(t,e){if(!Array.isArray(t)||!t.hasOwnProperty("raw"))throw Error("invalid template strings array");return Pu!==void 0?Pu.createHTML(e):e}const Pp=(t,e)=>{const n=t.length-1,r=[];let i,s=e===2?"<svg>":"",o=Sr;for(let a=0;a<n;a++){const c=t[a];let u,f,l=-1,h=0;for(;h<c.length&&(o.lastIndex=h,f=o.exec(c),f!==null);)h=o.lastIndex,o===Sr?f[1]==="!--"?o=Lu:f[1]!==void 0?o=Nu:f[2]!==void 0?(Pf.test(f[2])&&(i=RegExp("</"+f[2],"g")),o=Qt):f[3]!==void 0&&(o=Qt):o===Qt?f[0]===">"?(o=i??Sr,l=-1):f[1]===void 0?l=-2:(l=o.lastIndex-f[2].length,u=f[1],o=f[3]===void 0?Qt:f[3]==='"'?Uu:zu):o===Uu||o===zu?o=Qt:o===Lu||o===Nu?o=Sr:(o=Qt,i=void 0);const p=o===Qt&&t[a+1].startsWith("/>")?" ":"";s+=o===Sr?c+Bp:l>=0?(r.push(u),c.slice(0,l)+Bf+c.slice(l)+_t+p):c+_t+(l===-2?a:p)}return[Lf(t,s+(t[n]||"<?>")+(e===2?"</svg>":"")),r]};class Wr{constructor({strings:e,_$litType$:n},r){let i;this.parts=[];let s=0,o=0;const a=e.length-1,c=this.parts,[u,f]=Pp(e,n);if(this.el=Wr.createElement(u,r),on.currentNode=this.el.content,n===2){const l=this.el.content.firstChild;l.replaceWith(...l.childNodes)}for(;(i=on.nextNode())!==null&&c.length<a;){if(i.nodeType===1){if(i.hasAttributes())for(const l of i.getAttributeNames())if(l.endsWith(Bf)){const h=f[o++],p=i.getAttribute(l).split(_t),d=/([.?@])?(.*)/.exec(h);c.push({type:1,index:s,name:d[2],strings:p,ctor:d[1]==="."?Np:d[1]==="?"?zp:d[1]==="@"?Up:ro}),i.removeAttribute(l)}else l.startsWith(_t)&&(c.push({type:6,index:s}),i.removeAttribute(l));if(Pf.test(i.tagName)){const l=i.textContent.split(_t),h=l.length-1;if(h>0){i.textContent=Cs?Cs.emptyScript:"";for(let p=0;p<h;p++)i.append(l[p],Hr()),on.nextNode(),c.push({type:2,index:++s});i.append(l[h],Hr())}}}else if(i.nodeType===8)if(i.data===kf)c.push({type:2,index:s});else{let l=-1;for(;(l=i.data.indexOf(_t,l+1))!==-1;)c.push({type:7,index:s}),l+=_t.length-1}s++}}static createElement(e,n){const r=Cn.createElement("template");return r.innerHTML=e,r}}function sr(t,e,n=t,r){var o,a;if(e===ir)return e;let i=r!==void 0?(o=n._$Co)==null?void 0:o[r]:n._$Cl;const s=qr(e)?void 0:e._$litDirective$;return(i==null?void 0:i.constructor)!==s&&((a=i==null?void 0:i._$AO)==null||a.call(i,!1),s===void 0?i=void 0:(i=new s(t),i._$AT(t,n,r)),r!==void 0?(n._$Co??(n._$Co=[]))[r]=i:n._$Cl=i),i!==void 0&&(e=sr(t,i._$AS(t,e.values),i,r)),e}class Lp{constructor(e,n){this._$AV=[],this._$AN=void 0,this._$AD=e,this._$AM=n}get parentNode(){return this._$AM.parentNode}get _$AU(){return this._$AM._$AU}u(e){const{el:{content:n},parts:r}=this._$AD,i=((e==null?void 0:e.creationScope)??Cn).importNode(n,!0);on.currentNode=i;let s=on.nextNode(),o=0,a=0,c=r[0];for(;c!==void 0;){if(o===c.index){let u;c.type===2?u=new Ii(s,s.nextSibling,this,e):c.type===1?u=new c.ctor(s,c.name,c.strings,this,e):c.type===6&&(u=new $p(s,this,e)),this._$AV.push(u),c=r[++a]}o!==(c==null?void 0:c.index)&&(s=on.nextNode(),o++)}return on.currentNode=Cn,i}p(e){let n=0;for(const r of this._$AV)r!==void 0&&(r.strings!==void 0?(r._$AI(e,r,n),n+=r.strings.length-2):r._$AI(e[n])),n++}}class Ii{get _$AU(){var e;return((e=this._$AM)==null?void 0:e._$AU)??this._$Cv}constructor(e,n,r,i){this.type=2,this._$AH=J,this._$AN=void 0,this._$AA=e,this._$AB=n,this._$AM=r,this.options=i,this._$Cv=(i==null?void 0:i.isConnected)??!0}get parentNode(){let e=this._$AA.parentNode;const n=this._$AM;return n!==void 0&&(e==null?void 0:e.nodeType)===11&&(e=n.parentNode),e}get startNode(){return this._$AA}get endNode(){return this._$AB}_$AI(e,n=this){e=sr(this,e,n),qr(e)?e===J||e==null||e===""?(this._$AH!==J&&this._$AR(),this._$AH=J):e!==this._$AH&&e!==ir&&this._(e):e._$litType$!==void 0?this.g(e):e.nodeType!==void 0?this.$(e):kp(e)?this.T(e):this._(e)}k(e){return this._$AA.parentNode.insertBefore(e,this._$AB)}$(e){this._$AH!==e&&(this._$AR(),this._$AH=this.k(e))}_(e){this._$AH!==J&&qr(this._$AH)?this._$AA.nextSibling.data=e:this.$(Cn.createTextNode(e)),this._$AH=e}g(e){var s;const{values:n,_$litType$:r}=e,i=typeof r=="number"?this._$AC(e):(r.el===void 0&&(r.el=Wr.createElement(Lf(r.h,r.h[0]),this.options)),r);if(((s=this._$AH)==null?void 0:s._$AD)===i)this._$AH.p(n);else{const o=new Lp(i,this),a=o.u(this.options);o.p(n),this.$(a),this._$AH=o}}_$AC(e){let n=$u.get(e.strings);return n===void 0&&$u.set(e.strings,n=new Wr(e)),n}T(e){Of(this._$AH)||(this._$AH=[],this._$AR());const n=this._$AH;let r,i=0;for(const s of e)i===n.length?n.push(r=new Ii(this.k(Hr()),this.k(Hr()),this,this.options)):r=n[i],r._$AI(s),i++;i<n.length&&(this._$AR(r&&r._$AB.nextSibling,i),n.length=i)}_$AR(e=this._$AA.nextSibling,n){var r;for((r=this._$AP)==null?void 0:r.call(this,!1,!0,n);e&&e!==this._$AB;){const i=e.nextSibling;e.remove(),e=i}}setConnected(e){var n;this._$AM===void 0&&(this._$Cv=e,(n=this._$AP)==null||n.call(this,e))}}class ro{get tagName(){return this.element.tagName}get _$AU(){return this._$AM._$AU}constructor(e,n,r,i,s){this.type=1,this._$AH=J,this._$AN=void 0,this.element=e,this.name=n,this._$AM=i,this.options=s,r.length>2||r[0]!==""||r[1]!==""?(this._$AH=Array(r.length-1).fill(new String),this.strings=r):this._$AH=J}_$AI(e,n=this,r,i){const s=this.strings;let o=!1;if(s===void 0)e=sr(this,e,n,0),o=!qr(e)||e!==this._$AH&&e!==ir,o&&(this._$AH=e);else{const a=e;let c,u;for(e=s[0],c=0;c<s.length-1;c++)u=sr(this,a[r+c],n,c),u===ir&&(u=this._$AH[c]),o||(o=!qr(u)||u!==this._$AH[c]),u===J?e=J:e!==J&&(e+=(u??"")+s[c+1]),this._$AH[c]=u}o&&!i&&this.O(e)}O(e){e===J?this.element.removeAttribute(this.name):this.element.setAttribute(this.name,e??"")}}class Np extends ro{constructor(){super(...arguments),this.type=3}O(e){this.element[this.name]=e===J?void 0:e}}class zp extends ro{constructor(){super(...arguments),this.type=4}O(e){this.element.toggleAttribute(this.name,!!e&&e!==J)}}class Up extends ro{constructor(e,n,r,i,s){super(e,n,r,i,s),this.type=5}_$AI(e,n=this){if((e=sr(this,e,n,0)??J)===ir)return;const r=this._$AH,i=e===J&&r!==J||e.capture!==r.capture||e.once!==r.once||e.passive!==r.passive,s=e!==J&&(r===J||i);i&&this.element.removeEventListener(this.name,this,r),s&&this.element.addEventListener(this.name,this,e),this._$AH=e}handleEvent(e){var n;typeof this._$AH=="function"?this._$AH.call(((n=this.options)==null?void 0:n.host)??this.element,e):this._$AH.handleEvent(e)}}class $p{constructor(e,n,r){this.element=e,this.type=6,this._$AN=void 0,this._$AM=n,this.options=r}get _$AU(){return this._$AM._$AU}_$AI(e){sr(this,e)}}const Xo=Pr.litHtmlPolyfillSupport;Xo==null||Xo(Wr,Ii),(Pr.litHtmlVersions??(Pr.litHtmlVersions=[])).push("3.1.0");const Ss=(t,e,n)=>{const r=(n==null?void 0:n.renderBefore)??e;let i=r._$litPart$;if(i===void 0){const s=(n==null?void 0:n.renderBefore)??null;r._$litPart$=i=new Ii(e.insertBefore(Hr(),s),s,void 0,n??{})}return i._$AI(t),i};/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const Vp={ATTRIBUTE:1,CHILD:2,PROPERTY:3,BOOLEAN_ATTRIBUTE:4,EVENT:5,ELEMENT:6},Gp=t=>(...e)=>({_$litDirective$:t,values:e});class Hp{constructor(e){}get _$AU(){return this._$AM._$AU}_$AT(e,n,r){this._$Ct=e,this._$AM=n,this._$Ci=r}_$AS(e,n){return this.update(e,n)}update(e,n){return this.render(...n)}}/**
 * @license
 * Copyright 2018 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const Vu=Gp(class extends Hp{constructor(t){var e;if(super(t),t.type!==Vp.ATTRIBUTE||t.name!=="class"||((e=t.strings)==null?void 0:e.length)>2)throw Error("`classMap()` can only be used in the `class` attribute and must be the only part in the attribute.")}render(t){return" "+Object.keys(t).filter(e=>t[e]).join(" ")+" "}update(t,[e]){var r,i;if(this.it===void 0){this.it=new Set,t.strings!==void 0&&(this.st=new Set(t.strings.join(" ").split(/\s/).filter(s=>s!=="")));for(const s in e)e[s]&&!((r=this.st)!=null&&r.has(s))&&this.it.add(s);return this.render(e)}const n=t.element.classList;for(const s of this.it)s in e||(n.remove(s),this.it.delete(s));for(const s in e){const o=!!e[s];o===this.it.has(s)||(i=this.st)!=null&&i.has(s)||(o?(n.add(s),this.it.add(s)):(n.remove(s),this.it.delete(s)))}return ir}});var Gu={},is={},Ko=34,en=10,ss=13;function Nf(t){return new Function("d","return {"+t.map(function(e,n){return JSON.stringify(e)+": d["+n+'] || ""'}).join(",")+"}")}function qp(t,e){var n=Nf(t);return function(r,i){return e(n(r),i,t)}}function Hu(t){var e=Object.create(null),n=[];return t.forEach(function(r){for(var i in r)i in e||n.push(e[i]=i)}),n}function Ee(t,e){var n=t+"",r=n.length;return r<e?new Array(e-r+1).join(0)+n:n}function Wp(t){return t<0?"-"+Ee(-t,6):t>9999?"+"+Ee(t,6):Ee(t,4)}function jp(t){var e=t.getUTCHours(),n=t.getUTCMinutes(),r=t.getUTCSeconds(),i=t.getUTCMilliseconds();return isNaN(t)?"Invalid Date":Wp(t.getUTCFullYear())+"-"+Ee(t.getUTCMonth()+1,2)+"-"+Ee(t.getUTCDate(),2)+(i?"T"+Ee(e,2)+":"+Ee(n,2)+":"+Ee(r,2)+"."+Ee(i,3)+"Z":r?"T"+Ee(e,2)+":"+Ee(n,2)+":"+Ee(r,2)+"Z":n||e?"T"+Ee(e,2)+":"+Ee(n,2)+"Z":"")}function zf(t,e){var n=new RegExp('["'+t+`
\r]`),r=t.charCodeAt(0);function i(h,p){var d,m,g=s(h,function(x,b){if(d)return d(x,b-1);m=x,d=p?qp(x,p):Nf(x)});return g.columns=m||[],g}function s(h,p){var d=[],m=h.length,g=0,x=0,b,A=m<=0,E=!1,F=!0,C=e?e.comment:void 0;h.charCodeAt(m-1)===en&&--m,h.charCodeAt(m-1)===ss&&--m;function w(){if(A)return is;if(E)return E=!1,F=!0,Gu;if(F&&C){for(;;){let ee=0;for(;ee<C.length&&C.charAt(ee)===h.charAt(ee+g);)ee++;if(ee!==C.length)break;for(g+=ee;g<m&&(_=h.charCodeAt(g++),_!==en);)if(_===ss){h.charCodeAt(g)===en&&++g;break}}if(g>=m)return is}F=!1;var Y,j=g,_;if(h.charCodeAt(j)===Ko){for(;g++<m&&h.charCodeAt(g)!==Ko||h.charCodeAt(++g)===Ko;);return(Y=g)>=m?A=!0:(_=h.charCodeAt(g++))===en?E=!0:_===ss&&(E=!0,h.charCodeAt(g)===en&&++g),h.slice(j+1,Y-1).replace(/""/g,'"')}for(;g<m;){if((_=h.charCodeAt(Y=g++))===en)E=!0;else if(_===ss)E=!0,h.charCodeAt(g)===en&&++g;else if(_!==r)continue;return h.slice(j,Y)}return A=!0,h.slice(j,m)}for(;(b=w())!==is;){for(var L=[];b!==Gu&&b!==is;)L.push(b),b=w();p&&(L=p(L,x++))==null||d.push(L)}return d}function o(h,p){return h.map(function(d){return p.map(function(m){return l(d[m])}).join(t)})}function a(h,p){return p==null&&(p=Hu(h)),[p.map(l).join(t)].concat(o(h,p)).join(`
`)}function c(h,p){return p==null&&(p=Hu(h)),o(h,p).join(`
`)}function u(h){return h.map(f).join(`
`)}function f(h){return h.map(l).join(t)}function l(h){return h==null?"":h instanceof Date?jp(h):n.test(h+="")?'"'+h.replace(/"/g,'""')+'"':h}return{parse:i,parseRows:s,format:a,formatBody:c,formatRows:u,formatRow:f,formatValue:l}}var Yp=zf("	"),Xp=Yp.parseRows;function Ut(t,e,n){return t.fields=e||[],t.fname=n,t}function Kp(t){return t==null?null:t.fname}function Uf(t){return t==null?null:t.fields}function Jp(t){return t.length===1?Zp(t[0]):Qp(t)}const Zp=t=>function(e){return e[t]},Qp=t=>{const e=t.length;return function(n){for(let r=0;r<e;++r)n=n[t[r]];return n}};function W(t){throw Error(t)}function em(t){const e=[],n=t.length;let r=null,i=0,s="",o,a,c;t=t+"";function u(){e.push(s+t.substring(o,a)),s="",o=a+1}for(o=a=0;a<n;++a)if(c=t[a],c==="\\")s+=t.substring(o,a++),o=a;else if(c===r)u(),r=null,i=-1;else{if(r)continue;o===i&&c==='"'||o===i&&c==="'"?(o=a+1,r=c):c==="."&&!i?a>o?u():o=a+1:c==="["?(a>o&&u(),i=o=a+1):c==="]"&&(i||W("Access path missing open bracket: "+t),i>0&&u(),i=0,o=a+1)}return i&&W("Access path missing closing bracket: "+t),r&&W("Access path missing closing quote: "+t),a>o&&(a++,u()),e}function io(t,e,n){const r=em(t);return t=r.length===1?r[0]:t,Ut((n&&n.get||Jp)(r),[t],e||t)}io("id");const so=Ut(t=>t,[],"identity");Ut(()=>0,[],"zero");Ut(()=>1,[],"one");Ut(()=>!0,[],"true");Ut(()=>!1,[],"false");var Me=Array.isArray;function Re(t){return t===Object(t)}function Ye(t){return t[t.length-1]}function jr(t){return t==null||t===""?null:+t}const $f=t=>e=>t*Math.exp(e),Vf=t=>e=>Math.log(t*e),tm=t=>e=>Math.sign(e)*Math.log1p(Math.abs(e/t)),nm=t=>e=>Math.sign(e)*Math.expm1(Math.abs(e))*t,Fs=t=>e=>e<0?-Math.pow(-e,t):Math.pow(e,t);function Tc(t,e,n,r){const i=n(t[0]),s=n(Ye(t)),o=(s-i)*e;return[r(i-o),r(s-o)]}function rm(t,e){return Tc(t,e,jr,so)}function im(t,e){var n=Math.sign(t[0]);return Tc(t,e,Vf(n),$f(n))}function sm(t,e,n){return Tc(t,e,Fs(n),Fs(1/n))}function oo(t,e,n,r,i){const s=r(t[0]),o=r(Ye(t)),a=e!=null?r(e):(s+o)/2;return[i(a+(s-a)*n),i(a+(o-a)*n)]}function Gf(t,e,n){return oo(t,e,n,jr,so)}function Hf(t,e,n){const r=Math.sign(t[0]);return oo(t,e,n,Vf(r),$f(r))}function Da(t,e,n,r){return oo(t,e,n,Fs(r),Fs(1/r))}function om(t,e,n,r){return oo(t,e,n,tm(r),nm(r))}function Ia(t){return t!=null?Me(t)?t:[t]:[]}function am(t,e,n){let r=t[0],i=t[1],s;return i<r&&(s=i,i=r,r=s),s=i-r,s>=n-e?[e,n]:[r=Math.min(Math.max(r,e),n-s),r+s]}function Ie(t){return typeof t=="function"}const cm="descending";function qf(t,e,n){n=n||{},e=Ia(e)||[];const r=[],i=[],s={},o=n.comparator||um;return Ia(t).forEach((a,c)=>{a!=null&&(r.push(e[c]===cm?-1:1),i.push(a=Ie(a)?a:io(a,null,n)),(Uf(a)||[]).forEach(u=>s[u]=1))}),i.length===0?null:Ut(o(i,r),Object.keys(s))}const Wf=(t,e)=>(t<e||t==null)&&e!=null?-1:(t>e||e==null)&&t!=null?1:(e=e instanceof Date?+e:e,(t=t instanceof Date?+t:t)!==t&&e===e?-1:e!==e&&t===t?1:0),um=(t,e)=>t.length===1?lm(t[0],e[0]):fm(t,e,t.length),lm=(t,e)=>function(n,r){return Wf(t(n),t(r))*e},fm=(t,e,n)=>(e.push(0),function(r,i){let s,o=0,a=-1;for(;o===0&&++a<n;)s=t[a],o=Wf(s(r),s(i));return o*e[a]});function hm(t){return Ie(t)?t:()=>t}function Dc(t){for(let e,n,r=1,i=arguments.length;r<i;++r){e=arguments[r];for(n in e)t[n]=e[n]}return t}const dm=Object.prototype.hasOwnProperty;function qn(t,e){return dm.call(t,e)}function _i(t){return typeof t=="boolean"}function pm(t){return Object.prototype.toString.call(t)==="[object Date]"}function mm(t){return t&&Ie(t[Symbol.iterator])}function be(t){return typeof t=="number"}function gm(t){return Object.prototype.toString.call(t)==="[object RegExp]"}function V(t){return typeof t=="string"}function jf(t,e){const n=t[0],r=Ye(t),i=+e;return i?i===1?r:n+i*(r-n):n}function Ts(t){return t&&Ye(t)-t[0]||0}function ao(t){return Me(t)?"["+t.map(ao)+"]":Re(t)||V(t)?JSON.stringify(t).replace("\u2028","\\u2028").replace("\u2029","\\u2029"):t}function xm(t){return t==null||t===""?null:!t||t==="false"||t==="0"?!1:!!t}const ym=t=>be(t)||pm(t)?t:Date.parse(t);function bm(t,e){return e=e||ym,t==null||t===""?null:e(t)}function Am(t){return t==null||t===""?null:t+""}function Ds(t){const e={},n=t.length;for(let r=0;r<n;++r)e[t[r]]=!0;return e}var qu={},Jo={},Zo=34,Fr=10,Qo=13;function Yf(t){return new Function("d","return {"+t.map(function(e,n){return JSON.stringify(e)+": d["+n+'] || ""'}).join(",")+"}")}function wm(t,e){var n=Yf(t);return function(r,i){return e(n(r),i,t)}}function Wu(t){var e=Object.create(null),n=[];return t.forEach(function(r){for(var i in r)i in e||n.push(e[i]=i)}),n}function Ce(t,e){var n=t+"",r=n.length;return r<e?new Array(e-r+1).join(0)+n:n}function vm(t){return t<0?"-"+Ce(-t,6):t>9999?"+"+Ce(t,6):Ce(t,4)}function Em(t){var e=t.getUTCHours(),n=t.getUTCMinutes(),r=t.getUTCSeconds(),i=t.getUTCMilliseconds();return isNaN(t)?"Invalid Date":vm(t.getUTCFullYear())+"-"+Ce(t.getUTCMonth()+1,2)+"-"+Ce(t.getUTCDate(),2)+(i?"T"+Ce(e,2)+":"+Ce(n,2)+":"+Ce(r,2)+"."+Ce(i,3)+"Z":r?"T"+Ce(e,2)+":"+Ce(n,2)+":"+Ce(r,2)+"Z":n||e?"T"+Ce(e,2)+":"+Ce(n,2)+"Z":"")}function Cm(t){var e=new RegExp('["'+t+`
\r]`),n=t.charCodeAt(0);function r(l,h){var p,d,m=i(l,function(g,x){if(p)return p(g,x-1);d=g,p=h?wm(g,h):Yf(g)});return m.columns=d||[],m}function i(l,h){var p=[],d=l.length,m=0,g=0,x,b=d<=0,A=!1;l.charCodeAt(d-1)===Fr&&--d,l.charCodeAt(d-1)===Qo&&--d;function E(){if(b)return Jo;if(A)return A=!1,qu;var C,w=m,L;if(l.charCodeAt(w)===Zo){for(;m++<d&&l.charCodeAt(m)!==Zo||l.charCodeAt(++m)===Zo;);return(C=m)>=d?b=!0:(L=l.charCodeAt(m++))===Fr?A=!0:L===Qo&&(A=!0,l.charCodeAt(m)===Fr&&++m),l.slice(w+1,C-1).replace(/""/g,'"')}for(;m<d;){if((L=l.charCodeAt(C=m++))===Fr)A=!0;else if(L===Qo)A=!0,l.charCodeAt(m)===Fr&&++m;else if(L!==n)continue;return l.slice(w,C)}return b=!0,l.slice(w,d)}for(;(x=E())!==Jo;){for(var F=[];x!==qu&&x!==Jo;)F.push(x),x=E();h&&(F=h(F,g++))==null||p.push(F)}return p}function s(l,h){return l.map(function(p){return h.map(function(d){return f(p[d])}).join(t)})}function o(l,h){return h==null&&(h=Wu(l)),[h.map(f).join(t)].concat(s(l,h)).join(`
`)}function a(l,h){return h==null&&(h=Wu(l)),s(l,h).join(`
`)}function c(l){return l.map(u).join(`
`)}function u(l){return l.map(f).join(t)}function f(l){return l==null?"":l instanceof Date?Em(l):e.test(l+="")?'"'+l.replace(/"/g,'""')+'"':l}return{parse:r,parseRows:i,format:o,formatBody:a,formatRows:c,formatRow:u,formatValue:f}}function Sm(t){return t}function Fm(t){if(t==null)return Sm;var e,n,r=t.scale[0],i=t.scale[1],s=t.translate[0],o=t.translate[1];return function(a,c){c||(e=n=0);var u=2,f=a.length,l=new Array(f);for(l[0]=(e+=a[0])*r+s,l[1]=(n+=a[1])*i+o;u<f;)l[u]=a[u],++u;return l}}function Tm(t,e){for(var n,r=t.length,i=r-e;i<--r;)n=t[i],t[i++]=t[r],t[r]=n}function Dm(t,e){return typeof e=="string"&&(e=t.objects[e]),e.type==="GeometryCollection"?{type:"FeatureCollection",features:e.geometries.map(function(n){return ju(t,n)})}:ju(t,e)}function ju(t,e){var n=e.id,r=e.bbox,i=e.properties==null?{}:e.properties,s=Xf(t,e);return n==null&&r==null?{type:"Feature",properties:i,geometry:s}:r==null?{type:"Feature",id:n,properties:i,geometry:s}:{type:"Feature",id:n,bbox:r,properties:i,geometry:s}}function Xf(t,e){var n=Fm(t.transform),r=t.arcs;function i(f,l){l.length&&l.pop();for(var h=r[f<0?~f:f],p=0,d=h.length;p<d;++p)l.push(n(h[p],p));f<0&&Tm(l,d)}function s(f){return n(f)}function o(f){for(var l=[],h=0,p=f.length;h<p;++h)i(f[h],l);return l.length<2&&l.push(l[0]),l}function a(f){for(var l=o(f);l.length<4;)l.push(l[0]);return l}function c(f){return f.map(a)}function u(f){var l=f.type,h;switch(l){case"GeometryCollection":return{type:l,geometries:f.geometries.map(u)};case"Point":h=s(f.coordinates);break;case"MultiPoint":h=f.coordinates.map(s);break;case"LineString":h=o(f.arcs);break;case"MultiLineString":h=f.arcs.map(o);break;case"Polygon":h=c(f.arcs);break;case"MultiPolygon":h=f.arcs.map(c);break;default:return null}return{type:l,coordinates:h}}return u(e)}function Im(t,e){var n={},r={},i={},s=[],o=-1;e.forEach(function(u,f){var l=t.arcs[u<0?~u:u],h;l.length<3&&!l[1][0]&&!l[1][1]&&(h=e[++o],e[o]=u,e[f]=h)}),e.forEach(function(u){var f=a(u),l=f[0],h=f[1],p,d;if(p=i[l])if(delete i[p.end],p.push(u),p.end=h,d=r[h]){delete r[d.start];var m=d===p?p:p.concat(d);r[m.start=p.start]=i[m.end=d.end]=m}else r[p.start]=i[p.end]=p;else if(p=r[h])if(delete r[p.start],p.unshift(u),p.start=l,d=i[l]){delete i[d.end];var g=d===p?p:d.concat(p);r[g.start=d.start]=i[g.end=p.end]=g}else r[p.start]=i[p.end]=p;else p=[u],r[p.start=l]=i[p.end=h]=p});function a(u){var f=t.arcs[u<0?~u:u],l=f[0],h;return t.transform?(h=[0,0],f.forEach(function(p){h[0]+=p[0],h[1]+=p[1]})):h=f[f.length-1],u<0?[h,l]:[l,h]}function c(u,f){for(var l in u){var h=u[l];delete f[h.start],delete h.start,delete h.end,h.forEach(function(p){n[p<0?~p:p]=1}),s.push(h)}}return c(i,r),c(r,i),e.forEach(function(u){n[u<0?~u:u]||s.push([u])}),s}function _m(t){return Xf(t,Rm.apply(this,arguments))}function Rm(t,e,n){var r,i,s;if(arguments.length>1)r=Mm(t,e,n);else for(i=0,r=new Array(s=t.arcs.length);i<s;++i)r[i]=i;return{type:"MultiLineString",arcs:Im(t,r)}}function Mm(t,e,n){var r=[],i=[],s;function o(l){var h=l<0?~l:l;(i[h]||(i[h]=[])).push({i:l,g:s})}function a(l){l.forEach(o)}function c(l){l.forEach(a)}function u(l){l.forEach(c)}function f(l){switch(s=l,l.type){case"GeometryCollection":l.geometries.forEach(f);break;case"LineString":a(l.arcs);break;case"MultiLineString":case"Polygon":c(l.arcs);break;case"MultiPolygon":u(l.arcs);break}}return f(e),i.forEach(n==null?function(l){r.push(l[0].i)}:function(l){n(l[0].g,l[l.length-1].g)&&r.push(l[0].i)}),r}function Lr(t,e){return t==null||e==null?NaN:t<e?-1:t>e?1:t>=e?0:NaN}function Bm(t,e){return t==null||e==null?NaN:e<t?-1:e>t?1:e>=t?0:NaN}function co(t){let e,n,r;t.length!==2?(e=Lr,n=(a,c)=>Lr(t(a),c),r=(a,c)=>t(a)-c):(e=t===Lr||t===Bm?t:km,n=t,r=t);function i(a,c,u=0,f=a.length){if(u<f){if(e(c,c)!==0)return f;do{const l=u+f>>>1;n(a[l],c)<0?u=l+1:f=l}while(u<f)}return u}function s(a,c,u=0,f=a.length){if(u<f){if(e(c,c)!==0)return f;do{const l=u+f>>>1;n(a[l],c)<=0?u=l+1:f=l}while(u<f)}return u}function o(a,c,u=0,f=a.length){const l=i(a,c,u,f-1);return l>u&&r(a[l-1],c)>-r(a[l],c)?l-1:l}return{left:i,center:o,right:s}}function km(){return 0}function Kf(t){return t===null?NaN:+t}const Jf=co(Lr),_a=Jf.right;Jf.left;co(Kf).center;const gr=_a;function Om(t,e){let n,r;if(e===void 0)for(const i of t)i!=null&&(n===void 0?i>=i&&(n=r=i):(n>i&&(n=i),r<i&&(r=i)));else{let i=-1;for(let s of t)(s=e(s,++i,t))!=null&&(n===void 0?s>=s&&(n=r=s):(n>s&&(n=s),r<s&&(r=s)))}return[n,r]}class Sn extends Map{constructor(e,n=Nm){if(super(),Object.defineProperties(this,{_intern:{value:new Map},_key:{value:n}}),e!=null)for(const[r,i]of e)this.set(r,i)}get(e){return super.get(Yu(this,e))}has(e){return super.has(Yu(this,e))}set(e,n){return super.set(Pm(this,e),n)}delete(e){return super.delete(Lm(this,e))}}function Yu({_intern:t,_key:e},n){const r=e(n);return t.has(r)?t.get(r):n}function Pm({_intern:t,_key:e},n){const r=e(n);return t.has(r)?t.get(r):(t.set(r,n),n)}function Lm({_intern:t,_key:e},n){const r=e(n);return t.has(r)&&(n=t.get(r),t.delete(r)),n}function Nm(t){return t!==null&&typeof t=="object"?t.valueOf():t}function Ra(t){return t}function uo(t,...e){return Zf(t,Ra,Ra,e)}function zm(t,...e){return Zf(t,Array.from,Ra,e)}function Zf(t,e,n,r){return function i(s,o){if(o>=r.length)return n(s);const a=new Sn,c=r[o++];let u=-1;for(const f of s){const l=c(f,++u,s),h=a.get(l);h?h.push(f):a.set(l,[f])}for(const[f,l]of a)a.set(f,i(l,o));return e(a)}(t,0)}const Um=Math.sqrt(50),$m=Math.sqrt(10),Vm=Math.sqrt(2);function Is(t,e,n){const r=(e-t)/Math.max(0,n),i=Math.floor(Math.log10(r)),s=r/Math.pow(10,i),o=s>=Um?10:s>=$m?5:s>=Vm?2:1;let a,c,u;return i<0?(u=Math.pow(10,-i)/o,a=Math.round(t*u),c=Math.round(e*u),a/u<t&&++a,c/u>e&&--c,u=-u):(u=Math.pow(10,i)*o,a=Math.round(t/u),c=Math.round(e/u),a*u<t&&++a,c*u>e&&--c),c<a&&.5<=n&&n<2?Is(t,e,n*2):[a,c,u]}function _s(t,e,n){if(e=+e,t=+t,n=+n,!(n>0))return[];if(t===e)return[t];const r=e<t,[i,s,o]=r?Is(e,t,n):Is(t,e,n);if(!(s>=i))return[];const a=s-i+1,c=new Array(a);if(r)if(o<0)for(let u=0;u<a;++u)c[u]=(s-u)/-o;else for(let u=0;u<a;++u)c[u]=(s-u)*o;else if(o<0)for(let u=0;u<a;++u)c[u]=(i+u)/-o;else for(let u=0;u<a;++u)c[u]=(i+u)*o;return c}function Ma(t,e,n){return e=+e,t=+t,n=+n,Is(t,e,n)[2]}function Fn(t,e,n){e=+e,t=+t,n=+n;const r=e<t,i=r?Ma(e,t,n):Ma(t,e,n);return(r?-1:1)*(i<0?1/-i:i)}function Qf(t,e,n=Kf){if(!(!(r=t.length)||isNaN(e=+e))){if(e<=0||r<2)return+n(t[0],0,t);if(e>=1)return+n(t[r-1],r-1,t);var r,i=(r-1)*e,s=Math.floor(i),o=+n(t[s],s,t),a=+n(t[s+1],s+1,t);return o+(a-o)*(i-s)}}function Yr(t,e,n){t=+t,e=+e,n=(i=arguments.length)<2?(e=t,t=0,1):i<3?1:+n;for(var r=-1,i=Math.max(0,Math.ceil((e-t)/n))|0,s=new Array(i);++r<i;)s[r]=t+r*n;return s}function os(t,e){let n=0;if(e===void 0)for(let r of t)(r=+r)&&(n+=r);else{let r=-1;for(let i of t)(i=+e(i,++r,t))&&(n+=i)}return n}function Gm(t){return Math.abs(t=Math.round(t))>=1e21?t.toLocaleString("en").replace(/,/g,""):t.toString(10)}function Rs(t,e){if((n=(t=e?t.toExponential(e-1):t.toExponential()).indexOf("e"))<0)return null;var n,r=t.slice(0,n);return[r.length>1?r[0]+r.slice(2):r,+t.slice(n+1)]}function or(t){return t=Rs(Math.abs(t)),t?t[1]:NaN}function Hm(t,e){return function(n,r){for(var i=n.length,s=[],o=0,a=t[0],c=0;i>0&&a>0&&(c+a+1>r&&(a=Math.max(1,r-c)),s.push(n.substring(i-=a,i+a)),!((c+=a+1)>r));)a=t[o=(o+1)%t.length];return s.reverse().join(e)}}function qm(t){return function(e){return e.replace(/[0-9]/g,function(n){return t[+n]})}}var Wm=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function Mt(t){if(!(e=Wm.exec(t)))throw new Error("invalid format: "+t);var e;return new Ic({fill:e[1],align:e[2],sign:e[3],symbol:e[4],zero:e[5],width:e[6],comma:e[7],precision:e[8]&&e[8].slice(1),trim:e[9],type:e[10]})}Mt.prototype=Ic.prototype;function Ic(t){this.fill=t.fill===void 0?" ":t.fill+"",this.align=t.align===void 0?">":t.align+"",this.sign=t.sign===void 0?"-":t.sign+"",this.symbol=t.symbol===void 0?"":t.symbol+"",this.zero=!!t.zero,this.width=t.width===void 0?void 0:+t.width,this.comma=!!t.comma,this.precision=t.precision===void 0?void 0:+t.precision,this.trim=!!t.trim,this.type=t.type===void 0?"":t.type+""}Ic.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(this.width===void 0?"":Math.max(1,this.width|0))+(this.comma?",":"")+(this.precision===void 0?"":"."+Math.max(0,this.precision|0))+(this.trim?"~":"")+this.type};function jm(t){e:for(var e=t.length,n=1,r=-1,i;n<e;++n)switch(t[n]){case".":r=i=n;break;case"0":r===0&&(r=n),i=n;break;default:if(!+t[n])break e;r>0&&(r=0);break}return r>0?t.slice(0,r)+t.slice(i+1):t}var eh;function Ym(t,e){var n=Rs(t,e);if(!n)return t+"";var r=n[0],i=n[1],s=i-(eh=Math.max(-8,Math.min(8,Math.floor(i/3)))*3)+1,o=r.length;return s===o?r:s>o?r+new Array(s-o+1).join("0"):s>0?r.slice(0,s)+"."+r.slice(s):"0."+new Array(1-s).join("0")+Rs(t,Math.max(0,e+s-1))[0]}function Xu(t,e){var n=Rs(t,e);if(!n)return t+"";var r=n[0],i=n[1];return i<0?"0."+new Array(-i).join("0")+r:r.length>i+1?r.slice(0,i+1)+"."+r.slice(i+1):r+new Array(i-r.length+2).join("0")}const Ku={"%":(t,e)=>(t*100).toFixed(e),b:t=>Math.round(t).toString(2),c:t=>t+"",d:Gm,e:(t,e)=>t.toExponential(e),f:(t,e)=>t.toFixed(e),g:(t,e)=>t.toPrecision(e),o:t=>Math.round(t).toString(8),p:(t,e)=>Xu(t*100,e),r:Xu,s:Ym,X:t=>Math.round(t).toString(16).toUpperCase(),x:t=>Math.round(t).toString(16)};function Ju(t){return t}var Zu=Array.prototype.map,Qu=["y","z","a","f","p","n","µ","m","","k","M","G","T","P","E","Z","Y"];function Xm(t){var e=t.grouping===void 0||t.thousands===void 0?Ju:Hm(Zu.call(t.grouping,Number),t.thousands+""),n=t.currency===void 0?"":t.currency[0]+"",r=t.currency===void 0?"":t.currency[1]+"",i=t.decimal===void 0?".":t.decimal+"",s=t.numerals===void 0?Ju:qm(Zu.call(t.numerals,String)),o=t.percent===void 0?"%":t.percent+"",a=t.minus===void 0?"−":t.minus+"",c=t.nan===void 0?"NaN":t.nan+"";function u(l){l=Mt(l);var h=l.fill,p=l.align,d=l.sign,m=l.symbol,g=l.zero,x=l.width,b=l.comma,A=l.precision,E=l.trim,F=l.type;F==="n"?(b=!0,F="g"):Ku[F]||(A===void 0&&(A=12),E=!0,F="g"),(g||h==="0"&&p==="=")&&(g=!0,h="0",p="=");var C=m==="$"?n:m==="#"&&/[boxX]/.test(F)?"0"+F.toLowerCase():"",w=m==="$"?r:/[%p]/.test(F)?o:"",L=Ku[F],Y=/[defgprs%]/.test(F);A=A===void 0?6:/[gprs]/.test(F)?Math.max(1,Math.min(21,A)):Math.max(0,Math.min(20,A));function j(_){var ee=C,le=w,Ve,Kt,lt;if(F==="c")le=L(_)+le,_="";else{_=+_;var ft=_<0||1/_<0;if(_=isNaN(_)?c:L(Math.abs(_),A),E&&(_=jm(_)),ft&&+_==0&&d!=="+"&&(ft=!1),ee=(ft?d==="("?d:a:d==="-"||d==="("?"":d)+ee,le=(F==="s"?Qu[8+eh/3]:"")+le+(ft&&d==="("?")":""),Y){for(Ve=-1,Kt=_.length;++Ve<Kt;)if(lt=_.charCodeAt(Ve),48>lt||lt>57){le=(lt===46?i+_.slice(Ve+1):_.slice(Ve))+le,_=_.slice(0,Ve);break}}}b&&!g&&(_=e(_,1/0));var Tt=ee.length+_.length+le.length,Be=Tt<x?new Array(x-Tt+1).join(h):"";switch(b&&g&&(_=e(Be+_,Be.length?x-le.length:1/0),Be=""),p){case"<":_=ee+_+le+Be;break;case"=":_=ee+Be+_+le;break;case"^":_=Be.slice(0,Tt=Be.length>>1)+ee+_+le+Be.slice(Tt);break;default:_=Be+ee+_+le;break}return s(_)}return j.toString=function(){return l+""},j}function f(l,h){var p=u((l=Mt(l),l.type="f",l)),d=Math.max(-8,Math.min(8,Math.floor(or(h)/3)))*3,m=Math.pow(10,-d),g=Qu[8+d/3];return function(x){return p(m*x)+g}}return{format:u,formatPrefix:f}}var as,ue,_c;Km({thousands:",",grouping:[3],currency:["$",""]});function Km(t){return as=Xm(t),ue=as.format,_c=as.formatPrefix,as}function th(t){return Math.max(0,-or(Math.abs(t)))}function nh(t,e){return Math.max(0,Math.max(-8,Math.min(8,Math.floor(or(e)/3)))*3-or(Math.abs(t)))}function rh(t,e){return t=Math.abs(t),e=Math.abs(e)-t,Math.max(0,or(e)-or(t))+1}const ea=new Date,ta=new Date;function Z(t,e,n,r){function i(s){return t(s=arguments.length===0?new Date:new Date(+s)),s}return i.floor=s=>(t(s=new Date(+s)),s),i.ceil=s=>(t(s=new Date(s-1)),e(s,1),t(s),s),i.round=s=>{const o=i(s),a=i.ceil(s);return s-o<a-s?o:a},i.offset=(s,o)=>(e(s=new Date(+s),o==null?1:Math.floor(o)),s),i.range=(s,o,a)=>{const c=[];if(s=i.ceil(s),a=a==null?1:Math.floor(a),!(s<o)||!(a>0))return c;let u;do c.push(u=new Date(+s)),e(s,a),t(s);while(u<s&&s<o);return c},i.filter=s=>Z(o=>{if(o>=o)for(;t(o),!s(o);)o.setTime(o-1)},(o,a)=>{if(o>=o)if(a<0)for(;++a<=0;)for(;e(o,-1),!s(o););else for(;--a>=0;)for(;e(o,1),!s(o););}),n&&(i.count=(s,o)=>(ea.setTime(+s),ta.setTime(+o),t(ea),t(ta),Math.floor(n(ea,ta))),i.every=s=>(s=Math.floor(s),!isFinite(s)||!(s>0)?null:s>1?i.filter(r?o=>r(o)%s===0:o=>i.count(0,o)%s===0):i)),i}const ar=Z(()=>{},(t,e)=>{t.setTime(+t+e)},(t,e)=>e-t);ar.every=t=>(t=Math.floor(t),!isFinite(t)||!(t>0)?null:t>1?Z(e=>{e.setTime(Math.floor(e/t)*t)},(e,n)=>{e.setTime(+e+n*t)},(e,n)=>(n-e)/t):ar);ar.range;const yt=1e3,Ue=yt*60,bt=Ue*60,Et=bt*24,Rc=Et*7,el=Et*30,na=Et*365,At=Z(t=>{t.setTime(t-t.getMilliseconds())},(t,e)=>{t.setTime(+t+e*yt)},(t,e)=>(e-t)/yt,t=>t.getUTCSeconds());At.range;const lo=Z(t=>{t.setTime(t-t.getMilliseconds()-t.getSeconds()*yt)},(t,e)=>{t.setTime(+t+e*Ue)},(t,e)=>(e-t)/Ue,t=>t.getMinutes());lo.range;const fo=Z(t=>{t.setUTCSeconds(0,0)},(t,e)=>{t.setTime(+t+e*Ue)},(t,e)=>(e-t)/Ue,t=>t.getUTCMinutes());fo.range;const ho=Z(t=>{t.setTime(t-t.getMilliseconds()-t.getSeconds()*yt-t.getMinutes()*Ue)},(t,e)=>{t.setTime(+t+e*bt)},(t,e)=>(e-t)/bt,t=>t.getHours());ho.range;const po=Z(t=>{t.setUTCMinutes(0,0,0)},(t,e)=>{t.setTime(+t+e*bt)},(t,e)=>(e-t)/bt,t=>t.getUTCHours());po.range;const Rt=Z(t=>t.setHours(0,0,0,0),(t,e)=>t.setDate(t.getDate()+e),(t,e)=>(e-t-(e.getTimezoneOffset()-t.getTimezoneOffset())*Ue)/Et,t=>t.getDate()-1);Rt.range;const xn=Z(t=>{t.setUTCHours(0,0,0,0)},(t,e)=>{t.setUTCDate(t.getUTCDate()+e)},(t,e)=>(e-t)/Et,t=>t.getUTCDate()-1);xn.range;const ih=Z(t=>{t.setUTCHours(0,0,0,0)},(t,e)=>{t.setUTCDate(t.getUTCDate()+e)},(t,e)=>(e-t)/Et,t=>Math.floor(t/Et));ih.range;function Bn(t){return Z(e=>{e.setDate(e.getDate()-(e.getDay()+7-t)%7),e.setHours(0,0,0,0)},(e,n)=>{e.setDate(e.getDate()+n*7)},(e,n)=>(n-e-(n.getTimezoneOffset()-e.getTimezoneOffset())*Ue)/Rc)}const Ri=Bn(0),Ms=Bn(1),Jm=Bn(2),Zm=Bn(3),cr=Bn(4),Qm=Bn(5),eg=Bn(6);Ri.range;Ms.range;Jm.range;Zm.range;cr.range;Qm.range;eg.range;function kn(t){return Z(e=>{e.setUTCDate(e.getUTCDate()-(e.getUTCDay()+7-t)%7),e.setUTCHours(0,0,0,0)},(e,n)=>{e.setUTCDate(e.getUTCDate()+n*7)},(e,n)=>(n-e)/Rc)}const Mi=kn(0),Bs=kn(1),tg=kn(2),ng=kn(3),ur=kn(4),rg=kn(5),ig=kn(6);Mi.range;Bs.range;tg.range;ng.range;ur.range;rg.range;ig.range;const Xr=Z(t=>{t.setDate(1),t.setHours(0,0,0,0)},(t,e)=>{t.setMonth(t.getMonth()+e)},(t,e)=>e.getMonth()-t.getMonth()+(e.getFullYear()-t.getFullYear())*12,t=>t.getMonth());Xr.range;const Kr=Z(t=>{t.setUTCDate(1),t.setUTCHours(0,0,0,0)},(t,e)=>{t.setUTCMonth(t.getUTCMonth()+e)},(t,e)=>e.getUTCMonth()-t.getUTCMonth()+(e.getUTCFullYear()-t.getUTCFullYear())*12,t=>t.getUTCMonth());Kr.range;const st=Z(t=>{t.setMonth(0,1),t.setHours(0,0,0,0)},(t,e)=>{t.setFullYear(t.getFullYear()+e)},(t,e)=>e.getFullYear()-t.getFullYear(),t=>t.getFullYear());st.every=t=>!isFinite(t=Math.floor(t))||!(t>0)?null:Z(e=>{e.setFullYear(Math.floor(e.getFullYear()/t)*t),e.setMonth(0,1),e.setHours(0,0,0,0)},(e,n)=>{e.setFullYear(e.getFullYear()+n*t)});st.range;const ot=Z(t=>{t.setUTCMonth(0,1),t.setUTCHours(0,0,0,0)},(t,e)=>{t.setUTCFullYear(t.getUTCFullYear()+e)},(t,e)=>e.getUTCFullYear()-t.getUTCFullYear(),t=>t.getUTCFullYear());ot.every=t=>!isFinite(t=Math.floor(t))||!(t>0)?null:Z(e=>{e.setUTCFullYear(Math.floor(e.getUTCFullYear()/t)*t),e.setUTCMonth(0,1),e.setUTCHours(0,0,0,0)},(e,n)=>{e.setUTCFullYear(e.getUTCFullYear()+n*t)});ot.range;function sh(t,e,n,r,i,s){const o=[[At,1,yt],[At,5,5*yt],[At,15,15*yt],[At,30,30*yt],[s,1,Ue],[s,5,5*Ue],[s,15,15*Ue],[s,30,30*Ue],[i,1,bt],[i,3,3*bt],[i,6,6*bt],[i,12,12*bt],[r,1,Et],[r,2,2*Et],[n,1,Rc],[e,1,el],[e,3,3*el],[t,1,na]];function a(u,f,l){const h=f<u;h&&([u,f]=[f,u]);const p=l&&typeof l.range=="function"?l:c(u,f,l),d=p?p.range(u,+f+1):[];return h?d.reverse():d}function c(u,f,l){const h=Math.abs(f-u)/l,p=co(([,,g])=>g).right(o,h);if(p===o.length)return t.every(Fn(u/na,f/na,l));if(p===0)return ar.every(Math.max(Fn(u,f,l),1));const[d,m]=o[h/o[p-1][2]<o[p][2]/h?p-1:p];return d.every(m)}return[a,c]}const[sg,og]=sh(ot,Kr,Mi,ih,po,fo),[ag,cg]=sh(st,Xr,Ri,Rt,ho,lo),Jr="year",Zr="quarter",Qr="month",ei="week",ti="date",mo="day",Mc="dayofyear",ni="hours",ri="minutes",ii="seconds",go="milliseconds",ug=[Jr,Zr,Qr,ei,ti,mo,Mc,ni,ri,ii,go];ug.reduce((t,e,n)=>(t[e]=1+n,t),{});const lg={[Jr]:st,[Zr]:Xr.every(3),[Qr]:Xr,[ei]:Ri,[ti]:Rt,[mo]:Rt,[Mc]:Rt,[ni]:ho,[ri]:lo,[ii]:At,[go]:ar},fg={[Jr]:ot,[Zr]:Kr.every(3),[Qr]:Kr,[ei]:Mi,[ti]:xn,[mo]:xn,[Mc]:xn,[ni]:po,[ri]:fo,[ii]:At,[go]:ar};function hg(t){return lg[t]}function dg(t){return fg[t]}function ra(t){if(0<=t.y&&t.y<100){var e=new Date(-1,t.m,t.d,t.H,t.M,t.S,t.L);return e.setFullYear(t.y),e}return new Date(t.y,t.m,t.d,t.H,t.M,t.S,t.L)}function ia(t){if(0<=t.y&&t.y<100){var e=new Date(Date.UTC(-1,t.m,t.d,t.H,t.M,t.S,t.L));return e.setUTCFullYear(t.y),e}return new Date(Date.UTC(t.y,t.m,t.d,t.H,t.M,t.S,t.L))}function Tr(t,e,n){return{y:t,m:e,d:n,H:0,M:0,S:0,L:0}}function oh(t){var e=t.dateTime,n=t.date,r=t.time,i=t.periods,s=t.days,o=t.shortDays,a=t.months,c=t.shortMonths,u=Dr(i),f=Ir(i),l=Dr(s),h=Ir(s),p=Dr(o),d=Ir(o),m=Dr(a),g=Ir(a),x=Dr(c),b=Ir(c),A={a:ft,A:Tt,b:Be,B:ke,c:null,d:ol,e:ol,f:Pg,g:Wg,G:Yg,H:Bg,I:kg,j:Og,L:ah,m:Lg,M:Ng,p:ns,q:Jt,Q:ul,s:ll,S:zg,u:Ug,U:$g,V:Vg,w:Gg,W:Hg,x:null,X:null,y:qg,Y:jg,Z:Xg,"%":cl},E={a:Er,A:rs,b:oe,B:Ze,c:null,d:al,e:al,f:Qg,g:u1,G:f1,H:Kg,I:Jg,j:Zg,L:uh,m:e1,M:t1,p:Ge,q:Cr,Q:ul,s:ll,S:n1,u:r1,U:i1,V:s1,w:o1,W:a1,x:null,X:null,y:c1,Y:l1,Z:h1,"%":cl},F={a:j,A:_,b:ee,B:le,c:Ve,d:il,e:il,f:Ig,g:rl,G:nl,H:sl,I:sl,j:Sg,L:Dg,m:Cg,M:Fg,p:Y,q:Eg,Q:Rg,s:Mg,S:Tg,u:yg,U:bg,V:Ag,w:xg,W:wg,x:Kt,X:lt,y:rl,Y:nl,Z:vg,"%":_g};A.x=C(n,A),A.X=C(r,A),A.c=C(e,A),E.x=C(n,E),E.X=C(r,E),E.c=C(e,E);function C(T,B){return function(k){var v=[],ve=-1,$=0,Oe=T.length,Pe,Zt,ku;for(k instanceof Date||(k=new Date(+k));++ve<Oe;)T.charCodeAt(ve)===37&&(v.push(T.slice($,ve)),(Zt=tl[Pe=T.charAt(++ve)])!=null?Pe=T.charAt(++ve):Zt=Pe==="e"?" ":"0",(ku=B[Pe])&&(Pe=ku(k,Zt)),v.push(Pe),$=ve+1);return v.push(T.slice($,ve)),v.join("")}}function w(T,B){return function(k){var v=Tr(1900,void 0,1),ve=L(v,T,k+="",0),$,Oe;if(ve!=k.length)return null;if("Q"in v)return new Date(v.Q);if("s"in v)return new Date(v.s*1e3+("L"in v?v.L:0));if(B&&!("Z"in v)&&(v.Z=0),"p"in v&&(v.H=v.H%12+v.p*12),v.m===void 0&&(v.m="q"in v?v.q:0),"V"in v){if(v.V<1||v.V>53)return null;"w"in v||(v.w=1),"Z"in v?($=ia(Tr(v.y,0,1)),Oe=$.getUTCDay(),$=Oe>4||Oe===0?Bs.ceil($):Bs($),$=xn.offset($,(v.V-1)*7),v.y=$.getUTCFullYear(),v.m=$.getUTCMonth(),v.d=$.getUTCDate()+(v.w+6)%7):($=ra(Tr(v.y,0,1)),Oe=$.getDay(),$=Oe>4||Oe===0?Ms.ceil($):Ms($),$=Rt.offset($,(v.V-1)*7),v.y=$.getFullYear(),v.m=$.getMonth(),v.d=$.getDate()+(v.w+6)%7)}else("W"in v||"U"in v)&&("w"in v||(v.w="u"in v?v.u%7:"W"in v?1:0),Oe="Z"in v?ia(Tr(v.y,0,1)).getUTCDay():ra(Tr(v.y,0,1)).getDay(),v.m=0,v.d="W"in v?(v.w+6)%7+v.W*7-(Oe+5)%7:v.w+v.U*7-(Oe+6)%7);return"Z"in v?(v.H+=v.Z/100|0,v.M+=v.Z%100,ia(v)):ra(v)}}function L(T,B,k,v){for(var ve=0,$=B.length,Oe=k.length,Pe,Zt;ve<$;){if(v>=Oe)return-1;if(Pe=B.charCodeAt(ve++),Pe===37){if(Pe=B.charAt(ve++),Zt=F[Pe in tl?B.charAt(ve++):Pe],!Zt||(v=Zt(T,k,v))<0)return-1}else if(Pe!=k.charCodeAt(v++))return-1}return v}function Y(T,B,k){var v=u.exec(B.slice(k));return v?(T.p=f.get(v[0].toLowerCase()),k+v[0].length):-1}function j(T,B,k){var v=p.exec(B.slice(k));return v?(T.w=d.get(v[0].toLowerCase()),k+v[0].length):-1}function _(T,B,k){var v=l.exec(B.slice(k));return v?(T.w=h.get(v[0].toLowerCase()),k+v[0].length):-1}function ee(T,B,k){var v=x.exec(B.slice(k));return v?(T.m=b.get(v[0].toLowerCase()),k+v[0].length):-1}function le(T,B,k){var v=m.exec(B.slice(k));return v?(T.m=g.get(v[0].toLowerCase()),k+v[0].length):-1}function Ve(T,B,k){return L(T,e,B,k)}function Kt(T,B,k){return L(T,n,B,k)}function lt(T,B,k){return L(T,r,B,k)}function ft(T){return o[T.getDay()]}function Tt(T){return s[T.getDay()]}function Be(T){return c[T.getMonth()]}function ke(T){return a[T.getMonth()]}function ns(T){return i[+(T.getHours()>=12)]}function Jt(T){return 1+~~(T.getMonth()/3)}function Er(T){return o[T.getUTCDay()]}function rs(T){return s[T.getUTCDay()]}function oe(T){return c[T.getUTCMonth()]}function Ze(T){return a[T.getUTCMonth()]}function Ge(T){return i[+(T.getUTCHours()>=12)]}function Cr(T){return 1+~~(T.getUTCMonth()/3)}return{format:function(T){var B=C(T+="",A);return B.toString=function(){return T},B},parse:function(T){var B=w(T+="",!1);return B.toString=function(){return T},B},utcFormat:function(T){var B=C(T+="",E);return B.toString=function(){return T},B},utcParse:function(T){var B=w(T+="",!0);return B.toString=function(){return T},B}}}var tl={"-":"",_:" ",0:"0"},se=/^\s*\d+/,pg=/^%/,mg=/[\\^$*+?|[\]().{}]/g;function P(t,e,n){var r=t<0?"-":"",i=(r?-t:t)+"",s=i.length;return r+(s<n?new Array(n-s+1).join(e)+i:i)}function gg(t){return t.replace(mg,"\\$&")}function Dr(t){return new RegExp("^(?:"+t.map(gg).join("|")+")","i")}function Ir(t){return new Map(t.map((e,n)=>[e.toLowerCase(),n]))}function xg(t,e,n){var r=se.exec(e.slice(n,n+1));return r?(t.w=+r[0],n+r[0].length):-1}function yg(t,e,n){var r=se.exec(e.slice(n,n+1));return r?(t.u=+r[0],n+r[0].length):-1}function bg(t,e,n){var r=se.exec(e.slice(n,n+2));return r?(t.U=+r[0],n+r[0].length):-1}function Ag(t,e,n){var r=se.exec(e.slice(n,n+2));return r?(t.V=+r[0],n+r[0].length):-1}function wg(t,e,n){var r=se.exec(e.slice(n,n+2));return r?(t.W=+r[0],n+r[0].length):-1}function nl(t,e,n){var r=se.exec(e.slice(n,n+4));return r?(t.y=+r[0],n+r[0].length):-1}function rl(t,e,n){var r=se.exec(e.slice(n,n+2));return r?(t.y=+r[0]+(+r[0]>68?1900:2e3),n+r[0].length):-1}function vg(t,e,n){var r=/^(Z)|([+-]\d\d)(?::?(\d\d))?/.exec(e.slice(n,n+6));return r?(t.Z=r[1]?0:-(r[2]+(r[3]||"00")),n+r[0].length):-1}function Eg(t,e,n){var r=se.exec(e.slice(n,n+1));return r?(t.q=r[0]*3-3,n+r[0].length):-1}function Cg(t,e,n){var r=se.exec(e.slice(n,n+2));return r?(t.m=r[0]-1,n+r[0].length):-1}function il(t,e,n){var r=se.exec(e.slice(n,n+2));return r?(t.d=+r[0],n+r[0].length):-1}function Sg(t,e,n){var r=se.exec(e.slice(n,n+3));return r?(t.m=0,t.d=+r[0],n+r[0].length):-1}function sl(t,e,n){var r=se.exec(e.slice(n,n+2));return r?(t.H=+r[0],n+r[0].length):-1}function Fg(t,e,n){var r=se.exec(e.slice(n,n+2));return r?(t.M=+r[0],n+r[0].length):-1}function Tg(t,e,n){var r=se.exec(e.slice(n,n+2));return r?(t.S=+r[0],n+r[0].length):-1}function Dg(t,e,n){var r=se.exec(e.slice(n,n+3));return r?(t.L=+r[0],n+r[0].length):-1}function Ig(t,e,n){var r=se.exec(e.slice(n,n+6));return r?(t.L=Math.floor(r[0]/1e3),n+r[0].length):-1}function _g(t,e,n){var r=pg.exec(e.slice(n,n+1));return r?n+r[0].length:-1}function Rg(t,e,n){var r=se.exec(e.slice(n));return r?(t.Q=+r[0],n+r[0].length):-1}function Mg(t,e,n){var r=se.exec(e.slice(n));return r?(t.s=+r[0],n+r[0].length):-1}function ol(t,e){return P(t.getDate(),e,2)}function Bg(t,e){return P(t.getHours(),e,2)}function kg(t,e){return P(t.getHours()%12||12,e,2)}function Og(t,e){return P(1+Rt.count(st(t),t),e,3)}function ah(t,e){return P(t.getMilliseconds(),e,3)}function Pg(t,e){return ah(t,e)+"000"}function Lg(t,e){return P(t.getMonth()+1,e,2)}function Ng(t,e){return P(t.getMinutes(),e,2)}function zg(t,e){return P(t.getSeconds(),e,2)}function Ug(t){var e=t.getDay();return e===0?7:e}function $g(t,e){return P(Ri.count(st(t)-1,t),e,2)}function ch(t){var e=t.getDay();return e>=4||e===0?cr(t):cr.ceil(t)}function Vg(t,e){return t=ch(t),P(cr.count(st(t),t)+(st(t).getDay()===4),e,2)}function Gg(t){return t.getDay()}function Hg(t,e){return P(Ms.count(st(t)-1,t),e,2)}function qg(t,e){return P(t.getFullYear()%100,e,2)}function Wg(t,e){return t=ch(t),P(t.getFullYear()%100,e,2)}function jg(t,e){return P(t.getFullYear()%1e4,e,4)}function Yg(t,e){var n=t.getDay();return t=n>=4||n===0?cr(t):cr.ceil(t),P(t.getFullYear()%1e4,e,4)}function Xg(t){var e=t.getTimezoneOffset();return(e>0?"-":(e*=-1,"+"))+P(e/60|0,"0",2)+P(e%60,"0",2)}function al(t,e){return P(t.getUTCDate(),e,2)}function Kg(t,e){return P(t.getUTCHours(),e,2)}function Jg(t,e){return P(t.getUTCHours()%12||12,e,2)}function Zg(t,e){return P(1+xn.count(ot(t),t),e,3)}function uh(t,e){return P(t.getUTCMilliseconds(),e,3)}function Qg(t,e){return uh(t,e)+"000"}function e1(t,e){return P(t.getUTCMonth()+1,e,2)}function t1(t,e){return P(t.getUTCMinutes(),e,2)}function n1(t,e){return P(t.getUTCSeconds(),e,2)}function r1(t){var e=t.getUTCDay();return e===0?7:e}function i1(t,e){return P(Mi.count(ot(t)-1,t),e,2)}function lh(t){var e=t.getUTCDay();return e>=4||e===0?ur(t):ur.ceil(t)}function s1(t,e){return t=lh(t),P(ur.count(ot(t),t)+(ot(t).getUTCDay()===4),e,2)}function o1(t){return t.getUTCDay()}function a1(t,e){return P(Bs.count(ot(t)-1,t),e,2)}function c1(t,e){return P(t.getUTCFullYear()%100,e,2)}function u1(t,e){return t=lh(t),P(t.getUTCFullYear()%100,e,2)}function l1(t,e){return P(t.getUTCFullYear()%1e4,e,4)}function f1(t,e){var n=t.getUTCDay();return t=n>=4||n===0?ur(t):ur.ceil(t),P(t.getUTCFullYear()%1e4,e,4)}function h1(){return"+0000"}function cl(){return"%"}function ul(t){return+t}function ll(t){return Math.floor(+t/1e3)}var Nn,Bc,fh,kc,hh;d1({dateTime:"%x, %X",date:"%-m/%-d/%Y",time:"%-I:%M:%S %p",periods:["AM","PM"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]});function d1(t){return Nn=oh(t),Bc=Nn.format,fh=Nn.parse,kc=Nn.utcFormat,hh=Nn.utcParse,Nn}function Mr(t){const e={};return n=>e[n]||(e[n]=t(n))}function p1(t,e){return n=>{const r=t(n),i=r.indexOf(e);if(i<0)return r;let s=m1(r,i);const o=s<r.length?r.slice(s):"";for(;--s>i;)if(r[s]!=="0"){++s;break}return r.slice(0,s)+o}}function m1(t,e){let n=t.lastIndexOf("e"),r;if(n>0)return n;for(n=t.length;--n>e;)if(r=t.charCodeAt(n),r>=48&&r<=57)return n+1}function g1(t){const e=Mr(t.format),n=t.formatPrefix;return{format:e,formatPrefix:n,formatFloat(r){const i=Mt(r||",");if(i.precision==null){switch(i.precision=12,i.type){case"%":i.precision-=2;break;case"e":i.precision-=1;break}return p1(e(i),e(".1f")(1)[1])}else return e(i)},formatSpan(r,i,s,o){o=Mt(o??",f");const a=Fn(r,i,s),c=Math.max(Math.abs(r),Math.abs(i));let u;if(o.precision==null)switch(o.type){case"s":return isNaN(u=nh(a,c))||(o.precision=u),n(o,c);case"":case"e":case"g":case"p":case"r":{isNaN(u=rh(a,c))||(o.precision=u-(o.type==="e"));break}case"f":case"%":{isNaN(u=th(a))||(o.precision=u-(o.type==="%")*2);break}}return e(o)}}}x1();function x1(){return g1({format:ue,formatPrefix:_c})}function fl(t,e,n){n=n||{},Re(n)||W(`Invalid time multi-format specifier: ${n}`);const r=e(ii),i=e(ri),s=e(ni),o=e(ti),a=e(ei),c=e(Qr),u=e(Zr),f=e(Jr),l=t(n[go]||".%L"),h=t(n[ii]||":%S"),p=t(n[ri]||"%I:%M"),d=t(n[ni]||"%I %p"),m=t(n[ti]||n[mo]||"%a %d"),g=t(n[ei]||"%b %d"),x=t(n[Qr]||"%B"),b=t(n[Zr]||"%B"),A=t(n[Jr]||"%Y");return E=>(r(E)<E?l:i(E)<E?h:s(E)<E?p:o(E)<E?d:c(E)<E?a(E)<E?m:g:f(E)<E?u(E)<E?x:b:A)(E)}function dh(t){const e=Mr(t.format),n=Mr(t.utcFormat);return{timeFormat:r=>V(r)?e(r):fl(e,hg,r),utcFormat:r=>V(r)?n(r):fl(n,dg,r),timeParse:Mr(t.parse),utcParse:Mr(t.utcParse)}}let Ba;y1();function y1(){return Ba=dh({format:Bc,parse:fh,utcFormat:kc,utcParse:hh})}function b1(t){return dh(oh(t))}function A1(t){return arguments.length?Ba=b1(t):Ba}const w1=/^(data:|([A-Za-z]+:)?\/\/)/,v1=/^(?:(?:(?:f|ht)tps?|mailto|tel|callto|cid|xmpp|file|data):|[^a-z]|[a-z+.\-]+(?:[^a-z+.\-:]|$))/i,E1=/[\u0000-\u0020\u00A0\u1680\u180E\u2000-\u2029\u205f\u3000]/g,hl="file://";function C1(t,e){return n=>({options:n||{},sanitize:F1,load:S1,fileAccess:!!e,file:T1(e),http:I1(t)})}async function S1(t,e){const n=await this.sanitize(t,e),r=n.href;return n.localFile?this.file(r):this.http(r,e)}async function F1(t,e){e=Dc({},this.options,e);const n=this.fileAccess,r={href:null};let i,s,o;const a=v1.test(t.replace(E1,""));(t==null||typeof t!="string"||!a)&&W("Sanitize failure, invalid URI: "+ao(t));const c=w1.test(t);return(o=e.baseURL)&&!c&&(!t.startsWith("/")&&!o.endsWith("/")&&(t="/"+t),t=o+t),s=(i=t.startsWith(hl))||e.mode==="file"||e.mode!=="http"&&!c&&n,i?t=t.slice(hl.length):t.startsWith("//")&&(e.defaultProtocol==="file"?(t=t.slice(2),s=!0):t=(e.defaultProtocol||"http")+":"+t),Object.defineProperty(r,"localFile",{value:!!s}),r.href=t,e.target&&(r.target=e.target+""),e.rel&&(r.rel=e.rel+""),e.context==="image"&&e.crossOrigin&&(r.crossOrigin=e.crossOrigin+""),r}function T1(t){return t?e=>new Promise((n,r)=>{t.readFile(e,(i,s)=>{i?r(i):n(s)})}):D1}async function D1(){W("No file system access.")}function I1(t){return t?async function(e,n){const r=Dc({},this.options.http,n),i=n&&n.response,s=await t(e,r);return s.ok?Ie(s[i])?s[i]():s.text():W(s.status+""+s.statusText)}:_1}async function _1(){W("No HTTP fetch method available.")}const R1=t=>t!=null&&t===t,M1=t=>t==="true"||t==="false"||t===!0||t===!1,B1=t=>!Number.isNaN(Date.parse(t)),ph=t=>!Number.isNaN(+t)&&!(t instanceof Date),k1=t=>ph(t)&&Number.isInteger(+t),dl={boolean:xm,integer:jr,number:jr,date:bm,string:Am,unknown:so},cs=[M1,k1,ph,B1],O1=["boolean","integer","number","date"];function P1(t,e){if(!t||!t.length)return"unknown";const n=t.length,r=cs.length,i=cs.map((s,o)=>o+1);for(let s=0,o=0,a,c;s<n;++s)for(c=e?t[s][e]:t[s],a=0;a<r;++a)if(i[a]&&R1(c)&&!cs[a](c)&&(i[a]=0,++o,o===cs.length))return"string";return O1[i.reduce((s,o)=>s===0?o:s,0)-1]}function L1(t,e){return e.reduce((n,r)=>(n[r]=P1(t,r),n),{})}function pl(t){const e=function(n,r){const i={delimiter:t};return Oc(n,r?Dc(r,i):i)};return e.responseType="text",e}function Oc(t,e){return e.header&&(t=e.header.map(ao).join(e.delimiter)+`
`+t),Cm(e.delimiter).parse(t+"")}Oc.responseType="text";function N1(t){return typeof Buffer=="function"&&Ie(Buffer.isBuffer)?Buffer.isBuffer(t):!1}function Pc(t,e){const n=e&&e.property?io(e.property):so;return Re(t)&&!N1(t)?z1(n(t),e):n(JSON.parse(t))}Pc.responseType="json";function z1(t,e){return!Me(t)&&mm(t)&&(t=[...t]),e&&e.copy?JSON.parse(JSON.stringify(t)):t}const U1={interior:(t,e)=>t!==e,exterior:(t,e)=>t===e};function mh(t,e){let n,r,i,s;return t=Pc(t,e),e&&e.feature?(n=Dm,i=e.feature):e&&e.mesh?(n=_m,i=e.mesh,s=U1[e.filter]):W("Missing TopoJSON feature or mesh parameter."),r=(r=t.objects[i])?n(t,r,s):W("Invalid TopoJSON object: "+i),r&&r.features||[r]}mh.responseType="json";const sa={dsv:Oc,csv:pl(","),tsv:pl("	"),json:Pc,topojson:mh};function gh(t,e){return arguments.length>1?(sa[t]=e,this):qn(sa,t)?sa[t]:null}function xh(t,e,n,r){e=e||{};const i=gh(e.type||"json");return i||W("Unknown data format type: "+e.type),t=i(t,e),e.parse&&$1(t,e.parse,n,r),qn(t,"columns")&&delete t.columns,t}function $1(t,e,n,r){if(!t.length)return;const i=A1();n=n||i.timeParse,r=r||i.utcParse;let s=t.columns||Object.keys(t[0]),o,a,c,u,f,l;e==="auto"&&(e=L1(t,s)),s=Object.keys(e);const h=s.map(p=>{const d=e[p];let m,g;if(d&&(d.startsWith("date:")||d.startsWith("utc:")))return m=d.split(/:(.+)?/,2),g=m[1],(g[0]==="'"&&g[g.length-1]==="'"||g[0]==='"'&&g[g.length-1]==='"')&&(g=g.slice(1,-1)),(m[0]==="utc"?r:n)(g);if(!dl[d])throw Error("Illegal format pattern: "+p+":"+d);return dl[d]});for(c=0,f=t.length,l=s.length;c<f;++c)for(o=t[c],u=0;u<l;++u)a=s[u],o[a]=h[u](o[a])}const xo=C1(typeof fetch<"u"&&fetch,null),V1=`.genome-spy {
  font-family: system-ui, "Segoe UI", Roboto, Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol";
  position: relative;
}
.genome-spy canvas {
  transform: scale(1, 1);
  opacity: 1;
  transition: transform 0.6s, opacity 0.6s;
}
.genome-spy .loading-message {
  position: absolute;
  top: 0;
  bottom: 0;
  left: 0;
  right: 0;
  display: flex;
  align-items: center;
  justify-content: center;
}
.genome-spy .loading-message .message {
  color: #666;
  opacity: 0;
  transition: opacity 0.7s;
}
.genome-spy.loading canvas {
  transform: scale(0.95, 0.95);
  opacity: 0;
}
.genome-spy.loading .loading-message .message {
  opacity: 1;
}
.genome-spy.loading .ellipsis {
  animation: blinker 1s linear infinite;
}
@keyframes blinker {
  50% {
    opacity: 0;
  }
}
.genome-spy .tooltip {
  position: absolute;
  max-width: 450px;
  overflow: hidden;
  background: #f6f6f6;
  padding: 10px;
  font-size: 13px;
  box-shadow: 0px 3px 15px 0px rgba(0, 0, 0, 0.21);
  pointer-events: none;
  z-index: 100;
}
.genome-spy .tooltip > :last-child {
  margin-bottom: 0;
}
.genome-spy .tooltip > .title {
  padding-bottom: 5px;
  margin-bottom: 5px;
  border-bottom: 1px dashed #b6b6b6;
}
.genome-spy .tooltip .summary {
  font-size: 12px;
}
.genome-spy .tooltip table {
  border-collapse: collapse;
}
.genome-spy .tooltip table:first-child {
  margin-top: 0;
}
.genome-spy .tooltip table th,
.genome-spy .tooltip table td {
  padding: 2px 0.4em;
  vertical-align: top;
}
.genome-spy .tooltip table th:first-child,
.genome-spy .tooltip table td:first-child {
  padding-left: 0;
}
.genome-spy .tooltip table th {
  text-align: left;
  font-weight: bold;
}
.genome-spy .tooltip .color-legend {
  display: inline-block;
  width: 0.8em;
  height: 0.8em;
  margin-left: 0.4em;
  box-shadow: 0px 0px 3px 1px white;
}
.genome-spy .tooltip .attributes .hovered {
  background-color: #e0e0e0;
}
.genome-spy .tooltip .na {
  color: #aaa;
  font-style: italic;
  font-size: 80%;
}
.genome-spy .gene-track-tooltip .summary {
  font-size: 90%;
}
.genome-spy .message-box {
  display: flex;
  align-items: center;
  justify-content: center;
  position: absolute;
  top: 0;
  height: 100%;
  width: 100%;
}
.genome-spy .message-box > div {
  border: 1px solid red;
  padding: 10px;
  background: #fff0f0;
}`;function G1(t,e){var n=t.getBoundingClientRect();return[e.clientX-n.left-t.clientLeft,e.clientY-n.top-t.clientTop]}function ks(t,e){return t.length==e.length&&t.every((n,r)=>t[r]===e[r])}function ze(t){return Array.isArray(t)?t:typeof t<"u"?[t]:[]}function Bi(t){return t[t.length-1]}class H1{constructor(e){this.container=e,this.element=document.createElement("div"),this.element.className="tooltip",this._visible=!0,this.container.appendChild(this.element),this._previousTooltipDatum=void 0,this.enabledStack=[!0],this._penaltyUntil=0,this._lastCoords=void 0,this._previousMove=0,this.clear()}set visible(e){e!=this._visible&&(this.element.style.display=e?null:"none",this._visible=e)}get visible(){return this._visible}get enabled(){return Bi(this.enabledStack)??!0}pushEnabledState(e){this.enabledStack.push(e),e||(this.visible=!1)}popEnabledState(){this.enabledStack.pop()}handleMouseMove(e){this.mouseCoords=G1(this.container,e);const n=performance.now();!this.visible&&!this._isPenalty()&&n-this._previousMove>500&&(this._penaltyUntil=n+70),this._lastCoords&&q1(this.mouseCoords,this._lastCoords)>20&&(this._penaltyUntil=n+400),this._lastCoords=this.mouseCoords,this.visible&&this.updatePlacement(),this._previousMove=n}updatePlacement(){const[n,r]=this.mouseCoords;let i=n+20;i>this.container.clientWidth-this.element.offsetWidth&&(i=n-20-this.element.offsetWidth),this.element.style.left=i+"px",this.element.style.top=Math.min(r+20,this.container.clientHeight-this.element.offsetHeight)+"px"}setContent(e){if(!e||!this.enabled||this._isPenalty()){this.visible&&(Ss("",this.element),this.visible=!1),this._previousTooltipDatum=void 0;return}Ss(e,this.element),this.visible=!0,this.updatePlacement()}clear(){this._previousTooltipDatum=void 0,this.setContent(void 0)}updateWithDatum(e,n){e!==this._previousTooltipDatum&&(this._previousTooltipDatum=e,n||(n=r=>Promise.resolve(te`${JSON.stringify(r)}`)),n(e).then(r=>this.setContent(r)).catch(r=>{if(r!=="debounced")throw r}))}_isPenalty(){return this._penaltyUntil&&this._penaltyUntil>performance.now()}}function q1(t,e){let n=0;for(let r=0;r<t.length;r++)n+=(t[r]-e[r])**2;return Math.sqrt(n)}const W1="RawCode",j1="Literal",Y1="Property",X1="Identifier",K1="ArrayExpression",J1="BinaryExpression",Z1="CallExpression",Q1="ConditionalExpression",ex="LogicalExpression",tx="MemberExpression",nx="ObjectExpression",rx="UnaryExpression";function Je(t){this.type=t}Je.prototype.visit=function(t){let e,n,r;if(t(this))return 1;for(e=ix(this),n=0,r=e.length;n<r;++n)if(e[n].visit(t))return 1};function ix(t){switch(t.type){case K1:return t.elements;case J1:case ex:return[t.left,t.right];case Z1:return[t.callee].concat(t.arguments);case Q1:return[t.test,t.consequent,t.alternate];case tx:return[t.object,t.property];case nx:return t.properties;case Y1:return[t.key,t.value];case rx:return[t.argument];case X1:case j1:case W1:default:return[]}}var at,D,y,xe,z,yo=1,ki=2,Tn=3,$t=4,bo=5,On=6,Se=7,Oi=8,sx=9;at={};at[yo]="Boolean";at[ki]="<end>";at[Tn]="Identifier";at[$t]="Keyword";at[bo]="Null";at[On]="Numeric";at[Se]="Punctuator";at[Oi]="String";at[sx]="RegularExpression";var ox="ArrayExpression",ax="BinaryExpression",cx="CallExpression",ux="ConditionalExpression",yh="Identifier",lx="Literal",fx="LogicalExpression",hx="MemberExpression",dx="ObjectExpression",px="Property",mx="UnaryExpression",ne="Unexpected token %0",gx="Unexpected number",xx="Unexpected string",yx="Unexpected identifier",bx="Unexpected reserved word",Ax="Unexpected end of input",ka="Invalid regular expression",oa="Invalid regular expression: missing /",bh="Octal literals are not allowed in strict mode.",wx="Duplicate data property in object literal not allowed in strict mode",ce="ILLEGAL",si="Disabled.",vx=new RegExp("[\\xAA\\xB5\\xBA\\xC0-\\xD6\\xD8-\\xF6\\xF8-\\u02C1\\u02C6-\\u02D1\\u02E0-\\u02E4\\u02EC\\u02EE\\u0370-\\u0374\\u0376\\u0377\\u037A-\\u037D\\u037F\\u0386\\u0388-\\u038A\\u038C\\u038E-\\u03A1\\u03A3-\\u03F5\\u03F7-\\u0481\\u048A-\\u052F\\u0531-\\u0556\\u0559\\u0561-\\u0587\\u05D0-\\u05EA\\u05F0-\\u05F2\\u0620-\\u064A\\u066E\\u066F\\u0671-\\u06D3\\u06D5\\u06E5\\u06E6\\u06EE\\u06EF\\u06FA-\\u06FC\\u06FF\\u0710\\u0712-\\u072F\\u074D-\\u07A5\\u07B1\\u07CA-\\u07EA\\u07F4\\u07F5\\u07FA\\u0800-\\u0815\\u081A\\u0824\\u0828\\u0840-\\u0858\\u08A0-\\u08B2\\u0904-\\u0939\\u093D\\u0950\\u0958-\\u0961\\u0971-\\u0980\\u0985-\\u098C\\u098F\\u0990\\u0993-\\u09A8\\u09AA-\\u09B0\\u09B2\\u09B6-\\u09B9\\u09BD\\u09CE\\u09DC\\u09DD\\u09DF-\\u09E1\\u09F0\\u09F1\\u0A05-\\u0A0A\\u0A0F\\u0A10\\u0A13-\\u0A28\\u0A2A-\\u0A30\\u0A32\\u0A33\\u0A35\\u0A36\\u0A38\\u0A39\\u0A59-\\u0A5C\\u0A5E\\u0A72-\\u0A74\\u0A85-\\u0A8D\\u0A8F-\\u0A91\\u0A93-\\u0AA8\\u0AAA-\\u0AB0\\u0AB2\\u0AB3\\u0AB5-\\u0AB9\\u0ABD\\u0AD0\\u0AE0\\u0AE1\\u0B05-\\u0B0C\\u0B0F\\u0B10\\u0B13-\\u0B28\\u0B2A-\\u0B30\\u0B32\\u0B33\\u0B35-\\u0B39\\u0B3D\\u0B5C\\u0B5D\\u0B5F-\\u0B61\\u0B71\\u0B83\\u0B85-\\u0B8A\\u0B8E-\\u0B90\\u0B92-\\u0B95\\u0B99\\u0B9A\\u0B9C\\u0B9E\\u0B9F\\u0BA3\\u0BA4\\u0BA8-\\u0BAA\\u0BAE-\\u0BB9\\u0BD0\\u0C05-\\u0C0C\\u0C0E-\\u0C10\\u0C12-\\u0C28\\u0C2A-\\u0C39\\u0C3D\\u0C58\\u0C59\\u0C60\\u0C61\\u0C85-\\u0C8C\\u0C8E-\\u0C90\\u0C92-\\u0CA8\\u0CAA-\\u0CB3\\u0CB5-\\u0CB9\\u0CBD\\u0CDE\\u0CE0\\u0CE1\\u0CF1\\u0CF2\\u0D05-\\u0D0C\\u0D0E-\\u0D10\\u0D12-\\u0D3A\\u0D3D\\u0D4E\\u0D60\\u0D61\\u0D7A-\\u0D7F\\u0D85-\\u0D96\\u0D9A-\\u0DB1\\u0DB3-\\u0DBB\\u0DBD\\u0DC0-\\u0DC6\\u0E01-\\u0E30\\u0E32\\u0E33\\u0E40-\\u0E46\\u0E81\\u0E82\\u0E84\\u0E87\\u0E88\\u0E8A\\u0E8D\\u0E94-\\u0E97\\u0E99-\\u0E9F\\u0EA1-\\u0EA3\\u0EA5\\u0EA7\\u0EAA\\u0EAB\\u0EAD-\\u0EB0\\u0EB2\\u0EB3\\u0EBD\\u0EC0-\\u0EC4\\u0EC6\\u0EDC-\\u0EDF\\u0F00\\u0F40-\\u0F47\\u0F49-\\u0F6C\\u0F88-\\u0F8C\\u1000-\\u102A\\u103F\\u1050-\\u1055\\u105A-\\u105D\\u1061\\u1065\\u1066\\u106E-\\u1070\\u1075-\\u1081\\u108E\\u10A0-\\u10C5\\u10C7\\u10CD\\u10D0-\\u10FA\\u10FC-\\u1248\\u124A-\\u124D\\u1250-\\u1256\\u1258\\u125A-\\u125D\\u1260-\\u1288\\u128A-\\u128D\\u1290-\\u12B0\\u12B2-\\u12B5\\u12B8-\\u12BE\\u12C0\\u12C2-\\u12C5\\u12C8-\\u12D6\\u12D8-\\u1310\\u1312-\\u1315\\u1318-\\u135A\\u1380-\\u138F\\u13A0-\\u13F4\\u1401-\\u166C\\u166F-\\u167F\\u1681-\\u169A\\u16A0-\\u16EA\\u16EE-\\u16F8\\u1700-\\u170C\\u170E-\\u1711\\u1720-\\u1731\\u1740-\\u1751\\u1760-\\u176C\\u176E-\\u1770\\u1780-\\u17B3\\u17D7\\u17DC\\u1820-\\u1877\\u1880-\\u18A8\\u18AA\\u18B0-\\u18F5\\u1900-\\u191E\\u1950-\\u196D\\u1970-\\u1974\\u1980-\\u19AB\\u19C1-\\u19C7\\u1A00-\\u1A16\\u1A20-\\u1A54\\u1AA7\\u1B05-\\u1B33\\u1B45-\\u1B4B\\u1B83-\\u1BA0\\u1BAE\\u1BAF\\u1BBA-\\u1BE5\\u1C00-\\u1C23\\u1C4D-\\u1C4F\\u1C5A-\\u1C7D\\u1CE9-\\u1CEC\\u1CEE-\\u1CF1\\u1CF5\\u1CF6\\u1D00-\\u1DBF\\u1E00-\\u1F15\\u1F18-\\u1F1D\\u1F20-\\u1F45\\u1F48-\\u1F4D\\u1F50-\\u1F57\\u1F59\\u1F5B\\u1F5D\\u1F5F-\\u1F7D\\u1F80-\\u1FB4\\u1FB6-\\u1FBC\\u1FBE\\u1FC2-\\u1FC4\\u1FC6-\\u1FCC\\u1FD0-\\u1FD3\\u1FD6-\\u1FDB\\u1FE0-\\u1FEC\\u1FF2-\\u1FF4\\u1FF6-\\u1FFC\\u2071\\u207F\\u2090-\\u209C\\u2102\\u2107\\u210A-\\u2113\\u2115\\u2119-\\u211D\\u2124\\u2126\\u2128\\u212A-\\u212D\\u212F-\\u2139\\u213C-\\u213F\\u2145-\\u2149\\u214E\\u2160-\\u2188\\u2C00-\\u2C2E\\u2C30-\\u2C5E\\u2C60-\\u2CE4\\u2CEB-\\u2CEE\\u2CF2\\u2CF3\\u2D00-\\u2D25\\u2D27\\u2D2D\\u2D30-\\u2D67\\u2D6F\\u2D80-\\u2D96\\u2DA0-\\u2DA6\\u2DA8-\\u2DAE\\u2DB0-\\u2DB6\\u2DB8-\\u2DBE\\u2DC0-\\u2DC6\\u2DC8-\\u2DCE\\u2DD0-\\u2DD6\\u2DD8-\\u2DDE\\u2E2F\\u3005-\\u3007\\u3021-\\u3029\\u3031-\\u3035\\u3038-\\u303C\\u3041-\\u3096\\u309D-\\u309F\\u30A1-\\u30FA\\u30FC-\\u30FF\\u3105-\\u312D\\u3131-\\u318E\\u31A0-\\u31BA\\u31F0-\\u31FF\\u3400-\\u4DB5\\u4E00-\\u9FCC\\uA000-\\uA48C\\uA4D0-\\uA4FD\\uA500-\\uA60C\\uA610-\\uA61F\\uA62A\\uA62B\\uA640-\\uA66E\\uA67F-\\uA69D\\uA6A0-\\uA6EF\\uA717-\\uA71F\\uA722-\\uA788\\uA78B-\\uA78E\\uA790-\\uA7AD\\uA7B0\\uA7B1\\uA7F7-\\uA801\\uA803-\\uA805\\uA807-\\uA80A\\uA80C-\\uA822\\uA840-\\uA873\\uA882-\\uA8B3\\uA8F2-\\uA8F7\\uA8FB\\uA90A-\\uA925\\uA930-\\uA946\\uA960-\\uA97C\\uA984-\\uA9B2\\uA9CF\\uA9E0-\\uA9E4\\uA9E6-\\uA9EF\\uA9FA-\\uA9FE\\uAA00-\\uAA28\\uAA40-\\uAA42\\uAA44-\\uAA4B\\uAA60-\\uAA76\\uAA7A\\uAA7E-\\uAAAF\\uAAB1\\uAAB5\\uAAB6\\uAAB9-\\uAABD\\uAAC0\\uAAC2\\uAADB-\\uAADD\\uAAE0-\\uAAEA\\uAAF2-\\uAAF4\\uAB01-\\uAB06\\uAB09-\\uAB0E\\uAB11-\\uAB16\\uAB20-\\uAB26\\uAB28-\\uAB2E\\uAB30-\\uAB5A\\uAB5C-\\uAB5F\\uAB64\\uAB65\\uABC0-\\uABE2\\uAC00-\\uD7A3\\uD7B0-\\uD7C6\\uD7CB-\\uD7FB\\uF900-\\uFA6D\\uFA70-\\uFAD9\\uFB00-\\uFB06\\uFB13-\\uFB17\\uFB1D\\uFB1F-\\uFB28\\uFB2A-\\uFB36\\uFB38-\\uFB3C\\uFB3E\\uFB40\\uFB41\\uFB43\\uFB44\\uFB46-\\uFBB1\\uFBD3-\\uFD3D\\uFD50-\\uFD8F\\uFD92-\\uFDC7\\uFDF0-\\uFDFB\\uFE70-\\uFE74\\uFE76-\\uFEFC\\uFF21-\\uFF3A\\uFF41-\\uFF5A\\uFF66-\\uFFBE\\uFFC2-\\uFFC7\\uFFCA-\\uFFCF\\uFFD2-\\uFFD7\\uFFDA-\\uFFDC]"),Ex=new RegExp("[\\xAA\\xB5\\xBA\\xC0-\\xD6\\xD8-\\xF6\\xF8-\\u02C1\\u02C6-\\u02D1\\u02E0-\\u02E4\\u02EC\\u02EE\\u0300-\\u0374\\u0376\\u0377\\u037A-\\u037D\\u037F\\u0386\\u0388-\\u038A\\u038C\\u038E-\\u03A1\\u03A3-\\u03F5\\u03F7-\\u0481\\u0483-\\u0487\\u048A-\\u052F\\u0531-\\u0556\\u0559\\u0561-\\u0587\\u0591-\\u05BD\\u05BF\\u05C1\\u05C2\\u05C4\\u05C5\\u05C7\\u05D0-\\u05EA\\u05F0-\\u05F2\\u0610-\\u061A\\u0620-\\u0669\\u066E-\\u06D3\\u06D5-\\u06DC\\u06DF-\\u06E8\\u06EA-\\u06FC\\u06FF\\u0710-\\u074A\\u074D-\\u07B1\\u07C0-\\u07F5\\u07FA\\u0800-\\u082D\\u0840-\\u085B\\u08A0-\\u08B2\\u08E4-\\u0963\\u0966-\\u096F\\u0971-\\u0983\\u0985-\\u098C\\u098F\\u0990\\u0993-\\u09A8\\u09AA-\\u09B0\\u09B2\\u09B6-\\u09B9\\u09BC-\\u09C4\\u09C7\\u09C8\\u09CB-\\u09CE\\u09D7\\u09DC\\u09DD\\u09DF-\\u09E3\\u09E6-\\u09F1\\u0A01-\\u0A03\\u0A05-\\u0A0A\\u0A0F\\u0A10\\u0A13-\\u0A28\\u0A2A-\\u0A30\\u0A32\\u0A33\\u0A35\\u0A36\\u0A38\\u0A39\\u0A3C\\u0A3E-\\u0A42\\u0A47\\u0A48\\u0A4B-\\u0A4D\\u0A51\\u0A59-\\u0A5C\\u0A5E\\u0A66-\\u0A75\\u0A81-\\u0A83\\u0A85-\\u0A8D\\u0A8F-\\u0A91\\u0A93-\\u0AA8\\u0AAA-\\u0AB0\\u0AB2\\u0AB3\\u0AB5-\\u0AB9\\u0ABC-\\u0AC5\\u0AC7-\\u0AC9\\u0ACB-\\u0ACD\\u0AD0\\u0AE0-\\u0AE3\\u0AE6-\\u0AEF\\u0B01-\\u0B03\\u0B05-\\u0B0C\\u0B0F\\u0B10\\u0B13-\\u0B28\\u0B2A-\\u0B30\\u0B32\\u0B33\\u0B35-\\u0B39\\u0B3C-\\u0B44\\u0B47\\u0B48\\u0B4B-\\u0B4D\\u0B56\\u0B57\\u0B5C\\u0B5D\\u0B5F-\\u0B63\\u0B66-\\u0B6F\\u0B71\\u0B82\\u0B83\\u0B85-\\u0B8A\\u0B8E-\\u0B90\\u0B92-\\u0B95\\u0B99\\u0B9A\\u0B9C\\u0B9E\\u0B9F\\u0BA3\\u0BA4\\u0BA8-\\u0BAA\\u0BAE-\\u0BB9\\u0BBE-\\u0BC2\\u0BC6-\\u0BC8\\u0BCA-\\u0BCD\\u0BD0\\u0BD7\\u0BE6-\\u0BEF\\u0C00-\\u0C03\\u0C05-\\u0C0C\\u0C0E-\\u0C10\\u0C12-\\u0C28\\u0C2A-\\u0C39\\u0C3D-\\u0C44\\u0C46-\\u0C48\\u0C4A-\\u0C4D\\u0C55\\u0C56\\u0C58\\u0C59\\u0C60-\\u0C63\\u0C66-\\u0C6F\\u0C81-\\u0C83\\u0C85-\\u0C8C\\u0C8E-\\u0C90\\u0C92-\\u0CA8\\u0CAA-\\u0CB3\\u0CB5-\\u0CB9\\u0CBC-\\u0CC4\\u0CC6-\\u0CC8\\u0CCA-\\u0CCD\\u0CD5\\u0CD6\\u0CDE\\u0CE0-\\u0CE3\\u0CE6-\\u0CEF\\u0CF1\\u0CF2\\u0D01-\\u0D03\\u0D05-\\u0D0C\\u0D0E-\\u0D10\\u0D12-\\u0D3A\\u0D3D-\\u0D44\\u0D46-\\u0D48\\u0D4A-\\u0D4E\\u0D57\\u0D60-\\u0D63\\u0D66-\\u0D6F\\u0D7A-\\u0D7F\\u0D82\\u0D83\\u0D85-\\u0D96\\u0D9A-\\u0DB1\\u0DB3-\\u0DBB\\u0DBD\\u0DC0-\\u0DC6\\u0DCA\\u0DCF-\\u0DD4\\u0DD6\\u0DD8-\\u0DDF\\u0DE6-\\u0DEF\\u0DF2\\u0DF3\\u0E01-\\u0E3A\\u0E40-\\u0E4E\\u0E50-\\u0E59\\u0E81\\u0E82\\u0E84\\u0E87\\u0E88\\u0E8A\\u0E8D\\u0E94-\\u0E97\\u0E99-\\u0E9F\\u0EA1-\\u0EA3\\u0EA5\\u0EA7\\u0EAA\\u0EAB\\u0EAD-\\u0EB9\\u0EBB-\\u0EBD\\u0EC0-\\u0EC4\\u0EC6\\u0EC8-\\u0ECD\\u0ED0-\\u0ED9\\u0EDC-\\u0EDF\\u0F00\\u0F18\\u0F19\\u0F20-\\u0F29\\u0F35\\u0F37\\u0F39\\u0F3E-\\u0F47\\u0F49-\\u0F6C\\u0F71-\\u0F84\\u0F86-\\u0F97\\u0F99-\\u0FBC\\u0FC6\\u1000-\\u1049\\u1050-\\u109D\\u10A0-\\u10C5\\u10C7\\u10CD\\u10D0-\\u10FA\\u10FC-\\u1248\\u124A-\\u124D\\u1250-\\u1256\\u1258\\u125A-\\u125D\\u1260-\\u1288\\u128A-\\u128D\\u1290-\\u12B0\\u12B2-\\u12B5\\u12B8-\\u12BE\\u12C0\\u12C2-\\u12C5\\u12C8-\\u12D6\\u12D8-\\u1310\\u1312-\\u1315\\u1318-\\u135A\\u135D-\\u135F\\u1380-\\u138F\\u13A0-\\u13F4\\u1401-\\u166C\\u166F-\\u167F\\u1681-\\u169A\\u16A0-\\u16EA\\u16EE-\\u16F8\\u1700-\\u170C\\u170E-\\u1714\\u1720-\\u1734\\u1740-\\u1753\\u1760-\\u176C\\u176E-\\u1770\\u1772\\u1773\\u1780-\\u17D3\\u17D7\\u17DC\\u17DD\\u17E0-\\u17E9\\u180B-\\u180D\\u1810-\\u1819\\u1820-\\u1877\\u1880-\\u18AA\\u18B0-\\u18F5\\u1900-\\u191E\\u1920-\\u192B\\u1930-\\u193B\\u1946-\\u196D\\u1970-\\u1974\\u1980-\\u19AB\\u19B0-\\u19C9\\u19D0-\\u19D9\\u1A00-\\u1A1B\\u1A20-\\u1A5E\\u1A60-\\u1A7C\\u1A7F-\\u1A89\\u1A90-\\u1A99\\u1AA7\\u1AB0-\\u1ABD\\u1B00-\\u1B4B\\u1B50-\\u1B59\\u1B6B-\\u1B73\\u1B80-\\u1BF3\\u1C00-\\u1C37\\u1C40-\\u1C49\\u1C4D-\\u1C7D\\u1CD0-\\u1CD2\\u1CD4-\\u1CF6\\u1CF8\\u1CF9\\u1D00-\\u1DF5\\u1DFC-\\u1F15\\u1F18-\\u1F1D\\u1F20-\\u1F45\\u1F48-\\u1F4D\\u1F50-\\u1F57\\u1F59\\u1F5B\\u1F5D\\u1F5F-\\u1F7D\\u1F80-\\u1FB4\\u1FB6-\\u1FBC\\u1FBE\\u1FC2-\\u1FC4\\u1FC6-\\u1FCC\\u1FD0-\\u1FD3\\u1FD6-\\u1FDB\\u1FE0-\\u1FEC\\u1FF2-\\u1FF4\\u1FF6-\\u1FFC\\u200C\\u200D\\u203F\\u2040\\u2054\\u2071\\u207F\\u2090-\\u209C\\u20D0-\\u20DC\\u20E1\\u20E5-\\u20F0\\u2102\\u2107\\u210A-\\u2113\\u2115\\u2119-\\u211D\\u2124\\u2126\\u2128\\u212A-\\u212D\\u212F-\\u2139\\u213C-\\u213F\\u2145-\\u2149\\u214E\\u2160-\\u2188\\u2C00-\\u2C2E\\u2C30-\\u2C5E\\u2C60-\\u2CE4\\u2CEB-\\u2CF3\\u2D00-\\u2D25\\u2D27\\u2D2D\\u2D30-\\u2D67\\u2D6F\\u2D7F-\\u2D96\\u2DA0-\\u2DA6\\u2DA8-\\u2DAE\\u2DB0-\\u2DB6\\u2DB8-\\u2DBE\\u2DC0-\\u2DC6\\u2DC8-\\u2DCE\\u2DD0-\\u2DD6\\u2DD8-\\u2DDE\\u2DE0-\\u2DFF\\u2E2F\\u3005-\\u3007\\u3021-\\u302F\\u3031-\\u3035\\u3038-\\u303C\\u3041-\\u3096\\u3099\\u309A\\u309D-\\u309F\\u30A1-\\u30FA\\u30FC-\\u30FF\\u3105-\\u312D\\u3131-\\u318E\\u31A0-\\u31BA\\u31F0-\\u31FF\\u3400-\\u4DB5\\u4E00-\\u9FCC\\uA000-\\uA48C\\uA4D0-\\uA4FD\\uA500-\\uA60C\\uA610-\\uA62B\\uA640-\\uA66F\\uA674-\\uA67D\\uA67F-\\uA69D\\uA69F-\\uA6F1\\uA717-\\uA71F\\uA722-\\uA788\\uA78B-\\uA78E\\uA790-\\uA7AD\\uA7B0\\uA7B1\\uA7F7-\\uA827\\uA840-\\uA873\\uA880-\\uA8C4\\uA8D0-\\uA8D9\\uA8E0-\\uA8F7\\uA8FB\\uA900-\\uA92D\\uA930-\\uA953\\uA960-\\uA97C\\uA980-\\uA9C0\\uA9CF-\\uA9D9\\uA9E0-\\uA9FE\\uAA00-\\uAA36\\uAA40-\\uAA4D\\uAA50-\\uAA59\\uAA60-\\uAA76\\uAA7A-\\uAAC2\\uAADB-\\uAADD\\uAAE0-\\uAAEF\\uAAF2-\\uAAF6\\uAB01-\\uAB06\\uAB09-\\uAB0E\\uAB11-\\uAB16\\uAB20-\\uAB26\\uAB28-\\uAB2E\\uAB30-\\uAB5A\\uAB5C-\\uAB5F\\uAB64\\uAB65\\uABC0-\\uABEA\\uABEC\\uABED\\uABF0-\\uABF9\\uAC00-\\uD7A3\\uD7B0-\\uD7C6\\uD7CB-\\uD7FB\\uF900-\\uFA6D\\uFA70-\\uFAD9\\uFB00-\\uFB06\\uFB13-\\uFB17\\uFB1D-\\uFB28\\uFB2A-\\uFB36\\uFB38-\\uFB3C\\uFB3E\\uFB40\\uFB41\\uFB43\\uFB44\\uFB46-\\uFBB1\\uFBD3-\\uFD3D\\uFD50-\\uFD8F\\uFD92-\\uFDC7\\uFDF0-\\uFDFB\\uFE00-\\uFE0F\\uFE20-\\uFE2D\\uFE33\\uFE34\\uFE4D-\\uFE4F\\uFE70-\\uFE74\\uFE76-\\uFEFC\\uFF10-\\uFF19\\uFF21-\\uFF3A\\uFF3F\\uFF41-\\uFF5A\\uFF66-\\uFFBE\\uFFC2-\\uFFC7\\uFFCA-\\uFFCF\\uFFD2-\\uFFD7\\uFFDA-\\uFFDC]");function Ao(t,e){if(!t)throw new Error("ASSERT: "+e)}function dt(t){return t>=48&&t<=57}function Lc(t){return"0123456789abcdefABCDEF".indexOf(t)>=0}function Nr(t){return"01234567".indexOf(t)>=0}function Cx(t){return t===32||t===9||t===11||t===12||t===160||t>=5760&&[5760,6158,8192,8193,8194,8195,8196,8197,8198,8199,8200,8201,8202,8239,8287,12288,65279].indexOf(t)>=0}function oi(t){return t===10||t===13||t===8232||t===8233}function Pi(t){return t===36||t===95||t>=65&&t<=90||t>=97&&t<=122||t===92||t>=128&&vx.test(String.fromCharCode(t))}function Os(t){return t===36||t===95||t>=65&&t<=90||t>=97&&t<=122||t>=48&&t<=57||t===92||t>=128&&Ex.test(String.fromCharCode(t))}const Sx={if:1,in:1,do:1,var:1,for:1,new:1,try:1,let:1,this:1,else:1,case:1,void:1,with:1,enum:1,while:1,break:1,catch:1,throw:1,const:1,yield:1,class:1,super:1,return:1,typeof:1,delete:1,switch:1,export:1,import:1,public:1,static:1,default:1,finally:1,extends:1,package:1,private:1,function:1,continue:1,debugger:1,interface:1,protected:1,instanceof:1,implements:1};function Ah(){for(;y<xe;){const t=D.charCodeAt(y);if(Cx(t)||oi(t))++y;else break}}function Oa(t){var e,n,r,i=0;for(n=t==="u"?4:2,e=0;e<n;++e)y<xe&&Lc(D[y])?(r=D[y++],i=i*16+"0123456789abcdef".indexOf(r.toLowerCase())):O({},ne,ce);return String.fromCharCode(i)}function Fx(){var t,e,n,r;for(t=D[y],e=0,t==="}"&&O({},ne,ce);y<xe&&(t=D[y++],!!Lc(t));)e=e*16+"0123456789abcdef".indexOf(t.toLowerCase());return(e>1114111||t!=="}")&&O({},ne,ce),e<=65535?String.fromCharCode(e):(n=(e-65536>>10)+55296,r=(e-65536&1023)+56320,String.fromCharCode(n,r))}function wh(){var t,e;for(t=D.charCodeAt(y++),e=String.fromCharCode(t),t===92&&(D.charCodeAt(y)!==117&&O({},ne,ce),++y,t=Oa("u"),(!t||t==="\\"||!Pi(t.charCodeAt(0)))&&O({},ne,ce),e=t);y<xe&&(t=D.charCodeAt(y),!!Os(t));)++y,e+=String.fromCharCode(t),t===92&&(e=e.substr(0,e.length-1),D.charCodeAt(y)!==117&&O({},ne,ce),++y,t=Oa("u"),(!t||t==="\\"||!Os(t.charCodeAt(0)))&&O({},ne,ce),e+=t);return e}function Tx(){var t,e;for(t=y++;y<xe;){if(e=D.charCodeAt(y),e===92)return y=t,wh();if(Os(e))++y;else break}return D.slice(t,y)}function Dx(){var t,e,n;return t=y,e=D.charCodeAt(y)===92?wh():Tx(),e.length===1?n=Tn:Sx.hasOwnProperty(e)?n=$t:e==="null"?n=bo:e==="true"||e==="false"?n=yo:n=Tn,{type:n,value:e,start:t,end:y}}function aa(){var t=y,e=D.charCodeAt(y),n,r=D[y],i,s,o;switch(e){case 46:case 40:case 41:case 59:case 44:case 123:case 125:case 91:case 93:case 58:case 63:case 126:return++y,{type:Se,value:String.fromCharCode(e),start:t,end:y};default:if(n=D.charCodeAt(y+1),n===61)switch(e){case 43:case 45:case 47:case 60:case 62:case 94:case 124:case 37:case 38:case 42:return y+=2,{type:Se,value:String.fromCharCode(e)+String.fromCharCode(n),start:t,end:y};case 33:case 61:return y+=2,D.charCodeAt(y)===61&&++y,{type:Se,value:D.slice(t,y),start:t,end:y}}}if(o=D.substr(y,4),o===">>>=")return y+=4,{type:Se,value:o,start:t,end:y};if(s=o.substr(0,3),s===">>>"||s==="<<="||s===">>=")return y+=3,{type:Se,value:s,start:t,end:y};if(i=s.substr(0,2),r===i[1]&&"+-<>&|".indexOf(r)>=0||i==="=>")return y+=2,{type:Se,value:i,start:t,end:y};if(i==="//"&&O({},ne,ce),"<>=!+-*%&|^/".indexOf(r)>=0)return++y,{type:Se,value:r,start:t,end:y};O({},ne,ce)}function Ix(t){let e="";for(;y<xe&&Lc(D[y]);)e+=D[y++];return e.length===0&&O({},ne,ce),Pi(D.charCodeAt(y))&&O({},ne,ce),{type:On,value:parseInt("0x"+e,16),start:t,end:y}}function _x(t){let e="0"+D[y++];for(;y<xe&&Nr(D[y]);)e+=D[y++];return(Pi(D.charCodeAt(y))||dt(D.charCodeAt(y)))&&O({},ne,ce),{type:On,value:parseInt(e,8),octal:!0,start:t,end:y}}function ml(){var t,e,n;if(n=D[y],Ao(dt(n.charCodeAt(0))||n===".","Numeric literal must start with a decimal digit or a decimal point"),e=y,t="",n!=="."){if(t=D[y++],n=D[y],t==="0"){if(n==="x"||n==="X")return++y,Ix(e);if(Nr(n))return _x(e);n&&dt(n.charCodeAt(0))&&O({},ne,ce)}for(;dt(D.charCodeAt(y));)t+=D[y++];n=D[y]}if(n==="."){for(t+=D[y++];dt(D.charCodeAt(y));)t+=D[y++];n=D[y]}if(n==="e"||n==="E")if(t+=D[y++],n=D[y],(n==="+"||n==="-")&&(t+=D[y++]),dt(D.charCodeAt(y)))for(;dt(D.charCodeAt(y));)t+=D[y++];else O({},ne,ce);return Pi(D.charCodeAt(y))&&O({},ne,ce),{type:On,value:parseFloat(t),start:e,end:y}}function Rx(){var t="",e,n,r,i,s=!1;for(e=D[y],Ao(e==="'"||e==='"',"String literal must starts with a quote"),n=y,++y;y<xe;)if(r=D[y++],r===e){e="";break}else if(r==="\\")if(r=D[y++],!r||!oi(r.charCodeAt(0)))switch(r){case"u":case"x":D[y]==="{"?(++y,t+=Fx()):t+=Oa(r);break;case"n":t+=`
`;break;case"r":t+="\r";break;case"t":t+="	";break;case"b":t+="\b";break;case"f":t+="\f";break;case"v":t+="\v";break;default:Nr(r)?(i="01234567".indexOf(r),i!==0&&(s=!0),y<xe&&Nr(D[y])&&(s=!0,i=i*8+"01234567".indexOf(D[y++]),"0123".indexOf(r)>=0&&y<xe&&Nr(D[y])&&(i=i*8+"01234567".indexOf(D[y++]))),t+=String.fromCharCode(i)):t+=r;break}else r==="\r"&&D[y]===`
`&&++y;else{if(oi(r.charCodeAt(0)))break;t+=r}return e!==""&&O({},ne,ce),{type:Oi,value:t,octal:s,start:n,end:y}}function Mx(t,e){let n=t;e.indexOf("u")>=0&&(n=n.replace(/\\u\{([0-9a-fA-F]+)\}/g,(r,i)=>{if(parseInt(i,16)<=1114111)return"x";O({},ka)}).replace(/[\uD800-\uDBFF][\uDC00-\uDFFF]/g,"x"));try{new RegExp(n)}catch{O({},ka)}try{return new RegExp(t,e)}catch{return null}}function Bx(){var t,e,n,r,i;for(t=D[y],Ao(t==="/","Regular expression literal must start with a slash"),e=D[y++],n=!1,r=!1;y<xe;)if(t=D[y++],e+=t,t==="\\")t=D[y++],oi(t.charCodeAt(0))&&O({},oa),e+=t;else if(oi(t.charCodeAt(0)))O({},oa);else if(n)t==="]"&&(n=!1);else if(t==="/"){r=!0;break}else t==="["&&(n=!0);return r||O({},oa),i=e.substr(1,e.length-2),{value:i,literal:e}}function kx(){var t,e,n;for(e="",n="";y<xe&&(t=D[y],!!Os(t.charCodeAt(0)));)++y,t==="\\"&&y<xe?O({},ne,ce):(n+=t,e+=t);return n.search(/[^gimuy]/g)>=0&&O({},ka,n),{value:n,literal:e}}function Ox(){var t,e,n,r;return z=null,Ah(),t=y,e=Bx(),n=kx(),r=Mx(e.value,n.value),{literal:e.literal+n.literal,value:r,regex:{pattern:e.value,flags:n.value},start:t,end:y}}function Px(t){return t.type===Tn||t.type===$t||t.type===yo||t.type===bo}function vh(){if(Ah(),y>=xe)return{type:ki,start:y,end:y};const t=D.charCodeAt(y);return Pi(t)?Dx():t===40||t===41||t===59?aa():t===39||t===34?Rx():t===46?dt(D.charCodeAt(y+1))?ml():aa():dt(t)?ml():aa()}function Fe(){const t=z;return y=t.end,z=vh(),y=t.end,t}function Eh(){const t=y;z=vh(),y=t}function Lx(t){const e=new Je(ox);return e.elements=t,e}function gl(t,e,n){const r=new Je(t==="||"||t==="&&"?fx:ax);return r.operator=t,r.left=e,r.right=n,r}function Nx(t,e){const n=new Je(cx);return n.callee=t,n.arguments=e,n}function zx(t,e,n){const r=new Je(ux);return r.test=t,r.consequent=e,r.alternate=n,r}function Nc(t){const e=new Je(yh);return e.name=t,e}function Br(t){const e=new Je(lx);return e.value=t.value,e.raw=D.slice(t.start,t.end),t.regex&&(e.raw==="//"&&(e.raw="/(?:)/"),e.regex=t.regex),e}function xl(t,e,n){const r=new Je(hx);return r.computed=t==="[",r.object=e,r.property=n,r.computed||(n.member=!0),r}function Ux(t){const e=new Je(dx);return e.properties=t,e}function yl(t,e,n){const r=new Je(px);return r.key=e,r.value=n,r.kind=t,r}function $x(t,e){const n=new Je(mx);return n.operator=t,n.argument=e,n.prefix=!0,n}function O(t,e){var n,r=Array.prototype.slice.call(arguments,2),i=e.replace(/%(\d)/g,(s,o)=>(Ao(o<r.length,"Message reference must be in range"),r[o]));throw n=new Error(i),n.index=y,n.description=i,n}function wo(t){t.type===ki&&O(t,Ax),t.type===On&&O(t,gx),t.type===Oi&&O(t,xx),t.type===Tn&&O(t,yx),t.type===$t&&O(t,bx),O(t,ne,t.value)}function ye(t){const e=Fe();(e.type!==Se||e.value!==t)&&wo(e)}function G(t){return z.type===Se&&z.value===t}function ca(t){return z.type===$t&&z.value===t}function Vx(){const t=[];for(y=z.start,ye("[");!G("]");)G(",")?(Fe(),t.push(null)):(t.push(Dn()),G("]")||ye(","));return Fe(),Lx(t)}function bl(){y=z.start;const t=Fe();return t.type===Oi||t.type===On?(t.octal&&O(t,bh),Br(t)):Nc(t.value)}function Gx(){var t,e,n,r;if(y=z.start,t=z,t.type===Tn)return n=bl(),ye(":"),r=Dn(),yl("init",n,r);if(t.type===ki||t.type===Se)wo(t);else return e=bl(),ye(":"),r=Dn(),yl("init",e,r)}function Hx(){var t=[],e,n,r,i={},s=String;for(y=z.start,ye("{");!G("}");)e=Gx(),e.key.type===yh?n=e.key.name:n=s(e.key.value),r="$"+n,Object.prototype.hasOwnProperty.call(i,r)?O({},wx):i[r]=!0,t.push(e),G("}")||ye(",");return ye("}"),Ux(t)}function qx(){ye("(");const t=zc();return ye(")"),t}const Wx={if:1};function jx(){var t,e,n;if(G("("))return qx();if(G("["))return Vx();if(G("{"))return Hx();if(t=z.type,y=z.start,t===Tn||Wx[z.value])n=Nc(Fe().value);else if(t===Oi||t===On)z.octal&&O(z,bh),n=Br(Fe());else{if(t===$t)throw new Error(si);t===yo?(e=Fe(),e.value=e.value==="true",n=Br(e)):t===bo?(e=Fe(),e.value=null,n=Br(e)):G("/")||G("/=")?(n=Br(Ox()),Eh()):wo(Fe())}return n}function Yx(){const t=[];if(ye("("),!G(")"))for(;y<xe&&(t.push(Dn()),!G(")"));)ye(",");return ye(")"),t}function Xx(){y=z.start;const t=Fe();return Px(t)||wo(t),Nc(t.value)}function Kx(){return ye("."),Xx()}function Jx(){ye("[");const t=zc();return ye("]"),t}function Zx(){var t,e,n;for(t=jx();;)if(G("."))n=Kx(),t=xl(".",t,n);else if(G("("))e=Yx(),t=Nx(t,e);else if(G("["))n=Jx(),t=xl("[",t,n);else break;return t}function Al(){const t=Zx();if(z.type===Se&&(G("++")||G("--")))throw new Error(si);return t}function ys(){var t,e;if(z.type!==Se&&z.type!==$t)e=Al();else{if(G("++")||G("--"))throw new Error(si);if(G("+")||G("-")||G("~")||G("!"))t=Fe(),e=ys(),e=$x(t.value,e);else{if(ca("delete")||ca("void")||ca("typeof"))throw new Error(si);e=Al()}}return e}function wl(t){let e=0;if(t.type!==Se&&t.type!==$t)return 0;switch(t.value){case"||":e=1;break;case"&&":e=2;break;case"|":e=3;break;case"^":e=4;break;case"&":e=5;break;case"==":case"!=":case"===":case"!==":e=6;break;case"<":case">":case"<=":case">=":case"instanceof":case"in":e=7;break;case"<<":case">>":case">>>":e=8;break;case"+":case"-":e=9;break;case"*":case"/":case"%":e=11;break}return e}function Qx(){var t,e,n,r,i,s,o,a,c,u;if(t=z,c=ys(),r=z,i=wl(r),i===0)return c;for(r.prec=i,Fe(),e=[t,z],o=ys(),s=[c,r,o];(i=wl(z))>0;){for(;s.length>2&&i<=s[s.length-2].prec;)o=s.pop(),a=s.pop().value,c=s.pop(),e.pop(),n=gl(a,c,o),s.push(n);r=Fe(),r.prec=i,s.push(r),e.push(z),n=ys(),s.push(n)}for(u=s.length-1,n=s[u],e.pop();u>1;)e.pop(),n=gl(s[u-1].value,s[u-2],n),u-=2;return n}function Dn(){var t,e,n;return t=Qx(),G("?")&&(Fe(),e=Dn(),ye(":"),n=Dn(),t=zx(t,e,n)),t}function zc(){const t=Dn();if(G(","))throw new Error(si);return t}function ey(t){D=t,y=0,xe=D.length,z=null,Eh();const e=zc();if(z.type!==ki)throw new Error("Unexpect token after expression.");return e}var ty={NaN:"NaN",E:"Math.E",LN2:"Math.LN2",LN10:"Math.LN10",LOG2E:"Math.LOG2E",LOG10E:"Math.LOG10E",PI:"Math.PI",SQRT1_2:"Math.SQRT1_2",SQRT2:"Math.SQRT2",MIN_VALUE:"Number.MIN_VALUE",MAX_VALUE:"Number.MAX_VALUE"};function Ch(t){function e(o,a,c,u){let f=t(a[0]);return c&&(f=c+"("+f+")",c.lastIndexOf("new ",0)===0&&(f="("+f+")")),f+"."+o+(u<0?"":u===0?"()":"("+a.slice(1).map(t).join(",")+")")}function n(o,a,c){return u=>e(o,u,a,c)}const r="new Date",i="String",s="RegExp";return{isNaN:"Number.isNaN",isFinite:"Number.isFinite",abs:"Math.abs",acos:"Math.acos",asin:"Math.asin",atan:"Math.atan",atan2:"Math.atan2",ceil:"Math.ceil",cos:"Math.cos",exp:"Math.exp",floor:"Math.floor",hypot:"Math.hypot",log:"Math.log",max:"Math.max",min:"Math.min",pow:"Math.pow",random:"Math.random",round:"Math.round",sin:"Math.sin",sqrt:"Math.sqrt",tan:"Math.tan",clamp:function(o){o.length<3&&W("Missing arguments to clamp function."),o.length>3&&W("Too many arguments to clamp function.");const a=o.map(t);return"Math.max("+a[1]+", Math.min("+a[2]+","+a[0]+"))"},now:"Date.now",utc:"Date.UTC",datetime:r,date:n("getDate",r,0),day:n("getDay",r,0),year:n("getFullYear",r,0),month:n("getMonth",r,0),hours:n("getHours",r,0),minutes:n("getMinutes",r,0),seconds:n("getSeconds",r,0),milliseconds:n("getMilliseconds",r,0),time:n("getTime",r,0),timezoneoffset:n("getTimezoneOffset",r,0),utcdate:n("getUTCDate",r,0),utcday:n("getUTCDay",r,0),utcyear:n("getUTCFullYear",r,0),utcmonth:n("getUTCMonth",r,0),utchours:n("getUTCHours",r,0),utcminutes:n("getUTCMinutes",r,0),utcseconds:n("getUTCSeconds",r,0),utcmilliseconds:n("getUTCMilliseconds",r,0),length:n("length",null,-1),parseFloat:"parseFloat",parseInt:"parseInt",upper:n("toUpperCase",i,0),lower:n("toLowerCase",i,0),substring:n("substring",i),split:n("split",i),trim:n("trim",i,0),regexp:s,test:n("test",s),if:function(o){o.length<3&&W("Missing arguments to if function."),o.length>3&&W("Too many arguments to if function.");const a=o.map(t);return"("+a[0]+"?"+a[1]+":"+a[2]+")"}}}function ny(t){const e=t&&t.length-1;return e&&(t[0]==='"'&&t[e]==='"'||t[0]==="'"&&t[e]==="'")?t.slice(1,-1):t}function ry(t){t=t||{};const e=t.allowed?Ds(t.allowed):{},n=t.forbidden?Ds(t.forbidden):{},r=t.constants||ty,i=(t.functions||Ch)(l),s=t.globalvar,o=t.fieldvar,a=Ie(s)?s:d=>`${s}["${d}"]`;let c={},u={},f=0;function l(d){if(V(d))return d;const m=h[d.type];return m==null&&W("Unsupported type: "+d.type),m(d)}const h={Literal:d=>d.raw,Identifier:d=>{const m=d.name;return f>0?m:qn(n,m)?W("Illegal identifier: "+m):qn(r,m)?r[m]:qn(e,m)?m:(c[m]=1,a(m))},MemberExpression:d=>{const m=!d.computed,g=l(d.object);m&&(f+=1);const x=l(d.property);return g===o&&(u[ny(x)]=1),m&&(f-=1),g+(m?"."+x:"["+x+"]")},CallExpression:d=>{d.callee.type!=="Identifier"&&W("Illegal callee type: "+d.callee.type);const m=d.callee.name,g=d.arguments,x=qn(i,m)&&i[m];return x||W("Unrecognized function: "+m),Ie(x)?x(g):x+"("+g.map(l).join(",")+")"},ArrayExpression:d=>"["+d.elements.map(l).join(",")+"]",BinaryExpression:d=>"("+l(d.left)+" "+d.operator+" "+l(d.right)+")",UnaryExpression:d=>"("+d.operator+l(d.argument)+")",ConditionalExpression:d=>"("+l(d.test)+"?"+l(d.consequent)+":"+l(d.alternate)+")",LogicalExpression:d=>"("+l(d.left)+d.operator+l(d.right)+")",ObjectExpression:d=>"{"+d.properties.map(l).join(",")+"}",Property:d=>{f+=1;const m=l(d.key);return f-=1,m+":"+l(d.value)}};function p(d){const m={code:l(d),globals:Object.keys(c),fields:Object.keys(u)};return c={},u={},m}return p.functions=i,p.constants=r,p}function Sh(t,e,n){return n=(n-t)/(e-t),n=Math.max(0,Math.min(1,n)),n*n*(3-2*n)}function ai(t,e=0,n=1){return Math.max(e,Math.min(n,t))}function iy(t,e,n){return ai((n-t)/(e-t),0,1)}const Fh={clamp:ai,isArray:Me,isBoolean:_i,isDefined(t){return t!==void 0},isNumber:be,isObject:Re,isRegExp:gm,isString:V,isValid(t){return t!=null&&t===t},lerp:jf,linearstep:iy,smoothstep:Sh};function sy(t){const e=Ch(t);for(const n in Fh)e[n]=`this.${n}`;return e}const oy=ry({forbidden:[],allowed:["datum"],globalvar:"globalObject",fieldvar:"datum",functions:sy});function vo(t,e={}){try{const n=ey(t),r=oy(n),i=Function("datum","globalObject",`"use strict"; return (${r.code});`).bind(Fh),s=o=>i(o,e);return s.fields=r.fields,s.globals=r.globals,s.code=r.code,s}catch(n){throw new Error(`Invalid expression: ${t}, ${n.message}`)}}function ct(t,e){switch(arguments.length){case 0:break;case 1:this.range(t);break;default:this.range(e).domain(t);break}return this}function Vt(t,e){switch(arguments.length){case 0:break;case 1:{typeof t=="function"?this.interpolator(t):this.range(t);break}default:{this.domain(t),typeof e=="function"?this.interpolator(e):this.range(e);break}}return this}const Pa=Symbol("implicit");function Uc(){var t=new Sn,e=[],n=[],r=Pa;function i(s){let o=t.get(s);if(o===void 0){if(r!==Pa)return r;t.set(s,o=e.push(s)-1)}return n[o%n.length]}return i.domain=function(s){if(!arguments.length)return e.slice();e=[],t=new Sn;for(const o of s)t.has(o)||t.set(o,e.push(o)-1);return i},i.range=function(s){return arguments.length?(n=Array.from(s),i):n.slice()},i.unknown=function(s){return arguments.length?(r=s,i):r},i.copy=function(){return Uc(e,n).unknown(r)},ct.apply(i,arguments),i}function xr(t,e,n){t.prototype=e.prototype=n,n.constructor=t}function Li(t,e){var n=Object.create(t.prototype);for(var r in e)n[r]=e[r];return n}function Gt(){}var In=.7,lr=1/In,jn="\\s*([+-]?\\d+)\\s*",ci="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",tt="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",ay=/^#([0-9a-f]{3,8})$/,cy=new RegExp(`^rgb\\(${jn},${jn},${jn}\\)$`),uy=new RegExp(`^rgb\\(${tt},${tt},${tt}\\)$`),ly=new RegExp(`^rgba\\(${jn},${jn},${jn},${ci}\\)$`),fy=new RegExp(`^rgba\\(${tt},${tt},${tt},${ci}\\)$`),hy=new RegExp(`^hsl\\(${ci},${tt},${tt}\\)$`),dy=new RegExp(`^hsla\\(${ci},${tt},${tt},${ci}\\)$`),vl={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};xr(Gt,Bt,{copy(t){return Object.assign(new this.constructor,this,t)},displayable(){return this.rgb().displayable()},hex:El,formatHex:El,formatHex8:py,formatHsl:my,formatRgb:Cl,toString:Cl});function El(){return this.rgb().formatHex()}function py(){return this.rgb().formatHex8()}function my(){return Th(this).formatHsl()}function Cl(){return this.rgb().formatRgb()}function Bt(t){var e,n;return t=(t+"").trim().toLowerCase(),(e=ay.exec(t))?(n=e[1].length,e=parseInt(e[1],16),n===6?Sl(e):n===3?new re(e>>8&15|e>>4&240,e>>4&15|e&240,(e&15)<<4|e&15,1):n===8?us(e>>24&255,e>>16&255,e>>8&255,(e&255)/255):n===4?us(e>>12&15|e>>8&240,e>>8&15|e>>4&240,e>>4&15|e&240,((e&15)<<4|e&15)/255):null):(e=cy.exec(t))?new re(e[1],e[2],e[3],1):(e=uy.exec(t))?new re(e[1]*255/100,e[2]*255/100,e[3]*255/100,1):(e=ly.exec(t))?us(e[1],e[2],e[3],e[4]):(e=fy.exec(t))?us(e[1]*255/100,e[2]*255/100,e[3]*255/100,e[4]):(e=hy.exec(t))?Dl(e[1],e[2]/100,e[3]/100,1):(e=dy.exec(t))?Dl(e[1],e[2]/100,e[3]/100,e[4]):vl.hasOwnProperty(t)?Sl(vl[t]):t==="transparent"?new re(NaN,NaN,NaN,0):null}function Sl(t){return new re(t>>16&255,t>>8&255,t&255,1)}function us(t,e,n,r){return r<=0&&(t=e=n=NaN),new re(t,e,n,r)}function $c(t){return t instanceof Gt||(t=Bt(t)),t?(t=t.rgb(),new re(t.r,t.g,t.b,t.opacity)):new re}function Ps(t,e,n,r){return arguments.length===1?$c(t):new re(t,e,n,r??1)}function re(t,e,n,r){this.r=+t,this.g=+e,this.b=+n,this.opacity=+r}xr(re,Ps,Li(Gt,{brighter(t){return t=t==null?lr:Math.pow(lr,t),new re(this.r*t,this.g*t,this.b*t,this.opacity)},darker(t){return t=t==null?In:Math.pow(In,t),new re(this.r*t,this.g*t,this.b*t,this.opacity)},rgb(){return this},clamp(){return new re(yn(this.r),yn(this.g),yn(this.b),Ls(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:Fl,formatHex:Fl,formatHex8:gy,formatRgb:Tl,toString:Tl}));function Fl(){return`#${an(this.r)}${an(this.g)}${an(this.b)}`}function gy(){return`#${an(this.r)}${an(this.g)}${an(this.b)}${an((isNaN(this.opacity)?1:this.opacity)*255)}`}function Tl(){const t=Ls(this.opacity);return`${t===1?"rgb(":"rgba("}${yn(this.r)}, ${yn(this.g)}, ${yn(this.b)}${t===1?")":`, ${t})`}`}function Ls(t){return isNaN(t)?1:Math.max(0,Math.min(1,t))}function yn(t){return Math.max(0,Math.min(255,Math.round(t)||0))}function an(t){return t=yn(t),(t<16?"0":"")+t.toString(16)}function Dl(t,e,n,r){return r<=0?t=e=n=NaN:n<=0||n>=1?t=e=NaN:e<=0&&(t=NaN),new je(t,e,n,r)}function Th(t){if(t instanceof je)return new je(t.h,t.s,t.l,t.opacity);if(t instanceof Gt||(t=Bt(t)),!t)return new je;if(t instanceof je)return t;t=t.rgb();var e=t.r/255,n=t.g/255,r=t.b/255,i=Math.min(e,n,r),s=Math.max(e,n,r),o=NaN,a=s-i,c=(s+i)/2;return a?(e===s?o=(n-r)/a+(n<r)*6:n===s?o=(r-e)/a+2:o=(e-n)/a+4,a/=c<.5?s+i:2-s-i,o*=60):a=c>0&&c<1?0:o,new je(o,a,c,t.opacity)}function La(t,e,n,r){return arguments.length===1?Th(t):new je(t,e,n,r??1)}function je(t,e,n,r){this.h=+t,this.s=+e,this.l=+n,this.opacity=+r}xr(je,La,Li(Gt,{brighter(t){return t=t==null?lr:Math.pow(lr,t),new je(this.h,this.s,this.l*t,this.opacity)},darker(t){return t=t==null?In:Math.pow(In,t),new je(this.h,this.s,this.l*t,this.opacity)},rgb(){var t=this.h%360+(this.h<0)*360,e=isNaN(t)||isNaN(this.s)?0:this.s,n=this.l,r=n+(n<.5?n:1-n)*e,i=2*n-r;return new re(ua(t>=240?t-240:t+120,i,r),ua(t,i,r),ua(t<120?t+240:t-120,i,r),this.opacity)},clamp(){return new je(Il(this.h),ls(this.s),ls(this.l),Ls(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){const t=Ls(this.opacity);return`${t===1?"hsl(":"hsla("}${Il(this.h)}, ${ls(this.s)*100}%, ${ls(this.l)*100}%${t===1?")":`, ${t})`}`}}));function Il(t){return t=(t||0)%360,t<0?t+360:t}function ls(t){return Math.max(0,Math.min(1,t||0))}function ua(t,e,n){return(t<60?e+(n-e)*t/60:t<180?n:t<240?e+(n-e)*(240-t)/60:e)*255}const Dh=Math.PI/180,Ih=180/Math.PI,Ns=18,_h=.96422,Rh=1,Mh=.82521,Bh=4/29,Yn=6/29,kh=3*Yn*Yn,xy=Yn*Yn*Yn;function Oh(t){if(t instanceof nt)return new nt(t.l,t.a,t.b,t.opacity);if(t instanceof wt)return Ph(t);t instanceof re||(t=$c(t));var e=da(t.r),n=da(t.g),r=da(t.b),i=la((.2225045*e+.7168786*n+.0606169*r)/Rh),s,o;return e===n&&n===r?s=o=i:(s=la((.4360747*e+.3850649*n+.1430804*r)/_h),o=la((.0139322*e+.0971045*n+.7141733*r)/Mh)),new nt(116*i-16,500*(s-i),200*(i-o),t.opacity)}function Na(t,e,n,r){return arguments.length===1?Oh(t):new nt(t,e,n,r??1)}function nt(t,e,n,r){this.l=+t,this.a=+e,this.b=+n,this.opacity=+r}xr(nt,Na,Li(Gt,{brighter(t){return new nt(this.l+Ns*(t??1),this.a,this.b,this.opacity)},darker(t){return new nt(this.l-Ns*(t??1),this.a,this.b,this.opacity)},rgb(){var t=(this.l+16)/116,e=isNaN(this.a)?t:t+this.a/500,n=isNaN(this.b)?t:t-this.b/200;return e=_h*fa(e),t=Rh*fa(t),n=Mh*fa(n),new re(ha(3.1338561*e-1.6168667*t-.4906146*n),ha(-.9787684*e+1.9161415*t+.033454*n),ha(.0719453*e-.2289914*t+1.4052427*n),this.opacity)}}));function la(t){return t>xy?Math.pow(t,1/3):t/kh+Bh}function fa(t){return t>Yn?t*t*t:kh*(t-Bh)}function ha(t){return 255*(t<=.0031308?12.92*t:1.055*Math.pow(t,1/2.4)-.055)}function da(t){return(t/=255)<=.04045?t/12.92:Math.pow((t+.055)/1.055,2.4)}function yy(t){if(t instanceof wt)return new wt(t.h,t.c,t.l,t.opacity);if(t instanceof nt||(t=Oh(t)),t.a===0&&t.b===0)return new wt(NaN,0<t.l&&t.l<100?0:NaN,t.l,t.opacity);var e=Math.atan2(t.b,t.a)*Ih;return new wt(e<0?e+360:e,Math.sqrt(t.a*t.a+t.b*t.b),t.l,t.opacity)}function za(t,e,n,r){return arguments.length===1?yy(t):new wt(t,e,n,r??1)}function wt(t,e,n,r){this.h=+t,this.c=+e,this.l=+n,this.opacity=+r}function Ph(t){if(isNaN(t.h))return new nt(t.l,0,0,t.opacity);var e=t.h*Dh;return new nt(t.l,Math.cos(e)*t.c,Math.sin(e)*t.c,t.opacity)}xr(wt,za,Li(Gt,{brighter(t){return new wt(this.h,this.c,this.l+Ns*(t??1),this.opacity)},darker(t){return new wt(this.h,this.c,this.l-Ns*(t??1),this.opacity)},rgb(){return Ph(this).rgb()}}));var Lh=-.14861,Vc=1.78277,Gc=-.29227,Eo=-.90649,ui=1.97294,_l=ui*Eo,Rl=ui*Vc,Ml=Vc*Gc-Eo*Lh;function by(t){if(t instanceof bn)return new bn(t.h,t.s,t.l,t.opacity);t instanceof re||(t=$c(t));var e=t.r/255,n=t.g/255,r=t.b/255,i=(Ml*r+_l*e-Rl*n)/(Ml+_l-Rl),s=r-i,o=(ui*(n-i)-Gc*s)/Eo,a=Math.sqrt(o*o+s*s)/(ui*i*(1-i)),c=a?Math.atan2(o,s)*Ih-120:NaN;return new bn(c<0?c+360:c,a,i,t.opacity)}function Ua(t,e,n,r){return arguments.length===1?by(t):new bn(t,e,n,r??1)}function bn(t,e,n,r){this.h=+t,this.s=+e,this.l=+n,this.opacity=+r}xr(bn,Ua,Li(Gt,{brighter(t){return t=t==null?lr:Math.pow(lr,t),new bn(this.h,this.s,this.l*t,this.opacity)},darker(t){return t=t==null?In:Math.pow(In,t),new bn(this.h,this.s,this.l*t,this.opacity)},rgb(){var t=isNaN(this.h)?0:(this.h+120)*Dh,e=+this.l,n=isNaN(this.s)?0:this.s*e*(1-e),r=Math.cos(t),i=Math.sin(t);return new re(255*(e+n*(Lh*r+Vc*i)),255*(e+n*(Gc*r+Eo*i)),255*(e+n*(ui*r)),this.opacity)}}));function Nh(t,e,n,r,i){var s=t*t,o=s*t;return((1-3*t+3*s-o)*e+(4-6*s+3*o)*n+(1+3*t+3*s-3*o)*r+o*i)/6}function zh(t){var e=t.length-1;return function(n){var r=n<=0?n=0:n>=1?(n=1,e-1):Math.floor(n*e),i=t[r],s=t[r+1],o=r>0?t[r-1]:2*i-s,a=r<e-1?t[r+2]:2*s-i;return Nh((n-r/e)*e,o,i,s,a)}}function Uh(t){var e=t.length;return function(n){var r=Math.floor(((n%=1)<0?++n:n)*e),i=t[(r+e-1)%e],s=t[r%e],o=t[(r+1)%e],a=t[(r+2)%e];return Nh((n-r/e)*e,i,s,o,a)}}const Co=t=>()=>t;function $h(t,e){return function(n){return t+n*e}}function Ay(t,e,n){return t=Math.pow(t,n),e=Math.pow(e,n)-t,n=1/n,function(r){return Math.pow(t+r*e,n)}}function So(t,e){var n=e-t;return n?$h(t,n>180||n<-180?n-360*Math.round(n/360):n):Co(isNaN(t)?e:t)}function wy(t){return(t=+t)==1?ie:function(e,n){return n-e?Ay(e,n,t):Co(isNaN(e)?n:e)}}function ie(t,e){var n=e-t;return n?$h(t,n):Co(isNaN(t)?e:t)}const $a=function t(e){var n=wy(e);function r(i,s){var o=n((i=Ps(i)).r,(s=Ps(s)).r),a=n(i.g,s.g),c=n(i.b,s.b),u=ie(i.opacity,s.opacity);return function(f){return i.r=o(f),i.g=a(f),i.b=c(f),i.opacity=u(f),i+""}}return r.gamma=t,r}(1);function Vh(t){return function(e){var n=e.length,r=new Array(n),i=new Array(n),s=new Array(n),o,a;for(o=0;o<n;++o)a=Ps(e[o]),r[o]=a.r||0,i[o]=a.g||0,s[o]=a.b||0;return r=t(r),i=t(i),s=t(s),a.opacity=1,function(c){return a.r=r(c),a.g=i(c),a.b=s(c),a+""}}}var vy=Vh(zh),Ey=Vh(Uh);function Hc(t,e){e||(e=[]);var n=t?Math.min(e.length,t.length):0,r=e.slice(),i;return function(s){for(i=0;i<n;++i)r[i]=t[i]*(1-s)+e[i]*s;return r}}function Gh(t){return ArrayBuffer.isView(t)&&!(t instanceof DataView)}function Cy(t,e){return(Gh(e)?Hc:Hh)(t,e)}function Hh(t,e){var n=e?e.length:0,r=t?Math.min(n,t.length):0,i=new Array(r),s=new Array(n),o;for(o=0;o<r;++o)i[o]=Ht(t[o],e[o]);for(;o<n;++o)s[o]=e[o];return function(a){for(o=0;o<r;++o)s[o]=i[o](a);return s}}function qh(t,e){var n=new Date;return t=+t,e=+e,function(r){return n.setTime(t*(1-r)+e*r),n}}function We(t,e){return t=+t,e=+e,function(n){return t*(1-n)+e*n}}function Wh(t,e){var n={},r={},i;(t===null||typeof t!="object")&&(t={}),(e===null||typeof e!="object")&&(e={});for(i in e)i in t?n[i]=Ht(t[i],e[i]):r[i]=e[i];return function(s){for(i in n)r[i]=n[i](s);return r}}var Va=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,pa=new RegExp(Va.source,"g");function Sy(t){return function(){return t}}function Fy(t){return function(e){return t(e)+""}}function jh(t,e){var n=Va.lastIndex=pa.lastIndex=0,r,i,s,o=-1,a=[],c=[];for(t=t+"",e=e+"";(r=Va.exec(t))&&(i=pa.exec(e));)(s=i.index)>n&&(s=e.slice(n,s),a[o]?a[o]+=s:a[++o]=s),(r=r[0])===(i=i[0])?a[o]?a[o]+=i:a[++o]=i:(a[++o]=null,c.push({i:o,x:We(r,i)})),n=pa.lastIndex;return n<e.length&&(s=e.slice(n),a[o]?a[o]+=s:a[++o]=s),a.length<2?c[0]?Fy(c[0].x):Sy(e):(e=c.length,function(u){for(var f=0,l;f<e;++f)a[(l=c[f]).i]=l.x(u);return a.join("")})}function Ht(t,e){var n=typeof e,r;return e==null||n==="boolean"?Co(e):(n==="number"?We:n==="string"?(r=Bt(e))?(e=r,$a):jh:e instanceof Bt?$a:e instanceof Date?qh:Gh(e)?Hc:Array.isArray(e)?Hh:typeof e.valueOf!="function"&&typeof e.toString!="function"||isNaN(e)?Wh:We)(t,e)}function Ty(t){var e=t.length;return function(n){return t[Math.max(0,Math.min(e-1,Math.floor(n*e)))]}}function Dy(t,e){var n=So(+t,+e);return function(r){var i=n(r);return i-360*Math.floor(i/360)}}function Ni(t,e){return t=+t,e=+e,function(n){return Math.round(t*(1-n)+e*n)}}var Bl=180/Math.PI,Ga={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1};function Yh(t,e,n,r,i,s){var o,a,c;return(o=Math.sqrt(t*t+e*e))&&(t/=o,e/=o),(c=t*n+e*r)&&(n-=t*c,r-=e*c),(a=Math.sqrt(n*n+r*r))&&(n/=a,r/=a,c/=a),t*r<e*n&&(t=-t,e=-e,c=-c,o=-o),{translateX:i,translateY:s,rotate:Math.atan2(e,t)*Bl,skewX:Math.atan(c)*Bl,scaleX:o,scaleY:a}}var fs;function Iy(t){const e=new(typeof DOMMatrix=="function"?DOMMatrix:WebKitCSSMatrix)(t+"");return e.isIdentity?Ga:Yh(e.a,e.b,e.c,e.d,e.e,e.f)}function _y(t){return t==null||(fs||(fs=document.createElementNS("http://www.w3.org/2000/svg","g")),fs.setAttribute("transform",t),!(t=fs.transform.baseVal.consolidate()))?Ga:(t=t.matrix,Yh(t.a,t.b,t.c,t.d,t.e,t.f))}function Xh(t,e,n,r){function i(u){return u.length?u.pop()+" ":""}function s(u,f,l,h,p,d){if(u!==l||f!==h){var m=p.push("translate(",null,e,null,n);d.push({i:m-4,x:We(u,l)},{i:m-2,x:We(f,h)})}else(l||h)&&p.push("translate("+l+e+h+n)}function o(u,f,l,h){u!==f?(u-f>180?f+=360:f-u>180&&(u+=360),h.push({i:l.push(i(l)+"rotate(",null,r)-2,x:We(u,f)})):f&&l.push(i(l)+"rotate("+f+r)}function a(u,f,l,h){u!==f?h.push({i:l.push(i(l)+"skewX(",null,r)-2,x:We(u,f)}):f&&l.push(i(l)+"skewX("+f+r)}function c(u,f,l,h,p,d){if(u!==l||f!==h){var m=p.push(i(p)+"scale(",null,",",null,")");d.push({i:m-4,x:We(u,l)},{i:m-2,x:We(f,h)})}else(l!==1||h!==1)&&p.push(i(p)+"scale("+l+","+h+")")}return function(u,f){var l=[],h=[];return u=t(u),f=t(f),s(u.translateX,u.translateY,f.translateX,f.translateY,l,h),o(u.rotate,f.rotate,l,h),a(u.skewX,f.skewX,l,h),c(u.scaleX,u.scaleY,f.scaleX,f.scaleY,l,h),u=f=null,function(p){for(var d=-1,m=h.length,g;++d<m;)l[(g=h[d]).i]=g.x(p);return l.join("")}}}var Ry=Xh(Iy,"px, ","px)","deg)"),My=Xh(_y,", ",")",")"),By=1e-12;function kl(t){return((t=Math.exp(t))+1/t)/2}function ky(t){return((t=Math.exp(t))-1/t)/2}function Oy(t){return((t=Math.exp(2*t))-1)/(t+1)}const Py=function t(e,n,r){function i(s,o){var a=s[0],c=s[1],u=s[2],f=o[0],l=o[1],h=o[2],p=f-a,d=l-c,m=p*p+d*d,g,x;if(m<By)x=Math.log(h/u)/e,g=function(w){return[a+w*p,c+w*d,u*Math.exp(e*w*x)]};else{var b=Math.sqrt(m),A=(h*h-u*u+r*m)/(2*u*n*b),E=(h*h-u*u-r*m)/(2*h*n*b),F=Math.log(Math.sqrt(A*A+1)-A),C=Math.log(Math.sqrt(E*E+1)-E);x=(C-F)/e,g=function(w){var L=w*x,Y=kl(F),j=u/(n*b)*(Y*Oy(e*L+F)-ky(F));return[a+j*p,c+j*d,u*Y/kl(e*L+F)]}}return g.duration=x*1e3*e/Math.SQRT2,g}return i.rho=function(s){var o=Math.max(.001,+s),a=o*o,c=a*a;return t(o,a,c)},i}(Math.SQRT2,2,4);function Kh(t){return function(e,n){var r=t((e=La(e)).h,(n=La(n)).h),i=ie(e.s,n.s),s=ie(e.l,n.l),o=ie(e.opacity,n.opacity);return function(a){return e.h=r(a),e.s=i(a),e.l=s(a),e.opacity=o(a),e+""}}}const Ly=Kh(So);var Ny=Kh(ie);function zy(t,e){var n=ie((t=Na(t)).l,(e=Na(e)).l),r=ie(t.a,e.a),i=ie(t.b,e.b),s=ie(t.opacity,e.opacity);return function(o){return t.l=n(o),t.a=r(o),t.b=i(o),t.opacity=s(o),t+""}}function Jh(t){return function(e,n){var r=t((e=za(e)).h,(n=za(n)).h),i=ie(e.c,n.c),s=ie(e.l,n.l),o=ie(e.opacity,n.opacity);return function(a){return e.h=r(a),e.c=i(a),e.l=s(a),e.opacity=o(a),e+""}}}const Uy=Jh(So);var $y=Jh(ie);function Zh(t){return function e(n){n=+n;function r(i,s){var o=t((i=Ua(i)).h,(s=Ua(s)).h),a=ie(i.s,s.s),c=ie(i.l,s.l),u=ie(i.opacity,s.opacity);return function(f){return i.h=o(f),i.s=a(f),i.l=c(Math.pow(f,n)),i.opacity=u(f),i+""}}return r.gamma=e,r}(1)}const Vy=Zh(So);var Gy=Zh(ie);function qc(t,e){e===void 0&&(e=t,t=Ht);for(var n=0,r=e.length-1,i=e[0],s=new Array(r<0?0:r);n<r;)s[n]=t(i,i=e[++n]);return function(o){var a=Math.max(0,Math.min(r-1,Math.floor(o*=r)));return s[a](o-a)}}function Hy(t,e){for(var n=new Array(e),r=0;r<e;++r)n[r]=t(r/(e-1));return n}const qy=Object.freeze(Object.defineProperty({__proto__:null,interpolate:Ht,interpolateArray:Cy,interpolateBasis:zh,interpolateBasisClosed:Uh,interpolateCubehelix:Vy,interpolateCubehelixLong:Gy,interpolateDate:qh,interpolateDiscrete:Ty,interpolateHcl:Uy,interpolateHclLong:$y,interpolateHsl:Ly,interpolateHslLong:Ny,interpolateHue:Dy,interpolateLab:zy,interpolateNumber:We,interpolateNumberArray:Hc,interpolateObject:Wh,interpolateRgb:$a,interpolateRgbBasis:vy,interpolateRgbBasisClosed:Ey,interpolateRound:Ni,interpolateString:jh,interpolateTransformCss:Ry,interpolateTransformSvg:My,interpolateZoom:Py,piecewise:qc,quantize:Hy},Symbol.toStringTag,{value:"Module"}));function Wy(t){return function(){return t}}function Ha(t){return+t}var Ol=[0,1];function Te(t){return t}function qa(t,e){return(e-=t=+t)?function(n){return(n-t)/e}:Wy(isNaN(e)?NaN:.5)}function jy(t,e){var n;return t>e&&(n=t,t=e,e=n),function(r){return Math.max(t,Math.min(e,r))}}function Yy(t,e,n){var r=t[0],i=t[1],s=e[0],o=e[1];return i<r?(r=qa(i,r),s=n(o,s)):(r=qa(r,i),s=n(s,o)),function(a){return s(r(a))}}function Xy(t,e,n){var r=Math.min(t.length,e.length)-1,i=new Array(r),s=new Array(r),o=-1;for(t[r]<t[0]&&(t=t.slice().reverse(),e=e.slice().reverse());++o<r;)i[o]=qa(t[o],t[o+1]),s[o]=n(e[o],e[o+1]);return function(a){var c=gr(t,a,1,r)-1;return s[c](i[c](a))}}function zi(t,e){return e.domain(t.domain()).range(t.range()).interpolate(t.interpolate()).clamp(t.clamp()).unknown(t.unknown())}function Fo(){var t=Ol,e=Ol,n=Ht,r,i,s,o=Te,a,c,u;function f(){var h=Math.min(t.length,e.length);return o!==Te&&(o=jy(t[0],t[h-1])),a=h>2?Xy:Yy,c=u=null,l}function l(h){return h==null||isNaN(h=+h)?s:(c||(c=a(t.map(r),e,n)))(r(o(h)))}return l.invert=function(h){return o(i((u||(u=a(e,t.map(r),We)))(h)))},l.domain=function(h){return arguments.length?(t=Array.from(h,Ha),f()):t.slice()},l.range=function(h){return arguments.length?(e=Array.from(h),f()):e.slice()},l.rangeRound=function(h){return e=Array.from(h),n=Ni,f()},l.clamp=function(h){return arguments.length?(o=h?!0:Te,f()):o!==Te},l.interpolate=function(h){return arguments.length?(n=h,f()):n},l.unknown=function(h){return arguments.length?(s=h,l):s},function(h,p){return r=h,i=p,f()}}function Qh(){return Fo()(Te,Te)}function e0(t,e,n,r){var i=Fn(t,e,n),s;switch(r=Mt(r??",f"),r.type){case"s":{var o=Math.max(Math.abs(t),Math.abs(e));return r.precision==null&&!isNaN(s=nh(i,o))&&(r.precision=s),_c(r,o)}case"":case"e":case"g":case"p":case"r":{r.precision==null&&!isNaN(s=rh(i,Math.max(Math.abs(t),Math.abs(e))))&&(r.precision=s-(r.type==="e"));break}case"f":case"%":{r.precision==null&&!isNaN(s=th(i))&&(r.precision=s-(r.type==="%")*2);break}}return ue(r)}function Pn(t){var e=t.domain;return t.ticks=function(n){var r=e();return _s(r[0],r[r.length-1],n??10)},t.tickFormat=function(n,r){var i=e();return e0(i[0],i[i.length-1],n??10,r)},t.nice=function(n){n==null&&(n=10);var r=e(),i=0,s=r.length-1,o=r[i],a=r[s],c,u,f=10;for(a<o&&(u=o,o=a,a=u,u=i,i=s,s=u);f-- >0;){if(u=Ma(o,a,n),u===c)return r[i]=o,r[s]=a,e(r);if(u>0)o=Math.floor(o/u)*u,a=Math.ceil(a/u)*u;else if(u<0)o=Math.ceil(o*u)/u,a=Math.floor(a*u)/u;else break;c=u}return t},t}function t0(){var t=Qh();return t.copy=function(){return zi(t,t0())},ct.apply(t,arguments),Pn(t)}function n0(t){var e;function n(r){return r==null||isNaN(r=+r)?e:r}return n.invert=n,n.domain=n.range=function(r){return arguments.length?(t=Array.from(r,Ha),n):t.slice()},n.unknown=function(r){return arguments.length?(e=r,n):e},n.copy=function(){return n0(t).unknown(e)},t=arguments.length?Array.from(t,Ha):[0,1],Pn(n)}function r0(t,e){t=t.slice();var n=0,r=t.length-1,i=t[n],s=t[r],o;return s<i&&(o=n,n=r,r=o,o=i,i=s,s=o),t[n]=e.floor(i),t[r]=e.ceil(s),t}function Pl(t){return Math.log(t)}function Ll(t){return Math.exp(t)}function Ky(t){return-Math.log(-t)}function Jy(t){return-Math.exp(-t)}function Zy(t){return isFinite(t)?+("1e"+t):t<0?0:t}function Qy(t){return t===10?Zy:t===Math.E?Math.exp:e=>Math.pow(t,e)}function eb(t){return t===Math.E?Math.log:t===10&&Math.log10||t===2&&Math.log2||(t=Math.log(t),e=>Math.log(e)/t)}function Nl(t){return(e,n)=>-t(-e,n)}function Wc(t){const e=t(Pl,Ll),n=e.domain;let r=10,i,s;function o(){return i=eb(r),s=Qy(r),n()[0]<0?(i=Nl(i),s=Nl(s),t(Ky,Jy)):t(Pl,Ll),e}return e.base=function(a){return arguments.length?(r=+a,o()):r},e.domain=function(a){return arguments.length?(n(a),o()):n()},e.ticks=a=>{const c=n();let u=c[0],f=c[c.length-1];const l=f<u;l&&([u,f]=[f,u]);let h=i(u),p=i(f),d,m;const g=a==null?10:+a;let x=[];if(!(r%1)&&p-h<g){if(h=Math.floor(h),p=Math.ceil(p),u>0){for(;h<=p;++h)for(d=1;d<r;++d)if(m=h<0?d/s(-h):d*s(h),!(m<u)){if(m>f)break;x.push(m)}}else for(;h<=p;++h)for(d=r-1;d>=1;--d)if(m=h>0?d/s(-h):d*s(h),!(m<u)){if(m>f)break;x.push(m)}x.length*2<g&&(x=_s(u,f,g))}else x=_s(h,p,Math.min(p-h,g)).map(s);return l?x.reverse():x},e.tickFormat=(a,c)=>{if(a==null&&(a=10),c==null&&(c=r===10?"s":","),typeof c!="function"&&(!(r%1)&&(c=Mt(c)).precision==null&&(c.trim=!0),c=ue(c)),a===1/0)return c;const u=Math.max(1,r*a/e.ticks().length);return f=>{let l=f/s(Math.round(i(f)));return l*r<r-.5&&(l*=r),l<=u?c(f):""}},e.nice=()=>n(r0(n(),{floor:a=>s(Math.floor(i(a))),ceil:a=>s(Math.ceil(i(a)))})),e}function jc(){const t=Wc(Fo()).domain([1,10]);return t.copy=()=>zi(t,jc()).base(t.base()),ct.apply(t,arguments),t}function zl(t){return function(e){return Math.sign(e)*Math.log1p(Math.abs(e/t))}}function Ul(t){return function(e){return Math.sign(e)*Math.expm1(Math.abs(e))*t}}function Yc(t){var e=1,n=t(zl(e),Ul(e));return n.constant=function(r){return arguments.length?t(zl(e=+r),Ul(e)):e},Pn(n)}function i0(){var t=Yc(Fo());return t.copy=function(){return zi(t,i0()).constant(t.constant())},ct.apply(t,arguments)}function $l(t){return function(e){return e<0?-Math.pow(-e,t):Math.pow(e,t)}}function tb(t){return t<0?-Math.sqrt(-t):Math.sqrt(t)}function nb(t){return t<0?-t*t:t*t}function Xc(t){var e=t(Te,Te),n=1;function r(){return n===1?t(Te,Te):n===.5?t(tb,nb):t($l(n),$l(1/n))}return e.exponent=function(i){return arguments.length?(n=+i,r()):n},Pn(e)}function Kc(){var t=Xc(Fo());return t.copy=function(){return zi(t,Kc()).exponent(t.exponent())},ct.apply(t,arguments),t}function rb(){return Kc.apply(null,arguments).exponent(.5)}function s0(){var t=[],e=[],n=[],r;function i(){var o=0,a=Math.max(1,e.length);for(n=new Array(a-1);++o<a;)n[o-1]=Qf(t,o/a);return s}function s(o){return o==null||isNaN(o=+o)?r:e[gr(n,o)]}return s.invertExtent=function(o){var a=e.indexOf(o);return a<0?[NaN,NaN]:[a>0?n[a-1]:t[0],a<n.length?n[a]:t[t.length-1]]},s.domain=function(o){if(!arguments.length)return t.slice();t=[];for(let a of o)a!=null&&!isNaN(a=+a)&&t.push(a);return t.sort(Lr),i()},s.range=function(o){return arguments.length?(e=Array.from(o),i()):e.slice()},s.unknown=function(o){return arguments.length?(r=o,s):r},s.quantiles=function(){return n.slice()},s.copy=function(){return s0().domain(t).range(e).unknown(r)},ct.apply(s,arguments)}function o0(){var t=0,e=1,n=1,r=[.5],i=[0,1],s;function o(c){return c!=null&&c<=c?i[gr(r,c,0,n)]:s}function a(){var c=-1;for(r=new Array(n);++c<n;)r[c]=((c+1)*e-(c-n)*t)/(n+1);return o}return o.domain=function(c){return arguments.length?([t,e]=c,t=+t,e=+e,a()):[t,e]},o.range=function(c){return arguments.length?(n=(i=Array.from(c)).length-1,a()):i.slice()},o.invertExtent=function(c){var u=i.indexOf(c);return u<0?[NaN,NaN]:u<1?[t,r[0]]:u>=n?[r[n-1],e]:[r[u-1],r[u]]},o.unknown=function(c){return arguments.length&&(s=c),o},o.thresholds=function(){return r.slice()},o.copy=function(){return o0().domain([t,e]).range(i).unknown(s)},ct.apply(Pn(o),arguments)}function a0(){var t=[.5],e=[0,1],n,r=1;function i(s){return s!=null&&s<=s?e[gr(t,s,0,r)]:n}return i.domain=function(s){return arguments.length?(t=Array.from(s),r=Math.min(t.length,e.length-1),i):t.slice()},i.range=function(s){return arguments.length?(e=Array.from(s),r=Math.min(t.length,e.length-1),i):e.slice()},i.invertExtent=function(s){var o=e.indexOf(s);return[t[o-1],t[o]]},i.unknown=function(s){return arguments.length?(n=s,i):n},i.copy=function(){return a0().domain(t).range(e).unknown(n)},ct.apply(i,arguments)}function ib(t){return new Date(t)}function sb(t){return t instanceof Date?+t:+new Date(+t)}function Jc(t,e,n,r,i,s,o,a,c,u){var f=Qh(),l=f.invert,h=f.domain,p=u(".%L"),d=u(":%S"),m=u("%I:%M"),g=u("%I %p"),x=u("%a %d"),b=u("%b %d"),A=u("%B"),E=u("%Y");function F(C){return(c(C)<C?p:a(C)<C?d:o(C)<C?m:s(C)<C?g:r(C)<C?i(C)<C?x:b:n(C)<C?A:E)(C)}return f.invert=function(C){return new Date(l(C))},f.domain=function(C){return arguments.length?h(Array.from(C,sb)):h().map(ib)},f.ticks=function(C){var w=h();return t(w[0],w[w.length-1],C??10)},f.tickFormat=function(C,w){return w==null?F:u(w)},f.nice=function(C){var w=h();return(!C||typeof C.range!="function")&&(C=e(w[0],w[w.length-1],C??10)),C?h(r0(w,C)):f},f.copy=function(){return zi(f,Jc(t,e,n,r,i,s,o,a,c,u))},f}function ob(){return ct.apply(Jc(ag,cg,st,Xr,Ri,Rt,ho,lo,At,Bc).domain([new Date(2e3,0,1),new Date(2e3,0,2)]),arguments)}function ab(){return ct.apply(Jc(sg,og,ot,Kr,Mi,xn,po,fo,At,kc).domain([Date.UTC(2e3,0,1),Date.UTC(2e3,0,2)]),arguments)}function To(){var t=0,e=1,n,r,i,s,o=Te,a=!1,c;function u(l){return l==null||isNaN(l=+l)?c:o(i===0?.5:(l=(s(l)-n)*i,a?Math.max(0,Math.min(1,l)):l))}u.domain=function(l){return arguments.length?([t,e]=l,n=s(t=+t),r=s(e=+e),i=n===r?0:1/(r-n),u):[t,e]},u.clamp=function(l){return arguments.length?(a=!!l,u):a},u.interpolator=function(l){return arguments.length?(o=l,u):o};function f(l){return function(h){var p,d;return arguments.length?([p,d]=h,o=l(p,d),u):[o(0),o(1)]}}return u.range=f(Ht),u.rangeRound=f(Ni),u.unknown=function(l){return arguments.length?(c=l,u):c},function(l){return s=l,n=l(t),r=l(e),i=n===r?0:1/(r-n),u}}function qt(t,e){return e.domain(t.domain()).interpolator(t.interpolator()).clamp(t.clamp()).unknown(t.unknown())}function Zc(){var t=Pn(To()(Te));return t.copy=function(){return qt(t,Zc())},Vt.apply(t,arguments)}function c0(){var t=Wc(To()).domain([1,10]);return t.copy=function(){return qt(t,c0()).base(t.base())},Vt.apply(t,arguments)}function u0(){var t=Yc(To());return t.copy=function(){return qt(t,u0()).constant(t.constant())},Vt.apply(t,arguments)}function Qc(){var t=Xc(To());return t.copy=function(){return qt(t,Qc()).exponent(t.exponent())},Vt.apply(t,arguments)}function cb(){return Qc.apply(null,arguments).exponent(.5)}function Do(){var t=0,e=.5,n=1,r=1,i,s,o,a,c,u=Te,f,l=!1,h;function p(m){return isNaN(m=+m)?h:(m=.5+((m=+f(m))-s)*(r*m<r*s?a:c),u(l?Math.max(0,Math.min(1,m)):m))}p.domain=function(m){return arguments.length?([t,e,n]=m,i=f(t=+t),s=f(e=+e),o=f(n=+n),a=i===s?0:.5/(s-i),c=s===o?0:.5/(o-s),r=s<i?-1:1,p):[t,e,n]},p.clamp=function(m){return arguments.length?(l=!!m,p):l},p.interpolator=function(m){return arguments.length?(u=m,p):u};function d(m){return function(g){var x,b,A;return arguments.length?([x,b,A]=g,u=qc(m,[x,b,A]),p):[u(0),u(.5),u(1)]}}return p.range=d(Ht),p.rangeRound=d(Ni),p.unknown=function(m){return arguments.length?(h=m,p):h},function(m){return f=m,i=m(t),s=m(e),o=m(n),a=i===s?0:.5/(s-i),c=s===o?0:.5/(o-s),r=s<i?-1:1,p}}function l0(){var t=Pn(Do()(Te));return t.copy=function(){return qt(t,l0())},Vt.apply(t,arguments)}function f0(){var t=Wc(Do()).domain([.1,1,10]);return t.copy=function(){return qt(t,f0()).base(t.base())},Vt.apply(t,arguments)}function h0(){var t=Yc(Do());return t.copy=function(){return qt(t,h0()).constant(t.constant())},Vt.apply(t,arguments)}function eu(){var t=Xc(Do());return t.copy=function(){return qt(t,eu()).exponent(t.exponent())},Vt.apply(t,arguments)}function ub(){return eu.apply(null,arguments).exponent(.5)}function tu(t,e,n){const r=t-e+n*2;return t?r>0?r:1:0}const lb="identity",fr="linear",kt="log",Ui="pow",$i="sqrt",Io="symlog",d0="time",p0="utc",rt="sequential",yr="diverging",Wa="quantile",m0="quantize",g0="threshold",nu="ordinal",ja="point",x0="band",ru="bin-ordinal",Q="continuous",Vi="discrete",Gi="discretizing",$e="interpolating",y0="temporal";function fb(t){return function(e){let n=e[0],r=e[1],i;return r<n&&(i=n,n=r,r=i),[t.invert(n),t.invert(r)]}}function hb(t){return function(e){const n=t.range();let r=e[0],i=e[1],s=-1,o,a,c,u;for(i<r&&(a=r,r=i,i=a),c=0,u=n.length;c<u;++c)n[c]>=r&&n[c]<=i&&(s<0&&(s=c),o=c);if(!(s<0))return r=t.invertExtent(n[s]),i=t.invertExtent(n[o]),[r[0]===void 0?r[1]:r[0],i[1]===void 0?i[0]:i[1]]}}function iu(){const t=Uc().unknown(void 0),e=t.domain,n=t.range;let r=[0,1],i,s,o=!1,a=0,c=0,u=.5;delete t.unknown;function f(){const l=e().length,h=r[1]<r[0],p=r[1-h],d=tu(l,a,c);let m=r[h-0];i=(p-m)/(d||1),o&&(i=Math.floor(i)),m+=(p-m-i*(l-a))*u,s=i*(1-a),o&&(m=Math.round(m),s=Math.round(s));const g=Yr(l).map(x=>m+i*x);return n(h?g.reverse():g)}return t.domain=function(l){return arguments.length?(e(l),f()):e()},t.range=function(l){return arguments.length?(r=[+l[0],+l[1]],f()):r.slice()},t.rangeRound=function(l){return r=[+l[0],+l[1]],o=!0,f()},t.bandwidth=function(){return s},t.step=function(){return i},t.round=function(l){return arguments.length?(o=!!l,f()):o},t.padding=function(l){return arguments.length?(c=Math.max(0,Math.min(1,l)),a=c,f()):a},t.paddingInner=function(l){return arguments.length?(a=Math.max(0,Math.min(1,l)),f()):a},t.paddingOuter=function(l){return arguments.length?(c=Math.max(0,Math.min(1,l)),f()):c},t.align=function(l){return arguments.length?(u=Math.max(0,Math.min(1,l)),f()):u},t.invertRange=function(l){if(l[0]==null||l[1]==null)return;const h=r[1]<r[0],p=h?n().reverse():n(),d=p.length-1;let m=+l[0],g=+l[1],x,b,A;if(!(m!==m||g!==g)&&(g<m&&(A=m,m=g,g=A),!(g<p[0]||m>r[1-h])))return x=Math.max(0,_a(p,m)-1),b=m===g?x:_a(p,g)-1,m-p[x]>s+1e-10&&++x,h&&(A=x,x=d-b,b=d-A),x>b?void 0:e().slice(x,b+1)},t.invert=function(l){const h=t.invertRange([l,l]);return h&&h[0]},t.copy=function(){return iu().domain(e()).range(r).round(o).paddingInner(a).paddingOuter(c).align(u)},f()}function b0(t){const e=t.copy;return t.padding=t.paddingOuter,delete t.paddingInner,t.copy=function(){return b0(e())},t}function db(){return b0(iu().paddingInner(1))}var pb=Array.prototype.map;function mb(t){return pb.call(t,jr)}const gb=Array.prototype.slice;function A0(){let t=[],e=[];function n(r){return r==null||r!==r?void 0:e[(gr(t,r)-1)%e.length]}return n.domain=function(r){return arguments.length?(t=mb(r),n):t.slice()},n.range=function(r){return arguments.length?(e=gb.call(r),n):e.slice()},n.tickFormat=function(r,i){return e0(t[0],Ye(t),r??10,i)},n.copy=function(){return A0().domain(n.domain()).range(n.range())},n}const zs=new Map,xb=Symbol("vega_scale");function yb(t){return t[xb]=!0,t}function bb(t,e,n){const r=function(){const s=e();return s.invertRange||(s.invertRange=s.invert?fb(s):s.invertExtent?hb(s):void 0),s.type=t,yb(s)};return r.metadata=Ds(Ia(n)),r}function N(t,e,n){return arguments.length>1?(zs.set(t,bb(t,e,n)),this):Ab(t)?zs.get(t):void 0}N(lb,n0);N(fr,t0,Q);N(kt,jc,[Q,kt]);N(Ui,Kc,Q);N($i,rb,Q);N(Io,i0,Q);N(d0,ob,[Q,y0]);N(p0,ab,[Q,y0]);N(rt,Zc,[Q,$e]);N(`${rt}-${fr}`,Zc,[Q,$e]);N(`${rt}-${kt}`,c0,[Q,$e,kt]);N(`${rt}-${Ui}`,Qc,[Q,$e]);N(`${rt}-${$i}`,cb,[Q,$e]);N(`${rt}-${Io}`,u0,[Q,$e]);N(`${yr}-${fr}`,l0,[Q,$e]);N(`${yr}-${kt}`,f0,[Q,$e,kt]);N(`${yr}-${Ui}`,eu,[Q,$e]);N(`${yr}-${$i}`,ub,[Q,$e]);N(`${yr}-${Io}`,h0,[Q,$e]);N(Wa,s0,[Gi,Wa]);N(m0,o0,Gi);N(g0,a0,Gi);N(ru,A0,[Vi,Gi]);N(nu,Uc,Vi);N(x0,iu,Vi);N(ja,db,Vi);function Ab(t){return zs.has(t)}function Hi(t,e){const n=zs.get(t);return n&&n.metadata[e]}function me(t){return Hi(t,Q)}function Ot(t){return Hi(t,Vi)}function Hn(t){return Hi(t,Gi)}function w0(t){return Hi(t,kt)}function _o(t){return Hi(t,$e)}function wb(t,e){const n=e[0],r=Ye(e)-n;return function(i){return t(n+i*r)}}function Ro(t,e,n){return qc(v0(e||"rgb",n),t)}function vb(t,e){const n=new Array(e),r=e+1;for(let i=0;i<e;)n[i]=t(++i/r);return n}function v0(t,e){const n=qy[Eb(t)];return e!=null&&n&&n.gamma?n.gamma(e):n}function Eb(t){return"interpolate"+t.toLowerCase().split("-").map(e=>e[0].toUpperCase()+e.slice(1)).join("")}const Cb={blues:"cfe1f2bed8eca8cee58fc1de74b2d75ba3cf4592c63181bd206fb2125ca40a4a90",greens:"d3eecdc0e6baabdda594d3917bc77d60ba6c46ab5e329a512089430e7735036429",greys:"e2e2e2d4d4d4c4c4c4b1b1b19d9d9d8888887575756262624d4d4d3535351e1e1e",oranges:"fdd8b3fdc998fdb87bfda55efc9244f87f2cf06b18e4580bd14904b93d029f3303",purples:"e2e1efd4d4e8c4c5e0b4b3d6a3a0cc928ec3827cb97566ae684ea25c3696501f8c",reds:"fdc9b4fcb49afc9e80fc8767fa7051f6573fec3f2fdc2a25c81b1db21218970b13",blueGreen:"d5efedc1e8e0a7ddd18bd2be70c6a958ba9144ad77319c5d2089460e7736036429",bluePurple:"ccddecbad0e4a8c2dd9ab0d4919cc98d85be8b6db28a55a6873c99822287730f71",greenBlue:"d3eecec5e8c3b1e1bb9bd8bb82cec269c2ca51b2cd3c9fc7288abd1675b10b60a1",orangeRed:"fddcaffdcf9bfdc18afdad77fb9562f67d53ee6545e24932d32d1ebf130da70403",purpleBlue:"dbdaebc8cee4b1c3de97b7d87bacd15b9fc93a90c01e7fb70b70ab056199045281",purpleBlueGreen:"dbd8eac8cee4b0c3de93b7d872acd1549fc83892bb1c88a3097f8702736b016353",purpleRed:"dcc9e2d3b3d7ce9eccd186c0da6bb2e14da0e23189d91e6fc61159ab07498f023a",redPurple:"fccfccfcbec0faa9b8f98faff571a5ec539ddb3695c41b8aa908808d0179700174",yellowGreen:"e4f4acd1eca0b9e2949ed68880c97c62bb6e47aa5e3297502083440e723b036034",yellowOrangeBrown:"feeaa1fedd84fecc63feb746fca031f68921eb7215db5e0bc54c05ab3d038f3204",yellowOrangeRed:"fee087fed16ffebd59fea849fd903efc7335f9522bee3423de1b20ca0b22af0225",blueOrange:"134b852f78b35da2cb9dcae1d2e5eff2f0ebfce0bafbbf74e8932fc5690d994a07",brownBlueGreen:"704108a0651ac79548e3c78af3e6c6eef1eac9e9e48ed1c74da79e187a72025147",purpleGreen:"5b1667834792a67fb6c9aed3e6d6e8eff0efd9efd5aedda971bb75368e490e5e29",purpleOrange:"4114696647968f83b7b9b4d6dadbebf3eeeafce0bafbbf74e8932fc5690d994a07",redBlue:"8c0d25bf363adf745ef4ae91fbdbc9f2efeed2e5ef9dcae15da2cb2f78b3134b85",redGrey:"8c0d25bf363adf745ef4ae91fcdccbfaf4f1e2e2e2c0c0c0969696646464343434",yellowGreenBlue:"eff9bddbf1b4bde5b594d5b969c5be45b4c22c9ec02182b82163aa23479c1c3185",redYellowBlue:"a50026d4322cf16e43fcac64fedd90faf8c1dcf1ecabd6e875abd04a74b4313695",redYellowGreen:"a50026d4322cf16e43fcac63fedd8df9f7aed7ee8ea4d86e64bc6122964f006837",pinkYellowGreen:"8e0152c0267edd72adf0b3d6faddedf5f3efe1f2cab6de8780bb474f9125276419",spectral:"9e0142d13c4bf0704afcac63fedd8dfbf8b0e0f3a1a9dda269bda94288b55e4fa2",viridis:"440154470e61481a6c482575472f7d443a834144873d4e8a39568c35608d31688e2d708e2a788e27818e23888e21918d1f988b1fa08822a8842ab07f35b77943bf7154c56866cc5d7ad1518fd744a5db36bcdf27d2e21be9e51afde725",magma:"0000040404130b0924150e3720114b2c11603b0f704a107957157e651a80721f817f24828c29819a2e80a8327db6377ac43c75d1426fde4968e95462f1605df76f5cfa7f5efc8f65fe9f6dfeaf78febf84fece91fddea0fcedaffcfdbf",inferno:"0000040403130c0826170c3b240c4f330a5f420a68500d6c5d126e6b176e781c6d86216b932667a12b62ae305cbb3755c73e4cd24644dd513ae65c30ed6925f3771af8850ffb9506fca50afcb519fac62df6d645f2e661f3f484fcffa4",plasma:"0d088723069033059742039d5002a25d01a66a00a87801a88405a7900da49c179ea72198b12a90ba3488c33d80cb4779d35171da5a69e16462e76e5bed7953f2834cf68f44fa9a3dfca636fdb32ffec029fcce25f9dc24f5ea27f0f921",cividis:"00205100235800265d002961012b65042e670831690d346b11366c16396d1c3c6e213f6e26426e2c456e31476e374a6e3c4d6e42506e47536d4c566d51586e555b6e5a5e6e5e616e62646f66676f6a6a706e6d717270717573727976737c79747f7c75827f758682768985778c8877908b78938e789691789a94789e9778a19b78a59e77a9a177aea575b2a874b6ab73bbaf71c0b26fc5b66dc9b96acebd68d3c065d8c462ddc85fe2cb5ce7cf58ebd355f0d652f3da4ff7de4cfae249fce647",rainbow:"6e40aa883eb1a43db3bf3cafd83fa4ee4395fe4b83ff576eff6659ff7847ff8c38f3a130e2b72fcfcc36bee044aff05b8ff4576ff65b52f6673af27828ea8d1ddfa319d0b81cbecb23abd82f96e03d82e14c6edb5a5dd0664dbf6e40aa",sinebow:"ff4040fc582af47218e78d0bd5a703bfbf00a7d5038de70b72f41858fc2a40ff402afc5818f4720be78d03d5a700bfbf03a7d50b8de71872f42a58fc4040ff582afc7218f48d0be7a703d5bf00bfd503a7e70b8df41872fc2a58ff4040",turbo:"23171b32204a3e2a71453493493eae4b49c54a53d7485ee44569ee4074f53c7ff8378af93295f72e9ff42ba9ef28b3e926bce125c5d925cdcf27d5c629dcbc2de3b232e9a738ee9d3ff39347f68950f9805afc7765fd6e70fe667cfd5e88fc5795fb51a1f84badf545b9f140c5ec3cd0e637dae034e4d931ecd12ef4c92bfac029ffb626ffad24ffa223ff9821ff8d1fff821dff771cfd6c1af76118f05616e84b14df4111d5380fcb2f0dc0260ab61f07ac1805a313029b0f00950c00910b00",browns:"eedbbdecca96e9b97ae4a865dc9856d18954c7784cc0673fb85536ad44339f3632",tealBlues:"bce4d89dd3d181c3cb65b3c245a2b9368fae347da0306a932c5985",teals:"bbdfdfa2d4d58ac9c975bcbb61b0af4da5a43799982b8b8c1e7f7f127273006667",warmGreys:"dcd4d0cec5c1c0b8b4b3aaa7a59c9998908c8b827f7e7673726866665c5a59504e",goldGreen:"f4d166d5ca60b6c35c98bb597cb25760a6564b9c533f8f4f33834a257740146c36",goldOrange:"f4d166f8be5cf8aa4cf5983bf3852aef701be2621fd65322c54923b142239e3a26",goldRed:"f4d166f6be59f9aa51fc964ef6834bee734ae56249db5247cf4244c43141b71d3e",lightGreyRed:"efe9e6e1dad7d5cbc8c8bdb9bbaea9cd967ddc7b43e15f19df4011dc000b",lightGreyTeal:"e4eaead6dcddc8ced2b7c2c7a6b4bc64b0bf22a6c32295c11f85be1876bc",lightMulti:"e0f1f2c4e9d0b0de9fd0e181f6e072f6c053f3993ef77440ef4a3c",lightOrange:"f2e7daf7d5baf9c499fab184fa9c73f68967ef7860e8645bde515bd43d5b",lightTealBlue:"e3e9e0c0dccf9aceca7abfc859afc0389fb9328dad2f7ca0276b95255988",darkBlue:"3232322d46681a5c930074af008cbf05a7ce25c0dd38daed50f3faffffff",darkGold:"3c3c3c584b37725e348c7631ae8b2bcfa424ecc31ef9de30fff184ffffff",darkGreen:"3a3a3a215748006f4d048942489e4276b340a6c63dd2d836ffeb2cffffaa",darkMulti:"3737371f5287197d8c29a86995ce3fffe800ffffff",darkRed:"3434347036339e3c38cc4037e75d1eec8620eeab29f0ce32ffeb2c"},Sb={category10:"1f77b4ff7f0e2ca02cd627289467bd8c564be377c27f7f7fbcbd2217becf",category20:"1f77b4aec7e8ff7f0effbb782ca02c98df8ad62728ff98969467bdc5b0d58c564bc49c94e377c2f7b6d27f7f7fc7c7c7bcbd22dbdb8d17becf9edae5",category20b:"393b795254a36b6ecf9c9ede6379398ca252b5cf6bcedb9c8c6d31bd9e39e7ba52e7cb94843c39ad494ad6616be7969c7b4173a55194ce6dbdde9ed6",category20c:"3182bd6baed69ecae1c6dbefe6550dfd8d3cfdae6bfdd0a231a35474c476a1d99bc7e9c0756bb19e9ac8bcbddcdadaeb636363969696bdbdbdd9d9d9",tableau10:"4c78a8f58518e4575672b7b254a24beeca3bb279a2ff9da69d755dbab0ac",tableau20:"4c78a89ecae9f58518ffbf7954a24b88d27ab79a20f2cf5b43989483bcb6e45756ff9d9879706ebab0acd67195fcbfd2b279a2d6a5c99e765fd8b5a5",accent:"7fc97fbeaed4fdc086ffff99386cb0f0027fbf5b17666666",dark2:"1b9e77d95f027570b3e7298a66a61ee6ab02a6761d666666",paired:"a6cee31f78b4b2df8a33a02cfb9a99e31a1cfdbf6fff7f00cab2d66a3d9affff99b15928",pastel1:"fbb4aeb3cde3ccebc5decbe4fed9a6ffffcce5d8bdfddaecf2f2f2",pastel2:"b3e2cdfdcdaccbd5e8f4cae4e6f5c9fff2aef1e2cccccccc",set1:"e41a1c377eb84daf4a984ea3ff7f00ffff33a65628f781bf999999",set2:"66c2a5fc8d628da0cbe78ac3a6d854ffd92fe5c494b3b3b3",set3:"8dd3c7ffffb3bebadafb807280b1d3fdb462b3de69fccde5d9d9d9bc80bdccebc5ffed6f"};function E0(t){const e=t.length/6|0,n=new Array(e);for(let r=0;r<e;)n[r]="#"+t.slice(r*6,++r*6);return n}function C0(t,e){for(const n in t)su(n,e(t[n]))}const Vl={};C0(Sb,E0);C0(Cb,t=>Ro(E0(t)));function su(t,e){return t=t&&t.toLowerCase(),arguments.length>1?(Vl[t]=e,this):Vl[t]}function Fb(){let t=0;const e=new Map,n=r=>{let i=e.get(r);return i===void 0&&(i=t++,e.set(r,i)),i};return n.addAll=r=>{for(const i of r)n(i)},n.invert=r=>{for(const i of e.entries())if(i[1]==r)return i[0]},n.domain=()=>[...e.keys()],n}function Mo(){const t=e=>e;return t.invert=e=>e,t.copy=Mo,t.invertRange=()=>{},t.type="null",t}function Tb(t,e){const n={};e||(e=t.encoding);for(const[r,i]of Object.entries(e)){if(!i)continue;const s=((De(i)&&i.resolutionChannel)??(wn(r)&&r))||void 0,o=t.unitView.getScaleResolution(s);n[r]=Db(e[r],o==null?void 0:o.getScale(),t.unitView.getAccessor(r),r)}return n}function Db(t,e,n,r){let i;if(Xe(t)){const s=t.value;i=o=>s,i.constant=!0,i.constantValue=!0,i.accessor=void 0}else if(n)if(r=="text")i=s=>{},i.accessor=n,i.constant=n.constant;else{if(!e)if(!wn(r))e=Mo();else throw new Error(`Missing scale! "${r}": ${JSON.stringify(t)}`);if(i=s=>e(n(s)),Ot(e.type)){const s=Fb();s.addAll(e.domain()),i.indexer=s}i.constant=n.constant,i.accessor=n,i.scale=e}else throw new Error(`Missing value or accessor (field, expr, datum) on channel "${r}": ${JSON.stringify(t)}`);return i.invert=e?s=>e.invert(s):s=>{throw new Error("No scale available, cannot invert: "+JSON.stringify(t))},i.channelDef=t,i.applyMetadata=s=>{for(const o in i)o in i&&(s[o]=i[o]);return s},i}function Xe(t){return t&&"value"in t}function qi(t){return t&&"field"in t}function Wi(t){return t&&"datum"in t}function De(t){return qi(t)||Wi(t)||ou(t)||S0(t)}function Ya(t,e){const n=t.mark.encoding[e];if(De(n))return n;throw new Error("Not a channel def with scale!")}function S0(t){return t&&"chrom"in t}function ou(t){return t&&"expr"in t}const br=["x","y"],Ib=["x2","y2"],_b=[...br,...Ib];function F0(t){return br.includes(t)}function li(t){return _b.includes(t)}const au={x:"x2",y:"y2"},T0=Object.fromEntries(Object.entries(au).map(t=>[t[1],t[0]]));function zr(t){return t in T0}function Rb(t){const e=au[t];if(e)return e;throw new Error(`${t} has no secondary channel!`)}function _n(t){return T0[t]??t}function An(t){return["color","fill","stroke"].includes(_n(t))}function Bo(t){return["shape","squeeze"].includes(t)}function wn(t){return["x","y","x2","y2","color","fill","stroke","opacity","fillOpacity","strokeOpacity","strokeWidth","size","shape","angle","dx","dy","sample"].includes(t)}function Mb(t){switch(t){case"shape":return["circle","square","cross","diamond","triangle-up","triangle-right","triangle-down","triangle-left","tick-up","tick-right","tick-down","tick-left"]}}function D0(t){if(!Bo(t))throw new Error("Not a discrete channel: "+t);const e=new Map(Mb(t).map((n,r)=>[n,r]));return n=>{const r=e.get(n);if(r!==void 0)return r;throw new Error(`Invalid value for "${t}" channel: ${n}`)}}function U(t,e=t){if(/^[A-Za-z0-9_]+$/.test(t)){const n=new Function("datum",`return datum[${JSON.stringify(t)}]`);return Ut(n,[t],e)}else return io(t)}class Bb{constructor(){this.accessorCreators=[],this.register(e=>{if(qi(e))try{const n=U(e.field);return n.constant=!1,n.fields=Uf(n),n}catch(n){throw new Error(`Invalid field definition: ${n.message}`)}}),this.register(e=>ou(e)?kb(e.expr):void 0),this.register(e=>{if(Wi(e)){const r=hm(e.datum);return r.constant=!0,r.fields=[],r}})}register(e){this.accessorCreators.push(e)}createAccessor(e){for(const n of this.accessorCreators){const r=n(e);if(r)return r}}}function kb(t){const n=vo(t);return n.constant=n.fields.length==0,n}/* @license twgl.js 4.24.0 Copyright (c) 2015, Gregg Tavares All Rights Reserved.
Available via the MIT license.
see: http://github.com/greggman/twgl.js for details */const cu=5120,fi=5121,uu=5122,lu=5123,fu=5124,hu=5125,du=5126,Ob=32819,Pb=32820,Lb=33635,Nb=5131,zb=33640,Ub=35899,$b=35902,Vb=36269,Gb=34042,I0={};{const t=I0;t[cu]=Int8Array,t[fi]=Uint8Array,t[uu]=Int16Array,t[lu]=Uint16Array,t[fu]=Int32Array,t[hu]=Uint32Array,t[du]=Float32Array,t[Ob]=Uint16Array,t[Pb]=Uint16Array,t[Lb]=Uint16Array,t[Nb]=Uint16Array,t[zb]=Uint32Array,t[Ub]=Uint32Array,t[$b]=Uint32Array,t[Vb]=Uint32Array,t[Gb]=Uint32Array}function pu(t){if(t instanceof Int8Array)return cu;if(t instanceof Uint8Array||t instanceof Uint8ClampedArray)return fi;if(t instanceof Int16Array)return uu;if(t instanceof Uint16Array)return lu;if(t instanceof Int32Array)return fu;if(t instanceof Uint32Array)return hu;if(t instanceof Float32Array)return du;throw new Error("unsupported typed array type")}function Hb(t){if(t===Int8Array)return cu;if(t===Uint8Array||t===Uint8ClampedArray)return fi;if(t===Int16Array)return uu;if(t===Uint16Array)return lu;if(t===Int32Array)return fu;if(t===Uint32Array)return hu;if(t===Float32Array)return du;throw new Error("unsupported typed array type")}function qb(t){const e=I0[t];if(!e)throw new Error("unknown gl type");return e}const Us=typeof SharedArrayBuffer<"u"?function(e){return e&&e.buffer&&(e.buffer instanceof ArrayBuffer||e.buffer instanceof SharedArrayBuffer)}:function(e){return e&&e.buffer&&e.buffer instanceof ArrayBuffer};function Wb(...t){console.error(...t)}function _0(...t){console.warn(...t)}function jb(t,e){return typeof WebGLBuffer<"u"&&e instanceof WebGLBuffer}function R0(t,e){return typeof WebGLRenderbuffer<"u"&&e instanceof WebGLRenderbuffer}function ko(t,e){return typeof WebGLTexture<"u"&&e instanceof WebGLTexture}function Yb(t,e){return typeof WebGLSampler<"u"&&e instanceof WebGLSampler}const M0=35044,it=34962,Xb=34963,Kb=34660,Jb=5120,Zb=5121,Qb=5122,e2=5123,t2=5124,n2=5125,r2=5126,B0={attribPrefix:""};function k0(t,e,n,r,i){t.bindBuffer(e,n),t.bufferData(e,r,i||M0)}function O0(t,e,n,r){if(jb(t,e))return e;n=n||it;const i=t.createBuffer();return k0(t,n,i,e,r),i}function P0(t){return t==="indices"}function i2(t){return t instanceof Int8Array||t instanceof Uint8Array}function s2(t){return t===Int8Array||t===Uint8Array}function o2(t){return t.length?t:t.data}const a2=/coord|texture/i,c2=/color|colour/i;function L0(t,e){let n;if(a2.test(t)?n=2:c2.test(t)?n=4:n=3,e%n>0)throw new Error(`Can not guess numComponents for attribute '${t}'. Tried ${n} but ${e} values is not evenly divisible by ${n}. You should specify it.`);return n}function u2(t,e){return t.numComponents||t.size||L0(e,o2(t).length)}function mu(t,e){if(Us(t))return t;if(Us(t.data))return t.data;Array.isArray(t)&&(t={data:t});let n=t.type;return n||(P0(e)?n=Uint16Array:n=Float32Array),new n(t.data)}function l2(t,e){const n={};return Object.keys(e).forEach(function(r){if(!P0(r)){const i=e[r],s=i.attrib||i.name||i.attribName||B0.attribPrefix+r;if(i.value){if(!Array.isArray(i.value)&&!Us(i.value))throw new Error("array.value is not array or typedarray");n[s]={value:i.value}}else{let o,a,c,u;if(i.buffer&&i.buffer instanceof WebGLBuffer)o=i.buffer,u=i.numComponents||i.size,a=i.type,c=i.normalize;else if(typeof i=="number"||typeof i.data=="number"){const f=i.data||i,l=i.type||Float32Array,h=f*l.BYTES_PER_ELEMENT;a=Hb(l),c=i.normalize!==void 0?i.normalize:s2(l),u=i.numComponents||i.size||L0(r,f),o=t.createBuffer(),t.bindBuffer(it,o),t.bufferData(it,h,i.drawType||M0)}else{const f=mu(i,r);o=O0(t,f,void 0,i.drawType),a=pu(f),c=i.normalize!==void 0?i.normalize:i2(f),u=u2(i,r)}n[s]={buffer:o,numComponents:u,type:a,normalize:c,stride:i.stride||0,offset:i.offset||0,divisor:i.divisor===void 0?void 0:i.divisor,drawType:i.drawType}}}}),t.bindBuffer(it,null),n}function f2(t,e,n,r){n=mu(n),r!==void 0?(t.bindBuffer(it,e.buffer),t.bufferSubData(it,r,n)):k0(t,it,e.buffer,n,e.drawType)}function h2(t,e){return e===Jb||e===Zb?1:e===Qb||e===e2?2:e===t2||e===n2||e===r2?4:0}const ma=["position","positions","a_position"];function d2(t,e){let n,r;for(r=0;r<ma.length&&(n=ma[r],!(n in e||(n=B0.attribPrefix+n,n in e)));++r);r===ma.length&&(n=Object.keys(e)[0]);const i=e[n];if(!i.buffer)return 1;t.bindBuffer(it,i.buffer);const s=t.getBufferParameter(it,Kb);t.bindBuffer(it,null);const o=h2(t,i.type),a=s/o,c=i.numComponents||i.size,u=a/c;if(u%1!==0)throw new Error(`numComponents ${c} not correct for length ${length}`);return u}function p2(t,e,n){const r=l2(t,e),i=Object.assign({},n||{});i.attribs=Object.assign({},n?n.attribs:{},r);const s=e.indices;if(s){const o=mu(s,"indices");i.indices=O0(t,o,Xb),i.numElements=o.length,i.elementType=pu(o)}else i.numElements||(i.numElements=d2(t,i.attribs));return i}function Ar(t){return!!t.texStorage2D}const Xa=function(){const t={},e={};function n(r){const i=r.constructor.name;if(!t[i]){for(const s in r)if(typeof r[s]=="number"){const o=e[r[s]];e[r[s]]=o?`${o} | ${s}`:s}t[i]=!0}}return function(i,s){return n(i),e[s]||(typeof s=="number"?`0x${s.toString(16)}`:s)}}(),Wt={textureColor:new Uint8Array([128,192,255,255]),textureOptions:{},crossOrigin:void 0},hr=Us,N0=function(){let t;return function(){return t=t||(typeof document<"u"&&document.createElement?document.createElement("canvas").getContext("2d"):null),t}}(),Gl=6406,Qe=6407,q=6408,Hl=6409,ql=6410,_r=6402,Wl=34041,$s=33071,m2=9728,g2=9729,Ft=3553,Ct=34067,Pt=32879,Lt=35866,Oo=34069,x2=34070,y2=34071,b2=34072,A2=34073,w2=34074,Ka=10241,Ja=10240,Vs=10242,Gs=10243,jl=32882,v2=33082,E2=33083,C2=33084,S2=33085,gu=3317,z0=3314,U0=32878,$0=3316,V0=3315,G0=32877,F2=37443,T2=37441,D2=37440,I2=33321,_2=36756,R2=33325,M2=33326,B2=33330,k2=33329,O2=33338,P2=33337,L2=33340,N2=33339,z2=33323,U2=36757,$2=33327,V2=33328,G2=33336,H2=33335,q2=33332,W2=33331,j2=33334,Y2=33333,X2=32849,K2=35905,J2=36194,Z2=36758,Q2=35898,eA=35901,tA=34843,nA=34837,rA=36221,iA=36239,sA=36215,oA=36233,aA=36209,cA=36227,uA=32856,lA=35907,fA=36759,hA=32855,dA=32854,pA=32857,mA=34842,gA=34836,xA=36220,yA=36238,bA=36975,AA=36214,wA=36232,vA=36226,EA=36208,CA=33189,SA=33190,FA=36012,TA=36013,DA=35056,Dt=5120,H=5121,hs=5122,zn=5123,ds=5124,tn=5125,de=5126,Yl=32819,Xl=32820,Kl=33635,He=5131,Rr=36193,ga=33640,IA=35899,_A=35902,RA=36269,MA=34042,ps=33319,Un=33320,ms=6403,$n=36244,Vn=36248,nn=36249;let xa;function Po(t){if(!xa){const e={};e[Gl]={textureFormat:Gl,colorRenderable:!0,textureFilterable:!0,bytesPerElement:[1,2,2,4],type:[H,He,Rr,de]},e[Hl]={textureFormat:Hl,colorRenderable:!0,textureFilterable:!0,bytesPerElement:[1,2,2,4],type:[H,He,Rr,de]},e[ql]={textureFormat:ql,colorRenderable:!0,textureFilterable:!0,bytesPerElement:[2,4,4,8],type:[H,He,Rr,de]},e[Qe]={textureFormat:Qe,colorRenderable:!0,textureFilterable:!0,bytesPerElement:[3,6,6,12,2],type:[H,He,Rr,de,Kl]},e[q]={textureFormat:q,colorRenderable:!0,textureFilterable:!0,bytesPerElement:[4,8,8,16,2,2],type:[H,He,Rr,de,Yl,Xl]},e[_r]={textureFormat:_r,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[2,4],type:[tn,zn]},e[I2]={textureFormat:ms,colorRenderable:!0,textureFilterable:!0,bytesPerElement:[1],type:[H]},e[_2]={textureFormat:ms,colorRenderable:!1,textureFilterable:!0,bytesPerElement:[1],type:[Dt]},e[R2]={textureFormat:ms,colorRenderable:!1,textureFilterable:!0,bytesPerElement:[4,2],type:[de,He]},e[M2]={textureFormat:ms,colorRenderable:!1,textureFilterable:!1,bytesPerElement:[4],type:[de]},e[B2]={textureFormat:$n,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[1],type:[H]},e[k2]={textureFormat:$n,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[1],type:[Dt]},e[q2]={textureFormat:$n,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[2],type:[zn]},e[W2]={textureFormat:$n,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[2],type:[hs]},e[j2]={textureFormat:$n,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[4],type:[tn]},e[Y2]={textureFormat:$n,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[4],type:[ds]},e[z2]={textureFormat:ps,colorRenderable:!0,textureFilterable:!0,bytesPerElement:[2],type:[H]},e[U2]={textureFormat:ps,colorRenderable:!1,textureFilterable:!0,bytesPerElement:[2],type:[Dt]},e[$2]={textureFormat:ps,colorRenderable:!1,textureFilterable:!0,bytesPerElement:[8,4],type:[de,He]},e[V2]={textureFormat:ps,colorRenderable:!1,textureFilterable:!1,bytesPerElement:[8],type:[de]},e[G2]={textureFormat:Un,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[2],type:[H]},e[H2]={textureFormat:Un,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[2],type:[Dt]},e[O2]={textureFormat:Un,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[4],type:[zn]},e[P2]={textureFormat:Un,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[4],type:[hs]},e[L2]={textureFormat:Un,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[8],type:[tn]},e[N2]={textureFormat:Un,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[8],type:[ds]},e[X2]={textureFormat:Qe,colorRenderable:!0,textureFilterable:!0,bytesPerElement:[3],type:[H]},e[K2]={textureFormat:Qe,colorRenderable:!1,textureFilterable:!0,bytesPerElement:[3],type:[H]},e[J2]={textureFormat:Qe,colorRenderable:!0,textureFilterable:!0,bytesPerElement:[3,2],type:[H,Kl]},e[Z2]={textureFormat:Qe,colorRenderable:!1,textureFilterable:!0,bytesPerElement:[3],type:[Dt]},e[Q2]={textureFormat:Qe,colorRenderable:!1,textureFilterable:!0,bytesPerElement:[12,6,4],type:[de,He,IA]},e[eA]={textureFormat:Qe,colorRenderable:!1,textureFilterable:!0,bytesPerElement:[12,6,4],type:[de,He,_A]},e[tA]={textureFormat:Qe,colorRenderable:!1,textureFilterable:!0,bytesPerElement:[12,6],type:[de,He]},e[nA]={textureFormat:Qe,colorRenderable:!1,textureFilterable:!1,bytesPerElement:[12],type:[de]},e[rA]={textureFormat:Vn,colorRenderable:!1,textureFilterable:!1,bytesPerElement:[3],type:[H]},e[iA]={textureFormat:Vn,colorRenderable:!1,textureFilterable:!1,bytesPerElement:[3],type:[Dt]},e[sA]={textureFormat:Vn,colorRenderable:!1,textureFilterable:!1,bytesPerElement:[6],type:[zn]},e[oA]={textureFormat:Vn,colorRenderable:!1,textureFilterable:!1,bytesPerElement:[6],type:[hs]},e[aA]={textureFormat:Vn,colorRenderable:!1,textureFilterable:!1,bytesPerElement:[12],type:[tn]},e[cA]={textureFormat:Vn,colorRenderable:!1,textureFilterable:!1,bytesPerElement:[12],type:[ds]},e[uA]={textureFormat:q,colorRenderable:!0,textureFilterable:!0,bytesPerElement:[4],type:[H]},e[lA]={textureFormat:q,colorRenderable:!0,textureFilterable:!0,bytesPerElement:[4],type:[H]},e[fA]={textureFormat:q,colorRenderable:!1,textureFilterable:!0,bytesPerElement:[4],type:[Dt]},e[hA]={textureFormat:q,colorRenderable:!0,textureFilterable:!0,bytesPerElement:[4,2,4],type:[H,Xl,ga]},e[dA]={textureFormat:q,colorRenderable:!0,textureFilterable:!0,bytesPerElement:[4,2],type:[H,Yl]},e[pA]={textureFormat:q,colorRenderable:!0,textureFilterable:!0,bytesPerElement:[4],type:[ga]},e[mA]={textureFormat:q,colorRenderable:!1,textureFilterable:!0,bytesPerElement:[16,8],type:[de,He]},e[gA]={textureFormat:q,colorRenderable:!1,textureFilterable:!1,bytesPerElement:[16],type:[de]},e[xA]={textureFormat:nn,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[4],type:[H]},e[yA]={textureFormat:nn,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[4],type:[Dt]},e[bA]={textureFormat:nn,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[4],type:[ga]},e[AA]={textureFormat:nn,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[8],type:[zn]},e[wA]={textureFormat:nn,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[8],type:[hs]},e[vA]={textureFormat:nn,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[16],type:[ds]},e[EA]={textureFormat:nn,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[16],type:[tn]},e[CA]={textureFormat:_r,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[2,4],type:[zn,tn]},e[SA]={textureFormat:_r,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[4],type:[tn]},e[FA]={textureFormat:_r,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[4],type:[de]},e[DA]={textureFormat:Wl,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[4],type:[MA]},e[TA]={textureFormat:Wl,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[4],type:[RA]},Object.keys(e).forEach(function(n){const r=e[n];r.bytesPerElementMap={},r.bytesPerElement.forEach(function(i,s){const o=r.type[s];r.bytesPerElementMap[o]=i})}),xa=e}return xa[t]}function BA(t,e){const n=Po(t);if(!n)throw"unknown internal format";const r=n.bytesPerElementMap[e];if(r===void 0)throw"unknown internal format";return r}function wr(t){const e=Po(t);if(!e)throw"unknown internal format";return{format:e.textureFormat,type:e.type[0]}}function Jl(t){return(t&t-1)===0}function kA(t,e,n,r){if(!Ar(t))return Jl(e)&&Jl(n);const i=Po(r);if(!i)throw"unknown internal format";return i.colorRenderable&&i.textureFilterable}function OA(t){const e=Po(t);if(!e)throw"unknown internal format";return e.textureFilterable}function H0(t,e,n){return hr(e)?pu(e):n||H}function gs(t,e,n,r,i){if(i%1!==0)throw"can't guess dimensions";if(!n&&!r){const s=Math.sqrt(i/(e===Ct?6:1));s%1===0?(n=s,r=s):(n=i,r=1)}else if(r){if(!n&&(n=i/r,n%1))throw"can't guess dimensions"}else if(r=i/n,r%1)throw"can't guess dimensions";return{width:n,height:r}}function dr(t,e){e.colorspaceConversion!==void 0&&t.pixelStorei(F2,e.colorspaceConversion),e.premultiplyAlpha!==void 0&&t.pixelStorei(T2,e.premultiplyAlpha),e.flipY!==void 0&&t.pixelStorei(D2,e.flipY)}function q0(t){t.pixelStorei(gu,4),Ar(t)&&(t.pixelStorei(z0,0),t.pixelStorei(U0,0),t.pixelStorei($0,0),t.pixelStorei(V0,0),t.pixelStorei(G0,0))}function PA(t,e,n,r){r.minMag&&(n.call(t,e,Ka,r.minMag),n.call(t,e,Ja,r.minMag)),r.min&&n.call(t,e,Ka,r.min),r.mag&&n.call(t,e,Ja,r.mag),r.wrap&&(n.call(t,e,Vs,r.wrap),n.call(t,e,Gs,r.wrap),(e===Pt||Yb(t,e))&&n.call(t,e,jl,r.wrap)),r.wrapR&&n.call(t,e,jl,r.wrapR),r.wrapS&&n.call(t,e,Vs,r.wrapS),r.wrapT&&n.call(t,e,Gs,r.wrapT),r.minLod&&n.call(t,e,v2,r.minLod),r.maxLod&&n.call(t,e,E2,r.maxLod),r.baseLevel&&n.call(t,e,C2,r.baseLevel),r.maxLevel&&n.call(t,e,S2,r.maxLevel)}function W0(t,e,n){const r=n.target||Ft;t.bindTexture(r,e),PA(t,r,t.texParameteri,n)}function LA(t){return t=t||Wt.textureColor,hr(t)?t:new Uint8Array([t[0]*255,t[1]*255,t[2]*255,t[3]*255])}function Za(t,e,n,r,i,s){n=n||Wt.textureOptions,s=s||q;const o=n.target||Ft;if(r=r||n.width,i=i||n.height,t.bindTexture(o,e),kA(t,r,i,s))t.generateMipmap(o);else{const a=OA(s)?g2:m2;t.texParameteri(o,Ka,a),t.texParameteri(o,Ja,a),t.texParameteri(o,Vs,$s),t.texParameteri(o,Gs,$s)}}function hi(t){return t.auto===!0||t.auto===void 0&&t.level===void 0}function Qa(t,e){return e=e||{},e.cubeFaceOrder||[Oo,x2,y2,b2,A2,w2]}function ec(t,e){const r=Qa(t,e).map(function(i,s){return{face:i,ndx:s}});return r.sort(function(i,s){return i.face-s.face}),r}function j0(t,e,n,r){r=r||Wt.textureOptions;const i=r.target||Ft,s=r.level||0;let o=n.width,a=n.height;const c=r.internalFormat||r.format||q,u=wr(c),f=r.format||u.format,l=r.type||u.type;if(dr(t,r),t.bindTexture(i,e),i===Ct){const h=n.width,p=n.height;let d,m;if(h/6===p)d=p,m=[0,0,1,0,2,0,3,0,4,0,5,0];else if(p/6===h)d=h,m=[0,0,0,1,0,2,0,3,0,4,0,5];else if(h/3===p/2)d=h/3,m=[0,0,1,0,2,0,0,1,1,1,2,1];else if(h/2===p/3)d=h/2,m=[0,0,1,0,0,1,1,1,0,2,1,2];else throw"can't figure out cube map from element: "+(n.src?n.src:n.nodeName);const g=N0();g?(g.canvas.width=d,g.canvas.height=d,o=d,a=d,ec(t,r).forEach(function(x){const b=m[x.ndx*2+0]*d,A=m[x.ndx*2+1]*d;g.drawImage(n,b,A,d,d,0,0,d,d),t.texImage2D(x.face,s,c,f,l,g.canvas)}),g.canvas.width=1,g.canvas.height=1):typeof createImageBitmap<"u"&&(o=d,a=d,ec(t,r).forEach(function(x){const b=m[x.ndx*2+0]*d,A=m[x.ndx*2+1]*d;t.texImage2D(x.face,s,c,d,d,0,f,l,null),createImageBitmap(n,b,A,d,d,{premultiplyAlpha:"none",colorSpaceConversion:"none"}).then(function(E){dr(t,r),t.bindTexture(i,e),t.texImage2D(x.face,s,c,f,l,E),hi(r)&&Za(t,e,r,o,a,c)})}))}else if(i===Pt||i===Lt){const h=Math.min(n.width,n.height),p=Math.max(n.width,n.height),d=p/h;if(d%1!==0)throw"can not compute 3D dimensions of element";const m=n.width===p?1:0,g=n.height===p?1:0;t.pixelStorei(gu,1),t.pixelStorei(z0,n.width),t.pixelStorei(U0,0),t.pixelStorei(G0,0),t.texImage3D(i,s,c,h,h,h,0,f,l,null);for(let x=0;x<d;++x){const b=x*h*m,A=x*h*g;t.pixelStorei($0,b),t.pixelStorei(V0,A),t.texSubImage3D(i,s,0,0,x,h,h,1,f,l,n)}q0(t)}else t.texImage2D(i,s,c,f,l,n);hi(r)&&Za(t,e,r,o,a,c),W0(t,e,r)}function ji(){}function NA(t){if(typeof document<"u"){const e=document.createElement("a");return e.href=t,e.hostname===location.hostname&&e.port===location.port&&e.protocol===location.protocol}else{const e=new URL(location.href).origin;return new URL(t,location.href).origin===e}}function zA(t,e){return e===void 0&&!NA(t)?"anonymous":e}function UA(t,e,n){n=n||ji;let r;if(e=e!==void 0?e:Wt.crossOrigin,e=zA(t,e),typeof Image<"u"){r=new Image,e!==void 0&&(r.crossOrigin=e);const i=function(){r.removeEventListener("error",s),r.removeEventListener("load",o),r=null},s=function(){const c="couldn't load image: "+t;Wb(c),n(c,r),i()},o=function(){n(null,r),i()};return r.addEventListener("error",s),r.addEventListener("load",o),r.src=t,r}else if(typeof ImageBitmap<"u"){let i,s;const o=function(){n(i,s)},a={};e&&(a.mode="cors"),fetch(t,a).then(function(c){if(!c.ok)throw c;return c.blob()}).then(function(c){return createImageBitmap(c,{premultiplyAlpha:"none",colorSpaceConversion:"none"})}).then(function(c){s=c,setTimeout(o)}).catch(function(c){i=c,setTimeout(o)}),r=null}return r}function Y0(t){return typeof ImageBitmap<"u"&&t instanceof ImageBitmap||typeof ImageData<"u"&&t instanceof ImageData||typeof HTMLElement<"u"&&t instanceof HTMLElement}function xu(t,e,n){return Y0(t)?(setTimeout(function(){n(null,t)}),t):UA(t,e,n)}function yu(t,e,n){n=n||Wt.textureOptions;const r=n.target||Ft;if(t.bindTexture(r,e),n.color===!1)return;const i=LA(n.color);if(r===Ct)for(let s=0;s<6;++s)t.texImage2D(Oo+s,0,q,1,1,0,q,H,i);else r===Pt||r===Lt?t.texImage3D(r,0,q,1,1,1,0,q,H,i):t.texImage2D(r,0,q,1,1,0,q,H,i)}function $A(t,e,n,r){return r=r||ji,n=n||Wt.textureOptions,yu(t,e,n),n=Object.assign({},n),xu(n.src,n.crossOrigin,function(s,o){s?r(s,e,o):(j0(t,e,o,n),r(null,e,o))})}function VA(t,e,n,r){r=r||ji;const i=n.src;if(i.length!==6)throw"there must be 6 urls for a cubemap";const s=n.level||0,o=n.internalFormat||n.format||q,a=wr(o),c=n.format||a.format,u=n.type||H,f=n.target||Ft;if(f!==Ct)throw"target must be TEXTURE_CUBE_MAP";yu(t,e,n),n=Object.assign({},n);let l=6;const h=[],p=Qa(t,n);let d;function m(g){return function(x,b){--l,x?h.push(x):b.width!==b.height?h.push("cubemap face img is not a square: "+b.src):(dr(t,n),t.bindTexture(f,e),l===5?Qa().forEach(function(A){t.texImage2D(A,s,o,c,u,b)}):t.texImage2D(g,s,o,c,u,b),hi(n)&&t.generateMipmap(f)),l===0&&r(h.length?h:void 0,e,d)}}d=i.map(function(g,x){return xu(g,n.crossOrigin,m(p[x]))})}function GA(t,e,n,r){r=r||ji;const i=n.src,s=n.internalFormat||n.format||q,o=wr(s),a=n.format||o.format,c=n.type||H,u=n.target||Lt;if(u!==Pt&&u!==Lt)throw"target must be TEXTURE_3D or TEXTURE_2D_ARRAY";yu(t,e,n),n=Object.assign({},n);let f=i.length;const l=[];let h;const p=n.level||0;let d=n.width,m=n.height;const g=i.length;let x=!0;function b(A){return function(E,F){if(--f,E)l.push(E);else{if(dr(t,n),t.bindTexture(u,e),x){x=!1,d=n.width||F.width,m=n.height||F.height,t.texImage3D(u,p,s,d,m,g,0,a,c,null);for(let C=0;C<g;++C)t.texSubImage3D(u,p,0,0,C,d,m,1,a,c,F)}else{let C=F,w;(F.width!==d||F.height!==m)&&(w=N0(),C=w.canvas,w.canvas.width=d,w.canvas.height=m,w.drawImage(F,0,0,d,m)),t.texSubImage3D(u,p,0,0,A,d,m,1,a,c,C),w&&C===w.canvas&&(w.canvas.width=0,w.canvas.height=0)}hi(n)&&t.generateMipmap(u)}f===0&&r(l.length?l:void 0,e,h)}}h=i.map(function(A,E){return xu(A,n.crossOrigin,b(E))})}function X0(t,e,n,r){r=r||Wt.textureOptions;const i=r.target||Ft;t.bindTexture(i,e);let s=r.width,o=r.height,a=r.depth;const c=r.level||0,u=r.internalFormat||r.format||q,f=wr(u),l=r.format||f.format,h=r.type||H0(t,n,f.type);if(hr(n))n instanceof Uint8ClampedArray&&(n=new Uint8Array(n.buffer));else{const g=qb(h);n=new g(n)}const p=BA(u,h),d=n.byteLength/p;if(d%1)throw"length wrong size for format: "+Xa(t,l);let m;if(i===Pt||i===Lt)if(!s&&!o&&!a){const g=Math.cbrt(d);if(g%1!==0)throw"can't guess cube size of array of numElements: "+d;s=g,o=g,a=g}else s&&(!o||!a)?(m=gs(t,i,o,a,d/s),o=m.width,a=m.height):o&&(!s||!a)?(m=gs(t,i,s,a,d/o),s=m.width,a=m.height):(m=gs(t,i,s,o,d/a),s=m.width,o=m.height);else m=gs(t,i,s,o,d),s=m.width,o=m.height;if(q0(t),t.pixelStorei(gu,r.unpackAlignment||1),dr(t,r),i===Ct){const g=p/n.BYTES_PER_ELEMENT,x=d/6*g;ec(t,r).forEach(b=>{const A=x*b.ndx,E=n.subarray(A,A+x);t.texImage2D(b.face,c,u,s,o,0,l,h,E)})}else i===Pt||i===Lt?t.texImage3D(i,c,u,s,o,a,0,l,h,n):t.texImage2D(i,c,u,s,o,0,l,h,n);return{width:s,height:o,depth:a,type:h}}function HA(t,e,n){const r=n.target||Ft;t.bindTexture(r,e);const i=n.level||0,s=n.internalFormat||n.format||q,o=wr(s),a=n.format||o.format,c=n.type||o.type;if(dr(t,n),r===Ct)for(let u=0;u<6;++u)t.texImage2D(Oo+u,i,s,n.width,n.height,0,a,c,null);else r===Pt||r===Lt?t.texImage3D(r,i,s,n.width,n.height,n.depth,0,a,c,null):t.texImage2D(r,i,s,n.width,n.height,0,a,c,null)}function di(t,e,n){n=n||ji,e=e||Wt.textureOptions;const r=t.createTexture(),i=e.target||Ft;let s=e.width||1,o=e.height||1;const a=e.internalFormat||q;t.bindTexture(i,r),i===Ct&&(t.texParameteri(i,Vs,$s),t.texParameteri(i,Gs,$s));let c=e.src;if(c)if(typeof c=="function"&&(c=c(t,e)),typeof c=="string")$A(t,r,e,n);else if(hr(c)||Array.isArray(c)&&(typeof c[0]=="number"||Array.isArray(c[0])||hr(c[0]))){const u=X0(t,r,c,e);s=u.width,o=u.height}else Array.isArray(c)&&(typeof c[0]=="string"||Y0(c[0]))?i===Ct?VA(t,r,e,n):GA(t,r,e,n):(j0(t,r,c,e),s=c.width,o=c.height);else HA(t,r,e);return hi(e)&&Za(t,r,e,s,o,a),W0(t,r,e),r}function qA(t,e,n,r,i,s){r=r||n.width,i=i||n.height,s=s||n.depth;const o=n.target||Ft;t.bindTexture(o,e);const a=n.level||0,c=n.internalFormat||n.format||q,u=wr(c),f=n.format||u.format;let l;const h=n.src;if(h&&(hr(h)||Array.isArray(h)&&typeof h[0]=="number")?l=n.type||H0(t,h,u.type):l=n.type||u.type,o===Ct)for(let p=0;p<6;++p)t.texImage2D(Oo+p,a,c,r,i,0,f,l,null);else o===Pt||o===Lt?t.texImage3D(o,a,c,r,i,s,0,f,l,null):t.texImage2D(o,a,c,r,i,0,f,l,null)}const WA=_0,Hs=33984,jA=35048,Lo=34962,YA=34963,bu=35345,K0=35718,XA=35721,KA=35971,JA=35382,ZA=35396,QA=35398,ew=35392,tw=35395,No=5126,J0=35664,Z0=35665,Q0=35666,Au=5124,ed=35667,td=35668,nd=35669,rd=35670,id=35671,sd=35672,od=35673,ad=35674,cd=35675,ud=35676,nw=35678,rw=35680,iw=35679,sw=35682,ow=35685,aw=35686,cw=35687,uw=35688,lw=35689,fw=35690,hw=36289,dw=36292,pw=36293,wu=5125,ld=36294,fd=36295,hd=36296,mw=36298,gw=36299,xw=36300,yw=36303,bw=36306,Aw=36307,ww=36308,vw=36311,zo=3553,Uo=34067,vu=32879,$o=35866,R={};function dd(t,e){return R[e].bindPoint}function Ew(t,e){return function(n){t.uniform1f(e,n)}}function Cw(t,e){return function(n){t.uniform1fv(e,n)}}function Sw(t,e){return function(n){t.uniform2fv(e,n)}}function Fw(t,e){return function(n){t.uniform3fv(e,n)}}function Tw(t,e){return function(n){t.uniform4fv(e,n)}}function pd(t,e){return function(n){t.uniform1i(e,n)}}function md(t,e){return function(n){t.uniform1iv(e,n)}}function gd(t,e){return function(n){t.uniform2iv(e,n)}}function xd(t,e){return function(n){t.uniform3iv(e,n)}}function yd(t,e){return function(n){t.uniform4iv(e,n)}}function Dw(t,e){return function(n){t.uniform1ui(e,n)}}function Iw(t,e){return function(n){t.uniform1uiv(e,n)}}function _w(t,e){return function(n){t.uniform2uiv(e,n)}}function Rw(t,e){return function(n){t.uniform3uiv(e,n)}}function Mw(t,e){return function(n){t.uniform4uiv(e,n)}}function Bw(t,e){return function(n){t.uniformMatrix2fv(e,!1,n)}}function kw(t,e){return function(n){t.uniformMatrix3fv(e,!1,n)}}function Ow(t,e){return function(n){t.uniformMatrix4fv(e,!1,n)}}function Pw(t,e){return function(n){t.uniformMatrix2x3fv(e,!1,n)}}function Lw(t,e){return function(n){t.uniformMatrix3x2fv(e,!1,n)}}function Nw(t,e){return function(n){t.uniformMatrix2x4fv(e,!1,n)}}function zw(t,e){return function(n){t.uniformMatrix4x2fv(e,!1,n)}}function Uw(t,e){return function(n){t.uniformMatrix3x4fv(e,!1,n)}}function $w(t,e){return function(n){t.uniformMatrix4x3fv(e,!1,n)}}function Ae(t,e,n,r){const i=dd(t,e);return Ar(t)?function(s){let o,a;ko(t,s)?(o=s,a=null):(o=s.texture,a=s.sampler),t.uniform1i(r,n),t.activeTexture(Hs+n),t.bindTexture(i,o),t.bindSampler(n,a)}:function(s){t.uniform1i(r,n),t.activeTexture(Hs+n),t.bindTexture(i,s)}}function we(t,e,n,r,i){const s=dd(t,e),o=new Int32Array(i);for(let a=0;a<i;++a)o[a]=n+a;return Ar(t)?function(a){t.uniform1iv(r,o),a.forEach(function(c,u){t.activeTexture(Hs+o[u]);let f,l;ko(t,c)?(f=c,l=null):(f=c.texture,l=c.sampler),t.bindSampler(n,l),t.bindTexture(s,f)})}:function(a){t.uniform1iv(r,o),a.forEach(function(c,u){t.activeTexture(Hs+o[u]),t.bindTexture(s,c)})}}R[No]={Type:Float32Array,size:4,setter:Ew,arraySetter:Cw};R[J0]={Type:Float32Array,size:8,setter:Sw,cols:2};R[Z0]={Type:Float32Array,size:12,setter:Fw,cols:3};R[Q0]={Type:Float32Array,size:16,setter:Tw,cols:4};R[Au]={Type:Int32Array,size:4,setter:pd,arraySetter:md};R[ed]={Type:Int32Array,size:8,setter:gd,cols:2};R[td]={Type:Int32Array,size:12,setter:xd,cols:3};R[nd]={Type:Int32Array,size:16,setter:yd,cols:4};R[wu]={Type:Uint32Array,size:4,setter:Dw,arraySetter:Iw};R[ld]={Type:Uint32Array,size:8,setter:_w,cols:2};R[fd]={Type:Uint32Array,size:12,setter:Rw,cols:3};R[hd]={Type:Uint32Array,size:16,setter:Mw,cols:4};R[rd]={Type:Uint32Array,size:4,setter:pd,arraySetter:md};R[id]={Type:Uint32Array,size:8,setter:gd,cols:2};R[sd]={Type:Uint32Array,size:12,setter:xd,cols:3};R[od]={Type:Uint32Array,size:16,setter:yd,cols:4};R[ad]={Type:Float32Array,size:32,setter:Bw,rows:2,cols:2};R[cd]={Type:Float32Array,size:48,setter:kw,rows:3,cols:3};R[ud]={Type:Float32Array,size:64,setter:Ow,rows:4,cols:4};R[ow]={Type:Float32Array,size:32,setter:Pw,rows:2,cols:3};R[aw]={Type:Float32Array,size:32,setter:Nw,rows:2,cols:4};R[cw]={Type:Float32Array,size:48,setter:Lw,rows:3,cols:2};R[uw]={Type:Float32Array,size:48,setter:Uw,rows:3,cols:4};R[lw]={Type:Float32Array,size:64,setter:zw,rows:4,cols:2};R[fw]={Type:Float32Array,size:64,setter:$w,rows:4,cols:3};R[nw]={Type:null,size:0,setter:Ae,arraySetter:we,bindPoint:zo};R[rw]={Type:null,size:0,setter:Ae,arraySetter:we,bindPoint:Uo};R[iw]={Type:null,size:0,setter:Ae,arraySetter:we,bindPoint:vu};R[sw]={Type:null,size:0,setter:Ae,arraySetter:we,bindPoint:zo};R[hw]={Type:null,size:0,setter:Ae,arraySetter:we,bindPoint:$o};R[dw]={Type:null,size:0,setter:Ae,arraySetter:we,bindPoint:$o};R[pw]={Type:null,size:0,setter:Ae,arraySetter:we,bindPoint:Uo};R[mw]={Type:null,size:0,setter:Ae,arraySetter:we,bindPoint:zo};R[gw]={Type:null,size:0,setter:Ae,arraySetter:we,bindPoint:vu};R[xw]={Type:null,size:0,setter:Ae,arraySetter:we,bindPoint:Uo};R[yw]={Type:null,size:0,setter:Ae,arraySetter:we,bindPoint:$o};R[bw]={Type:null,size:0,setter:Ae,arraySetter:we,bindPoint:zo};R[Aw]={Type:null,size:0,setter:Ae,arraySetter:we,bindPoint:vu};R[ww]={Type:null,size:0,setter:Ae,arraySetter:we,bindPoint:Uo};R[vw]={Type:null,size:0,setter:Ae,arraySetter:we,bindPoint:$o};function Vo(t,e){return function(n){if(n.value)switch(t.disableVertexAttribArray(e),n.value.length){case 4:t.vertexAttrib4fv(e,n.value);break;case 3:t.vertexAttrib3fv(e,n.value);break;case 2:t.vertexAttrib2fv(e,n.value);break;case 1:t.vertexAttrib1fv(e,n.value);break;default:throw new Error("the length of a float constant value must be between 1 and 4!")}else t.bindBuffer(Lo,n.buffer),t.enableVertexAttribArray(e),t.vertexAttribPointer(e,n.numComponents||n.size,n.type||No,n.normalize||!1,n.stride||0,n.offset||0),n.divisor!==void 0&&t.vertexAttribDivisor(e,n.divisor)}}function jt(t,e){return function(n){if(n.value)if(t.disableVertexAttribArray(e),n.value.length===4)t.vertexAttrib4iv(e,n.value);else throw new Error("The length of an integer constant value must be 4!");else t.bindBuffer(Lo,n.buffer),t.enableVertexAttribArray(e),t.vertexAttribIPointer(e,n.numComponents||n.size,n.type||Au,n.stride||0,n.offset||0),n.divisor!==void 0&&t.vertexAttribDivisor(e,n.divisor)}}function Go(t,e){return function(n){if(n.value)if(t.disableVertexAttribArray(e),n.value.length===4)t.vertexAttrib4uiv(e,n.value);else throw new Error("The length of an unsigned integer constant value must be 4!");else t.bindBuffer(Lo,n.buffer),t.enableVertexAttribArray(e),t.vertexAttribIPointer(e,n.numComponents||n.size,n.type||wu,n.stride||0,n.offset||0),n.divisor!==void 0&&t.vertexAttribDivisor(e,n.divisor)}}function Eu(t,e,n){const r=n.size,i=n.count;return function(s){t.bindBuffer(Lo,s.buffer);const o=s.size||s.numComponents||r,a=o/i,c=s.type||No,f=R[c].size*o,l=s.normalize||!1,h=s.offset||0,p=f/i;for(let d=0;d<i;++d)t.enableVertexAttribArray(e+d),t.vertexAttribPointer(e+d,a,c,l,f,h+p*d),s.divisor!==void 0&&t.vertexAttribDivisor(e+d,s.divisor)}}const K={};K[No]={size:4,setter:Vo};K[J0]={size:8,setter:Vo};K[Z0]={size:12,setter:Vo};K[Q0]={size:16,setter:Vo};K[Au]={size:4,setter:jt};K[ed]={size:8,setter:jt};K[td]={size:12,setter:jt};K[nd]={size:16,setter:jt};K[wu]={size:4,setter:Go};K[ld]={size:8,setter:Go};K[fd]={size:12,setter:Go};K[hd]={size:16,setter:Go};K[rd]={size:4,setter:jt};K[id]={size:8,setter:jt};K[sd]={size:12,setter:jt};K[od]={size:16,setter:jt};K[ad]={size:4,setter:Eu,count:2};K[cd]={size:9,setter:Eu,count:3};K[ud]={size:16,setter:Eu,count:4};function bd(t){const e=t.name;return e.startsWith("gl_")||e.startsWith("webgl_")}const Vw=/(\.|\[|]|\w+)/g,Gw=t=>t>="0"&&t<="9";function Ad(t,e,n,r){const i=t.split(Vw).filter(a=>a!=="");let s=0,o="";for(;;){const a=i[s++];o+=a;const c=Gw(a[0]),u=c?parseInt(a):a;if(c&&(o+=i[s++]),s===i.length){n[u]=e;break}else{const l=i[s++],h=l==="[",p=n[u]||(h?[]:{});n[u]=p,n=p,r[o]=r[o]||function(d){return function(m){vd(d,m)}}(p),o+=l}}}function Hw(t,e){let n=0;function r(a,c,u){const f=c.name.endsWith("[0]"),l=c.type,h=R[l];if(!h)throw new Error(`unknown type: 0x${l.toString(16)}`);let p;if(h.bindPoint){const d=n;n+=c.size,f?p=h.arraySetter(t,l,d,u,c.size):p=h.setter(t,l,d,u,c.size)}else h.arraySetter&&f?p=h.arraySetter(t,u):p=h.setter(t,u);return p.location=u,p}const i={},s={},o=t.getProgramParameter(e,K0);for(let a=0;a<o;++a){const c=t.getActiveUniform(e,a);if(bd(c))continue;let u=c.name;u.endsWith("[0]")&&(u=u.substr(0,u.length-3));const f=t.getUniformLocation(e,c.name);if(f){const l=r(e,c,f);i[u]=l,Ad(u,l,s,i)}}return i}function qw(t,e){const n={},r=t.getProgramParameter(e,KA);for(let i=0;i<r;++i){const s=t.getTransformFeedbackVarying(e,i);n[s.name]={index:i,type:s.type,size:s.size}}return n}function Ww(t,e){const n=t.getProgramParameter(e,K0),r=[],i=[];for(let a=0;a<n;++a){i.push(a),r.push({});const c=t.getActiveUniform(e,a);r[a].name=c.name}[["UNIFORM_TYPE","type"],["UNIFORM_SIZE","size"],["UNIFORM_BLOCK_INDEX","blockNdx"],["UNIFORM_OFFSET","offset"]].forEach(function(a){const c=a[0],u=a[1];t.getActiveUniforms(e,i,t[c]).forEach(function(f,l){r[l][u]=f})});const s={},o=t.getProgramParameter(e,JA);for(let a=0;a<o;++a){const c=t.getActiveUniformBlockName(e,a),u={index:t.getUniformBlockIndex(e,c),usedByVertexShader:t.getActiveUniformBlockParameter(e,a,ZA),usedByFragmentShader:t.getActiveUniformBlockParameter(e,a,QA),size:t.getActiveUniformBlockParameter(e,a,ew),uniformIndices:t.getActiveUniformBlockParameter(e,a,tw)};u.used=u.usedByVertexShader||u.usedByFragmentShader,s[c]=u}return{blockSpecs:s,uniformData:r}}const Zl=/\[\d+\]\.$/,jw=(t,e)=>((t+(e-1))/e|0)*e;function Yw(t,e,n,r){if(e||n){r=r||1;const s=t.length/4;return function(o){let a=0,c=0;for(let u=0;u<s;++u){for(let f=0;f<r;++f)t[a++]=o[c++];a+=4-r}}}else return function(i){i.length?t.set(i):t[0]=i}}function Xw(t,e,n,r){const i=n.blockSpecs,s=n.uniformData,o=i[r];if(!o)return WA("no uniform block object named:",r),{name:r,uniforms:{}};const a=new ArrayBuffer(o.size),c=t.createBuffer(),u=o.index;t.bindBuffer(bu,c),t.uniformBlockBinding(e,o.index,u);let f=r+".";Zl.test(f)&&(f=f.replace(Zl,"."));const l={},h={},p={};return o.uniformIndices.forEach(function(d){const m=s[d];let g=m.name;g.startsWith(f)&&(g=g.substr(f.length));const x=g.endsWith("[0]");x&&(g=g.substr(0,g.length-3));const b=R[m.type],A=b.Type,E=x?jw(b.size,16)*m.size:b.size*m.size,F=new A(a,m.offset,E/A.BYTES_PER_ELEMENT);l[g]=F;const C=Yw(F,x,b.rows,b.cols);h[g]=C,Ad(g,C,p,h)}),{name:r,array:a,asFloat:new Float32Array(a),buffer:c,uniforms:l,setters:h}}function ya(t,e,n){return Xw(t,e.program,e.uniformBlockSpec,n)}function wd(t,e,n){const i=(e.uniformBlockSpec||e).blockSpecs[n.name];if(i){const s=i.index;return t.bindBufferRange(bu,s,n.buffer,n.offset||0,n.array.byteLength),!0}return!1}function ba(t,e,n){wd(t,e,n)&&t.bufferData(bu,n.array,jA)}function Rn(t,e){const n=t.setters;for(const r in e){const i=n[r];if(i){const s=e[r];i(s)}}}function vd(t,e){for(const n in e){const r=t[n];typeof r=="function"?r(e[n]):vd(t[n],e[n])}}function cn(t,...e){const n=t.uniformSetters||t,r=e.length;for(let i=0;i<r;++i){const s=e[i];if(Array.isArray(s)){const o=s.length;for(let a=0;a<o;++a)cn(n,s[a])}else for(const o in s){const a=n[o];a&&a(s[o])}}}function Kw(t,e){const n={},r=t.getProgramParameter(e,XA);for(let i=0;i<r;++i){const s=t.getActiveAttrib(e,i);if(bd(s))continue;const o=t.getAttribLocation(e,s.name),a=K[s.type],c=a.setter(t,o,a);c.location=o,n[s.name]=c}return n}function Jw(t,e){for(const n in e){const r=t[n];r&&r(e[n])}}function vr(t,e,n){n.vertexArrayObject?t.bindVertexArray(n.vertexArrayObject):(Jw(e.attribSetters||e,n.attribs),n.indices&&t.bindBuffer(YA,n.indices))}function Zw(t,e){const n=Hw(t,e),r=Kw(t,e),i={program:e,uniformSetters:n,attribSetters:r};return Ar(t)&&(i.uniformBlockSpec=Ww(t,e),i.transformFeedbackInfo=qw(t,e)),i}const Qw=4,Ql=5123;function Yi(t,e,n,r,i,s){n=n===void 0?Qw:n;const o=e.indices,a=e.elementType,c=r===void 0?e.numElements:r;i=i===void 0?0:i,a||o?s!==void 0?t.drawElementsInstanced(n,c,a===void 0?Ql:e.elementType,i,s):t.drawElements(n,c,a===void 0?Ql:e.elementType,i):s!==void 0?t.drawArraysInstanced(n,i,c,s):t.drawArrays(n,i,c)}const ev=36160,un=36161,tv=3553,nv=5121,rv=6402,iv=6408,sv=33190,ov=36012,av=35056,cv=36013,uv=32854,lv=32855,fv=36194,Ed=33189,Cd=6401,Sd=36168,Cu=34041,tc=36064,Ho=36096,Fd=36128,Su=33306,nc=33071,rc=9729,Td=[{format:iv,type:nv,min:rc,wrap:nc},{format:Cu}],Ke={};Ke[Cu]=Su;Ke[Cd]=Fd;Ke[Sd]=Fd;Ke[rv]=Ho;Ke[Ed]=Ho;Ke[sv]=Ho;Ke[ov]=Ho;Ke[av]=Su;Ke[cv]=Su;function hv(t,e){return Ke[t]||Ke[e]}const Yt={};Yt[uv]=!0;Yt[lv]=!0;Yt[fv]=!0;Yt[Cu]=!0;Yt[Ed]=!0;Yt[Cd]=!0;Yt[Sd]=!0;function dv(t){return Yt[t]}const pv=32;function mv(t){return t>=tc&&t<tc+pv}function gv(t,e,n,r){const i=ev,s=t.createFramebuffer();t.bindFramebuffer(i,s),n=n||t.drawingBufferWidth,r=r||t.drawingBufferHeight,e=e||Td;const o=[],a={framebuffer:s,attachments:[],width:n,height:r};return e.forEach(function(c,u){let f=c.attachment;const l=c.samples,h=c.format;let p=c.attachmentPoint||hv(h,c.internalFormat);if(p||(p=tc+u),mv(p)&&o.push(p),!f)if(l!==void 0||dv(h))f=t.createRenderbuffer(),t.bindRenderbuffer(un,f),l>1?t.renderbufferStorageMultisample(un,l,h,n,r):t.renderbufferStorage(un,h,n,r);else{const d=Object.assign({},c);d.width=n,d.height=r,d.auto===void 0&&(d.auto=!1,d.min=d.min||d.minMag||rc,d.mag=d.mag||d.minMag||rc,d.wrapS=d.wrapS||d.wrap||nc,d.wrapT=d.wrapT||d.wrap||nc),f=di(t,d)}if(R0(t,f))t.framebufferRenderbuffer(i,p,un,f);else if(ko(t,f))c.layer!==void 0?t.framebufferTextureLayer(i,p,f,c.level||0,c.layer):t.framebufferTexture2D(i,p,c.target||tv,f,c.level||0);else throw new Error("unknown attachment type");a.attachments.push(f)}),t.drawBuffers&&t.drawBuffers(o),a}function xv(t,e,n,r,i){r=r||t.drawingBufferWidth,i=i||t.drawingBufferHeight,e.width=r,e.height=i,n=n||Td,n.forEach(function(s,o){const a=e.attachments[o],c=s.format,u=s.samples;if(u!==void 0||R0(t,a))t.bindRenderbuffer(un,a),u>1?t.renderbufferStorageMultisample(un,u,c,r,i):t.renderbufferStorage(un,c,r,i);else if(ko(t,a))qA(t,a,s,r,i);else throw new Error("unknown attachment type")})}function yv(t,e,n){const r=t.createVertexArray();return t.bindVertexArray(r),e.length||(e=[e]),e.forEach(function(i){vr(t,i,n)}),t.bindVertexArray(null),{numElements:n.numElements,elementType:n.elementType,vertexArrayObject:r}}const bv=/^(.*?)_/;function Av(t,e){Xa(t,0);const n=t.getExtension(e);if(n){const r={},i=bv.exec(e)[1],s="_"+i;for(const o in n){const a=n[o],c=typeof a=="function",u=c?i:s;let f=o;o.endsWith(u)&&(f=o.substring(0,o.length-u.length)),t[f]!==void 0?!c&&t[f]!==a&&_0(f,t[f],a,o):c?t[f]=function(l){return function(){return l.apply(n,arguments)}}(a):(t[f]=a,r[f]=a)}r.constructor={name:n.constructor.name},Xa(r,0)}return n}const ef=["ANGLE_instanced_arrays","EXT_blend_minmax","EXT_color_buffer_float","EXT_color_buffer_half_float","EXT_disjoint_timer_query","EXT_disjoint_timer_query_webgl2","EXT_frag_depth","EXT_sRGB","EXT_shader_texture_lod","EXT_texture_filter_anisotropic","OES_element_index_uint","OES_standard_derivatives","OES_texture_float","OES_texture_float_linear","OES_texture_half_float","OES_texture_half_float_linear","OES_vertex_array_object","WEBGL_color_buffer_float","WEBGL_compressed_texture_atc","WEBGL_compressed_texture_etc1","WEBGL_compressed_texture_pvrtc","WEBGL_compressed_texture_s3tc","WEBGL_compressed_texture_s3tc_srgb","WEBGL_depth_texture","WEBGL_draw_buffers"];function Dd(t){for(let e=0;e<ef.length;++e)Av(t,ef[e])}function wv(t,e){const n=["webgl2","webgl","experimental-webgl"];let r=null;for(let i=0;i<n.length;++i)if(r=t.getContext(n[i],e),r){Dd(r);break}return r}function vv(t,e){return wv(t,e)}const Ev=`uniform Mark{uniform float uMinWidth;uniform float uMinHeight;uniform float uMinOpacity;uniform float uCornerRadiusTopRight;uniform float uCornerRadiusBottomRight;uniform float uCornerRadiusTopLeft;uniform float uCornerRadiusBottomLeft;};/***The vertex position wrt the rectangle specified by(x,x2,y,y2).*[0,0]=[x,y],[1,1]=[x2,y2].*The x or y component may contain fractional values if the rectangle*have been tessellated.*/in vec2 frac;out lowp vec4 vFillColor;out lowp vec4 vStrokeColor;out float vHalfStrokeWidth;out vec4 vCornerRadii;
#if defined(ROUNDED_CORNERS) || defined(STROKED)
out vec2 vPosInPixels;
#endif
out vec2 vHalfSizeInPixels;/***Clamps the minimumSize and returns an opacity that reflects the amount of clamping.*/float clampMinSize(inout float pos,float frac,float size,float minSize){if(minSize>0.0&&abs(size)<minSize){pos+=(frac-0.5)*(minSize*sign(size)-size);return abs(size)/minSize;}return 1.0;}void sort(inout float a,inout float b){if(a>b){float tmp=b;b=a;a=tmp;}}void main(void){vec2 normalizedMinSize=vec2(uMinWidth,uMinHeight)/uViewportSize;vec4 cornerRadii=vec4(uCornerRadiusTopRight,uCornerRadiusBottomRight,uCornerRadiusBottomLeft,uCornerRadiusTopLeft);float x=getScaled_x();float x2=getScaled_x2();float y=getScaled_y();float y2=getScaled_y2();sort(x,x2);sort(y,y2);float clampMargin=1.0;vec2 pos1=vec2(clamp(x,0.0-clampMargin,1.0+clampMargin),y);vec2 pos2=vec2(clamp(x2,0.0-clampMargin,1.0+clampMargin),y2);vec2 size=pos2-pos1;if(size.x<=0.0||size.y<=0.0){gl_Position=vec4(0.0,0.0,0.0,1.0);return;}vec2 pos=pos1+frac*size;size.y*=getSampleFacetHeight(pos);float opaFactor=uViewOpacity*max(uMinOpacity,clampMinSize(pos.x,frac.x,size.x,normalizedMinSize.x)*clampMinSize(pos.y,frac.y,size.y,normalizedMinSize.y));pos=applySampleFacet(pos);
#if defined(ROUNDED_CORNERS) || defined(STROKED)
float aaPadding=1.0/uDevicePixelRatio;float strokeWidth=getScaled_strokeWidth();float strokeOpacity=getScaled_strokeOpacity()*opaFactor;vec2 centeredFrac=frac-0.5;vec2 expand=centeredFrac*(strokeWidth+aaPadding)/uViewportSize;pos+=expand;vec2 sizeInPixels=size*uViewportSize;vPosInPixels=(centeredFrac+expand/size)*sizeInPixels;vHalfSizeInPixels=sizeInPixels/2.0;vCornerRadii=min(cornerRadii,min(vHalfSizeInPixels.x,vHalfSizeInPixels.y));vHalfStrokeWidth=strokeWidth/2.0;vStrokeColor=vec4(getScaled_stroke()*strokeOpacity,strokeOpacity);
#endif
gl_Position=unitToNdc(pos);float fillOpacity=getScaled_fillOpacity()*opaFactor;vFillColor=vec4(getScaled_fill()*fillOpacity,fillOpacity);setupPicking();}`,Cv=`#if defined(ROUNDED_CORNERS) || defined(STROKED)
in vec2 vPosInPixels;
#endif
in vec2 vHalfSizeInPixels;in lowp vec4 vFillColor;in lowp vec4 vStrokeColor;in float vHalfStrokeWidth;in vec4 vCornerRadii;out lowp vec4 fragColor;float sdRoundedBox(vec2 p,vec2 b,vec4 r){r.xy=p.x>0.0 ? r.xy : r.zw;r.x=p.y>0.0 ? r.x  : r.y;vec2 q=abs(p)-b+r.x;return min(max(q.x,q.y),0.0)+length(max(q,0.0))-r.x;}float sdSharpBox(vec2 p,vec2 b){vec2 q=abs(p)-b;return max(q.x,q.y);}void main(void){
#if defined(ROUNDED_CORNERS) || defined(STROKED)
#ifdef ROUNDED_CORNERS
float d=sdRoundedBox(vPosInPixels,vHalfSizeInPixels,vCornerRadii);
#else
float d=sdSharpBox(vPosInPixels,vHalfSizeInPixels);
#endif
fragColor=distanceToColor(d,vFillColor,vStrokeColor,vHalfStrokeWidth);if(fragColor.a==0.0){discard;}
#else
fragColor=vFillColor;
#endif
if(uPickingEnabled){fragColor=vPickingColor;}}`,Fu="attr_",Id="uDomain_",Sv="range_",tf="scale_",_d="getScaled_",ic="uRangeTexture_",nf=3402823466e29;function Fv(t){const e=t.match(/^(?:(\w+)-)?(\w+)$/);if(!e)throw new Error("Not a scale type: "+t);return{family:e[1]||"continuous",transform:e[2]}}function Tv(t,e){let n;if(Bo(t))n=ln(D0(t)(e));else if(V(e))if(An(t))n=Iv(e);else throw new Error(`String values are not supported on the "${t}" channel: ${e}`);else if(_i(e))n=ln(e?1:0);else if(e===null)if(An(t))n=ln([0,0,0]);else throw new Error(`null value is not supported on the "${t}" chanel.`);else n=ln(e);return`
#define ${t}_DEFINED
${n.type} ${_d}${t}() {
    // Constant value
    return ${n};
}`}function Dv(t,e,n){if(Xe(n))throw new Error(`Cannot create scale for "value": ${JSON.stringify(n)}`);if(!e)throw new Error("Scale is undefined");const r=_n(t),i=Fu+t,s=Id+r,o=Sv+r,a=qs(e.type),c=a?"vec2":"float",u=e.domain?e.domain().length:void 0;let f;const l=[];l.push(""),l.push("/".repeat(70)),l.push(`// Channel: ${t}`),l.push(""),l.push(`#define ${t}_DEFINED`);const{transform:h}=Fv(e.type),p=(w,...L)=>_v.apply(null,[w,"value",...L]);let d;switch(h){case"linear":d=p("scaleLinear","domain",o);break;case"log":d=p("scaleLog","domain",o,e.base());break;case"symlog":d=p("scaleSymlog","domain",o,e.constant());break;case"pow":case"sqrt":d=p("scalePow","domain",o,e.exponent());break;case"index":case"locus":d=p("scaleBandHp","domain",o,e.paddingInner(),e.paddingOuter(),e.align(),n.band??.5);break;case"point":case"band":d=p("scaleBand","domain",o,e.paddingInner(),e.paddingOuter(),e.align(),n.band??.5);break;case"ordinal":case"null":case"identity":d=p("scaleIdentity");break;case"threshold":break;default:throw new Error(`Unsupported scale type: ${e.type}! ${t}: ${JSON.stringify(n)}`)}const m=_o(e.type)||me(e.type)&&An(t)?[0,1]:e.range?e.range():void 0;if(m&&t==r&&m.length&&m.every(be)){const w=rf(m);l.push(`const ${w.type} ${o} = ${w};`)}const g=An(t)?"vec3":"float";let x;if(An(t)){const w=ic+r;if(t==r&&l.push(`uniform sampler2D ${w};`),me(e.type))x=`getInterpolatedColor(${w}, transformed)`;else if(Ot(e.type)||Hn(e.type))x=`getDiscreteColor(${w}, int(transformed))`;else throw new Error("Problem with color scale!")}else if(e.type==="ordinal"||Hn(e.type)){const w=ic+r;t==r&&l.push(`uniform sampler2D ${w};`),x=`getDiscreteColor(${w}, int(transformed)).r`}Wi(n)?l.push(`uniform highp ${c} ${i};`):l.push(`in highp ${c} ${i};`);const b=[],A=me(e.type)&&u>2,E=Hn(e.type)||A;if(b.push("int slot = 0;"),E){const w=s;b.push(A?`while (slot < ${w}.length() - 2 && value >= ${w}[slot + 1]) { slot++; }`:`while (slot < ${w}.length() && value >= ${w}[slot]) { slot++; }`)}const F=me(e.type)||Hn(e.type)||["band","point"].includes(e.type);if(d){const w=s;F&&(a?b.push(`vec3 domain = ${w};`):b.push(`vec2 domain = vec2(${w}[slot], ${w}[slot + 1]);`)),b.push(`float transformed = ${d};`),A&&b.push(`transformed = (float(slot) + transformed) / (float(${w}.length() - 1));`)}else b.push("float transformed = float(slot);");"clamp"in e&&e.clamp()&&b.push(`transformed = clampToRange(transformed, ${rf(m)});`),b.push(`return ${x??"transformed"};`),l.push(`
${g} ${tf}${t}(${c} value) {
${b.map(w=>`    ${w}
`).join("")}
}`),l.push(`
${g} ${_d}${t}() {
    return ${tf}${t}(${i});
}`);const C=l.join(`
`);if(F&&t==r){const w=me(e.type)||Hn(e.type)?u:2;f=a?`highp vec3 ${s};`:`mediump float ${s}[${w}];`}return{glsl:C,domainUniform:f}}function sc(t){if(!be(t))throw new Error(`Not a number: ${t}`);if(t==1/0)return""+nf;if(t==-1/0)return""+-nf;{let e=`${t}`;return/^(-)?\d+$/.test(e)&&(e+=".0"),e}}function ln(t){typeof t=="number"&&(t=[t]);const e=t.length;if(e<1||e>4)throw new Error("Invalid number of components: "+e);let n,r;return e>1?(n=`vec${e}`,r=`${n}(${t.map(sc).join(", ")})`):(n="float",r=sc(t[0])),Object.assign(r,{type:n,numComponents:e})}function Iv(t){const e=Bt(t).rgb();return ln([e.r,e.g,e.b].map(n=>n/255))}function rf(t){return ln([t[0],Bi(t)])}function _v(t,...e){const n=[];for(const r of e)be(r)?n.push(sc(r)):Me(r)?n.push(ln(r)):n.push(r);return`${t}(${n.join(", ")})`}function qs(t){return t=="index"||t=="locus"}const Rd=2**11,Rv=Rd-1;function Md(t,e=[]){const n=t&Rv,r=t-n;return e[0]=r,e[1]=n,e}function Mv(t){const e=t%Rd;return[t-e,e]}function Bv(t){return[...Mv(t[0]),t[1]-t[0]]}class kv{constructor(e){this.size=e,this.arrays={},this.pushers=[],this.dataUpdaters=[],this.vertexCount=0}addConverter(e,n){const r=this.createUpdater(Fu+e,n.numComponents||1,n.arrayReference),i=n.f;this.dataUpdaters.push(n.arrayReference?s=>r(i(s)):s=>r(i(s)))}createUpdater(e,n,r){if(!be(this.size))throw new Error("The number of vertices must be defined!");let i,s,o=0;const a=new Float32Array(this.size*n);if(this.arrays[e]={data:a,numComponents:n},n==1){let c=0;const u=f=>{c=+f};i=()=>{a[o++]=c},s=u}else{let c=r??[0];const u=r?f=>{}:f=>{c=f};switch(n){case 1:break;case 2:i=()=>{a[o++]=c[0],a[o++]=c[1]},s=u;break;case 3:i=()=>{a[o++]=c[0],a[o++]=c[1],a[o++]=c[2]},s=u;break;case 4:i=()=>{a[o++]=c[0],a[o++]=c[1],a[o++]=c[2],a[o++]=c[3]},s=u;break;default:throw new Error("Invalid numComponents: "+n)}}return this.pushers.push(i),s}_unrollPushAll(){let e="",n="";for(let i=0;i<this.pushers.length;i++)e+=`const p${i} = that.pushers[${i}];
`,n+=`p${i}();
`;const r=new Function("that",`${e}

            return function unrolledPushAll() {
                ${n}
                that.vertexCount++;
            };
        `);this.pushAll=r(this)}pushAll(){this.size>1e5?this._unrollPushAll():this.pushAll=()=>{for(let n=0;n<this.pushers.length;n++)this.pushers[n]();this.vertexCount++},this.pushAll()}updateFromDatum(e){for(let n=0;n<this.dataUpdaters.length;n++)this.dataUpdaters[n](e)}pushFromDatum(e){this.updateFromDatum(e),this.pushAll()}}const Wn=5,Aa=127;function oc(t){const e=[];for(let d=0;d<=Aa;d++)e.push(void 0);const n=new Map;for(const d of t.chars)d.id<=Aa?e[d.id]=d:n.set(d.id,d);const r=8722;n.has(r)||n.set(r,e["-".charCodeAt(0)]);function i(d){return(d<=Aa?e[d]:n.get(d))||e[63]}function s(d){return i(d.charCodeAt(0))}const o=t.common.base,a=s("x"),c=s("X"),u=s("q"),f=a.height-Wn*2,l=c.height-Wn*2,h=u.height-a.height+u.yoffset-a.yoffset;function p(d,m=1){let g=0;for(let x=0;x<d.length;x++)g+=i(d.charCodeAt(x)).xadvance;return g/o*m}return{measureWidth:p,getCharByCode:i,getChar:s,xHeight:f,capHeight:l,descent:h,common:t.common}}const sf=2**31-1,Ov=-(2**31);function Pv(t,e,n,r=n){const i=new Int32Array(t);i.fill(sf);let s=Ov,o=!1;const a=new Int32Array(t),c=e[0],f=(e[1]-e[0])/t,l=(g,x)=>{const b=(g-c)/f,A=Math.floor(b);return ai(x&&A==b?A-1:A,0,t-1)};function h(g,x,b){x>s?s=x:o||(o=!0,console.debug("Items are not ordered properly. Disabling binned index."));const A=n(g),E=l(A,!1);i[E]>x&&(i[E]=x),a[E]<b&&(a[E]=b)}function p(g,x,b){x>s?s=x:o||(o=!0,console.debug("Items are not ordered properly. Disabling binned index."));const A=n(g),E=r(g),F=l(A,!1),C=l(E,!0);for(let w=F;w<=C;w++)i[w]>x&&(i[w]=x),a[w]<b&&(a[w]=b)}const d=(g,x,b=[0,0])=>{const A=l(g,!1),E=l(x,!0),F=i[A],C=Math.max(a[E],F);return b[0]=F,b[1]=C,b},m=()=>{for(let x=1;x<a.length;x++)a[x]<a[x-1]&&(a[x]=a[x-1]);let g=!0;for(let x=i.length-1;x>0;x--)g&&i[x]==sf?(i[x]=a[x],g=!1):i[x-1]>i[x]&&(i[x-1]=i[x]);return d};if(h.getIndex=m,p.getIndex=m,!o)return n==r?h:p}class Xi{constructor({encoders:e,numVertices:n=void 0,attributes:r=[]}){this.encoders=e,this.variableEncoders=Object.fromEntries(Object.entries(e).filter(([i,s])=>r.includes(i)&&s&&s.scale&&!s.constant)),this.allocatedVertices=n,this.variableBuilder=new kv(n);for(const[i,s]of Object.entries(this.variableEncoders)){const o=s.accessor,a=[0,0],c=qs(s.scale.type),u=s.indexer,f=u?l=>u(o(l)):c?l=>Md(o(l),a):o;this.variableBuilder.addConverter(i,{f,numComponents:c?2:1,arrayReference:c?a:void 0})}this.lastOffset=0,this.rangeMap=new Sn([],JSON.stringify)}registerBatch(e){var s;const n=this.lastOffset,r=this.variableBuilder.vertexCount,i=r-n;i&&this.rangeMap.set(e,{offset:n,count:i,xIndex:(s=this.xIndexer)==null?void 0:s.getIndex()}),this.lastOffset=r}addBatches(e){for(const[n,r]of e)this.addBatch(n,r)}addBatch(e,n,r=0,i=n.length){this.prepareXIndexer(n,r,i);for(let s=r;s<i;s++){const o=n[s];this.variableBuilder.pushFromDatum(o),this.addToXIndex(o)}this.registerBatch(e)}prepareXIndexer(e,n=0,r=n+e.length){const i=()=>{this.addToXIndex=c=>{},this.xIndexer=void 0};if(!e.length||r-n<0){i();return}const s=c=>{var u;return c&&me((u=c.scale)==null?void 0:u.type)&&c},o=s(this.variableEncoders.x),a=s(this.variableEncoders.x2);if(o){const c=o.accessor,u=a?a.accessor:c,f=[c(e[n]),u(e[r-1])];if(f[1]>f[0]){this.xIndexer=Pv(50,f,c,u);let l=this.variableBuilder.vertexCount;this.addToXIndex=h=>{let p=this.variableBuilder.vertexCount;this.xIndexer(h,l,p),l=p}}else i()}else i()}addToXIndex(e){}toArrays(){return{arrays:this.variableBuilder.arrays,vertexCount:this.variableBuilder.vertexCount,allocatedVertices:this.allocatedVertices,rangeMap:this.rangeMap}}}class Lv extends Xi{constructor({encoders:e,attributes:n,tessellationThreshold:r=1/0,visibleRange:i=[-1/0,1/0],numItems:s}){super({encoders:e,attributes:n,numVertices:r==1/0?s*6:void 0}),this.visibleRange=i,this.tessellationThreshold=r||1/0,this.updateFrac=this.variableBuilder.createUpdater("frac",2)}addBatch(e,n,r=0,i=n.length){if(i<=r)return;const s=this.encoders,[o,a]=this.visibleRange,c=h=>h.accessor||(p=>0),u=c(s.x),f=c(s.x2);this.prepareXIndexer(n,r,i);const l=[0,0];this.updateFrac(l);for(let h=r;h<i;h++){const p=n[h];let d=u(p),m=f(p);if(d>m&&([d,m]=[m,d]),m<o||d>a)continue;d<o&&(d=o),m>a&&(m=a),this.variableBuilder.updateFromDatum(p),l[0]=0,l[1]=0;const g=1;this.variableBuilder.pushAll();for(let x=0;x<=g;x++)l[0]=x/g,l[1]=0,this.variableBuilder.pushAll(),l[1]=1,this.variableBuilder.pushAll();this.variableBuilder.pushAll(),this.addToXIndex(p)}this.registerBatch(e)}}class Nv extends Xi{constructor({encoders:e,attributes:n,tessellationThreshold:r=1/0,visibleRange:i=[-1/0,1/0],numItems:s}){super({encoders:e,attributes:n,numVertices:r==1/0?s*6:void 0}),this.visibleRange=i,this.tessellationThreshold=r||1/0,this.updateSide=this.variableBuilder.createUpdater("side",1),this.updatePos=this.variableBuilder.createUpdater("pos",1)}addBatch(e,n,r=0,i=n.length){this.prepareXIndexer(n,r,i);for(let s=r;s<i;s++){const o=n[s];this.variableBuilder.updateFromDatum(o),this.updateSide(-.5),this.updatePos(0),this.variableBuilder.pushAll();const a=1;for(let c=0;c<=a;c++)this.updatePos(c/a),this.updateSide(-.5),this.variableBuilder.pushAll(),this.updateSide(.5),this.variableBuilder.pushAll();this.variableBuilder.pushAll(),this.addToXIndex(o)}this.registerBatch(e)}}class zv extends Xi{constructor({encoders:e,attributes:n,numItems:r=void 0}){super({encoders:e,attributes:n,numVertices:r})}}class Uv extends Xi{constructor({encoders:e,attributes:n,numItems:r=void 0}){super({encoders:e,attributes:n,numVertices:r})}toArrays(){const e=this.variableBuilder.arrays;for(let n of Object.values(e))n.divisor=1;return super.toArrays()}}class $v extends Xi{constructor({encoders:e,attributes:n,fontMetrics:r,properties:i,numCharacters:s=void 0}){super({encoders:e,attributes:n,numVertices:s*6}),this.metadata=r,this.metrics=r,this.properties=i;const a=e.text.channelDef;this.numberFormat=!Xe(a)&&"format"in a&&a.format?ue(a.format):c=>c,this.updateVertexCoord=this.variableBuilder.createUpdater("vertexCoord",2),this.updateTextureCoord=this.variableBuilder.createUpdater("textureCoord",2),this.updateWidth=this.variableBuilder.createUpdater("width",1)}addBatch(e,n,r=0,i=n.length){const s=this.properties.align||"left",o=this.properties.logoLetters??!1,a=this.metadata.common.base,c=this.metadata.common.scaleH;let u=-Wn;switch(this.properties.baseline){case"top":u+=this.metrics.capHeight;break;case"middle":u+=this.metrics.capHeight/2;break;case"bottom":u-=this.metrics.descent;break}const f=this.encoders.text.accessor||this.encoders.text,l=[0,0];this.updateVertexCoord(l);const h=[0,0];this.updateTextureCoord(h),this.prepareXIndexer(n,r,i);for(let p=r;p<i;p++){const d=n[p],m=this.numberFormat(f(d)),g=V(m)?m:m===null?"":""+m;if(g.length==0)continue;this.variableBuilder.updateFromDatum(d);const x=o?g.length:this.metrics.measureWidth(g);this.updateWidth(x);let b=s=="right"?-x:s=="center"?-x/2:0;if(!o){const C=this.metrics.getCharByCode(g.charCodeAt(0));b-=(C.width-C.xadvance)/a/2}let A=-.5,E=1,F=1;for(let C=0;C<g.length;C++){const w=this.metrics.getCharByCode(g.charCodeAt(C)),L=o?1:w.xadvance/a;if(w.id==32){b+=L;continue}o?(F=(w.width+Wn*2)/w.width,b=-F/2,E=(w.height+Wn*2)/w.height,A=-.5-Wn/w.height):(E=w.height/a,A=-(w.height+w.yoffset+u)/a,F=w.width/a);const Y=w.x,j=w.y;l[0]=b,l[1]=A+E,h[0]=Y/c,h[1]=j/c,this.variableBuilder.pushAll(),l[0]=b+F,l[1]=A+E,h[0]=(Y+w.width)/c,h[1]=j/c,this.variableBuilder.pushAll(),l[0]=b,l[1]=A,h[0]=Y/c,h[1]=(j+w.height)/c,this.variableBuilder.pushAll(),l[0]=b+F,l[1]=A+E,h[0]=(Y+w.width)/c,h[1]=j/c,this.variableBuilder.pushAll(),l[0]=b,l[1]=A,h[0]=Y/c,h[1]=(j+w.height)/c,this.variableBuilder.pushAll(),l[0]=b+F,l[1]=A,h[0]=(Y+w.width)/c,h[1]=(j+w.height)/c,this.variableBuilder.pushAll(),b+=L}this.addToXIndex(d)}this.registerBatch(e)}}const of=`#define PI 3.141593
uniform View{mediump vec2 uViewOffset;mediump vec2 uViewScale;mediump vec2 uViewportSize;lowp float uDevicePixelRatio;lowp float uViewOpacity;bool uPickingEnabled;};/***Maps a coordinate on the unit scale to a normalized device coordinate.*(0,0)is at the bottom left corner.*/vec4 unitToNdc(vec2 coord){return vec4((coord*uViewScale+uViewOffset)*2.0-1.0,0.0,1.0);}vec4 unitToNdc(float x,float y){return unitToNdc(vec2(x,y));}vec4 pixelsToNdc(vec2 coord){return unitToNdc(coord/uViewportSize);}vec4 pixelsToNdc(float x,float y){return pixelsToNdc(vec2(x,y));}float linearstep(float edge0,float edge1,float x){return clamp((x-edge0)/(edge1-edge0),0.0,1.0);}/***Specialized linearstep for doing antialiasing*/float distanceToRatio(float d){return clamp(d*uDevicePixelRatio+0.5,0.0,1.0);}vec4 distanceToColor(float d,vec4 fill,vec4 stroke,float halfStrokeWidth){if(halfStrokeWidth>0.0){float sd=abs(d)-halfStrokeWidth;return mix(stroke,d<=0.0 ? fill : vec4(0.0),distanceToRatio(sd));}else{return fill*distanceToRatio(-d);}}`,Vv="uniform highp float uZero;vec3 getDiscreteColor(sampler2D s,int index){return texelFetch(s,ivec2(index % textureSize(s,0).x,0),0).rgb;}vec3 getInterpolatedColor(sampler2D s,float unitValue){return texture(s,vec2(unitValue,0.0)).rgb;}float clampToRange(float value,vec2 range){return clamp(value,min(range[0],range[1]),max(range[0],range[1]));}float scaleIdentity(float value){return value;}float scaleLinear(float value,vec2 domain,vec2 range){float domainSpan=domain[1]-domain[0];float rangeSpan=range[1]-range[0];return(value-domain[0])/domainSpan*rangeSpan+range[0];}float scaleLog(float value,vec2 domain,vec2 range,float base){return scaleLinear(log(value)/log(base),log(domain)/log(base),range);}float symlog(float value,float constant){return sign(value)*log(abs(value/constant)+1.0);}float scaleSymlog(float value,vec2 domain,vec2 range,float constant){return scaleLinear(symlog(value,constant),vec2(symlog(domain[0],constant),symlog(domain[1],constant)),range);}float scalePow(float value,vec2 domain,vec2 range,float exponent){return scaleLinear(pow(abs(value),exponent)*sign(value),pow(abs(domain),vec2(exponent))*sign(domain),range);}float scaleBand(float value,vec2 domainExtent,vec2 range,float paddingInner,float paddingOuter,float align,float band){float start=range[0];float stop=range[1];float rangeSpan=stop-start;float n=domainExtent[1]-domainExtent[0];paddingInner=int(n)>1 ? paddingInner : 0.0;float step=rangeSpan/max(1.0,n-paddingInner+paddingOuter*2.0);start+=(rangeSpan-step*(n-paddingInner))*align;float bandwidth=step*(1.0-paddingInner);return start+(value-domainExtent[0])*step+bandwidth*band;}float scaleBandHp(vec2 value,vec3 domainExtent,vec2 range,float paddingInner,float paddingOuter,float align,float band){float start=range[0];float stop=range[1];float rangeSpan=stop-start;vec2 domainStart=domainExtent.xy;float n=domainExtent[2];float step=rangeSpan/max(1.0,n-paddingInner+paddingOuter*2.0);start+=(rangeSpan-step*(n-paddingInner))*align;float bandwidth=step*(1.0-paddingInner);float inf=1.0/uZero;float hi=max(value[0]-domainStart[0],-inf);float lo=max(value[1]-domainStart[1],-inf);return dot(vec4(start,hi,lo,bandwidth),vec4(1.0,step,step,band));}",Gv=`/***Describes where a sample facet should be shown. Interpolating between the*current and target positions/heights allows for transitioning between facet*configurations.*/struct SampleFacetPosition{float pos;float height;float targetPos;float targetHeight;};/***Trasition fraction[0,1]between the current and target configurations.*/uniform float uTransitionOffset;
#if !defined(SAMPLE_FACET_UNIFORM) && !defined(SAMPLE_FACET_TEXTURE)
SampleFacetPosition getSampleFacetPos(){return SampleFacetPosition(0.0,1.0,0.0,1.0);}
#elif defined(SAMPLE_FACET_UNIFORM)
/***Location and height of the band on the Y axis on a normalized[0,1]scale.*Elements: curr pos,curr height,target pos,target height*/uniform vec4 uSampleFacet;SampleFacetPosition getSampleFacetPos(){return SampleFacetPosition(1.0-uSampleFacet.x-uSampleFacet.y,uSampleFacet.y,1.0-uSampleFacet.z-uSampleFacet.w,uSampleFacet.w);}
#elif defined(SAMPLE_FACET_TEXTURE)
uniform sampler2D uSampleFacetTexture;SampleFacetPosition getSampleFacetPos(){vec4 texel=texelFetch(uSampleFacetTexture,ivec2(int(attr_facetIndex),0),0);return SampleFacetPosition(1.0-texel.r-texel.g,texel.g,1.0-texel.r-texel.g,texel.g);}
#endif
bool isFacetedSamples(SampleFacetPosition facetPos){return facetPos!=SampleFacetPosition(0.0,1.0,0.0,1.0);}bool isFacetedSamples(){return isFacetedSamples(getSampleFacetPos());}bool isInTransit(){return uTransitionOffset>0.0;}float getTransitionFraction(float xPos){return smoothstep(0.0,0.7+uTransitionOffset,(xPos-uTransitionOffset)*2.0);}vec2 applySampleFacet(vec2 pos){SampleFacetPosition facetPos=getSampleFacetPos();if(!isFacetedSamples(facetPos)){return pos;}else if(isInTransit()){vec2 interpolated=mix(vec2(facetPos.pos,facetPos.height),vec2(facetPos.targetPos,facetPos.targetHeight),getTransitionFraction(pos.x));return vec2(pos.x,interpolated[0]+pos.y*interpolated[1]);}else{return vec2(pos.x,facetPos.pos+pos.y*facetPos.height);}}float getSampleFacetHeight(vec2 pos){SampleFacetPosition facetPos=getSampleFacetPos();if(!isFacetedSamples(facetPos)){return 1.0;}else if(isInTransit()){return mix(facetPos.height,facetPos.targetHeight,getTransitionFraction(pos.x));}else{return facetPos.height;}}`,Hv=`/**Based on concepts presented at:*https:*https:*/out highp vec4 vPickingColor;/***Passes the unique id to the fragment shader as a color if picking is enabled.*Returns true if picking is enabled.*/bool setupPicking(){if(uPickingEnabled){
#ifdef uniqueId_DEFINED
int id=int(getScaled_uniqueId());vPickingColor=vec4(ivec4(id>>0,id>>8,id>>16,0xFF)&0xFF)/float(0xFF);
#else
vPickingColor=vec4(1.0);
#endif
return true;}return false;}`,qv="in highp vec4 vPickingColor;",bs=Symbol("cacheMap");function pr(t,e,n){let r=pi(t).get(e);return r===void 0&&(r=n(e),pi(t).set(e,r)),r}function Bd(t,e){pi(t).delete(e)}function As(t,e){const n=pi(t);for(const r of n.keys())r.startsWith(e)&&n.delete(r);pi(t).delete(e)}function kd(t){t[bs]=new Map}function pi(t){return t[bs]||kd(t),t[bs]}function Wv(t,e,n,r){const i=V(t)?t:t.name,s=!V(t)&&t.extent||[0,1];if(n===void 0&&!V(t)&&(n=t.count),i){const o=su(i);if(Ie(o)){const a=Od(o,{extent:s,count:n});return qo(e,{minMag:e.LINEAR,format:e.RGB,height:1,wrap:e.CLAMP_TO_EDGE},a,r)}else{if(Me(o))return ac(o,e);throw new Error("Unknown scheme: "+i)}}}function jv(t,e="rgb",n,r){const i=Ro(t,V(e)?e:e.type,V(e)?void 0:e.gamma),s=Od(i);return qo(n,{minMag:n.LINEAR,format:n.RGB,height:1,wrap:n.CLAMP_TO_EDGE},s,r)}function Yv(t,e,n,r){const i=Math.max(t.length,n||0),s=new Float32Array(i);for(let o=0;o<i;o++)s[o]=t[o%t.length];return qo(e,{minMag:e.NEAREST,format:e.RED,internalFormat:e.R32F,height:1},s,r)}function ac(t,e,n,r){const i=Pd(t,n);return qo(e,{minMag:e.NEAREST,format:e.RGB,height:1},i,r)}function Od(t,{extent:e=[0,1],reverse:n=!1,count:r=256}={}){const i=e[0],s=Bi(e)-i,o=Yr(r).map(a=>a/(r-1)).map(a=>i+a/s).map(t);return n&&o.reverse(),Pd(o)}function Pd(t,e){const n=Math.max(t.length,e||0),r=new Uint8Array(n*3);for(let i=0;i<n;i++){const s=Bt(t[i%t.length]).rgb();r[i*3+0]=s.r,r[i*3+1]=s.g,r[i*3+2]=s.b}return r}class Xv{constructor(e,n,r){this._container=e,this._sizeSource=n,this._shaderCache=new Map,this._listeners=[],this.rangeTextures=new WeakMap;const i=document.createElement("canvas");e.appendChild(i);const s=vv(i,{antialias:!0,depth:!1,premultipliedAlpha:!0});if(!s)throw new Error("Unable to initialize WebGL. Your browser or machine may not support it.");if(!Ar(s))throw new Error("Your web browser does not support WebGL 2.0. Chrome, Firefox, and Safari Tech Preview should work.");if(Dd(s),s.blendFunc(s.ONE,s.ONE_MINUS_SRC_ALPHA),this.canvas=i,this.gl=s,this._pickingAttachmentOptions=[{format:s.RGBA,type:s.UNSIGNED_BYTE,minMag:s.LINEAR,wrap:s.CLAMP_TO_EDGE}],this._pickingBufferInfo=gv(s,this._pickingAttachmentOptions),s.bindFramebuffer(s.FRAMEBUFFER,null),this.adjustGl(),this._resizeObserver=new ResizeObserver(o=>{this.invalidateSize(),this._emit("resize")}),this._resizeObserver.observe(this._container),this._updateDpr(),this._clearColor=[0,0,0,0],r){const o=Bt(r).rgb();this._clearColor=[o.r/255,o.g/255,o.b/255,o.opacity]}}invalidateSize(){this._logicalCanvasSize=void 0,this._updateDpr(),this.adjustGl()}_updateDpr(){this.dpr=window.devicePixelRatio}compileShader(e,n){const r="#version 300 es",i="precision mediump float;";Me(n)&&(n=n.join(`

`));const s=this.gl,o=n.replaceAll(/ {2,}|^\s*\/\/.*$/gm,"");let a=this._shaderCache.get(o);if(!a){const c=[r,i,n].join(`

`);a=s.createShader(e),s.shaderSource(a,c),s.compileShader(a),this._shaderCache.set(o,a)}return a}adjustGl(){const e=this.getLogicalCanvasSize();this.canvas.style.width=`${e.width}px`,this.canvas.style.height=`${e.height}px`;const n=this.getPhysicalCanvasSize(e);this.canvas.width=n.width,this.canvas.height=n.height,xv(this.gl,this._pickingBufferInfo,this._pickingAttachmentOptions)}finalize(){this._resizeObserver.unobserve(this._container),this.canvas.remove()}getPhysicalCanvasSize(e){return e=e||this.getLogicalCanvasSize(),{width:e.width*this.dpr,height:e.height*this.dpr}}getLogicalCanvasSize(){var s;if(this._logicalCanvasSize)return this._logicalCanvasSize;const e=((s=this._sizeSource)==null?void 0:s.call(this))??{width:void 0,height:void 0},n=window.getComputedStyle(this._container,null),r=e.width??this._container.clientWidth-parseFloat(n.paddingLeft)-parseFloat(n.paddingRight),i=e.height??this._container.clientHeight-parseFloat(n.paddingTop)-parseFloat(n.paddingBottom);return this._logicalCanvasSize={width:r,height:i},this._logicalCanvasSize}addEventListener(e,n){this._listeners.push({type:e,listener:n})}_emit(e){for(const n of this._listeners)n.type===e&&n.listener()}readPickingPixel(e,n){const r=this.gl;e*=this.dpr,n*=this.dpr;const i=this.getPhysicalCanvasSize().height,s=new Uint8Array(4);return r.bindFramebuffer(r.FRAMEBUFFER,this._pickingBufferInfo.framebuffer),r.readPixels(e,i-n-1,1,1,r.RGBA,r.UNSIGNED_BYTE,s),r.bindFramebuffer(r.FRAMEBUFFER,null),s}clearAll(){const e=this.gl,{width:n,height:r}=this.getPhysicalCanvasSize();e.viewport(0,0,n,r),e.disable(e.SCISSOR_TEST),e.clearColor(...this._clearColor),e.clear(e.COLOR_BUFFER_BIT)}createRangeTexture(e,n=!1){const r=this.rangeTextures.get(e);if(!n&&r)return;function i(o,a){return Ot(a.type)?a.domain().length:a.type=="threshold"?a.domain().length+1:a.type=="quantize"||a.type=="quantile"?o??4:o}const s=e.channel;if(An(s)){const o=e.getScaleProps(),a=e.getScale(),c=a.range();let u;if(o.scheme)if(a.type=="threshold"&&c)u=ac(c,this.gl,a.domain().length,r);else{let f=V(o.scheme)?void 0:o.scheme.count;f=i(f,a),u=Wv(o.scheme,this.gl,f,r)}else _o(a.type)||me(a.type)&&c.length>2?u=jv(c,o.interpolate,this.gl,r):u=ac(c,this.gl,a.domain().length,r);this.rangeTextures.set(e,u)}else{const o=e.getScale();if(o.type==="ordinal"||Hn(o.type)){const a=Bo(s)?D0(s):u=>u,c=e.getScale().range();this.rangeTextures.set(e,Yv(c.map(a),this.gl,o.domain().length,r))}}}}function Kv(t,e="",n=0){const r=/ERROR:\s*\d+:(\d+)/gi,i=[...e.matchAll(r)],s=new Map(i.map((o,a)=>{const c=parseInt(o[1]),u=i[a+1],f=u?u.index:e.length,l=e.substring(o.index,f);return[c-1,l]}));return t.split(`
`).map((o,a)=>{const c=s.get(a);return`${a+1+n}: ${o}${c?`

^^^ ${c}`:""}`}).join(`
`)}function Jv(t,e,n){const r=t.createProgram();t.attachShader(r,e),t.attachShader(r,n),t.linkProgram(r);function i(){let s,o;if(!t.getProgramParameter(r,t.LINK_STATUS)){s=t.getProgramInfoLog(r);for(const c of[e,n])t.getShaderParameter(c,t.COMPILE_STATUS)||(s=t.getShaderInfoLog(c),o=Kv(t.getShaderSource(c),s,0)+`
Error compiling: ${s}`,t.deleteShader(c));t.deleteProgram(r)}if(s)return{message:s,detail:o}}return{program:r,getProgramErrors:i}}function qo(t,e,n,r){return r?X0(t,r,n,e):r=di(t,{...e,src:n}),r}function Zv(...t){const e={get(n,r,i){for(const s of t){const a=s()[r];if(a!==void 0)return a}},has(n,r,i){for(const s of t){const o=s();if(r in o)return!0}return!1}};return new Proxy({},e)}function Qv(t){return V(t)||be(t)||_i(t)}class vn extends Error{constructor(e,n){super(e),this.name="ViewError",this.view=n}}const eE="SAMPLE_FACET_UNIFORM",af="SAMPLE_FACET_TEXTURE";class Ki{constructor(e){this.unitView=e,this.encoders=void 0,this.bufferInfo=void 0,this.programInfo=void 0,this.vertexArrayInfo=void 0,this.domainUniformInfo=void 0,this.viewUniformInfo=void 0,this.markUniformInfo=void 0,this.markUniformsAltered=!0,this.rangeMap=new tE,this.defaultProperties={get clip(){return["x","y"].map(n=>e.getScaleResolution(n)).some(n=>(n==null?void 0:n.isZoomable())??!1)},xOffset:0,yOffset:0,minBufferSize:0},this.properties=Zv(typeof this.unitView.spec.mark=="object"?()=>this.unitView.spec.mark:()=>({}),()=>this.defaultProperties)}get opaque(){return!1}getAttributes(){throw new Error("Not implemented!")}getSupportedChannels(){return["sample","facetIndex","x","y","color","opacity","search","uniqueId"]}getDefaultEncoding(){const e={sample:void 0,uniqueId:void 0};return this.isPickingParticipant()&&(e.uniqueId={field:"_uniqueId"}),e}fixEncoding(e){return e}get encoding(){return pr(this,"encoding",()=>{const e=this.getDefaultEncoding(),n=this.unitView.getEncoding(),r=o=>{const a=this.properties[o];return Qv(a)&&{value:a}},i=Object.fromEntries(this.getSupportedChannels().map(o=>[o,r(o)]).filter(o=>o[1].value!==void 0)),s=this.fixEncoding({...e,...i,...n});for(const o of Object.keys(s))this.getSupportedChannels().includes(o)||delete s[o];return s})}getContext(){return this.unitView.context}getType(){return this.unitView.getMarkType()}initializeData(){}initializeEncoders(){this.encoders=Tb(this)}async initializeGraphics(){}updateGraphicsData(){}getSampleFacetMode(){if(this.encoders.facetIndex)return af;if(this.unitView.getLayoutAncestors().find(e=>"samples"in e.spec))return eE}createAndLinkShaders(e,n,r=[]){const i=this.getAttributes(),s="// view: "+this.unitView.getPathString();this.domainUniforms=[];let o=[];const a=this.getSampleFacetMode();a&&r.push(`#define ${a}`);for(const p of i){let d;if(p in this.encoding)d=p;else continue;const m=this.encoding[d];if(m)if(Xe(m))o.push(Tv(d,m.value));else{const g=De(m)&&m.resolutionChannel||d,x=wn(g)?this.unitView.getScaleResolution(g).getScale():Mo(),b=Dv(d,x,m);o.push(b.glsl),b.domainUniform&&this.domainUniforms.push(b.domainUniform)}}const c=this.domainUniforms.length?`layout(std140) uniform Domains {
`+this.domainUniforms.map(p=>`    ${p}
`).join("")+`};

`:"",f=[`precision highp float;
`,s,...r,of,Vv,c,...o,Gv,Hv,e],l=[s,...r,of,qv,n],h=this.gl;this.programStatus=Jv(h,this.glHelper.compileShader(h.VERTEX_SHADER,f),this.glHelper.compileShader(h.FRAGMENT_SHADER,l))}finalizeGraphicsInitialization(){const e=this.programStatus.getProgramErrors();if(e){e.detail&&console.warn(e.detail);const n=new Error("Cannot create shader program: "+e.message);throw n.view=this.unitView,n}this.programInfo=Zw(this.gl,this.programStatus.program),delete this.programStatus,this.domainUniforms.length&&(this.domainUniformInfo=ya(this.gl,this.programInfo,"Domains")),this.viewUniformInfo=ya(this.gl,this.programInfo,"View"),this.markUniformInfo=ya(this.gl,this.programInfo,"Mark"),this.gl.useProgram(this.programInfo.program),this._setDatums(),cn(this.programInfo,{uSampleFacet:[0,1,0,1],uTransitionOffset:0,uZero:0})}registerMarkUniform(e,n,r=i=>i){const i=this.markUniformInfo.setters[e];if(Ld(n)){const s=this.unitView.context.paramBroker.createExpression(n.expr),o=()=>{i(r(s(null))),this.markUniformsAltered=!0};s.addListener(o),o()}else i(r(n)),this.markUniformsAltered=!0}_setDatums(){for(const[e,n]of Object.entries(this.encoding))if(Wi(n)){const r=this.encoders[e],i=r.indexer?r.indexer(n.datum):qs(r.scale.type)?Md(+n.datum):+n.datum;cn(this.programInfo,{[Fu+e]:i})}}deleteGraphicsData(){if(this.bufferInfo){const e=this.gl;for(let n=0;n<8;n++)e.disableVertexAttribArray(n);Object.values(this.bufferInfo.attribs).forEach(n=>this.gl.deleteBuffer(n.buffer)),this.bufferInfo.indices&&this.gl.deleteBuffer(this.bufferInfo.indices),this.bufferInfo=void 0}}updateBufferInfo(e){if(this.gl.bindVertexArray(null),this.bufferInfo&&e.vertexCount<=this.bufferInfo.allocatedVertices)for(const[n,r]of Object.entries(e.arrays))r.data&&f2(this.gl,this.bufferInfo.attribs[n],r.data,0);else this.deleteGraphicsData(),this.bufferInfo=p2(this.gl,e.arrays,{numElements:e.vertexCount}),this.bufferInfo.allocatedVertices=e.allocatedVertices,this.vertexArrayInfo=void 0}get glHelper(){return this.getContext().glHelper}get gl(){return this.glHelper.gl}onBeforeSampleAnimation(){}onAfterSampleAnimation(){}isReady(){return this.bufferInfo&&this.programInfo}isPickingParticipant(){if(this.properties.tooltip===null)return!1;for(const e of this.unitView.getLayoutAncestors())if(!e.isPickingSupported())return!1;return!0}bindOrSetMarkUniformBlock(){this.markUniformsAltered?(ba(this.gl,this.programInfo,this.markUniformInfo),this.markUniformsAltered=!1):wd(this.gl,this.programInfo,this.markUniformInfo)}prepareRender(e){const n=this.glHelper,r=this.gl,i=[];if(i.push(()=>{this.vertexArrayInfo||(this.vertexArrayInfo=yv(this.gl,this.programInfo,this.bufferInfo)),r.useProgram(this.programInfo.program)}),this.domainUniformInfo){for(const[o,a]of Object.entries(this.domainUniformInfo.setters)){const c=o.substring(Id.length),u=this.encoding[c],f=De(u)&&u.resolutionChannel||c;if(wn(f)){const l=this.unitView.getScaleResolution(f).getScale();i.push(()=>{const h=Ot(l.type)?[0,l.domain().length]:l.domain();a(qs(l.type)?Bv(h):h)})}}i.push(()=>ba(r,this.programInfo,this.domainUniformInfo))}for(const[o,a]of Object.entries(this.encoding))if(De(a)){const c=De(a)&&a.resolutionChannel||o;if(wn(c)){const u=this.unitView.getScaleResolution(c),f=n.rangeTextures.get(u);f&&i.push(()=>cn(this.programInfo,{[ic+o]:f}))}}this.getSampleFacetMode()==af&&i.push(()=>{let o;for(const a of this.unitView.getLayoutAncestors())if(o=a.getSampleFacetTexture(),o)break;if(!o)throw new Error("No facet texture available. This is bug.");cn(this.programInfo,{uSampleFacetTexture:o})});const s=(e.picking??!1)&&this.isPickingParticipant();return i.push(()=>Rn(this.viewUniformInfo,{uViewOpacity:this.unitView.getEffectiveOpacity(),uPickingEnabled:s})),this.opaque||e.picking?i.push(()=>r.disable(r.BLEND)):i.push(()=>r.enable(r.BLEND)),i}prepareSampleFacetRendering(e){const n=e.sampleFacetRenderingOptions,r=this.programInfo.uniformSetters.uSampleFacet;if(n&&r){const i=n.locSize?n.locSize.location:0,s=n.locSize?n.locSize.size:1;if(i>1||i+s<0)return!1;const o=n.targetLocSize?n.targetLocSize.location:i,a=n.targetLocSize?n.targetLocSize.size:s;this.gl.uniform4f(r.location,i,s,o,a)}return!0}render(e){}createRenderCallback(e,n){var l;if(!this.bufferInfo)throw new vn(`${this.getType()} mark has no data. This is bug.`,this.unitView);const r=this;let i;const s=(l=this.unitView.getScaleResolution("x"))==null?void 0:l.getScale(),o=s&&me(s.type),a=["index","locus"].includes(s==null?void 0:s.type)?-1:0,c=[0,0];i=h=>{if(o&&h.xIndex){const p=s.domain(),d=h.xIndex(p[0]+a,p[1],c),m=d[0],g=d[1]-m;g>0&&e(m,g)}else e(h.offset,h.count)};const u=this.rangeMap.get(void 0).count==0?n.facetId:void 0,f=this.rangeMap.get(u);return n.sampleFacetRenderingOptions?function(){f.count&&r.prepareSampleFacetRendering(n)&&i(f)}:function(){f.count&&i(f)}}setViewport(e,n){e=e.flatten();const r=this.unitView.context.devicePixelRatio,i=this.gl,s=this.properties,o=this.glHelper.getLogicalCanvasSize(),a=.5,c=(s.xOffset??0)+a,u=(s.yOffset??0)+a;let f,l=e;if(s.clip!=="never"&&(s.clip||n)){let h=0,p=0,d;if(n){if(l=e.intersect(n).flatten(),!l.isDefined())return!1;d=[e.width/l.width,e.height/l.height],p=Math.max(0,e.y2-n.y2),h=Math.min(0,e.x-n.x)}else d=[1,1];const m=[l.x,o.height-l.y2,l.width,l.height].map(A=>A*r),g=m.map(A=>Math.round(A)),[x,b]=m.map((A,E)=>A-g[E]);i.viewport(...g),i.scissor(...g),i.enable(i.SCISSOR_TEST),f={uViewOffset:[(c+h+x/r)/l.width,-(u+p-b/r)/l.height],uViewScale:d}}else{if(!e.isDefined())return!1;i.viewport(0,0,o.width*r,o.height*r),i.disable(i.SCISSOR_TEST),f={uViewOffset:[(e.x+c)/o.width,(o.height-e.y-u-e.height)/o.height],uViewScale:[e.width/o.width,e.height/o.height]}}return Rn(this.viewUniformInfo,{...f,uViewportSize:[e.width,e.height],uDevicePixelRatio:r}),ba(this.gl,this.programInfo,this.viewUniformInfo),!0}findDatumAt(e,n){}}class tE extends Sn{constructor(){super([],JSON.stringify)}get(e){let n=super.get(e);return n===void 0&&(n={offset:0,count:0,xIndex:void 0},super.set(e,n)),n}migrateEntries(e){for(const[n,r]of e.entries())Object.assign(this.get(n),r)}}function Ld(t){return typeof t=="object"&&"expr"in t&&V(t.expr)}function cc(t,e){const n=Rb(e);let r=t[e]&&{...t[e]},i=t[n]&&{...t[n]};if(!(Xe(r)||Xe(i))){if(r){if(!De(t[e]))return;if(i){if(r.type!="quantitative"){const s=(1-(r.band||1))/2;r.band=s,i.band=-s}}else if(r.type=="quantitative")i={datum:0};else{i={...r};const s=(1-(r.band??1))/2;r.band=0+s,i.band=1-s}}else r={value:0},i={value:1};t[e]=r,t[n]=i}}function Nd(t,e){t.stroke||(e?t.stroke={value:null}:t.stroke={resolutionChannel:"color",...t.color}),Xe(t.stroke)&&t.stroke.value===null&&(t.strokeWidth={value:0}),t.strokeOpacity||(t.strokeOpacity={resolutionChannel:"opacity",...t.opacity})}function zd(t,e){Xe(t.fill)&&t.fill.value===null?t.fillOpacity={value:0}:t.fill||(t.fill={resolutionChannel:"color",...t.color},!e&&!t.fillOpacity&&(t.fillOpacity={value:0})),t.fillOpacity||(e?t.fillOpacity={resolutionChannel:"opacity",...t.opacity}:t.fillOpacity={value:0})}var mi,uc,gi,lc;class nE extends Ki{constructor(n){super(n);M(this,mi);M(this,gi);Object.defineProperties(this.defaultProperties,Object.getOwnPropertyDescriptors({x2:void 0,y2:void 0,filled:!0,color:"#4c78a8",opacity:1,strokeWidth:3,cornerRadius:0,minWidth:.5,minHeight:.5,minOpacity:1,tessellationZoomThreshold:10,tessellationTiles:35}))}getAttributes(){return["uniqueId","facetIndex","x","x2","y","y2","fill","stroke","fillOpacity","strokeOpacity","strokeWidth"]}getSupportedChannels(){return[...super.getSupportedChannels(),"x2","y2","fill","stroke","fillOpacity","strokeOpacity","strokeWidth"]}get opaque(){return pr(this,"opaque",()=>!I(this,mi,uc).call(this)&&!I(this,gi,lc).call(this)&&Xe(this.encoding.fillOpacity)&&this.encoding.fillOpacity.value==1&&this.properties.minOpacity==1)&&this.unitView.getEffectiveOpacity()==1}fixEncoding(n){return cc(n,"x"),cc(n,"y"),Nd(n,this.properties.filled),zd(n,this.properties.filled),delete n.color,delete n.opacity,n}onBeforeSampleAnimation(){}onAfterSampleAnimation(){}async initializeGraphics(){await super.initializeGraphics();const n=[];I(this,mi,uc).call(this)&&n.push("ROUNDED_CORNERS"),I(this,gi,lc).call(this)&&n.push("STROKED"),this.createAndLinkShaders(Ev,Cv,n.map(r=>"#define "+r))}finalizeGraphicsInitialization(){super.finalizeGraphicsInitialization(),this.gl.useProgram(this.programInfo.program);const n=this.properties;this.registerMarkUniform("uMinWidth",n.minWidth),this.registerMarkUniform("uMinHeight",n.minHeight),this.registerMarkUniform("uMinOpacity",n.minOpacity),this.registerMarkUniform("uCornerRadiusTopRight",n.cornerRadiusTopRight??n.cornerRadius??0),this.registerMarkUniform("uCornerRadiusBottomRight",n.cornerRadiusBottomRight??n.cornerRadius??0),this.registerMarkUniform("uCornerRadiusTopLeft",n.cornerRadiusTopLeft??n.cornerRadius??0),this.registerMarkUniform("uCornerRadiusBottomLeft",n.cornerRadiusBottomLeft??n.cornerRadius??0)}updateGraphicsData(){const n=this.unitView.getCollector(),r=n.getItemCount(),i=new Lv({encoders:this.encoders,attributes:this.getAttributes(),numItems:r});i.addBatches(n.facetBatches);const s=i.toArrays();this.rangeMap.migrateEntries(s.rangeMap),this.updateBufferInfo(s)}prepareRender(n){const r=super.prepareRender(n);return r.push(()=>this.bindOrSetMarkUniformBlock()),r.push(()=>vr(this.gl,this.programInfo,this.vertexArrayInfo)),r}render(n){const r=this.gl;return this.createRenderCallback((i,s)=>{Yi(r,this.vertexArrayInfo,r.TRIANGLE_STRIP,s,i)},n)}findDatumAt(n,r){n=ze(n);const i=this.unitView.getCollector().facetBatches.get(n);if(!i)return;const s=this.encoders,o=s.x.scale.type;if(Ot(o)){const a=s.x.accessor;return i.find(c=>r==a(c))}else{const a=s.x.accessor,c=s.x2.accessor;return i.find(u=>r>=a(u)&&r<c(u))}}}mi=new WeakSet,uc=function(){const n=this.properties;return n.cornerRadius||n.cornerRadiusBottomLeft||n.cornerRadiusBottomRight||n.cornerRadiusTopLeft||n.cornerRadiusTopRight},gi=new WeakSet,lc=function(){const n=this.encoding.strokeWidth;return!(Xe(n)&&!n.value)};const rE=`out float vRadius;out float vRadiusWithPadding;out lowp vec4 vFillColor;out lowp vec4 vStrokeColor;out lowp float vShape;out lowp float vHalfStrokeWidth;out mat2 vRotationMatrix;const float CIRCLE=0.0;const float SQUARE=1.0;const float CROSS=2.0;const float DIAMOND=3.0;const float TRIANGLE_UP=4.0;const float TRIANGLE_RIGHT=5.0;const float TRIANGLE_DOWN=6.0;const float TRIANGLE_LEFT=7.0;const float TICK_UP=8.0;const float TICK_RIGHT=9.0;const float TICK_DOWN=10.0;const float TICK_LEFT=11.0;float computeSemanticThresholdFactor(){return getScaled_semanticScore()>=uSemanticThreshold ? 1.0 : 0.0;}/***Computes a scaling factor for the points in a sample-faceted view.*/float getDownscaleFactor(vec2 pos){if(!isFacetedSamples()){return 1.0;}float sampleFacetHeight=getSampleFacetHeight(pos);float maxPointDiameter=sqrt(uMaxPointSize);float factor=sampleFacetHeight*uViewportSize.y*uMaxRelativePointDiameter;return clamp(0.0,maxPointDiameter,factor)/maxPointDiameter;}vec2 getDxDy(){
#if defined(dx_DEFINED) || defined(dy_DEFINED)
return vec2(getScaled_dx(),getScaled_dy())/uViewportSize;
#else
return vec2(0.0,0.0);
#endif
}void main(void){float shapeAngle=0.0;float semanticThresholdFactor=computeSemanticThresholdFactor();if(semanticThresholdFactor<=0.0){gl_PointSize=0.0;gl_Position=vec4(100.0,0.0,0.0,0.0);return;}float size=getScaled_size();vec2 pos=vec2(getScaled_x(),getScaled_y())+getDxDy();gl_Position=unitToNdc(applySampleFacet(pos));float strokeWidth=getScaled_strokeWidth();float diameter=sqrt(size)*uScaleFactor*semanticThresholdFactor*getDownscaleFactor(pos);float opacity=uViewOpacity;if(strokeWidth<=0.0||uInwardStroke){float minDiameter=1.0/uDevicePixelRatio;if(diameter<minDiameter){opacity*=pow(diameter/minDiameter,2.5);diameter=minDiameter;}}float fillOpa=getScaled_fillOpacity()*opacity;float strokeOpa=getScaled_strokeOpacity()*opacity;vShape=getScaled_shape();bool circle=vShape==0.0;if(vShape>TICK_UP&&vShape<=TICK_LEFT){shapeAngle=(vShape-TICK_UP)*90.0;vShape=TICK_UP;}else if(vShape>TRIANGLE_UP&&vShape<=TRIANGLE_LEFT){shapeAngle=(vShape-TRIANGLE_UP)*90.0;vShape=TRIANGLE_UP;}float angleInDegrees=getScaled_angle();float angle=-(shapeAngle+angleInDegrees)*PI/180.0;float sinTheta=sin(angle);float cosTheta=cos(angle);vRotationMatrix=mat2(cosTheta,sinTheta,-sinTheta,cosTheta);float roomForRotation=circle ? 1.0 : sin(mod(angle,PI/2.0)+PI/4.0)/sin(PI/4.0);float aaPadding=1.0/uDevicePixelRatio;float rotationPadding=(diameter*roomForRotation)-diameter;float strokePadding=uInwardStroke ? 0.0 : strokeWidth*(circle ? 1.0 : sqrt(3.0));float padding=rotationPadding+strokePadding+aaPadding;gl_PointSize=(diameter+padding)*uDevicePixelRatio;vRadius=diameter/2.0;vRadiusWithPadding=vRadius+padding/2.0;vHalfStrokeWidth=strokeWidth/2.0;vFillColor=vec4(getScaled_fill()*fillOpa,fillOpa);vStrokeColor=vec4(getScaled_stroke()*strokeOpa,strokeOpa);setupPicking();}`,iE="const lowp vec4 white=vec4(1.0);const lowp vec4 black=vec4(0.0,0.0,0.0,1.0);in float vRadius;in float vRadiusWithPadding;in lowp vec4 vFillColor;in lowp vec4 vStrokeColor;in lowp float vShape;in lowp float vHalfStrokeWidth;in mat2 vRotationMatrix;out lowp vec4 fragColor;const float CIRCLE=0.0;const float SQUARE=1.0;const float CROSS=2.0;const float DIAMOND=3.0;const float TRIANGLE_UP=4.0;const float TICK_UP=8.0;float circle(vec2 p,float r){return length(p)-r;}float square(vec2 p,float r){p=abs(p);return max(p.x,p.y)-r;}float tickUp(vec2 p,float r){float halfR=r*0.5;p.y+=halfR;p=abs(p);return max(p.x-r*0.15,p.y-halfR);}float equilateralTriangle(vec2 p,float r){p.y=-p.y;float k=sqrt(3.0);float kr=k*r;p.y-=kr/2.0;return max((abs(p.x)*k+p.y)/2.0,-p.y-kr);}float crossShape(vec2 p,float r){p=abs(p);vec2 b=vec2(0.4,1.0)*r;vec2 v=abs(p)-b.xy;vec2 h=abs(p)-b.yx;return min(max(v.x,v.y),max(h.x,h.y));}float diamond(vec2 p,float r){p=abs(p);return(max(abs(p.x-p.y),abs(p.x+p.y))-r)/sqrt(2.0);}void main(){float d;vec2 p=vRotationMatrix*(2.0*gl_PointCoord-1.0)*vRadiusWithPadding;float r=vRadius;if(vShape==CIRCLE){d=circle(p,r);}else if(vShape==SQUARE){d=square(p,r);}else if(vShape==CROSS){d=crossShape(p,r);}else if(vShape==DIAMOND){d=diamond(p,r);}else if(vShape==TRIANGLE_UP){d=equilateralTriangle(p,r);}else if(vShape==TICK_UP){d=tickUp(p,r);}else{d=0.0;}if(!uPickingEnabled){lowp vec4 fillColor=mix(vFillColor,white,-d*uGradientStrength/vRadius);fragColor=distanceToColor(d+(uInwardStroke ? vHalfStrokeWidth : 0.0),fillColor,vStrokeColor,vHalfStrokeWidth);}else if(d-vHalfStrokeWidth<=0.0){fragColor=vPickingColor;}else{discard;}}",sE="uniform Mark{/***The stroke should only grow inwards,e.g,the diameter/outline is not affected by the stroke width.*Thus,a point that has a zero size has no visible stroke. This allows strokes to be used with*geometric zoom,etc.*/uniform bool uInwardStroke;uniform lowp float uMaxRelativePointDiameter;uniform mediump float uScaleFactor;uniform mediump float uMaxPointSize;uniform mediump float uZoomLevel;uniform highp float uSemanticThreshold;uniform mediump float uGradientStrength;};",ut=1,Xt=2,Tu=4,oE={};class X{get behavior(){return 0}constructor(){this.children=[],this.parent=void 0,this.completed=!1}reset(){this.completed=!1;for(const e of this.children)e.reset()}initialize(){}_updatePropagator(){this._propagate=Function("children",Yr(this.children.length).map(e=>`const child${e} = children[${e}];`).join(`
`)+`return function propagate(datum) {${Yr(this.children.length).map(e=>`child${e}.handle(datum);`).join(`
`)}}`)(this.children)}setParent(e){this.parent=e}addChild(e){if(e.parent)throw new Error("Cannot add the child! It already has a parent.");return this.children.push(e),e.setParent(this),this._updatePropagator(),this}adopt(e){e.parent&&e.parent.removeChild(e),this.addChild(e)}adoptChildrenOf(e){for(const n of e.children)this.adopt(n)}insertAsParent(e){if(this.isRoot())throw new Error("Cannot insert a new parent for a root node!");e.parent=this.parent,this.parent.children[this.parent.children.indexOf(this)]=e,this.parent._updatePropagator(),this.parent=void 0,e.addChild(this)}removeChild(e){const n=this.children.indexOf(e);if(n>-1)this.children.splice(n,1),e.parent=void 0,this._updatePropagator();else throw new Error("Trying to remove an unknown child node!")}excise(){if(this.isRoot())throw new Error("Cannot excise root node!");if(this.isTerminal())this.parent.removeChild(this);else if(this.children.length==1){const e=this.children[0];e.setParent(this.parent),this.parent.children[this.parent.children.indexOf(this)]=e,this.parent._updatePropagator(),this.setParent(void 0),this.children.length=0}else throw new Error("Cannot excise a node that has multiple children!")}isRoot(){return!this.parent}isBranching(){return this.children.length>1}isTerminal(){return this.children.length==0}visit(e){e(this);for(const n of this.children)n.visit(e);e.afterChildren&&e.afterChildren(this)}subtreeToString(e=0){const n=this.children.map(r=>r.subtreeToString(e+1)).join("");return`${" ".repeat(e*2)}* ${this.constructor.name}${("identifier"in this&&this.identifier?": "+this.identifier:"")??""} 
${n}`}getGlobalObject(){return this.parent?this.parent.getGlobalObject():oE}handle(e){this._propagate(e)}complete(){this.completed=!0;for(const e of this.children)e.complete()}beginBatch(e){for(const n of this.children)n.beginBatch(e)}_propagate(e){}}function Ud(t){return t.type=="file"}function aE(t){return t.type=="facet"}class $d extends X{constructor(e){super(),this.k=e.size||500,this.reset()}reset(){super.reset(),this.reservoir=[],this.W=void 0,this.ingester=this._initialIngester}_initialIngester(e){this.reservoir.push(e),this.reservoir.length==this.k&&(this.W=Math.exp(Math.log(Math.random())/this.k),this.i=this.k,this.next=this.i,this.ingester=this._finalIngester,this._setNextStop())}_finalIngester(e){++this.i==this.next&&(this.reservoir[Math.floor(Math.random()*this.k)]=e,this.W*=Math.exp(Math.log(Math.random())/this.k),this._setNextStop())}_setNextStop(){this.next+=Math.floor(Math.log(Math.random())/Math.log(1-this.W))+1}handle(e){this.ingester(e)}complete(){for(const e of this.reservoir)this._propagate(e);super.complete()}}function cE(t,e,n){const r=new $d({type:"sample",size:t});for(const i of e)r.handle(n(i));return r.complete(),r.reservoir}const uE={};class lE extends Ki{constructor(e){super(e),Object.defineProperties(this.defaultProperties,Object.getOwnPropertyDescriptors({x:.5,y:.5,color:"#4c78a8",filled:!0,opacity:1,size:100,semanticScore:0,shape:"circle",strokeWidth:2,fillGradientStrength:0,dx:0,dy:0,angle:0,sampleFacetPadding:.1,semanticZoomFraction:.02}))}getAttributes(){return["inwardStroke","uniqueId","facetIndex","x","y","size","semanticScore","shape","strokeWidth","gradientStrength","dx","dy","fill","stroke","fillOpacity","strokeOpacity","angle"]}getSupportedChannels(){return[...super.getSupportedChannels(),"size","semanticScore","shape","strokeWidth","dx","dy","fill","stroke","fillOpacity","strokeOpacity","angle"]}getDefaultEncoding(){return{...super.getDefaultEncoding(),...uE}}fixEncoding(e){return Nd(e,this.properties.filled),zd(e,this.properties.filled),delete e.color,delete e.opacity,e}initializeData(){super.initializeData();const e=this.unitView.getAccessor("semanticScore");e&&(this.sampledSemanticScores=Float32Array.from(cE(1e4,this.unitView.getCollector().getData(),e)),this.sampledSemanticScores.sort((n,r)=>n-r))}async initializeGraphics(){await super.initializeGraphics(),this.createAndLinkShaders(rE,iE,[sE])}finalizeGraphicsInitialization(){super.finalizeGraphicsInitialization(),this.gl.useProgram(this.programInfo.program);const e=this.properties;Rn(this.markUniformInfo,{uInwardStroke:!!e.inwardStroke,uGradientStrength:+e.fillGradientStrength,uMaxRelativePointDiameter:1-2*e.sampleFacetPadding})}updateGraphicsData(){const e=this.unitView.getCollector(),n=e.getItemCount(),r=new zv({encoders:this.encoders,attributes:this.getAttributes(),numItems:Math.max(n,this.properties.minBufferSize||0)});r.addBatches(e.facetBatches);const i=r.toArrays();this.rangeMap.migrateEntries(i.rangeMap),this.updateBufferInfo(i)}_getGeometricScaleFactor(){const e=Math.pow(2,this.properties.geometricZoomBound||0);return Math.pow(Math.min(1,this.unitView.getZoomLevel()/e),1/3)}_getMaxPointSize(){const e=this.encoders.size;return e.constant?e(null):e.scale.range().reduce((n,r)=>Math.max(n,r))}getSemanticThreshold(){if(this.sampledSemanticScores){const e=Math.max(0,1-this.properties.semanticZoomFraction*this.unitView.getZoomLevel());if(e<=0)return-1/0;if(e>=1)return 1/0;{const n=this.sampledSemanticScores;return Qf(n,e)}}else return-1}prepareRender(e){const n=super.prepareRender(e);return n.push(()=>{Rn(this.markUniformInfo,{uMaxPointSize:this._getMaxPointSize(),uScaleFactor:this._getGeometricScaleFactor(),uSemanticThreshold:this.getSemanticThreshold()}),this.markUniformsAltered=!0}),n.push(()=>this.bindOrSetMarkUniformBlock()),n.push(()=>vr(this.gl,this.programInfo,this.vertexArrayInfo)),n}render(e){const n=this.gl;return this.createRenderCallback((r,i)=>{i&&Yi(n,this.vertexArrayInfo,n.POINTS,i,r)},e)}}const fE="const int BUTT=0;const int SQUARE=1;const int ROUND=2;in float pos;in float side;out vec4 vColor;out float vSize;out float vNormalLengthInPixels;out highp vec2 vPosInPixels;void main(void){float pixelSize=1.0/uDevicePixelRatio;float size=getScaled_size();float opacity=getScaled_opacity()*uViewOpacity;if(size<pixelSize){opacity*=size/pixelSize;size=pixelSize;}vec2 a=applySampleFacet(vec2(getScaled_x(),getScaled_y()));vec2 b=applySampleFacet(vec2(getScaled_x2(),getScaled_y2()));vec2 tangent=b-a;float offset=0.0;float relativeDiff=0.0;if(uMinLength>0.0||uStrokeCap!=BUTT){float len=length(tangent*uViewportSize);float diff=max(0.0,uMinLength-len);if(uStrokeCap!=BUTT){diff+=size;}relativeDiff=diff/len;offset=relativeDiff*(pos-0.5);}vec2 p=pos<1.0? a+tangent*(pos+offset): b+tangent*offset;float aaPadding=pixelSize;vec2 normal=normalize(vec2(-tangent.y,tangent.x)/uViewportSize);p+=normal*side*(size+aaPadding)/uViewportSize;gl_Position=unitToNdc(p);vColor=vec4(getScaled_color()*opacity,opacity);vSize=size;vNormalLengthInPixels=side*(size+aaPadding);vPosInPixels=vec2(pos,(1.0-pos))*(1.0+relativeDiff)*length(tangent*uViewportSize)-vec2(uStrokeCap!=BUTT ? size/2.0 : 0.0);setupPicking();}",hE="const int BUTT=0;const int SQUARE=1;const int ROUND=2;uniform sampler2D uDashTexture;in vec4 vColor;in float vSize;in vec2 vPosInPixels;in float vNormalLengthInPixels;out lowp vec4 fragColor;void main(void){float dpr=uDevicePixelRatio;float distanceFromEnd=-min(vPosInPixels[0],vPosInPixels[1]);float distance;if(distanceFromEnd>0.0&&uStrokeCap==ROUND){distance=length(vec2(distanceFromEnd,vNormalLengthInPixels));}else{distance=abs(vNormalLengthInPixels);}float opacity=clamp(((vSize/2.0-distance)*dpr),-0.5,0.5)+0.5;if(uDashTextureSize>0.0){float pos=(vPosInPixels[0]+uStrokeDashOffset)*dpr;float floored=floor(pos);vec2 texelPositions=(floored+vec2(0.5,1.5))/dpr/uDashTextureSize;opacity*=mix(texture(uDashTexture,vec2(texelPositions[0],0)).r,texture(uDashTexture,vec2(texelPositions[1],0)).r,clamp((pos-floored),0.0,1.0));}fragColor=vColor*opacity;if(uPickingEnabled){fragColor=vPickingColor;}}",dE="uniform Mark{uniform mediump float uMinLength;uniform mediump float uDashTextureSize;uniform lowp int uStrokeCap;uniform mediump float uStrokeDashOffset;};";class pE extends Ki{constructor(e){super(e),this.dashTextureSize=0,Object.defineProperties(this.defaultProperties,Object.getOwnPropertyDescriptors({x2:void 0,y2:void 0,size:1,color:"black",opacity:1,minLength:0,strokeDash:null,strokeDashOffset:0,strokeCap:"butt"}))}getAttributes(){return["uniqueId","facetIndex","x","x2","y","y2","size","color","opacity"]}getSupportedChannels(){return[...super.getSupportedChannels(),"x2","y2","size"]}fixEncoding(e){if(!(e.x&&e.y&&e.x2&&e.y2))if(e.x&&e.x2&&!e.y)e.y={value:.5},e.y2=e.y;else if(e.y&&e.y2&&!e.x)e.x={value:.5},e.x2=e.x;else if(e.x&&!e.y)e.y={value:0},e.y2={value:1},e.x2=e.x;else if(e.y&&!e.x)e.x={value:0},e.x2={value:1},e.y2=e.y;else if(e.x&&e.y&&e.y2)e.x2=e.x;else if(e.y&&e.x&&e.x2)e.y2=e.y;else if(e.y&&e.x)if(!e.x2&&De(e.y)&&e.y.type=="quantitative")e.x2=e.x,e.y2={datum:0};else if(!e.y2&&De(e.x)&&e.x.type=="quantitative")e.y2=e.y,e.x2={datum:0};else throw new Error("A bug!");else throw new Error("Invalid x and y encodings for rule mark: "+JSON.stringify(e));return e}async initializeGraphics(){if(await super.initializeGraphics(),this.properties.strokeDash){const e=this.gl,n=mE(this.properties.strokeDash);this.dashTexture=di(e,{mag:e.NEAREST,min:e.NEAREST,internalFormat:e.R8,format:e.RED,src:n,height:1}),this.dashTextureSize=n.length}this.createAndLinkShaders(fE,hE,[dE])}finalizeGraphicsInitialization(){super.finalizeGraphicsInitialization(),this.gl.useProgram(this.programInfo.program);const e=this.properties;this.registerMarkUniform("uMinLength",e.minLength),this.registerMarkUniform("uStrokeCap",e.strokeCap??"butt",n=>["butt","square","round"].indexOf(n)),Rn(this.markUniformInfo,{uDashTextureSize:+this.dashTextureSize}),this.markUniformsAltered=!0}updateGraphicsData(){const e=this.unitView.getCollector(),n=e.getItemCount(),r=new Nv({encoders:this.encoders,attributes:this.getAttributes(),numItems:Math.max(n,this.properties.minBufferSize||0)});r.addBatches(e.facetBatches);const i=r.toArrays();this.rangeMap.migrateEntries(i.rangeMap),this.updateBufferInfo(i)}prepareRender(e){const n=super.prepareRender(e);return n.push(()=>this.bindOrSetMarkUniformBlock()),this.dashTexture&&n.push(()=>cn(this.programInfo,{uDashTexture:this.dashTexture})),n.push(()=>vr(this.gl,this.programInfo,this.vertexArrayInfo)),n}render(e){const n=this.gl;return this.createRenderCallback((r,i)=>Yi(n,this.vertexArrayInfo,n.TRIANGLE_STRIP,i,r),e)}}function mE(t){if(t.length==0||t.length%2||t.findIndex(s=>Math.round(s)!=s||s<1||s>1e3)>=0)throw new Error("Invalid stroke dash pattern: "+JSON.stringify(t));const e=t.reduce((s,o)=>s+o),n=new Uint8Array(e);let r=!0,i=0;for(let s of t){for(;s;)n[i++]=r&&255||0,s--;r=!r}return n}const gE="uniform Mark{uniform float uArcHeightFactor;uniform float uMinArcHeight;uniform float uMinPickingSize;uniform int uShape;uniform int uOrient;uniform bool uClampApex;uniform float uMaxChordLength;uniform vec2 uArcFadingDistance;};in vec2 strip;out vec4 vColor;out float vSize;out float vNormalLengthInPixels;const int SHAPE_ARC=0;const int SHAPE_DOME=1;const int SHAPE_DIAGONAL=2;const int SHAPE_LINE=3;const int ORIENT_VERTICAL=0;const int ORIENT_HORIZONTAL=1;float distanceFromLine(vec2 pointOnLine1,vec2 pointOnLine2,vec2 point){vec2 a=point-pointOnLine1;vec2 b=pointOnLine2-pointOnLine1;vec2 proj=dot(a,b)/dot(b,b)*b;return length(a-proj);}bool isInsideViewport(vec2 point,float marginFactor){vec2 margin=uViewportSize*vec2(marginFactor);return point.x>=-margin.x&&point.x<=uViewportSize.x+margin.x&&point.y>=-margin.y&&point.y<=uViewportSize.y+margin.y;}void main(void){float pixelSize=1.0/uDevicePixelRatio;float opacity=getScaled_opacity()*uViewOpacity;vec2 p1,p2,p3,p4;vec2 a=applySampleFacet(vec2(getScaled_x(),getScaled_y()))*uViewportSize;vec2 b=applySampleFacet(vec2(getScaled_x2(),getScaled_y2()))*uViewportSize;if(uShape<=SHAPE_DOME){if(uShape==SHAPE_DOME){vec2 height=vec2(0.0);if(uOrient==ORIENT_VERTICAL){p1=vec2(min(a.x,b.x),b.y);p4=vec2(max(a.x,b.x),b.y);height=vec2(0.0,a.y-b.y);if(uClampApex){if(p4.x>0.0){p1.x=max(p1.x,-p4.x);}if(p1.x<uViewportSize.x){p4.x=min(p4.x,2.0*uViewportSize.x-p1.x);}}}else{p1=vec2(b.x,min(a.y,b.y));p4=vec2(b.x,max(a.y,b.y));height=vec2(a.x-b.x,0.0);if(uClampApex){if(p4.y>0.0){p1.y=max(p1.y,-p4.y);}if(p1.y<uViewportSize.y){p4.y=min(p4.y,2.0*uViewportSize.y-p1.y);}}}vec2 controlOffset=height/0.75;p2=p1+controlOffset;p3=p4+controlOffset;}if(uShape==SHAPE_ARC){p1=a;p4=b;vec2 chordVector=p4-p1;vec2 unitChordVector=normalize(chordVector);vec2 chordNormal=vec2(-unitChordVector.y,unitChordVector.x);float chordLength=length(chordVector);if(chordLength>uMaxChordLength){if(isInsideViewport(p1,2.0)){chordLength=uMaxChordLength;p4=p1+unitChordVector*uMaxChordLength;}else if(isInsideViewport(p4,2.0)){chordLength=uMaxChordLength;p1=p4-unitChordVector*uMaxChordLength;}}float height=max(chordLength/2.0*uArcHeightFactor,uMinArcHeight);vec2 controlOffset=chordNormal*height/0.75;p2=p1+controlOffset;p3=p4+controlOffset;}}else if(uShape==SHAPE_DIAGONAL){if(uOrient==ORIENT_VERTICAL){p1=a;p2=vec2(a.x,(a.y+b.y)/2.0);p3=vec2(b.x,(a.y+b.y)/2.0);p4=b;}else{p1=a;p2=vec2((a.x+b.x)/2.0,a.y);p3=vec2((a.x+b.x)/2.0,b.y);p4=b;}}else if(uShape==SHAPE_LINE){p1=a;p2=(a+b)/2.0;p3=p2;p4=b;}float t=smoothstep(0.0,1.0,strip.x);vec2 C1=p4-3.0*p3+3.0*p2-p1;vec2 C2=3.0*p3-6.0*p2+3.0*p1;vec2 C3=3.0*p2-3.0*p1;vec2 C4=p1;vec2 p;if(t==0.0){p=p1;}else if(t==1.0){p=p4;}else{p=C1*t*t*t+C2*t*t+C3*t+C4;}vec2 tangent=normalize(3.0*C1*t*t+2.0*C2*t+C3);vec2 normal=vec2(-tangent.y,tangent.x);float size=getScaled_size();if(size<pixelSize){opacity*=size/pixelSize;size=pixelSize;}float paddedSize=uPickingEnabled? max(size,uMinPickingSize): size+pixelSize;vNormalLengthInPixels=strip.y*paddedSize;if(uShape==SHAPE_ARC&&uArcFadingDistance[0]>0.0&&uArcFadingDistance[1]>0.0){float d=distanceFromLine(p1,p4,p);float distanceOpacity=smoothstep(uArcFadingDistance[1],uArcFadingDistance[0],d);opacity*=distanceOpacity;if(distanceOpacity<=0.0){vNormalLengthInPixels=0.0;}}p+=normal*vNormalLengthInPixels;gl_Position=pixelsToNdc(p);vec3 color=getScaled_color();vColor=vec4(color*opacity,opacity);vSize=paddedSize;setupPicking();}",xE="in vec4 vColor;in float vSize;in float vNormalLengthInPixels;out lowp vec4 fragColor;void main(void){float dpr=uDevicePixelRatio;float distance=abs(vNormalLengthInPixels);float opacity=clamp(((vSize/2.0-distance)*dpr),0.0,1.0);fragColor=vColor*opacity;if(uPickingEnabled){fragColor=vPickingColor;}}",yE=["arc","dome","diagonal","line"],bE=["vertical","horizontal"];class AE extends Ki{constructor(e){super(e),Object.defineProperties(this.defaultProperties,Object.getOwnPropertyDescriptors({x:0,x2:void 0,y:0,y2:void 0,size:1,color:"black",opacity:1,segments:101,arcHeightFactor:1,minArcHeight:1.5,minPickingSize:3,clampApex:!1,maxChordLength:5e4,arcFadingDistance:!1,linkShape:"arc",orient:"vertical"}))}getAttributes(){return["uniqueId","facetIndex","x","x2","y","y2","size","height","color","opacity"]}getSupportedChannels(){return[...super.getSupportedChannels(),"x2","y2","size"]}fixEncoding(e){return e.x2||(De(e.x)?e.x2={datum:0}:e.x2=e.x),e.y2||(De(e.y)?e.y2={datum:0}:e.y2=e.y),e}async initializeGraphics(){await super.initializeGraphics(),this.createAndLinkShaders(gE,xE)}finalizeGraphicsInitialization(){super.finalizeGraphicsInitialization(),this.gl.useProgram(this.programInfo.program);const e=this.properties;this.registerMarkUniform("uArcFadingDistance",e.arcFadingDistance,n=>n||[0,0]),this.registerMarkUniform("uArcHeightFactor",e.arcHeightFactor),this.registerMarkUniform("uMinArcHeight",e.minArcHeight),this.registerMarkUniform("uMinPickingSize",e.minPickingSize),this.registerMarkUniform("uShape",e.linkShape,n=>yE.indexOf(n)),this.registerMarkUniform("uOrient",e.orient,n=>bE.indexOf(n)),this.registerMarkUniform("uClampApex",e.clampApex,n=>!!n),this.registerMarkUniform("uMaxChordLength",e.maxChordLength)}updateGraphicsData(){const e=this.unitView.getCollector(),n=e.getItemCount(),r=new Uv({encoders:this.encoders,attributes:this.getAttributes(),numItems:n});r.addBatches(e.facetBatches);const i=r.toArrays();i.arrays.strip={data:wE(this.properties.segments),numComponents:2},this.rangeMap.migrateEntries(i.rangeMap),this.arrays=Object.fromEntries(Object.entries(i.arrays).map(([s,o])=>[s,{...o,data:void 0}])),this.updateBufferInfo(i)}prepareRender(e){const n=super.prepareRender(e);return n.push(()=>this.bindOrSetMarkUniformBlock()),n}render(e){const n=this.gl;return this.createRenderCallback((r,i)=>{this.gl.bindVertexArray(this.vertexArrayInfo.vertexArrayObject);for(const s of Object.entries(this.bufferInfo.attribs)){const[o,a]=s;a.buffer&&a.numComponents&&a.divisor&&(a.offset=r*this.arrays[o].numComponents*4)}vr(n,this.programInfo,this.bufferInfo),Yi(n,this.bufferInfo,n.TRIANGLE_STRIP,(this.properties.segments+1)*2,0,i)},e)}}function wE(t){let e=0;const n=[];for(;e<=t;e++)n.push(e/t,.5),n.push(e/t,-.5);return n}const vE=`in mediump vec2 vertexCoord;in lowp vec2 textureCoord;in float width;out vec2 vTexCoord;out vec4 vColor;out float vSlope;out float vEdgeFadeOpacity;struct RangeResult{float pos;float scale;};float minValue(vec4 v){return min(min(v.x,v.y),min(v.z,v.w));}float maxValue(vec4 v){return max(max(v.x,v.y),max(v.z,v.w));}/***All measures are in[0,1]*/RangeResult positionInsideRange(float a,float b,float width,float padding,int align,bool flush){float span=b-a;float paddedWidth=width+2.0*padding;if(a>1.0||b<0.0){return RangeResult(0.0,0.0);}float extra=max(0.0,span-paddedWidth);float pos;if(align==0){float centre=a+b;if(flush){float leftOver=max(0.0,paddedWidth-centre);centre+=min(leftOver,extra);float rightOver=max(0.0,paddedWidth+centre-2.0);centre-=min(rightOver,extra);}pos=centre/2.0;}else if(align<0){float edge=a;if(flush){float over=max(0.0,-edge);edge+=min(over,extra);}pos=edge+padding;}else{float edge=b;if(flush){float over=max(0.0,edge-1.0);edge-=min(over,extra);}pos=edge-padding;}float scale=clamp((span-padding)/paddedWidth,0.0,1.0);return RangeResult(pos,scale);}vec2 calculateRotatedDimensions(float width,mat2 rotationMatrix){vec2 a=abs(rotationMatrix*vec2(width/2.0,0.5));vec2 b=abs(rotationMatrix*vec2(width/2.0,-0.5));return vec2(max(a.x,b.x),max(a.y,b.y))*2.0;}ivec2 fixAlignForAngle(ivec2 align,float angleInDegrees){float a=mod(angleInDegrees+45.0,360.0);int x=align.x;int y=-align.y;if(a<90.0){return ivec2(x,y);}else if(a<180.0){return ivec2(y,-x);}else if(a<270.0){return ivec2(-x,y);}else{return ivec2(-y,x);}}void main(void){float opacity=getScaled_opacity()*uViewOpacity;vec2 size=vec2(getScaled_size());float x=getScaled_x();float y=getScaled_y();float scale=1.0;float angleInDegrees=getScaled_angle();float angle=-angleInDegrees*PI/180.0;float sinTheta=sin(angle);float cosTheta=cos(angle);mat2 rotationMatrix=mat2(cosTheta,sinTheta,-sinTheta,cosTheta);vec2 flushSize=calculateRotatedDimensions(width,rotationMatrix);
#if defined(x2_DEFINED) || defined(y2_DEFINED)
ivec2 align=fixAlignForAngle(uAlign,angleInDegrees);
#else
ivec2 align=uAlign;
#endif
#ifdef x2_DEFINED
float x2=getScaled_x2();if(uLogoLetter){size.x=(x2-x)*uViewportSize.x;x+=(x2-x)/2.0;}else{float x2=getScaled_x2();RangeResult result=positionInsideRange(min(x,x2),max(x,x2),size.x*scale*flushSize.x/uViewportSize.x,uPaddingX/uViewportSize.x,align.x,uFlushX);x=result.pos;scale*=result.scale;}
#endif
vec2 pos=applySampleFacet(vec2(x,y));
#ifdef y2_DEFINED
float y2=getScaled_y2();vec2 pos2=applySampleFacet(vec2(x,y2));if(uLogoLetter){size.y=(pos2.y-pos.y)*uViewportSize.y;pos.y+=(pos2.y-pos.y)/2.0;}else{RangeResult result=positionInsideRange(min(pos.y,pos2.y),max(pos.y,pos2.y),size.y*scale*flushSize.y/uViewportSize.y,uPaddingY/uViewportSize.y,align.y,uFlushY);pos.y=result.pos;scale*=result.scale;}
#endif
if(scale<1.0){if(uSqueeze){vec2 scaleFadeExtent=vec2(3.0,6.0)/size;if(scale<scaleFadeExtent[0]){gl_Position=vec4(0.0);return;}size*=scale;opacity*=linearstep(scaleFadeExtent[0],scaleFadeExtent[1],scale);}else if(scale<1.0){gl_Position=vec4(0.0);return;}}vec2 charPos=rotationMatrix*(vertexCoord*size+uD);vec2 unitPos=pos+charPos/uViewportSize;gl_Position=unitToNdc(unitPos);vSlope=max(1.0,min(size.x,size.y)/uSdfNumerator);vColor=vec4(getScaled_color()*opacity,opacity);vTexCoord=textureCoord;if(maxValue(uViewportEdgeFadeDistance)>-pow(10.0,10.0)){vEdgeFadeOpacity=minValue(((vec4(1.0,1.0,0.0,0.0)+vec4(-1.0,-1.0,1.0,1.0)*unitPos.yxyx)*uViewportSize.yxyx-uViewportEdgeFadeDistance)/uViewportEdgeFadeWidth);}else{vEdgeFadeOpacity=1.0;}setupPicking();}`,EE="uniform sampler2D uTexture;in vec2 vTexCoord;in float vEdgeFadeOpacity;in vec4 vColor;in float vSlope;out lowp vec4 fragColor;float median(float r,float g,float b){return max(min(r,g),min(max(r,g),b));}void main(){vec3 c=texture(uTexture,vTexCoord).rgb;float sigDist=1.0-median(c.r,c.g,c.b);float slope=uLogoLetter? 0.7/length(vec2(dFdy(sigDist),dFdx(sigDist))): vSlope;float opa=clamp((sigDist-0.5)*slope+0.5,0.0,1.0);opa*=pow(clamp(vEdgeFadeOpacity,0.0,1.0),2.2);fragColor=vColor*opa;if(uPickingEnabled){fragColor=vPickingColor;}}",CE="uniform Mark{uniform mediump float uSdfNumerator;uniform mediump vec2 uD;uniform mediump vec4 uViewportEdgeFadeWidth;uniform mediump vec4 uViewportEdgeFadeDistance;uniform bool uSqueeze;uniform bool uLogoLetter;uniform lowp ivec2 uAlign;uniform mediump float uPaddingX;uniform bool uFlushX;uniform mediump float uPaddingY;uniform bool uFlushY;};",SE={left:-1,center:0,right:1},FE={top:-1,middle:0,bottom:1,alphabetic:1};class TE extends Ki{constructor(e){super(e),Object.defineProperties(this.defaultProperties,Object.getOwnPropertyDescriptors({x:.5,y:.5,x2:void 0,y2:void 0,text:"",size:11,color:"black",opacity:1,font:void 0,fontStyle:void 0,fontWeight:void 0,align:"center",baseline:"middle",dx:0,dy:0,angle:0,fitToBand:!1,squeeze:!0,paddingX:0,paddingY:0,flushX:!0,flushY:!0,logoLetters:!1,viewportEdgeFadeWidthTop:0,viewportEdgeFadeWidthRight:0,viewportEdgeFadeWidthBottom:0,viewportEdgeFadeWidthLeft:0,viewportEdgeFadeDistanceTop:-1/0,viewportEdgeFadeDistanceRight:-1/0,viewportEdgeFadeDistanceBottom:-1/0,viewportEdgeFadeDistanceLeft:-1/0})),this.font=this.properties.font?e.context.fontManager.getFont(this.properties.font,this.properties.fontStyle,this.properties.fontWeight):e.context.fontManager.getDefaultFont()}getAttributes(){return["uniqueId","facetIndex","x","x2","y","y2","color","size","opacity","angle"]}getSupportedChannels(){return[...super.getSupportedChannels(),"x2","y2","size","text","angle"]}fixEncoding(e){for(const n of br)this.properties.fitToBand&&cc(e,n);return e}async initializeGraphics(){await super.initializeGraphics(),this.createAndLinkShaders(vE,EE,[CE])}finalizeGraphicsInitialization(){super.finalizeGraphicsInitialization(),this.gl.useProgram(this.programInfo.program);const e=this.properties;Rn(this.markUniformInfo,{uPaddingX:e.paddingX,uPaddingY:e.paddingY,uFlushX:!!e.flushX,uFlushY:!!e.flushY,uAlign:[SE[e.align],FE[e.baseline]],uD:[e.dx,-e.dy],uLogoLetter:!!e.logoLetters,uSqueeze:!!e.squeeze,uViewportEdgeFadeWidth:[e.viewportEdgeFadeWidthTop,e.viewportEdgeFadeWidthRight,e.viewportEdgeFadeWidthBottom,e.viewportEdgeFadeWidthLeft],uViewportEdgeFadeDistance:[e.viewportEdgeFadeDistanceTop,e.viewportEdgeFadeDistanceRight,e.viewportEdgeFadeDistanceBottom,e.viewportEdgeFadeDistanceLeft]})}updateGraphicsData(){const e=this.unitView.getCollector(),n=e.getData(),r=this.encoding,i=this.encoders.text.accessor||this.encoders.text;let s=0;const o="format"in r.text?ue(r.text.format):u=>u;for(const u of n){const f=o(i(u)),l=V(f)?f:f===null?"":""+f;s+=l&&l.length||0}const a=new $v({encoders:this.encoders,attributes:this.getAttributes(),properties:this.properties,fontMetrics:this.font.metrics,numCharacters:Math.max(s,this.properties.minBufferSize||0)});a.addBatches(e.facetBatches);const c=a.toArrays();this.rangeMap.migrateEntries(c.rangeMap),this.updateBufferInfo(c)}prepareRender(e){const n=super.prepareRender(e);let r=.35;this.properties.logoLetters&&(r/=2);const i=this.font.metrics.common.base/(this.unitView.context.devicePixelRatio/r);return n.push(()=>{Rn(this.markUniformInfo,{uSdfNumerator:i}),this.markUniformsAltered=!0,cn(this.programInfo,{uTexture:this.font.texture})}),n.push(()=>this.bindOrSetMarkUniformBlock()),n.push(()=>vr(this.gl,this.programInfo,this.vertexArrayInfo)),n}render(e){const n=this.gl;return this.createRenderCallback((r,i)=>Yi(n,this.vertexArrayInfo,n.TRIANGLES,i,r),e)}}function cf(t,e,{spacing:n,devicePixelRatio:r,offset:i,reverse:s}={}){n=n||0,i=i||0;let o=0,a=0;for(const d of t)o+=xs(d.px)+(wa(d)?0:n),a+=xs(d.grow);o-=n;const c=Math.max(0,e-o),u=r!==void 0?d=>Math.round(d*r)/r:d=>d,f=[],l=[],h=d=>{const m=f.length;if(!m)return;const g=(d?n:0)*(s?-1:1);p-=g;for(let x=0;x<m;x++)l.push({location:p+(x+1)/(m+1)*g,size:0});p+=g,f.length=0};let p=s?Math.max(e,o):0+i;if(t.length==1&&wa(t[0]))return[{location:p,size:0}];for(let d=0;d<t.length;d++){const m=t[d];if(wa(m))f.push(m);else{h(l.length>0);const g=xs(m.px)+(a?xs(m.grow)/a*c:0);s&&(p-=g),l.push({location:u(p),size:u(g)}),s?p-=n:p+=g+n}}return p+=s?n:-n,h(!1),l}function DE(t){let e=0,n=0;for(const r of t)e=Math.max(e,r.px??0),n=Math.max(n,r.grow??0);return{px:e,grow:n}}var xi,fc;const Bu=class Bu{constructor(e,n){M(this,xi);this.width=e,this.height=n}addPadding(e){return I(this,xi,fc).call(this,e.width,e.height)}subtractPadding(e){return I(this,xi,fc).call(this,-e.width,-e.height)}};xi=new WeakSet,fc=function(e,n){return new Bu({px:(this.width.px??0)+e,grow:this.width.grow},{px:(this.height.px??0)+n,grow:this.height.grow})};let Nt=Bu;const Ur=Object.freeze({px:0,grow:0}),uf=new Nt(Ur,Ur);function wa(t){return!t.px&&!t.grow}function xs(t){return t||0}function IE(t){return t&&(be(t.px)||be(t.grow))}function Vd(t){if(Gd(t))throw new Error("parseSizeDef does not accept step-based sizes.");if(IE(t))return t;if(be(t))return{px:t,grow:0};if(t==="container")return{px:0,grow:1};if(!t)return{px:0,grow:1};throw new Error(`Invalid sizeDef: ${t}`)}class pe{constructor(e,n,r,i){this.top=e||0,this.right=n||0,this.bottom=r||0,this.left=i||0}get width(){return this.left+this.right}get height(){return this.top+this.bottom}expand(e){return e<=0?this:new pe(this.top+e,this.right+e,this.bottom+e,this.left+e)}add(e){return new pe(this.top+e.top,this.right+e.right,this.bottom+e.bottom,this.left+e.left)}subtract(e){return new pe(this.top-e.top,this.right-e.right,this.bottom-e.bottom,this.left-e.left)}union(e){return new pe(Math.max(this.top,e.top),Math.max(this.right,e.right),Math.max(this.bottom,e.bottom),Math.max(this.left,e.left))}getHorizontal(){return new pe(0,this.right,0,this.left)}getVertical(){return new pe(this.top,0,this.bottom,0)}get horizontalTotal(){return this.left+this.right}get verticalTotal(){return this.top+this.bottom}static createFromConfig(e){return typeof e=="number"?this.createUniformPadding(e):e?this.createFromRecord(e):hc}static createFromRecord(e){return new pe(e.top,e.right,e.bottom,e.left)}static zero(){return hc}static createUniformPadding(e){return new pe(e,e,e,e)}}const hc=pe.createUniformPadding(0);Object.freeze(hc);const _E=/^([A-Za-z]+:)?\/\//;function RE(t,e){if(e&&_E.test(e))return e;const n=t();return n&&e?n.endsWith("/")?n+e:n+"/"+e:n??e}const ME="VISIT_SKIP",$r="VISIT_STOP",lf=t=>t;var Xn,yi,bi,hn,kr,Ai,dc;class BE{constructor(e,n,r,i,s,o={}){M(this,hn);M(this,Ai);M(this,Xn,{});M(this,yi,{});M(this,bi,{});fe(this,"opacityFunction",lf);if(!e)throw new Error("View spec must be defined!");this.context=n,this.layoutParent=r,this.dataParent=i,this.name=e.name||s,this.spec=e,this.resolutions={scale:{},axis:{}},kd(this),this.options={blockEncodingInheritance:!1,contributesToScaleDomain:!0,...o},this.needsAxes={x:!1,y:!1}}getPadding(){return this._cache("size/padding",()=>pe.createFromConfig(this.spec.padding))}getOverhang(){return pe.zero()}isScrollable(){return this.spec.viewportWidth!=null||this.spec.viewportHeight!=null}getSize(){return this._cache("size/size",()=>this.isConfiguredVisible()?new Nt(I(this,hn,kr).call(this,"width"),I(this,hn,kr).call(this,"height")):uf)}getViewportSize(){if(!this.isScrollable())return this.getSize();if(!this.isConfiguredVisible())return uf;const e=this.getSize();return new Nt(I(this,hn,kr).call(this,"viewportWidth")??e.width,I(this,hn,kr).call(this,"viewportHeight")??e.height)}isConfiguredVisible(){return this.context.isViewConfiguredVisible(this)}isVisibleInSpec(){return this.spec.visible??!0}isVisible(){return this.getLayoutAncestors().every(e=>e.isConfiguredVisible())}getEffectiveOpacity(){var e;return this.opacityFunction(((e=this.layoutParent)==null?void 0:e.getEffectiveOpacity())??1)}getPathString(){return this.getLayoutAncestors().map(e=>e.name).reverse().join("/")}getLayoutAncestors(){return I(this,Ai,dc).call(this,"layoutParent")}getDataAncestors(){return I(this,Ai,dc).call(this,"dataParent")}handleBroadcast(e){for(const n of S(this,Xn)[e.type]||[])n(e)}_addBroadcastHandler(e,n){let r=S(this,Xn)[e];r||(r=[],S(this,Xn)[e]=r),r.push(n)}handleInteractionEvent(e,n,r){const i=r?S(this,yi):S(this,bi);for(const s of i[n.type]||[])s(e,n)}addInteractionEventListener(e,n,r){const i=r?S(this,yi):S(this,bi);let s=i[e];s||(s=[],i[e]=s),s.push(n)}visit(e){try{const n=e(this);if(e.postOrder&&e.postOrder(this),n!==$r)return n}catch(n){throw n.view=this,n}}getDescendants(){const e=[];return this.visit(n=>{e.push(n)}),e}configureViewOpacity(){(!this.opacityFunction||this.opacityFunction===lf)&&(this.opacityFunction=OE(this))}onBeforeRender(){}render(e,n,r={}){}getEncoding(){const e=this.dataParent&&!this.options.blockEncodingInheritance?this.dataParent.getEncoding():{},n=this.spec.encoding||{},r={...e,...n};for(const[i,s]of Object.entries(r))s===null&&delete r[i];return r}getFacetAccessor(e){if(this.layoutParent)return this.layoutParent.getFacetAccessor(this)}getFacetFields(e){var r;const n=this.getEncoding().sample;return qi(n)?[n.field]:(r=this.layoutParent)==null?void 0:r.getFacetFields(this)}getSampleFacetTexture(){}getScaleResolution(e){const n=_n(e);return this.getDataAncestors().map(r=>r.resolutions.scale[n]).find(r=>r)}getAxisResolution(e){const n=_n(e);return this.getDataAncestors().map(r=>r.resolutions.axis[n]).find(r=>r)}getConfiguredResolution(e,n){var r,i;return(i=(r=this.spec.resolve)==null?void 0:r[n])==null?void 0:i[e]}getConfiguredOrDefaultResolution(e,n){return this.getConfiguredResolution(e,n)??this.getConfiguredResolution("default",n)??this.getDefaultResolution(e,n)}getDefaultResolution(e,n){return"independent"}getBaseUrl(){return RE(()=>{var e;return(e=this.dataParent)==null?void 0:e.getBaseUrl()},this.spec.baseUrl)}isPickingSupported(){return!0}getTitleText(){const e=this.spec.title;if(e)return V(e)?e:e.text}_cache(e,n){return pr(this,e,n)}_invalidateCacheByPrefix(e,n="self"){switch(n){case"self":As(this,e);break;case"ancestors":for(const r of this.getLayoutAncestors())As(r,e);break;case"progeny":this.visit(r=>As(r,e));break}}invalidateSizeCache(){this._invalidateCacheByPrefix("size/","ancestors")}propagateInteractionEvent(e){}}Xn=new WeakMap,yi=new WeakMap,bi=new WeakMap,hn=new WeakSet,kr=function(e){var i;let n=this.spec[e];const r=e=="viewportWidth"||e=="viewportHeight";if(Gd(n)){if(r)throw new vn(`Cannot use step-based size with "${e}"!`,this);const s=n.step,o=(i=this.getScaleResolution(e=="width"?"x":"y"))==null?void 0:i.getScale();if(o){let a=0;if(Ot(o.type))a=o.domain().length;else if(["locus","index"].includes(o.type)){const u=o.domain();a=Bi(u)-u[0]}else throw new vn(`Cannot use step-based size with "${o.type}" scale!`,this);const c=o;return a=tu(a,c.paddingInner(),c.paddingOuter()),{px:a*s,grow:0}}else throw new vn("Cannot use 'step' size with missing scale!",this)}else return(n&&Vd(n))??(r?void 0:{px:0,grow:1})},Ai=new WeakSet,dc=function(e){const n=[];let r=this;do n.push(r),r=r[e];while(r);return n};function kE(t){return"unitsPerPixel"in t}function OE(t){const e=t.spec.opacity;if(e!==void 0){if(be(e))return n=>n*e;if(kE(e)){const n=s=>{var a;const o=(a=t.getScaleResolution(s))==null?void 0:a.getScale();if(["linear","index","locus"].includes(o==null?void 0:o.type))return o},r=e.channel?n(e.channel):n("x")??n("y");if(!r)throw new vn("Cannot find a resolved quantitative scale for dynamic opacity!",t);const i=jc().domain(e.unitsPerPixel).range(e.values).clamp(!0);return s=>{const a=Ts(r.domain())/1e3;return i(a)*s}}else if(Ld(e)){const n=t.context.paramBroker.createExpression(e.expr);return r=>n(null)*r}}return n=>n}const Gd=t=>!!(t!=null&&t.step);class Mn extends BE{constructor(e,n,r,i,s,o){super(e,n,r,i,s,o),this.spec=e}async initializeChildren(){}*[Symbol.iterator](){}replaceChild(e,n){throw new Error("Not implemented")}visit(e){let n;try{n=e(this)}catch(r){throw r.view=this,r}if(n===$r)return n;if(n!==ME){e.beforeChildren&&e.beforeChildren(this);for(const r of this){const i=r.visit(e);if(i===$r)return i}e.afterChildren&&e.afterChildren(this),e.postOrder&&e.postOrder(this)}}findDescendantByPath(e){for(const n of this)if(n.name===e[0]){if(e.length==1)return n;if(n instanceof Mn)return n.findDescendantByPath(e.slice(1))}}findChildByName(e){for(const n of this)if(n.name===e)return n}findDescendantByName(e){let n;return this.visit(r=>{if(r.name==e)return n=r,$r}),n}getDefaultResolution(e,n){return"shared"}}const ff=1;function Du(){let t=[0,1],e=[0,1],n=1,r=1,i=0,s=0,o=.5,a=0;const u=f=>(f+o-t[0])/n*r+e[0];return u.invert=f=>(f-e[0])/r*n+t[0]-o,u.domain=function(f){if(arguments.length){t=Om(f),n=t[1]-t[0];const l=t[0]===0&&t[0]===0;if(n<ff&&!l){n=ff;const h=(t[0]+t[1])/2;t[0]=h-n/2,t[1]=h+n/2}return u}else return t.slice()},u.range=function(f){return arguments.length?(e=[...f],r=e[1]-e[0],u):e},u.numberingOffset=function(f){return arguments.length?(a=f,u):a},u.padding=function(f){return arguments.length?(s=f,i=Math.min(1,f),u):i},u.paddingInner=function(f){return arguments.length?(i=Math.min(1,f),u):i},u.paddingOuter=function(f){return arguments.length?(s=f,u):s},u.align=function(f){return arguments.length?(o=Math.max(0,Math.min(1,f)),u):o},u.step=()=>r/n,u.bandwidth=()=>u.step(),u.ticks=f=>{const l=u.align(),h=u.numberingOffset();return _s(t[0]-l+h,t[1]-l+h,Math.min(f,Math.ceil(n))).filter(Number.isInteger).map(p=>p-a)},u.tickFormat=(f,l)=>{if(l)throw new Error("Index scale's tickFormat does not support a specifier!");const p=Fn(t[0],t[1],Math.min(f,Math.ceil(n)))<1e5?ue(","):ue(".3s");return d=>p(d+a)},u.copy=()=>Du().domain(t).range(e).paddingInner(i).paddingOuter(s).numberingOffset(a),u}function PE(){const t=Du().numberingOffset(1);let e;t.genome=function(r){return arguments.length?(e=r,t):e},t.ticks=r=>{if(!e)return[];const i=t.domain(),s=t.numberingOffset(),[o,a]=[Math.max(i[0],0),Math.min(i[1],e.totalSize-1)].map(f=>e.toChromosome(f)),c=Math.max(1,Fn(i[0],i[1],r)),u=[];for(let f=o.index;f<=a.index;f++){const l=e.chromosomes[f],h=Math.max(l.continuousStart+c,i[0]-(i[0]-l.continuousStart)%c),p=Math.min(l.continuousEnd-c/4,i[1]+1);for(let d=h;d<=p;d+=c){const m=d-s;m>=i[0]&&m<i[1]&&u.push(m)}}return u},t.tickFormat=(r,i)=>{if(!e)return;if(i)throw new Error("Locus scale's tickFormat does not support a specifier!");const s=t.domain(),o=s[1]-s[0],a=t.numberingOffset(),u=Fn(s[0],s[1],Math.min(r,Math.ceil(o)))<1e6?ue(","):ue(".3s"),f=l=>l-e.toChromosome(l).continuousStart;return l=>u(f(l)+a)};const n=t.copy;return t.copy=()=>n().genome(e),t}function LE(t){return t.type=="locus"}function Ws(t,e,n){if(n=n||[],t.some(o=>o===null)){if(t.every(o=>o===null))return null;throw console.warn(t),new Error("Cannot merge objects with nulls!")}const r={},i=(o,a)=>o===a||Gn(o)&&Gn(a)||Gn(o)&&a===!0||o===!0&&Re(a),s=o=>{for(let a in o){const c=o[a];if(!n.includes(a)&&c!==void 0)if(r[a]!==void 0&&!i(r[a],c))console.warn(`Conflicting property ${a} of ${e}: (${JSON.stringify(r[a])} and ${JSON.stringify(o[a])}). Using ${JSON.stringify(r[a])}.`);else{const u=r[a];if(Gn(u))Gn(c)&&(r[a]=Ws([u,c],a));else if(Gn(c)){if(!(u===!0||u===void 0))throw new Error("Bug in merge! Target is: "+u);r[a]=Ws([{},c],a)}else r[a]=c}}};for(const o of t)s(o);return r}function Gn(t){return Re(t)&&!Array.isArray(t)}/*!
 * Adapted from vega-encode:
 * https://github.com/vega/vega/blob/master/packages/vega-encode/src/ticks.js
 *
 * Copyright (c) 2015-2018, University of Washington Interactive Data Lab
 * All rights reserved.
 *
 * BSD-3-Clause License: https://github.com/vega/vega-lite/blob/master/LICENSE
 */function Hd(t,e,n){return be(e)&&n!=null&&(e=Math.min(e,~~(Ts(t.domain())/n)||1)),Re(e)&&(e.step,e=e.interval),e}function qd(t,e,n){var r=t.range(),i=Math.floor(r[0]),s=Math.ceil(Ye(r));if(i>s&&(r=s,s=i,i=r),e=e.filter(function(a){return a=t(a),i<=a&&a<=s}),n>0&&e.length>1){for(var o=[e[0],Ye(e)];e.length>n&&e.length>=3;)e=e.filter(function(a,c){return!(c%2)});e.length<3&&(e=o)}return e}function NE(t,e){return t.bins?qd(t,zE(t.bins,e)):t.ticks?t.ticks(e):t.domain()}function zE(t,e){var n=t.length,r=~~(n/(e||n));return r<2?t.slice():t.filter(function(i,s){return!(s%r)})}function UE(t,e,n){var r=t.tickFormat?t.tickFormat(e,n):n?ue(n):String;if(w0(t.type)){var i=VE(n);r=t.bins?i:$E(r,i)}return r}function $E(t,e){return function(n){return t(n)?e(n):""}}function VE(t){var e=Mt(t||",");if(e.precision==null){switch(e.precision=12,e.type){case"%":e.precision-=2;break;case"e":e.precision-=1;break}return GE(ue(e),ue(".1f")(1)[1])}else return ue(e)}function GE(t,e){return function(n){var r=t(n),i=r.indexOf(e),s,o;if(i<0)return r;for(s=HE(r,i),o=s<r.length?r.slice(s):"";--s>i;)if(r[s]!=="0"){++s;break}return r.slice(0,s)+o}}function HE(t,e){var n=t.lastIndexOf("e"),r;if(n>0)return n;for(n=t.length;--n>e;)if(r=t.charCodeAt(n),r>=48&&r<=57)return n+1}/*!
 * Adapted from vega-encode:
 * https://github.com/vega/vega/blob/master/packages/vega-encode/src/Scale.js
 *
 * Copyright (c) 2015-2018, University of Washington Interactive Data Lab
 * All rights reserved.
 *
 * BSD-3-Clause License: https://github.com/vega/vega-lite/blob/master/LICENSE
 */const qE="locus",WE="index";var jE=5;function YE(t){const e=t.type;return!t.bins&&(e===fr||e===Ui||e===$i)}function Wd(t){return me(t)&&![rt,WE,qE].includes(t)}function jd(t){return t||{warn:(e,...n)=>console.warn(e,...n)}}var XE=Ds(["set","modified","clear","type","scheme","schemeExtent","schemeCount","domain","domainMin","domainMid","domainMax","domainRaw","domainImplicit","nice","zero","bins","range","rangeStep","round","reverse","interpolate","interpolateGamma","zoom","fp64","name"]);function Yd(t,e,n){n=jd(n);for(const r in t)if(!XE[r]){if(r==="padding"&&Wd(e.type))continue;Ie(e[r])?e[r](t[r]):n.warn("Unsupported scale property: "+r)}rC(e,t,nC(e,t,QE(e,t,n)))}function KE(t,e){const n=JE(t),r=N(n);if(!r)throw new Error("Unknown scale type: "+n);const i=r();return!t.domain&&me(i.type)&&(t.domain=[0,0]),Yd(t,i,e),i}function JE(t){var e=t.type,n="",r;return e===rt?rt+"-"+fr:(ZE(t)&&(r=t.rawDomain?t.rawDomain.length:t.domain?t.domain.length+ +(t.domainMid!=null):0,n=r===2?rt+"-":r===3?yr+"-":""),(n+e||fr).toLowerCase())}function ZE(t){const e=t.type;return me(e)&&e!==d0&&e!==p0&&(t.scheme||t.range&&t.range.length&&t.range.every(V))}function QE(t,e,n){if(!t.domain)return 0;n=jd(n);var r=eC(t,e.domainRaw,n);if(r>-1)return r;var i=e.domain,s=t.type,o=e.zero||e.zero===void 0&&YE(t),a,c;return i?(Wd(s)&&e.padding&&i[0]!==Ye(i)&&(i=tC(s,i,e.range,e.padding,e.exponent,e.constant)),(o||e.domainMin!=null||e.domainMax!=null||e.domainMid!=null)&&(a=(i=i.slice()).length-1||1,o&&(i[0]>0&&(i[0]=0),i[a]<0&&(i[a]=0)),e.domainMin!=null&&(i[0]=e.domainMin),e.domainMax!=null&&(i[a]=e.domainMax),e.domainMid!=null&&(c=e.domainMid,(c<i[0]||c>i[a])&&n.warn("Scale domainMid exceeds domain min or max.",c),i.splice(a,0,c))),t.domain(Xd(s,i,n)),s===nu&&t.unknown(e.domainImplicit?Pa:void 0),e.nice&&t.nice&&t.nice(e.nice!==!0&&Hd(t,e.nice)||null),i.length):0}function eC(t,e,n){return e?(t.domain(Xd(t.type,e,n)),e.length):-1}function tC(t,e,n,r,i,s){var o=Math.abs(Ye(n)-n[0]),a=o/(o-2*r),c=t===kt?Hf(e,null,a):t===$i?Da(e,null,a,.5):t===Ui?Da(e,null,a,i||1):t===Io?om(e,null,a,s||1):Gf(e,null,a);return e=e.slice(),e[0]=c[0],e[e.length-1]=c[1],e}function Xd(t,e,n){if(w0(t)){var r=Math.abs(e.reduce(function(i,s){return i+(s<0?-1:s>0?1:0)},0));r!==e.length&&n.warn("Log scale domain includes zero: "+ao(e))}return e}function nC(t,e,n){let r=e.bins;if(r&&!Me(r)){const i=(r.start==null||r.stop==null)&&t.domain(),s=r.start==null?i[0]:r.start,o=r.stop==null?Ye(i):r.stop,a=r.step;a||W("Scale bins parameter missing step property."),r=Yr(s,o+a,a)}return r?t.bins=r:t.bins&&delete t.bins,t.type===ru&&(r?!e.domain&&!e.domainRaw&&(t.domain(r),n=r.length):t.bins=t.domain()),n}function rC(t,e,n){var r=t.type,i=e.round||!1,s=e.range;if(e.rangeStep!=null)s=iC(r,e,n);else if(e.scheme&&(s=sC(r,e,n),Ie(s))){if(t.interpolator)return t.interpolator(s);W(`Scale type ${r} does not support interpolating color schemes.`)}if(s&&_o(r))return t.interpolator(Ro(pc(s,e.reverse),e.interpolate,e.interpolateGamma));s&&e.interpolate&&t.interpolate?t.interpolate(v0(e.interpolate,e.interpolateGamma)):Ie(t.round)?t.round(i):Ie(t.rangeRound)&&t.interpolate(i?Ni:Ht),s&&t.range(pc(s,e.reverse))}function iC(t,e,n){t!==x0&&t!==ja&&W("Only band and point scales support rangeStep.");var r=(e.paddingOuter!=null?e.paddingOuter:e.padding)||0,i=t===ja?1:(e.paddingInner!=null?e.paddingInner:e.padding)||0;return[0,e.rangeStep*tu(n,i,r)]}function sC(t,e,n){var r=e.schemeExtent,i,s;return Me(e.scheme)?s=Ro(e.scheme,e.interpolate,e.interpolateGamma):(i=e.scheme.toLowerCase(),s=su(i),s||W(`Unrecognized scheme name: ${e.scheme}`)),n=t===g0?n+1:t===ru?n-1:t===Wa||t===m0?+e.schemeCount||jE:n,_o(t)?hf(s,r,e.reverse):Ie(s)?vb(hf(s,r),n):t===nu?s:s.slice(0,n)}function hf(t,e,n){return Ie(t)&&(e||n)?wb(t,pc(e||[0,1],n)):t}function pc(t,e){return e?t.slice().reverse():t}const df=ue(",d");function oC(t,e){return t.chrom+":"+df(Math.floor(t.pos+1))+"-"+(t.chrom!=e.chrom?e.chrom+":":"")+df(Math.ceil(e.pos))}const aC="https://genomespy.app/data/genomes/";class cC{constructor(e){if(this.config=e,!this.config.contigs&&typeof this.config.name!="string")throw new Error("No name has been defined for the genome assembly!");this.chromosomes=[],this.cumulativeChromPositions=new Map,this.chromosomesByName=new Map,this.startByIndex=[],this.totalSize=0,this.config.contigs&&this.setChromSizes(this.config.contigs)}get name(){return this.config.name}async load(e){if(!this.config.contigs){this.config.baseUrl?this.baseUrl=/^http(s)?/.test(this.config.baseUrl)?this.config.baseUrl:e+"/"+this.config.baseUrl:this.baseUrl=aC;try{this.setChromSizes(uC(await xo({baseURL:this.baseUrl}).load(`${this.config.name}/${this.name}.chrom.sizes`)))}catch(n){throw new Error(`Could not load chrom sizes: ${n.message}`)}}}hasChrPrefix(){return this.chromosomes.some(e=>e.name.startsWith("chr"))}setChromSizes(e){let n=0;this.startByIndex=[0];for(let r=0;r<e.length;r++){this.startByIndex.push(n);const i=e[r].size,s={...e[r],continuousStart:n,continuousEnd:n+i,continuousInterval:[n,n+i],index:r,number:r+1,odd:!(r&1)};this.chromosomes.push(s);const o=s.name.replace(/^chr/i,"");for(const a of["chr"+o,"CHR"+o,"Chr"+o,s.number,""+s.number,o,s.name])this.cumulativeChromPositions.set(a,n),this.chromosomesByName.set(a,s);n+=s.size}this.totalSize=n}getExtent(){return[0,this.totalSize]}toContinuous(e,n){let r=this.cumulativeChromPositions.get(e);if(r===void 0)throw new Error("Unknown chromosome/contig: "+e);return r+ +n}toChromosome(e){if(e>this.totalSize)return;e=Math.floor(e);const n=gr(this.startByIndex,e)-1;if(n>0&&n<=this.chromosomes.length)return this.chromosomes[n-1]}toChromosomal(e){const n=this.toChromosome(e);if(n)return{chrom:n.name,pos:Math.floor(e)-n.continuousStart}}getChromosome(e){return this.chromosomesByName.get(e)}formatInterval(e){return oC(...this.toChromosomalInterval(e))}toChromosomalInterval(e){const n=this.toChromosomal(e[0]+.5),r=this.toChromosomal(e[1]-.5);return r.pos+=1,[n,r]}toContinuousInterval(e){var i;let[n,r]=e;return r||(r=n),[this.toContinuous(n.chrom,n.pos??0),this.toContinuous(r.chrom,r.pos??((i=this.chromosomesByName.get(r.chrom))==null?void 0:i.size))]}toDiscreteChromosomeIntervals(e){const n=e[0],r=e[1],i=[];if(n.chrom===r.chrom)i.push({chrom:n.chrom,startPos:n.pos,endPos:r.pos});else{const s=this.chromosomes.findIndex(a=>a.name===n.chrom),o=this.chromosomes.findIndex(a=>a.name===r.chrom);i.push({chrom:n.chrom,startPos:n.pos,endPos:this.chromosomes[s].size});for(let a=s+1;a<o;a++)i.push({chrom:this.chromosomes[a].name,startPos:0,endPos:this.chromosomes[a].size});i.push({chrom:r.chrom,startPos:0,endPos:r.pos})}return i}continuousToDiscreteChromosomeIntervals(e){return this.toDiscreteChromosomeIntervals([this.toChromosomal(e[0]),this.toChromosomal(e[1])])}parseInterval(e){const n=e.match(/^(chr[0-9A-Z]+)(?::([0-9,]+)(?:-(?:(chr[0-9A-Z]+):)?([0-9,]+))?)?$/);if(n){const r=n[1];if(n.slice(2).every(a=>a===void 0)){const a=this.getChromosome(r);return a?[a.continuousStart,a.continuousEnd]:void 0}const i=n[3]||r,s=parseInt(n[2].replace(/,/g,"")),o=n[4]!==void 0?parseInt(n[4].replace(/,/g,"")):s;return[this.toContinuous(r,s-1),this.toContinuous(i,o)]}}}function uC(t){return Xp(t).filter(e=>/^chr[0-9A-Z]+$/.test(e[0])).map(([e,n])=>({name:e,size:parseInt(n)}))}function Kd(t){return Re(t)&&"chrom"in t}function lC(t){return t.every(Kd)}class Ji extends Array{constructor(){super(),this.type=void 0}extend(e){return this}extendAll(e){if(e instanceof Ji&&e.type!=this.type)throw new Error(`Cannot combine different types of domains: ${this.type} and ${e.type}`);for(const n of e)this.extend(n);return this}extendAllWithAccessor(e,n){for(const r of e)this.extend(n(r));return this}}class va extends Ji{constructor(){super(),this.type="quantitative"}extend(e){return e==null||Number.isNaN(e)?this:(e=+e,this.length?e<this[0]?this[0]=e:e>this[1]&&(this[1]=e):(this.push(e),this.push(e)),this)}}class Jd extends Ji{constructor(){super(),this.type="ordinal",this.uniqueValues=new Set}extend(e){return e==null||Number.isNaN(e)?this:(this.uniqueValues.has(e)||(this.uniqueValues.add(e),this.push(e)),this)}}class Zd extends Jd{constructor(){super(),this.type="nominal"}}class fC extends Ji{constructor(e){super();let n=0;for(let r=1;r<e.length;r++)n+=Math.sign(e[r]-e[r-1]);if(Math.abs(n)!=e.length-1)throw new Error("Piecewise domain must be strictly increasing or decreasing: "+JSON.stringify(e));e.forEach(r=>this.push(r))}extend(e){if(this.includes(e))return this;throw new Error("Piecewise domains are immutable and cannot be unioned!")}}const pf={quantitative:va,index:va,locus:va,nominal:Zd,ordinal:Jd};function mf(t,e){if(t=="quantitative"&&hC(e)){const n=new fC(e);return n.type=t,n}else if(pf[t]){const n=new pf[t];return n.type=t,e&&n.extendAll(e),n}throw new Error("Unknown type: "+t)}function hC(t){return t&&t.length>0&&t.length!=2&&t.every(e=>typeof e=="number")}function dC(t){return((t*=2)<=1?t*t*t:(t-=2)*t*t+2)/2}function pC(t,e,n){return t*Math.pow(e/t,n)}N("index",Du,["continuous"]);N("locus",PE,["continuous"]);N("null",Mo,[]);const gf="quantitative",Qd="ordinal",ep="nominal",tp="locus",mC="index";var pt,Kn,ae,et,It,Zs,np,Jn,ws,mt,rn,wi,mc,Qs,rp,Fc,xC,vi,gc;class gC{constructor(e){M(this,et);M(this,Zs);M(this,Jn);M(this,mt);M(this,wi);M(this,Qs);M(this,Fc);M(this,vi);M(this,pt,void 0);M(this,Kn,new Set);M(this,ae,void 0);this.channel=e,this.members=[],this.type=null,this.name=void 0}addEventListener(e,n){if(e!="domain")throw new Error("Unsupported event type: "+e);S(this,Kn).add(n)}removeEventListener(e,n){if(e!="domain")throw new Error("Unsupported event type: "+e);S(this,Kn).delete(n)}pushUnitView(e,n){var o;const r=Ya(e,n),i=r.type,s=(o=r==null?void 0:r.scale)==null?void 0:o.name;if(s){if(this.name!==void 0&&s!=this.name)throw new Error(`Shared scales have conflicting names: "${s}" vs. "${this.name}"!`);this.name=s}if(!this.type)this.type=i;else if(i!==this.type&&!zr(n))throw new Error(`Can not use shared scale for different data types: ${this.type} vs. ${i}. Use "resolve: independent" for channel ${this.channel}`);this.members.push({view:e,channel:n})}isExplicitDomain(){return!!this.getConfiguredDomain()}isDomainInitialized(){const e=S(this,ae);if(!e)return!1;const n=e.domain();return me(e.type)?n.length>2||n.length==2&&(n[0]!==0||n[1]!==0):n.length>0}getScaleProps(){return pr(this,"scaleProps",()=>{const e=I(this,Zs,np).call(this);if(e===null||e.type=="null")return{type:"null"};const n={...I(this,Qs,rp).call(this,this.type),...e};n.type||(n.type=yC(this.channel,this.type));const r=I(this,Jn,ws).call(this);return r&&r.length>0?n.domain=r:Ot(n.type)&&(n.domain=new Zd),!n.domain&&n.domainMid!==void 0&&(n.domain=[n.domainMin??0,n.domainMax??1]),this.channel=="y"&&Ot(n.type)&&n.reverse==null&&(n.reverse=!0),n.range&&n.scheme&&delete n.scheme,!("zoom"in n)&&["index","locus"].includes(n.type)&&(n.zoom=!0),bC(n,this.channel),n})}getConfiguredDomain(){return I(this,vi,gc).call(this,e=>zr(e.channel)?void 0:e.view.getConfiguredDomain(e.channel))}getDataDomain(){return I(this,vi,gc).call(this,e=>zr(e.channel)?void 0:e.view.extractDataDomain(e.channel))}reconfigure(){if(S(this,ae)&&S(this,ae).type!="null"){const e=this.isDomainInitialized(),n=S(this,ae).domain();Bd(this,"scaleProps");const r=this.getScaleProps();if(Yd(r,S(this,ae)),me(S(this,ae).type)&&he(this,pt,I(this,wi,mc).call(this)),!e){I(this,et,It).call(this);return}const i=S(this,ae).domain();ks(i,n)||(this.isZoomable()?S(this,ae).domain(n):I(this,mt,rn).call(this)?(S(this,ae).domain(n),this.zoomTo(i,500)):I(this,et,It).call(this))}}getScale(){if(S(this,ae))return S(this,ae);const e=this.getScaleProps(),n=KE(e);return he(this,ae,n),LE(n)&&n.genome(this.getGenome()),me(n.type)&&he(this,pt,I(this,wi,mc).call(this)),n}getDomain(){return this.getScale().domain()}getComplexDomain(){var e;return((e=this.getGenome())==null?void 0:e.toChromosomalInterval(this.getDomain()))??this.getDomain()}isZoomed(){return I(this,mt,rn).call(this)&&ks(I(this,Jn,ws).call(this),this.getDomain())}isZoomable(){return I(this,mt,rn).call(this)&&!!this.getScaleProps().zoom}zoom(e,n,r){if(!I(this,mt,rn).call(this))return!1;const i=this.getScale(),s=i.domain();let o=[...s],a=i.invert(n);switch(this.getScaleProps().reverse&&(r=-r),"align"in i&&(a+=i.align()),i.type){case"linear":case"index":case"locus":o=rm(o,r||0),o=Gf(o,a,e);break;case"log":o=im(o,r||0),o=Hf(o,a,e);break;case"pow":case"sqrt":{const c=i;o=sm(o,r||0,c.exponent()),o=Da(o,a,e,c.exponent());break}default:throw new Error("Zooming is not implemented for: "+i.type)}return S(this,pt)&&(o=am(o,S(this,pt)[0],S(this,pt)[1])),[0,1].some(c=>o[c]!=s[c])?(i.domain(o),I(this,et,It).call(this),!0):!1}async zoomTo(e,n=!1){var a;if(_i(n)&&(n=n?700:0),!I(this,mt,rn).call(this))throw new Error("Not a zoomable scale!");const r=this.fromComplexInterval(e),i=(a=this.members[0])==null?void 0:a.view.context.animator,s=this.getScale(),o=s.domain();if(n>0&&o.length==2){const c=o[1]-o[0],u=o[0]+c/2,f=r[1]-r[0],l=r[0]+f/2;await i.transition({duration:n,easingFunction:dC,onUpdate:h=>{const p=pC(c,f,h),d=(c-p)/(c-f),m=d*l+(1-d)*u;s.domain([m-p/2,m+p/2]),I(this,et,It).call(this)}}),s.domain(r),I(this,et,It).call(this)}else s.domain(r),i==null||i.requestRender(),I(this,et,It).call(this)}resetZoom(){if(!I(this,mt,rn).call(this))throw new Error("Not a zoomable scale!");const e=this.getDomain(),n=I(this,Jn,ws).call(this);return[0,1].some(r=>n[r]!=e[r])?(S(this,ae).domain(n),I(this,et,It).call(this),!0):!1}getZoomLevel(){return this.isZoomable()?Ts(S(this,pt))/Ts(this.getScale().domain()):1}getGenome(){var n;if(this.type!=="locus")return;const e=(n=this.members[0].view.context.genomeStore)==null?void 0:n.getGenome();if(!e)throw new Error("No genome has been defined!");return e}invertToComplex(e){const n=this.getScale();if("invert"in n){const r=n.invert(e);return this.toComplex(r)}else throw new Error("The scale does not support inverting!")}toComplex(e){const n=this.getGenome();return n?n.toChromosomal(e):e}fromComplex(e){return Kd(e)?this.getGenome().toContinuous(e.chrom,e.pos):e}fromComplexInterval(e){return this.type==="locus"&&lC(e)?this.getGenome().toContinuousInterval(e):e}}pt=new WeakMap,Kn=new WeakMap,ae=new WeakMap,et=new WeakSet,It=function(){for(const e of S(this,Kn).values())e({type:"domain",scaleResolution:this})},Zs=new WeakSet,np=function(){return pr(this,"mergedScaleProps",()=>{const e=this.members.map(n=>Ya(n.view,n.channel).scale).filter(n=>n!==void 0);return Ws(e,"scale",["domain"])})},Jn=new WeakSet,ws=function(){return this.getConfiguredDomain()??(this.type==tp?this.getGenome().getExtent():this.getDataDomain())},mt=new WeakSet,rn=function(){const e=this.getScale().type;return me(e)},wi=new WeakSet,mc=function(){const e=this.getScaleProps(),n=e.zoom;if(AC(n)&&Me(n.extent))return this.fromComplexInterval(n.extent);if(n)return e.type=="locus"?this.getGenome().getExtent():S(this,ae).domain()},Qs=new WeakSet,rp=function(e){const n=this.channel,r={};return this.isExplicitDomain()&&(r.zero=!1),li(n)?r.nice=!this.isExplicitDomain():An(n)?r.scheme=e==ep?"tableau10":e==Qd?"blues":"viridis":Bo(n)?r.range=n=="shape"?["circle","square","triangle-up","cross","diamond"]:[]:n=="size"?r.range=[0,400]:n=="angle"&&(r.range=[0,360]),r},Fc=new WeakSet,xC=function(){return this.members.map(e=>e.view.getPathString()).join(", ")},vi=new WeakSet,gc=function(e){const n=this.members.filter(r=>!r.view.getLayoutAncestors().some(i=>!i.options.contributesToScaleDomain)).map(e).filter(r=>!!r);if(n.length)return n.reduce((r,i)=>r.extendAll(i))};function yC(t,e){if(e==mC||e==tp){if(F0(t))return e;throw new Error(`${t} does not support ${e} data type. Only positional channels do.`)}const n={x:["band","band","linear"],y:["band","band","linear"],size:[void 0,"point","linear"],opacity:[void 0,"point","linear"],fillOpacity:[void 0,"point","linear"],strokeOpacity:[void 0,"point","linear"],color:["ordinal","ordinal","linear"],fill:["ordinal","ordinal","linear"],stroke:["ordinal","ordinal","linear"],strokeWidth:[void 0,void 0,"linear"],shape:["ordinal","ordinal",void 0],dx:[void 0,void 0,"null"],dy:[void 0,void 0,"null"],angle:[void 0,void 0,"linear"]},i=["sample"].includes(t)?"null":n[t]?n[t][[ep,Qd,gf].indexOf(e)]:e==gf?"linear":"ordinal";if(i===void 0)throw new Error(`Channel "${t}" is not compatible with "${e}" data type. Use of a proper scale may be needed.`);return i}function bC(t,e){li(e)&&t.type!=="ordinal"&&(t.range=[0,1]),e=="opacity"&&me(t.type)&&(t.clamp=!0)}function AC(t){return Re(t)}function xc(t){const e=new Set;function n(r){for(const i of Object.values(r.resolutions.scale))e.add(i)}for(const r of ze(t)){r.visit(n);for(const i of r.getDataAncestors()){if(!i.options.contributesToScaleDomain)break;n(i)}}e.forEach(r=>r.reconfigure())}function Ea(...t){for(const e of t)if(e!==void 0)return e}class wC{constructor(e){this.channel=e,this.members=[]}get scaleResolution(){var e;return(e=Bi(this.members))==null?void 0:e.view.getScaleResolution(this.channel)}pushUnitView(e,n){const r=e.getScaleResolution(this.channel);if(!r)throw new Error("Cannot find a scale resolution!");if(this.scaleResolution&&r!==this.scaleResolution)throw new Error("Shared axes must have a shared scale!");this.members.push({view:e,channel:n})}getAxisProps(){return pr(this,"axisProps",()=>{const e=this.members.map(n=>{const r=n.view.mark.encoding[n.channel];return"axis"in r&&r.axis});return e.length>0&&e.some(n=>n===null)?null:Ws(e.filter(n=>n!==void 0),"axis",["title"])})}getTitle(){const e=s=>{var a;const o=Ya(s.view,s.channel);if(!Xe(o))return{member:s,explicitTitle:Ea("axis"in o?(a=o.axis)==null?void 0:a.title:void 0,o.title),implicitTitle:Ea(qi(o)?o.field:void 0,ou(o)?o.expr:void 0)}},n=this.members.map(e),r=n.filter(s=>{var o;if(zr(s.member.channel)&&!s.explicitTitle){const a=_n(s.member.channel);return((o=n.find(c=>c.member.view==s.member.view&&c.member.channel==a))==null?void 0:o.explicitTitle)===void 0}return!0}),i=new Set(r.map(s=>Ea(s.explicitTitle,s.implicitTitle)).filter(V));return i.size?[...i].join(", "):null}}const vC={point:lE,rect:nE,rule:pE,link:AE,text:TE};class Ne extends Mn{constructor(e,n,r,i,s,o){super(e,n,r,i,s,o),this.spec=e;const a=vC[this.getMarkType()];if(a)this.mark=new a(this);else throw new Error(`No such mark: ${this.getMarkType()}`);this.resolve(),this.coords=void 0,this.needsAxes={x:!0,y:!0}}render(e,n,r={}){this.isConfiguredVisible()&&(this.coords=n,e.pushView(this,n),e.renderMark(this.mark,r),e.popView(this))}getMarkType(){return typeof this.spec.mark=="object"?this.spec.mark.type:this.spec.mark}resolve(e){e||(this.resolve("scale"),this.resolve("axis"));const n=this.mark.encoding;for(const[r,i]of Object.entries(n)){if(!De(i))continue;const s=_n(i.resolutionChannel??r);if(!wn(s)||e=="axis"&&!li(s))continue;let o=this;for(;(o.getConfiguredOrDefaultResolution(s,e)=="forced"||o.dataParent instanceof Mn&&["shared","excluded","forced"].includes(o.dataParent.getConfiguredOrDefaultResolution(s,e)))&&o.getConfiguredOrDefaultResolution(s,e)!="excluded";)o=o.dataParent;e=="axis"&&li(r)&&F0(s)?(o.resolutions[e][s]||(o.resolutions[e][s]=new wC(s)),o.resolutions[e][s].pushUnitView(this,r)):e=="scale"&&wn(r)&&(o.resolutions[e][s]||(o.resolutions[e][s]=new gC(s)),o.resolutions[e][s].pushUnitView(this,r))}}getAccessor(e){return this._cache("accessor/"+e,()=>{const n=this.mark.encoding;if(n&&n[e])return this.context.accessorFactory.createAccessor(n[e])})}getFacetAccessor(e){const n=this.getAccessor("sample");return n||super.getFacetAccessor(this)}getCollector(){return this.context.dataFlow.findCollectorByKey(this)}_validateDomainQuery(e){if(zr(e))throw new Error(`getDomain(${e}), must only be called for primary channels!`);const n=this.mark.encoding[e];if(!De(n))throw new Error("The channel has no scale, cannot get domain!");return n}getConfiguredDomain(e){const n=this._validateDomainQuery(e),r=n&&n.scale&&n.scale.domain;if(r){const i=this.getScaleResolution(n.resolutionChannel??e);return mf(n.type??"nominal",i.fromComplexInterval(r))}}extractDataDomain(e){const r=this._validateDomainQuery(e).type??"nominal",i=a=>{let c;const u=this.mark.encoding[a];if(u){const f=this.context.accessorFactory.createAccessor(u);if(f)if(c=mf(r),f.constant)c.extend(f({}));else{const l=this.getCollector();l!=null&&l.completed&&l.visitData(h=>c.extend(f(h)))}}return c};let s=i(e);const o=au[e];if(o){const a=i(o);a&&s.extendAll(a)}return s}getZoomLevel(){const e=n=>{var r;return((r=this.getScaleResolution(n))==null?void 0:r.getZoomLevel())??1};return br.map(e).reduce((n,r)=>n*r,1)}propagateInteractionEvent(e){this.handleInteractionEvent(void 0,e,!0),e.target=this,!e.stopped&&this.handleInteractionEvent(void 0,e,!1)}getDefaultResolution(e,n){return e=="x"?"shared":"independent"}}function*Iu(t,e=[]){for(const[n,r]of t.entries())if(r instanceof Map)for(const i of Iu(r,[...e,n]))yield i;else yield[[...e,n],r]}class ip extends X{get behavior(){return Tu}constructor(e){super(),this.params=e??{type:"collect"},this.observers=[],this.facetBatches=void 0,this._init()}_init(){this._data=[],this.facetBatches=new Sn([],JSON.stringify),this.facetBatches.set(void 0,this._data)}reset(){super.reset(),this._init()}handle(e){this._data.push(e)}beginBatch(e){aE(e)&&(this._data=[],this.facetBatches.set(ze(e.facetId),this._data))}complete(){var i,s;const e=(i=this.params)==null?void 0:i.sort,n=e?qf(e.field,e.order):void 0,r=o=>{n&&o.sort(n)};if((s=this.params.groupby)!=null&&s.length){if(this.facetBatches.size>1)throw new Error("TODO: Support faceted data!");const o=this.params.groupby.map(c=>U(c)),a=uo(this._data,...o);this.facetBatches.clear();for(const[c,u]of Iu(a))this.facetBatches.set(c,u)}for(const o of this.facetBatches.values())r(o);if(this.children.length)for(const[o,a]of this.facetBatches.entries()){if(o){const c={type:"facet",facetId:o};for(const u of this.children)u.beginBatch(c)}for(const c of a)this._propagate(c)}super.complete();for(const o of this.observers)o(this)}getData(){switch(this._checkStatus(),this.facetBatches.size){case 0:return[];case 1:return[...this.facetBatches.values()][0];default:{const e=this.facetBatches;return{[Symbol.iterator]:function*(){for(const r of e.values())for(let i=0;i<r.length;i++)yield r[i]}}}}}visitData(e){this._checkStatus();for(const n of this.facetBatches.values())for(let r=0;r<n.length;r++)e(n[r])}getItemCount(){let e=0;for(const n of this.facetBatches.values())e+=n.length;return e}_checkStatus(){if(!this.completed)throw new Error("Data propagation is not completed! No data are available.")}}class js{constructor(){this.ids=[],this.values=[],this.length=0}clear(){this.length=0}push(e,n){let r=this.length++;for(;r>0;){const i=r-1>>1,s=this.values[i];if(n>=s)break;this.ids[r]=this.ids[i],this.values[r]=s,r=i}this.ids[r]=e,this.values[r]=n}pop(){if(this.length===0)return;const e=this.ids[0];if(this.length--,this.length>0){const n=this.ids[0]=this.ids[this.length],r=this.values[0]=this.values[this.length],i=this.length>>1;let s=0;for(;s<i;){let o=(s<<1)+1;const a=o+1;let c=this.ids[o],u=this.values[o];const f=this.values[a];if(a<this.length&&f<u&&(o=a,c=this.ids[a],u=f),u>=r)break;this.ids[s]=c,this.values[s]=u,s=o}this.ids[s]=n,this.values[s]=r}return e}peek(){if(this.length!==0)return this.ids[0]}peekValue(){if(this.length!==0)return this.values[0]}shrink(){this.ids.length=this.values.length=this.length}}class EC extends X{get behavior(){return ut}constructor(e){super(),this.params=e,this.startAccessor=U(e.start),this.endAccessor=U(e.end),this.chromAccessor=e.chrom?U(e.chrom):n=>{},this.weightAccessor=e.weight?U(e.weight):n=>1,this.as={coverage:e.as||"coverage",start:e.asStart||e.start,end:e.asEnd||e.end,chrom:e.asChrom||e.chrom},this.createSegment=new Function("start","end","coverage","chrom","return {"+Object.entries(this.as).filter(([n,r])=>r).map(([n,r])=>`${JSON.stringify(r)}: ${n}`).join(", ")+"};"),this.ends=new js}reset(){super.reset(),this.initialize()}initialize(){const e=this.as.coverage,n=this.as.end,r=this.as.chrom,i=this.startAccessor,s=this.endAccessor,o=this.chromAccessor,a=this.weightAccessor;let c,u,f,l=0,h;const p=this.ends;p.clear();const d=(g,x,b)=>{if(g==x)return;let A=!1;c&&(c[e]===b?(c[n]=x,A=!0):c[e]!=0&&this._propagate(c)),A||(c=this.createSegment(g,x,b,f))},m=()=>{let g;for(;(g=p.peekValue())!==void 0;)d(h,g,l),h=g,l-=p.pop();h=void 0,c&&(this._propagate(c),c=void 0)};this.handle=g=>{const x=i(g);let b;for(;(b=p.peekValue())!==void 0&&b<x;)d(h,b,l),h=b,l-=p.pop();if(r){let E=o(g);E!==u&&(m(),f=E,u=f)}h!==void 0&&d(h,x,l),h=x;const A=a(g);l+=A,p.push(A,s(g))},this.complete=()=>{m(),super.complete()}}}function CC(t,e,n=0,r=t.length){const i=new js,s=r-n;let o;for(o=0;o<e&&o<s;o++)i.push(o,t[n+o]);for(;o<s;o++){const u=t[n+o];u>=i.peekValue()&&(i.push(o,u),i.pop())}const a=[];let c;for(;(c=i.pop())!==void 0;)a.push(n+c);return a.reverse()}class SC{constructor(e,n=-1/0,r=1/0){this.maxSize=e,this.lowerLimit=n,this.upperLimit=r;const i=this.maxSize*2+1;this.lowerLimits=new Float64Array(i),this.upperLimits=new Float64Array(i),this.lowerChildren=new Int32Array(i),this.upperChildren=new Int32Array(i),this.reset()}reset(){this.lowerLimits.fill(0),this.upperLimits.fill(0),this.lowerChildren.fill(0),this.upperChildren.fill(0),this.n=1,this.lowerLimits[0]=this.lowerLimit,this.upperLimits[0]=this.upperLimit}_findSlot(e,n,r=0){if(e>=this.lowerLimits[r]&&n<=this.upperLimits[r]){const i=this.lowerChildren[r];if(i){const s=this._findSlot(e,n,i);return s>=0?s:this._findSlot(e,n,this.upperChildren[r])}else return r}else return-1}reserve(e,n){if(n-e<=0)throw new Error("Cannot reserve an empty or negative-size slot!");if(this.n+1>this.lowerLimits.length)return!1;const r=this._findSlot(e,n);if(r<0)return!1;const i=this.n++,s=this.n++;return this.lowerLimits[i]=this.lowerLimits[r],this.upperLimits[i]=e,this.lowerLimits[s]=n,this.upperLimits[s]=this.upperLimits[r],this.lowerChildren[r]=i,this.upperChildren[r]=s,!0}}class FC extends X{get behavior(){return Tu}constructor(e,n){if(super(),this.params=e,this._data=[],this.channel=e.channel??"x",!["x","y"].includes(this.channel))throw new Error("Invalid channel: "+this.channel);this.posAccessor=U(this.params.pos),this.posBisector=co(this.posAccessor),this.scoreAccessor=U(this.params.score),this.widthAccessor=U(this.params.width),this.laneAccessor=this.params.lane?U(this.params.lane):i=>0,this.padding=this.params.padding??0,this.reservationMaps=new Map,this.resolution=n.getScaleResolution(this.channel);const r=()=>this._filterAndPropagate();this.schedule=()=>n.context.animator.requestTransition(r),this.resolution.addEventListener("domain",i=>this.schedule()),n._addBroadcastHandler("layoutComputed",()=>this.schedule())}complete(){const e=this.posAccessor;this._data.sort((n,r)=>e(n)-e(r)),this._scores=this._data.map(this.scoreAccessor);for(const n of new Set(this._data.map(this.laneAccessor)))this.reservationMaps.set(n,new SC(200));this.schedule(),super.complete()}_filterAndPropagate(){var o;super.reset();const e=this.resolution.getScale(),n=(o=this.resolution.members[0].view.coords)==null?void 0:o[this.channel=="x"?"width":"height"];if(!n)return;for(const a of this.reservationMaps.values())a.reset();const r=e.domain(),i=70,s=CC(this._scores,i,this.posBisector.left(this._data,r[0]),this.posBisector.right(this._data,r[1]));for(const a of s){const c=this._data[a],u=e(this.posAccessor(c))*n,f=this.widthAccessor(c)/2+this.padding;this.reservationMaps.get(this.laneAccessor(c)).reserve(u-f,u+f)&&this._propagate(c)}super.complete()}reset(){super.reset(),this._data=[],this.groups=new Map}handle(e){this._data.push(e)}}class TC extends X{constructor(e){super(),this.params=e,this.predicate=void 0}initialize(){this.predicate=vo(this.params.expr,this.getGlobalObject())}handle(e){this.predicate(e)&&this._propagate(e)}}class DC extends X{get behavior(){return ut}constructor(e){super();const n=e.index;if(e.fields){const r=ze(e.fields).map(s=>U(s)),i=ze(e.as||e.fields);if(r.length!==i.length)throw new Error(`Lengths of "fields" (${r.length}), and "as" (${i.length}) do not match!`);this.handle=s=>{const o=r.map((c,u)=>c(s)??[]),a=o[0].length;for(let c=0;c<a;c++){const u=Object.assign({},s);for(let f=0;f<r.length;f++)u[i[f]]=c<o[f].length?o[f][c]:null;n&&(u[n]=c),this._propagate(u)}}}else this.handle=r=>{for(let i=0;i<r.length;i++){const s=Object.assign({},r[i]);n&&(s[n]=i),this._propagate(s)}}}}const IC="0".charCodeAt(0);function*_C(t,e=","){const n=e.charCodeAt(0);let r=0;for(let i=0;i<t.length;i++){const s=t.charCodeAt(i);s==n?(yield r,r=0):r=r*10+s-IC}yield r}class RC extends X{get behavior(){return ut}constructor(e){super();const n=U(e.exons??"exons"),r=U(e.start??"start"),[i,s]=e.as||["exonStart","exonEnd"];this.handle=o=>{let a=r(o),c=a,u=!0;const f=n(o);for(const l of _C(f)){if(u)c=a+l;else{a=c+l;const h=Object.assign({},o);h[i]=c,h[s]=a,this._propagate(h)}u=!u}}}}class MC extends X{get behavior(){return ut}constructor(e){super();const n=ze(e.field).map(s=>U(s)),r=ze(e.separator),i=ze(e.as||e.field);if(n.length!==r.length||n.length!==i.length)throw new Error(`Lengths of "separator" (${r.length}), "fields" (${n.length}), and "as" (${i.length}) do not match!`);this.handle=s=>{if(n.some(c=>!c(s)))return;const o=n.map((c,u)=>c(s).split(r[u]));BC(o,s);const a=o[0].length;for(let c=0;c<a;c++){const u=Object.assign({},s);for(let f=0;f<n.length;f++)u[i[f]]=o[f][c];this._propagate(u)}}}}function BC(t,e){const n=t.map(r=>r.length);if(!n.every(r=>r==n[0]))throw new Error("Mismatching number of elements in the fields to be split: "+JSON.stringify(e))}class kC extends X{get behavior(){return Xt}constructor(e){super(),this.params=e,this.as=e.as,this.fn=void 0}initialize(){this.fn=vo(this.params.expr,this.getGlobalObject())}handle(e){e[this.as]=this.fn(e),this._propagate(e)}}class sp extends X{get behavior(){return Xt}constructor(e,n){super();const r=e.channel??"x";if(!["x","y"].includes(r))throw new Error("Invalid channel: "+r);const i=n.getScaleResolution(r).getGenome();if(!i)throw new Error("LinearizeGenomicCoordinate transform requires a locus scale!");const s=U(e.chrom),o=ze(e.pos).map(d=>U(d)),a=ze(e.as);if(o.length!=a.length)throw new Error('The number of "pos" and "as" elements must be equal!');const c=ze(e.offset);let u;if(c.length==0)u=new Array(o.length).fill(0);else if(c.length==1)u=new Array(o.length).fill(c[0]);else if(c.length==o.length)u=c;else throw new Error(`Invalid "offset" parameter: ${JSON.stringify(e.offset)}!`);const f=new Function("datum","chromOffset","posAccessors",a.map((d,m)=>`datum[${JSON.stringify(d)}] = chromOffset + +posAccessors[${m}](datum) - ${u[m]};`).join(`
`));let l,h=0;const p=d=>{if(d!==l){if(h=i.cumulativeChromPositions.get(d),h===void 0)throw new Error("Unknown chromosome/contig: "+d);l=d}return h};this.handle=d=>{f(d,p(s(d)),o),this._propagate(d)}}}const OC=["Lato-Regular.png"],PC=[{id:87,width:53,height:40,xoffset:0,yoffset:-30.093000000000004,xadvance:43.491,chnl:15,x:0,y:0,page:0},{id:124,width:17,height:50,xoffset:0,yoffset:-32.193000000000005,xadvance:10.521,chnl:15,x:0,y:42,page:0},{id:40,width:20,height:49,xoffset:0,yoffset:-32.571000000000005,xadvance:11.214,chnl:15,x:0,y:94,page:0},{id:41,width:19,height:49,xoffset:0,yoffset:-32.571000000000005,xadvance:11.214,chnl:15,x:0,y:145,page:0},{id:36,width:32,height:49,xoffset:0,yoffset:-34.419000000000004,xadvance:24.360000000000003,chnl:15,x:0,y:196,page:0},{id:125,width:21,height:48,xoffset:0,yoffset:-32.193000000000005,xadvance:12.642000000000001,chnl:15,x:0,y:247,page:0},{id:91,width:22,height:48,xoffset:0,yoffset:-32.193000000000005,xadvance:12.852,chnl:15,x:0,y:297,page:0},{id:93,width:19,height:48,xoffset:0,yoffset:-32.193000000000005,xadvance:12.852,chnl:15,x:0,y:347,page:0},{id:123,width:21,height:48,xoffset:0,yoffset:-32.193000000000005,xadvance:12.642000000000001,chnl:15,x:0,y:397,page:0},{id:106,width:19,height:48,xoffset:0,yoffset:-30.639000000000003,xadvance:10.08,chnl:15,x:0,y:447,page:0},{id:81,width:43,height:47,xoffset:0,yoffset:-30.429000000000002,xadvance:33.621,chnl:15,x:21,y:447,page:0},{id:77,width:45,height:40,xoffset:0,yoffset:-30.093000000000004,xadvance:38.997,chnl:15,x:66,y:447,page:0},{id:64,width:43,height:44,xoffset:0,yoffset:-28.539,xadvance:35.133,chnl:15,x:23,y:397,page:0},{id:92,width:28,height:43,xoffset:0,yoffset:-30.933000000000003,xadvance:18.984,chnl:15,x:68,y:397,page:0},{id:47,width:28,height:43,xoffset:0,yoffset:-30.933000000000003,xadvance:18.984,chnl:15,x:98,y:397,page:0},{id:109,width:42,height:32,xoffset:0,yoffset:-21.609,xadvance:34.545,chnl:15,x:113,y:447,page:0},{id:119,width:42,height:31,xoffset:0,yoffset:-21.315,xadvance:32.991,chnl:15,x:157,y:447,page:0},{id:42,width:25,height:42,xoffset:0,yoffset:-31.626,xadvance:17.85,chnl:15,x:128,y:397,page:0},{id:37,width:42,height:41,xoffset:0,yoffset:-30.387,xadvance:33.663000000000004,chnl:15,x:155,y:397,page:0},{id:79,width:42,height:41,xoffset:0,yoffset:-30.429000000000002,xadvance:33.621,chnl:15,x:199,y:397,page:0},{id:102,width:24,height:41,xoffset:0,yoffset:-30.534000000000002,xadvance:14.721,chnl:15,x:243,y:397,page:0},{id:100,width:31,height:41,xoffset:0,yoffset:-30.933000000000003,xadvance:23.520000000000003,chnl:15,x:269,y:397,page:0},{id:98,width:32,height:41,xoffset:0,yoffset:-30.933000000000003,xadvance:23.520000000000003,chnl:15,x:302,y:397,page:0},{id:56,width:32,height:41,xoffset:0,yoffset:-30.429000000000002,xadvance:24.360000000000003,chnl:15,x:336,y:397,page:0},{id:38,width:40,height:41,xoffset:0,yoffset:-30.429000000000002,xadvance:29.904000000000003,chnl:15,x:370,y:397,page:0},{id:108,width:17,height:41,xoffset:0,yoffset:-30.933000000000003,xadvance:9.912,chnl:15,x:412,y:397,page:0},{id:107,width:31,height:41,xoffset:0,yoffset:-30.933000000000003,xadvance:21.336000000000002,chnl:15,x:431,y:397,page:0},{id:48,width:33,height:41,xoffset:0,yoffset:-30.429000000000002,xadvance:24.360000000000003,chnl:15,x:464,y:397,page:0},{id:71,width:38,height:41,xoffset:0,yoffset:-30.429000000000002,xadvance:30.681,chnl:15,x:21,y:347,page:0},{id:83,width:31,height:41,xoffset:0,yoffset:-30.429000000000002,xadvance:22.785,chnl:15,x:61,y:347,page:0},{id:63,width:27,height:41,xoffset:0,yoffset:-30.429000000000002,xadvance:18.795,chnl:15,x:94,y:347,page:0},{id:105,width:18,height:41,xoffset:0,yoffset:-30.639000000000003,xadvance:10.08,chnl:15,x:123,y:347,page:0},{id:51,width:32,height:41,xoffset:0,yoffset:-30.429000000000002,xadvance:24.360000000000003,chnl:15,x:143,y:347,page:0},{id:104,width:31,height:41,xoffset:0,yoffset:-30.933000000000003,xadvance:23.436,chnl:15,x:177,y:347,page:0},{id:67,width:37,height:41,xoffset:0,yoffset:-30.429000000000002,xadvance:28.056,chnl:15,x:210,y:347,page:0},{id:88,width:37,height:40,xoffset:0,yoffset:-30.093000000000004,xadvance:27.258000000000003,chnl:15,x:249,y:347,page:0},{id:68,width:40,height:40,xoffset:0,yoffset:-30.093000000000004,xadvance:31.941000000000003,chnl:15,x:288,y:347,page:0},{id:70,width:32,height:40,xoffset:0,yoffset:-30.093000000000004,xadvance:23.751,chnl:15,x:330,y:347,page:0},{id:34,width:23,height:40,xoffset:0,yoffset:-30.093000000000004,xadvance:15.561000000000002,chnl:15,x:364,y:347,page:0},{id:72,width:38,height:40,xoffset:0,yoffset:-30.093000000000004,xadvance:32.067,chnl:15,x:389,y:347,page:0},{id:73,width:18,height:40,xoffset:0,yoffset:-30.093000000000004,xadvance:11.760000000000002,chnl:15,x:429,y:347,page:0},{id:74,width:24,height:40,xoffset:0,yoffset:-30.093000000000004,xadvance:17.745,chnl:15,x:449,y:347,page:0},{id:75,width:38,height:40,xoffset:0,yoffset:-30.093000000000004,xadvance:27.825000000000003,chnl:15,x:24,y:297,page:0},{id:76,width:31,height:40,xoffset:0,yoffset:-30.093000000000004,xadvance:21.567,chnl:15,x:475,y:347,page:0},{id:66,width:35,height:40,xoffset:0,yoffset:-30.093000000000004,xadvance:27.153000000000002,chnl:15,x:64,y:297,page:0},{id:78,width:38,height:40,xoffset:0,yoffset:-30.093000000000004,xadvance:32.067,chnl:15,x:101,y:297,page:0},{id:33,width:18,height:40,xoffset:0,yoffset:-30.093000000000004,xadvance:11.298,chnl:15,x:141,y:297,page:0},{id:80,width:34,height:40,xoffset:0,yoffset:-30.093000000000004,xadvance:25.221,chnl:15,x:161,y:297,page:0},{id:65,width:38,height:40,xoffset:0,yoffset:-30.093000000000004,xadvance:28.434,chnl:15,x:197,y:297,page:0},{id:82,width:36,height:40,xoffset:0,yoffset:-30.093000000000004,xadvance:26.313000000000002,chnl:15,x:237,y:297,page:0},{id:35,width:33,height:40,xoffset:0,yoffset:-30.093000000000004,xadvance:24.360000000000003,chnl:15,x:275,y:297,page:0},{id:84,width:34,height:40,xoffset:0,yoffset:-30.093000000000004,xadvance:24.801000000000002,chnl:15,x:310,y:297,page:0},{id:85,width:37,height:40,xoffset:0,yoffset:-30.093000000000004,xadvance:30.891000000000002,chnl:15,x:346,y:297,page:0},{id:86,width:38,height:40,xoffset:0,yoffset:-30.093000000000004,xadvance:28.434,chnl:15,x:385,y:297,page:0},{id:39,width:16,height:40,xoffset:0,yoffset:-30.093000000000004,xadvance:8.568000000000001,chnl:15,x:425,y:297,page:0},{id:69,width:32,height:40,xoffset:0,yoffset:-30.093000000000004,xadvance:24.255000000000003,chnl:15,x:443,y:297,page:0},{id:89,width:36,height:40,xoffset:0,yoffset:-30.093000000000004,xadvance:26.208000000000002,chnl:15,x:23,y:247,page:0},{id:90,width:34,height:40,xoffset:0,yoffset:-30.093000000000004,xadvance:25.284000000000002,chnl:15,x:477,y:297,page:0},{id:49,width:31,height:40,xoffset:0,yoffset:-30.156000000000002,xadvance:24.360000000000003,chnl:15,x:61,y:247,page:0},{id:50,width:32,height:40,xoffset:0,yoffset:-30.429000000000002,xadvance:24.360000000000003,chnl:15,x:94,y:247,page:0},{id:57,width:32,height:40,xoffset:0,yoffset:-30.429000000000002,xadvance:24.360000000000003,chnl:15,x:128,y:247,page:0},{id:94,width:32,height:40,xoffset:0,yoffset:-30.093000000000004,xadvance:24.360000000000003,chnl:15,x:162,y:247,page:0},{id:96,width:21,height:40,xoffset:0,yoffset:-30.429000000000002,xadvance:16.8,chnl:15,x:196,y:247,page:0},{id:55,width:33,height:40,xoffset:0,yoffset:-30.093000000000004,xadvance:24.360000000000003,chnl:15,x:219,y:247,page:0},{id:54,width:33,height:40,xoffset:0,yoffset:-30.093000000000004,xadvance:24.360000000000003,chnl:15,x:254,y:247,page:0},{id:53,width:32,height:40,xoffset:0,yoffset:-30.093000000000004,xadvance:24.360000000000003,chnl:15,x:289,y:247,page:0},{id:52,width:33,height:40,xoffset:0,yoffset:-30.093000000000004,xadvance:24.360000000000003,chnl:15,x:323,y:247,page:0},{id:103,width:31,height:39,xoffset:0,yoffset:-21.630000000000003,xadvance:21.84,chnl:15,x:358,y:247,page:0},{id:112,width:32,height:39,xoffset:0,yoffset:-21.651,xadvance:23.541,chnl:15,x:391,y:247,page:0},{id:113,width:31,height:39,xoffset:0,yoffset:-21.651,xadvance:23.520000000000003,chnl:15,x:425,y:247,page:0},{id:116,width:25,height:39,xoffset:0,yoffset:-28.182000000000002,xadvance:15.057,chnl:15,x:458,y:247,page:0},{id:121,width:31,height:38,xoffset:0,yoffset:-21.273,xadvance:21.651,chnl:15,x:34,y:196,page:0},{id:59,width:18,height:36,xoffset:0,yoffset:-20.706,xadvance:10.983,chnl:15,x:485,y:247,page:0},{id:43,width:32,height:34,xoffset:0,yoffset:-24.486,xadvance:24.360000000000003,chnl:15,x:67,y:196,page:0},{id:60,width:30,height:33,xoffset:0,yoffset:-23.331000000000003,xadvance:24.360000000000003,chnl:15,x:101,y:196,page:0},{id:62,width:31,height:33,xoffset:0,yoffset:-23.331000000000003,xadvance:24.360000000000003,chnl:15,x:133,y:196,page:0},{id:117,width:30,height:32,xoffset:0,yoffset:-21.273,xadvance:23.415000000000003,chnl:15,x:166,y:196,page:0},{id:99,width:29,height:32,xoffset:0,yoffset:-21.609,xadvance:20.055,chnl:15,x:198,y:196,page:0},{id:110,width:31,height:32,xoffset:0,yoffset:-21.609,xadvance:23.436,chnl:15,x:229,y:196,page:0},{id:111,width:32,height:32,xoffset:0,yoffset:-21.609,xadvance:23.814,chnl:15,x:262,y:196,page:0},{id:126,width:32,height:26,xoffset:0,yoffset:-16.128,xadvance:24.360000000000003,chnl:15,x:201,y:447,page:0},{id:101,width:31,height:32,xoffset:0,yoffset:-21.609,xadvance:22.176000000000002,chnl:15,x:296,y:196,page:0},{id:114,width:25,height:32,xoffset:0,yoffset:-21.651,xadvance:15.288,chnl:15,x:329,y:196,page:0},{id:115,width:27,height:32,xoffset:0,yoffset:-21.609,xadvance:18.186,chnl:15,x:356,y:196,page:0},{id:97,width:28,height:32,xoffset:0,yoffset:-21.651,xadvance:20.874000000000002,chnl:15,x:385,y:196,page:0},{id:118,width:31,height:31,xoffset:0,yoffset:-21.273,xadvance:21.672,chnl:15,x:415,y:196,page:0},{id:61,width:31,height:29,xoffset:0,yoffset:-19.089000000000002,xadvance:24.360000000000003,chnl:15,x:448,y:196,page:0},{id:120,width:30,height:31,xoffset:0,yoffset:-21.273,xadvance:20.916,chnl:15,x:21,y:145,page:0},{id:58,width:18,height:31,xoffset:0,yoffset:-20.706,xadvance:10.5,chnl:15,x:53,y:145,page:0},{id:122,width:28,height:31,xoffset:0,yoffset:-21.273,xadvance:18.984,chnl:15,x:73,y:145,page:0},{id:95,width:28,height:16,xoffset:0,yoffset:0,xadvance:19.278000000000002,chnl:15,x:235,y:447,page:0},{id:45,width:23,height:24,xoffset:0,yoffset:-14.175,xadvance:15.603000000000002,chnl:15,x:481,y:196,page:0},{id:44,width:17,height:21,xoffset:0,yoffset:-4.956,xadvance:9.534,chnl:15,x:103,y:145,page:0},{id:46,width:18,height:15,xoffset:0,yoffset:-4.956,xadvance:9.912,chnl:15,x:0,y:497,page:0},{id:32,width:0,height:0,xoffset:0,yoffset:0,xadvance:10.752,chnl:15,x:20,y:497,page:0}],LC={face:"Lato Regular",size:42,bold:0,italic:0,charset:[" ","!",'"',"#","$","%","&","'","(",")","*","+",",","-",".","/","0","1","2","3","4","5","6","7","8","9",":",";","<","=",">","?","@","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","[","\\","]","^","_","`","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","{","|","}","~"],unicode:1,stretchH:100,smooth:1,aa:1,padding:[0,0,0,0],spacing:[2,2]},NC={lineHeight:50.400000000000006,base:41.454,scaleW:512,scaleH:512,pages:1,packed:0,alphaChnl:0,redChnl:0,greenChnl:0,blueChnl:0},zC=[],op={pages:OC,chars:PC,info:LC,common:NC,kernings:zC};class UC extends X{get behavior(){return Xt}constructor(e){super();const n=oc(op),r=U(e.field),i=e.as,s=e.fontSize;this.handle=o=>{const a=r(o);a!==void 0?o[i]=n.measureWidth(a,s):o[i]=0,this._propagate(o)}}}const $C=65536;class VC extends X{get behavior(){return Xt}constructor(e){super(),this.params=e}reset(){super.reset(),this.initialize()}initialize(){const e=this.params,n=e.as||"lane",r=be(e.spacing)?e.spacing:1,i=U(e.start),s=U(e.end);if(!e.preference!=!e.preferredOrder)throw new Error('Must specify both "preference" and "preferredOrder"');if(e.preference){const o=new Float64Array($C),a=U(e.preference),c=e.preferredOrder;let u=1/0;this.handle=f=>{const l=i(f);l<u&&o.fill(-1/0),u=l;const h=c.indexOf(a(f));let p=-1;if(h>=0&&o[h]<l)p=h;else{const d=i(f);for(p=0;p<o.length&&!(o[p]<d);p++);if(p>=o.length)throw new Error("Out of lanes!")}o[p]=s(f)+r,f[n]=p,this._propagate(f)}}else{const o=new js,a=new js;let c=-1/0,u=0;this.handle=f=>{const l=i(f);for(;o.length&&(o.peekValue()<=l||l<c);){const p=o.pop();a.push(p,p)}c=l;let h=a.pop();h===void 0&&(h=u++),f[n]=h,this._propagate(f),o.push(h,s(f)+r)}}}}class GC extends X{get behavior(){return ut}constructor(e){if(super(),e.as&&e.as.length!=e.fields.length)throw new Error('"fields" and "as" have unequal lengths!');const n=e.fields.map(i=>U(i)),r=e.as?e.as:n.map(Kp);this.handle=i=>{const s={};for(let o=0;o<n.length;o++)s[r[o]]=n[o](i);this._propagate(s)}}}class HC extends X{get behavior(){return Xt}constructor(e){super();const n=new RegExp(e.regex),r=typeof e.as=="string"?[e.as]:e.as,i=U(e.field);this.handle=s=>{const o=i(s);if(V(o)){const a=o.match(n);if(a){if(a.length-1!=r.length)throw new Error('The number of RegEx groups and the length of "as" do not match!');for(let c=0;c<r.length;c++)s[r[c]]=a[c+1]}else if(e.skipInvalidInput)for(let c=0;c<r.length;c++)s[r[c]]=void 0;else throw new Error(`"${o}" does not match the given regex: ${n.toString()}`)}else if(!e.skipInvalidInput)throw new Error(`Trying to match a non-string field. Encountered type: ${typeof o}, field content: "${o}".`);this._propagate(s)}}}class qC extends X{get behavior(){return ut}constructor(e){super();const n=ze(e.columnRegex).map(h=>new RegExp(h)),r=ze(e.asValue);if(n.length!=r.length)throw new Error('Lengths of "columnRegex" and "as" are not equal!');const i=e.skipRegex?new RegExp(e.skipRegex):void 0,s=e.asKey||"sample";let o,a,c;const u=h=>{var g;const p=Object.keys(h),d=new Map;for(const[x,b]of n.entries())for(const A of p){const E=(g=b.exec(A))==null?void 0:g[1];if(E!==void 0){let F=d.get(E);F||(F=[],d.set(E,F)),F[x]=A}}o=[...d.entries()],a=p.filter(x=>!n.some(b=>b.test(x))&&!(i&&i.test(x)));const m=[...a.map(x=>JSON.stringify(x)+": datum["+JSON.stringify(x)+"]"),JSON.stringify(s)+": sampleId",...r.map(x=>JSON.stringify(x)+": null")];c=new Function("datum","sampleId",`return {
`+m.join(`,
`)+`
};`)},f=h=>{o||u(h);for(const[p,d]of o){const m=c(h,p);for(let g=0;g<d.length;g++)m[r[g]]=h[d[g]];this._propagate(m)}},l=h=>{u(h),f(h),this.handle=f};this.handle=l,this.beginBatch=h=>{Ud(h)&&(this.handle=l),super.beginBatch(h)}}}class WC extends X{get behavior(){return Xt}constructor(e){super(),this.params=e,this.buffer=[]}reset(){this.buffer=[]}handle(e){this.buffer.push(e)}complete(){const e=this.params,n=e.as||["y0","y1"],r=e.sort?qf(e.sort.field,e.sort.order):void 0,i=e.field?U(e.field):()=>1,s=e.groupby.map(f=>U(f)),o=zm(this.buffer,f=>s.map(l=>l(f)).join()).map(f=>f[1]);let a=f=>!0;if(e.baseField){const f=U(e.baseField);a=l=>f(l)!==null}let c,u;switch(e.offset){case"normalize":c=(f,l)=>f/l,u=(f,l)=>os(f,l);break;case"center":c=(f,l)=>f-l/2,u=(f,l)=>os(f,l);break;case"information":{const f=Math.log2(e.cardinality??4);c=(l,h)=>l/h,u=(l,h)=>{const d=os(l,b=>+!a(b)),m=os(l,h),g=m-d;let x=0;for(let b=0;b<l.length;b++){const A=l[b];if(a(A)){const E=h(A)/g;x-=E*Math.log2(E)}}return g/(f-(x+0))*(g/m)}}break;default:c=(f,l)=>f,u=(f,l)=>1}for(const f of o){r&&f.sort(r);const l=u(f,i);let h=0;for(const p of f){const d=h+i(p);a(p)&&(p[n[0]]=c(h,l),p[n[1]]=c(d,l),this._propagate(p),h=d)}}super.complete()}}class jC extends X{get behavior(){return ut}constructor(e){super();const n=U(e.field??"sequence"),[r,i]=e.as??["pos","sequence"];this.handle=s=>{const o=Object.assign({},s,{[i]:"",[r]:0}),a=n(s);for(let c=0;c<a.length;c++){const u=Object.assign({},o);u[r]=c,u[i]=a.charAt(c),this._propagate(u)}}}}class YC extends X{get behavior(){return ut}constructor(e){super(),this.params=e,this.buffer=[]}reset(){this.buffer=[]}handle(e){this.buffer.push(e)}complete(){const n=this.params.groupby,r=n.map(s=>U(s)),i=uo(this.buffer,...r);for(const[s,o]of Iu(i)){const a={count:o.length};for(let c=0;c<n.length;c++)a[n[c]]=s[c];this._propagate(a)}super.complete()}}const XC="_uniqueId",xf=1e4,yf=[null];class ap extends X{get behavior(){return Xt}constructor(e){super(),this.params=e,this.as=e.as??XC,this._blocks=[],this._usedBlocks=0,this._id=-1}initialize(){}reset(){super.reset(),this._usedBlocks=0,this._id=-1}handle(e){e[this.as]=this._nextId(),this._propagate(e)}_nextId(){return++this._id%xf==0&&(this._id=this._getBlock()*xf),this._id}_getBlock(){return this._usedBlocks<this._blocks.length?this._blocks[this._usedBlocks++]:this._reserveBlock()}_reserveBlock(){const e=yf.length;return yf[e]=this,this._blocks.push(e),this._usedBlocks++,e}}const KC={aggregate:YC,collect:ip,coverage:EC,filterScoredLabels:FC,filter:TC,flatten:DC,flattenCompressedExons:RC,flattenDelimited:MC,flattenSequence:jC,formula:kC,identifier:ap,linearizeGenomicCoordinate:sp,measureText:UC,pileup:VC,project:GC,regexExtract:HC,regexFold:qC,sample:$d,stack:WC};function JC(t,e){const n=KC[t.type];if(n)return new n(t,e);throw new Error("Unknown transform: "+t.type)}function cp(t){if(!lp(t)&&!bf(t))return;const e={...t.format};if(e.type??(e.type=bf(t)&&ZC(t.url)),e.parse??(e.parse="auto"),!e.type)throw new Error("Format for the data source was not defined and it could not be inferred: "+JSON.stringify(t));return e}function ZC(t){var e;if(Array.isArray(t)&&(t=t[0]),t)return(e=t.match(/\.(csv|tsv|json)/))==null?void 0:e[1]}const up=t=>typeof t!="object"?QC:eS,QC=t=>({data:t}),eS=t=>t;function bf(t){return"url"in t}class Zi extends X{get identifier(){}handle(e){throw new Error("Source does not handle incoming data!")}async load(){}}function lp(t){return"values"in t}class tS extends Zi{constructor(e,n){var r;if(super(),this.params=e,typeof e.values=="string"&&!((r=e==null?void 0:e.format)!=null&&r.type))throw new Error("Data format type (csv, dsv, ...) must be specified if a string is provided!")}loadSynchronously(){const e=this.params.values;let n=[],r=i=>i;if(Array.isArray(e))e.length>0&&(n=e,r=up(e[0]));else if(typeof e=="object")n=[e];else if(typeof e=="string")n=xh(e,cp(this.params));else throw new Error('"values" in data configuration is not an array, object, or a string!');this.reset(),this.beginBatch({type:"file"});for(const i of n)this._propagate(r(i));this.complete()}async load(){this.loadSynchronously()}}function nS(t){return"url"in t}class rS extends Zi{constructor(e,n){super(),this.params=e,this.baseUrl=n==null?void 0:n.getBaseUrl()}get identifier(){return JSON.stringify({params:this.params,baseUrl:this.baseUrl})}async load(){const e=this.params.url,n=Array.isArray(e)?e:[e],r=async s=>xo({baseURL:this.baseUrl}).load(s).catch(o=>{throw new Error(`Cannot fetch: ${this.baseUrl}${s}: ${o.message}`)}),i=(s,o)=>{try{const a=xh(s,cp(this.params));this.beginBatch({type:"file",url:o});for(const c of a)this._propagate(c)}catch(a){throw new Error(`Cannot parse: ${o}: ${a.message}`)}};this.reset(),await Promise.all(n.map(s=>r(s).then(i))),this.complete()}}function iS(t){return"sequence"in t}class sS extends Zi{constructor(e,n){if(super(),this.sequence=e.sequence,!("start"in this.sequence))throw new Error("'start' is missing from sequence parameters!");if(!("stop"in this.sequence))throw new Error("'stop' is missing from sequence parameters!")}loadSynchronously(){const e=this.sequence.as||"data",n=this.sequence.step||1,r=this.sequence.stop;this.reset(),this.beginBatch({type:"file"});for(let i=this.sequence.start;i<r;i+=n)this._propagate({[e]:i});this.complete()}async load(){this.loadSynchronously()}}class Ln extends Zi{constructor(e,n){if(super(),this.view=e,n){if(n!=="x"&&n!=="y")throw new Error(`Invalid channel specified for the dynamic data source: ${n}. Must be either "x" or "y"`)}else throw new Error('No channel has been specified for the dynamic data source. Must be either "x" or "y".');if(this.channel=n,this.scaleResolution=this.view.getScaleResolution(n),!this.scaleResolution){const i=[`The dynamic data source cannot find a resolved scale for channel "${n}".`];throw this.view instanceof Ne||i.push('Make sure the view has a "shared" scale resolution as it is not a unit view.'),new Error(i.join(" "))}const r=()=>{this.view.isVisible()&&this.onDomainChanged(this.scaleResolution.getDomain(),this.scaleResolution.getComplexDomain())};this.scaleResolution.addEventListener("domain",r),this.view.context.addBroadcastListener("layoutComputed",r)}getAxisLength(){const e=this.scaleResolution.members.map(n=>{var r;return(r=n.view.coords)==null?void 0:r[this.channel==="x"?"width":"height"]}).filter(n=>n>0);return e.length?e.reduce((n,r)=>Math.min(n,r),1e4):0}get genome(){return this.scaleResolution.getGenome()}async onDomainChanged(e,n){}requestRender(){this.view.context.animator.requestRender()}async load(){this.reset(),this.complete()}publishData(e){this.reset(),this.beginBatch({type:"file"});for(const n of e)this._propagate(n);this.complete(),xc(this.view),this.requestRender()}}class oS extends Ln{constructor(n,r){const i={axis:{},...n};super(r,i.channel);fe(this,"ticks",[]);this.params=n}async onDomainChanged(){const n=this.scaleResolution.getScale(),r=this.params.axis,i=this.getAxisLength(),s=u=>25+60*Sh(100,700,u),o=be(r.tickCount)?r.tickCount:Math.round(i/s(i)),a=Hd(n,o,r.tickMinStep),c=r.values?qd(n,r.values,a):NE(n,a);if(!ks(c,this.ticks)){this.ticks=c;const u=UE(n,o,r.format);this.publishData(c.map(f=>({value:f,label:u(f)})))}}}class aS extends Ln{constructor(e,n){super(n,e.channel)}async load(){this.publishData(this.genome.chromosomes)}}const cS="modulepreload",uS=function(t,e){return new URL(t,e).href},Af={},_e=function(e,n,r){if(!n||n.length===0)return e();const i=document.getElementsByTagName("link");return Promise.all(n.map(s=>{if(s=uS(s,r),s in Af)return;Af[s]=!0;const o=s.endsWith(".css"),a=o?'[rel="stylesheet"]':"";if(!!r)for(let f=i.length-1;f>=0;f--){const l=i[f];if(l.href===s&&(!o||l.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${s}"]${a}`))return;const u=document.createElement("link");if(u.rel=o?"stylesheet":cS,o||(u.as="script",u.crossOrigin=""),u.href=s,document.head.appendChild(u),o)return new Promise((f,l)=>{u.addEventListener("load",f),u.addEventListener("error",()=>l(new Error(`Unable to preload CSS for ${s}`)))})})).then(()=>e()).catch(s=>{const o=new Event("vite:preloadError",{cancelable:!0});if(o.payload=s,window.dispatchEvent(o),!o.defaultPrevented)throw s})};function Qi(t){return class extends t{constructor(){super(...arguments);fe(this,"lastQuantizedInterval",[0,0])}quantizeInterval(r,i){return[Math.max(Math.floor(r[0]/i-1)*i,0),Math.min(Math.ceil(r[1]/i+1)*i,this.genome.totalSize)]}checkAndUpdateLastInterval(r){return ks(this.lastQuantizedInterval,r)?!1:(this.lastQuantizedInterval=r,!0)}}}function es(t,e){return!e||/^(data:|([A-Za-z]+:)?\/\/)/.test(t)||t.startsWith("/")?t:(e.endsWith("/")||(e+="/"),e+t)}class lS extends Qi(Ln){constructor(e,n){const r={channel:"x",windowSize:7e3,...e};if(super(n,r.channel),this.params=r,!this.params.url)throw new Error("No URL provided for IndexedFastaSource");this.initializedPromise=new Promise(i=>{Promise.all([_e(()=>import("./index-462333f7.js").then(s=>s.i),["./index-462333f7.js","./_commonjsHelpers-de833af9.js"],import.meta.url),_e(()=>import("./index-f8b9b7f4.js"),["./index-f8b9b7f4.js","./__vite-browser-external-d053bc6e.js","./index-462333f7.js","./_commonjsHelpers-de833af9.js","./long-c1fdf4ae.js"],import.meta.url),_e(()=>import("./index-5c802462.js"),["./index-5c802462.js","./__vite-browser-external-d053bc6e.js","./remoteFile-1948951e.js","./index-462333f7.js","./_commonjsHelpers-de833af9.js"],import.meta.url)]).then(([{Buffer:s},{IndexedFasta:o},{RemoteFile:a}])=>{typeof window<"u"&&(window.Buffer??(window.Buffer=s));const c=u=>new a(es(u,this.view.getBaseUrl()));this.fasta=new o({fasta:c(this.params.url),fai:c(this.params.indexUrl??this.params.url+".fai")}),i()})})}async onDomainChanged(e){const n=this.params.windowSize;if(e[1]-e[0]>n)return;await this.initializedPromise;const r=this.quantizeInterval(e,n);if(this.checkAndUpdateLastInterval(r)){const i=this.genome.continuousToDiscreteChromosomeIntervals(r),s=await Promise.all(i.map(o=>this.fasta.getSequence(o.chrom,o.startPos,o.endPos).then(a=>({chrom:o.chrom,start:o.startPos,sequence:a}))));this.publishData(s)}}}function Wo(t,e,n=!0){let r,i=o=>{};return function(...a){return new Promise((c,u)=>{const f=()=>{clearTimeout(r),i=l=>{},c(t(...a))};n&&i("debounced"),clearTimeout(r),i=u,r=window.setTimeout(f,e)})}}class fS extends Qi(Ln){constructor(n,r){const i={pixelsPerBin:2,channel:"x",...n};super(r,i.channel);fe(this,"reductionLevels",[]);fe(this,"lastRequestId",0);fe(this,"bbi");if(this.params=i,!this.params.url)throw new Error("No URL provided for BigWigSource");this.doDebouncedRequest=Wo(this.doRequest.bind(this),200,!1),this.initializedPromise=new Promise(s=>{Promise.all([_e(()=>import("./index-396a8699.js"),["./index-396a8699.js","./index-462333f7.js","./_commonjsHelpers-de833af9.js","./index-d89cadd6.js","./__vite-browser-external-d053bc6e.js","./remoteFile-1948951e.js"],import.meta.url),_e(()=>import("./index-5c802462.js"),["./index-5c802462.js","./__vite-browser-external-d053bc6e.js","./remoteFile-1948951e.js","./index-462333f7.js","./_commonjsHelpers-de833af9.js"],import.meta.url)]).then(([{BigWig:o},{RemoteFile:a}])=>{this.bbi=new o({filehandle:new a(es(this.params.url,this.view.getBaseUrl()))}),this.bbi.getHeader().then(c=>{this.reductionLevels=c.zoomLevels.map(u=>u.reductionLevel).reverse(),this.reductionLevels.push(1),s()})})})}async onDomainChanged(n){await this.initializedPromise;const r=this.getAxisLength()||700,i=hS(n,r,this.reductionLevels),s=Math.max(i*r,5e3),o=this.quantizeInterval(n,s);this.checkAndUpdateLastInterval(o)&&this.doDebouncedRequest(o,i)}async doRequest(n,r){const i=await this.getFeatures(n,.5/r/this.params.pixelsPerBin);i.requestId<this.lastRequestId||this.publishData(i.features)}async getFeatures(n,r){let i=++this.lastRequestId;const s=new AbortController,o=this.genome.continuousToDiscreteChromosomeIntervals(n),a=await Promise.all(o.map(c=>this.bbi.getFeatures(c.chrom,c.startPos,c.endPos,{scale:r,signal:s.signal}).then(u=>u.map(f=>({chrom:c.chrom,start:f.start,end:f.end,score:f.score})))));return{requestId:i,abort:()=>s.abort(),features:a.flat()}}}function hS(t,e,n){const r=(t[1]-t[0])/e;return n.find(i=>i<r)??n.at(-1)}class dS extends Qi(Ln){constructor(n,r){const i={channel:"x",windowSize:1e6,...n};super(r,i.channel);fe(this,"lastRequestId",0);fe(this,"parser");fe(this,"bbi");if(this.params=i,!this.params.url)throw new Error("No URL provided for BigBedSource");this.doDebouncedRequest=Wo(this.doRequest.bind(this),200,!1),this.initializedPromise=new Promise(s=>{Promise.all([_e(()=>import("./index-7a37a249.js"),["./index-7a37a249.js","./_commonjsHelpers-de833af9.js"],import.meta.url),_e(()=>import("./index-396a8699.js"),["./index-396a8699.js","./index-462333f7.js","./_commonjsHelpers-de833af9.js","./index-d89cadd6.js","./__vite-browser-external-d053bc6e.js","./remoteFile-1948951e.js"],import.meta.url),_e(()=>import("./index-5c802462.js"),["./index-5c802462.js","./__vite-browser-external-d053bc6e.js","./remoteFile-1948951e.js","./index-462333f7.js","./_commonjsHelpers-de833af9.js"],import.meta.url)]).then(([o,{BigBed:a},{RemoteFile:c}])=>{const u=o.default;this.bbi=new a({filehandle:new c(es(this.params.url,this.view.getBaseUrl()))}),this.headerPromise=this.bbi.getHeader(),this.headerPromise.then(async f=>{this.parser=new u({autoSql:f.autoSql}),s()})})})}async onDomainChanged(n){await this.initializedPromise;const r=this.params.windowSize;if(n[1]-n[0]>r)return;const i=this.quantizeInterval(n,r);this.checkAndUpdateLastInterval(i)&&this.doDebouncedRequest(i)}async doRequest(n){const r=await this.getFeatures(n);r.requestId<this.lastRequestId||this.publishData(r.features)}async getFeatures(n){let r=++this.lastRequestId;const i=new AbortController,s=this.genome.continuousToDiscreteChromosomeIntervals(n),o=await Promise.all(s.map(a=>this.bbi.getFeatures(a.chrom,a.startPos,a.endPos,{signal:i.signal}).then(c=>c.map(u=>this.parser.parseLine(`${a.chrom}	${u.start}	${u.end}	${u.rest}`,{uniqueId:u.uniqueId})))));return{requestId:r,abort:()=>i.abort(),features:o.flat()}}}class pS extends Qi(Ln){constructor(n,r){const i={channel:"x",windowSize:2e4,...n};super(r,i.channel);fe(this,"lastRequestId",0);fe(this,"bam");fe(this,"chrPrefixFixer",n=>n);if(this.params=i,!this.params.url)throw new Error("No URL provided for BamSource");this.initializedPromise=new Promise(s=>{Promise.all([_e(()=>import("./index-234835b1.js"),["./index-234835b1.js","./long-c1fdf4ae.js","./index-462333f7.js","./_commonjsHelpers-de833af9.js","./__vite-browser-external-d053bc6e.js","./remoteFile-1948951e.js","./index-d89cadd6.js"],import.meta.url),_e(()=>import("./index-5c802462.js"),["./index-5c802462.js","./__vite-browser-external-d053bc6e.js","./remoteFile-1948951e.js","./index-462333f7.js","./_commonjsHelpers-de833af9.js"],import.meta.url)]).then(([{BamFile:o},{RemoteFile:a}])=>{const c=u=>new a(es(u,this.view.getBaseUrl()));this.bam=new o({bamFilehandle:c(this.params.url),baiFilehandle:c(this.params.indexUrl??this.params.url+".bai")}),this.bam.getHeader().then(u=>{var h,p;const f=this.genome.hasChrPrefix(),l=(p=(h=this.bam.indexToChr)==null?void 0:h[0])==null?void 0:p.refName.startsWith("chr");f&&!l?this.chrPrefixFixer=d=>d.replace("chr",""):!f&&l&&(this.chrPrefixFixer=d=>"chr"+d),s()})})})}async onDomainChanged(n){const r=this.params.windowSize;if(n[1]-n[0]>r)return;await this.initializedPromise;const i=this.quantizeInterval(n,r);if(this.checkAndUpdateLastInterval(i)){const s=this.genome.continuousToDiscreteChromosomeIntervals(i),o=await Promise.all(s.map(a=>this.bam.getRecordsForRange(this.chrPrefixFixer(a.chrom),a.startPos,a.endPos).then(c=>c.map(u=>({chrom:a.chrom,start:u.get("start"),end:u.get("end"),name:u.get("name"),MD:u.get("MD"),cigar:u.get("cigar"),mapq:u.get("mq"),strand:u.get("strand")===1?"+":"-"})))));this.publishData(o.flat())}}}class mS extends Qi(Ln){constructor(n,r){const i={channel:"x",windowSize:3e6,debounceDomainChange:200,...n};super(r,i.channel);fe(this,"lastRequestId",0);fe(this,"tbiIndex");if(this.params=i,!this.params.url)throw new Error("No URL provided for TabixSource");this.params.debounceDomainChange>0&&(this.onDomainChanged=Wo(this.onDomainChanged.bind(this),this.params.debounceDomainChange,!1)),this.initializedPromise=new Promise(s=>{Promise.all([_e(()=>import("./index-462333f7.js").then(o=>o.i),["./index-462333f7.js","./_commonjsHelpers-de833af9.js"],import.meta.url),_e(()=>import("./index-4e587624.js"),["./index-4e587624.js","./index-d89cadd6.js","./_commonjsHelpers-de833af9.js","./index-462333f7.js","./__vite-browser-external-d053bc6e.js","./long-c1fdf4ae.js"],import.meta.url),_e(()=>import("./index-5c802462.js"),["./index-5c802462.js","./__vite-browser-external-d053bc6e.js","./remoteFile-1948951e.js","./index-462333f7.js","./_commonjsHelpers-de833af9.js"],import.meta.url)]).then(([{Buffer:o},{TabixIndexedFile:a},{RemoteFile:c}])=>{typeof window<"u"&&(window.Buffer??(window.Buffer=o));const u=f=>new c(es(f,this.view.getBaseUrl()));this.tbiIndex=new a({filehandle:u(this.params.url),tbiFilehandle:u(this.params.indexUrl??this.params.url+".tbi")}),s()})})}async onDomainChanged(n){const r=this.params.windowSize;if(n[1]-n[0]>r)return;const i=this.quantizeInterval(n,r);this.checkAndUpdateLastInterval(i)&&this.doRequest(i)}async doRequest(n){const r=await this.getFeatures(n);r.requestId<this.lastRequestId||this.publishData(r.features)}async getFeatures(n){await this.initializedPromise;let r=++this.lastRequestId;const i=new AbortController,s=this.genome.continuousToDiscreteChromosomeIntervals(n),o=await Promise.all(s.map(async a=>{const c=[];return await this.tbiIndex.getLines(a.chrom,a.startPos,a.endPos,{lineCallback:u=>{c.push(u)},signal:i.signal}),this._parseFeatures(c)}));return{requestId:r,abort:()=>i.abort(),features:o.flat()}}_parseFeatures(n){return[]}}var Ei;class gS extends mS{constructor(n,r){super(n,r);M(this,Ei,void 0);_e(()=>import("./index-ba6a6d03.js"),["./index-ba6a6d03.js","./_commonjsHelpers-de833af9.js","./index-462333f7.js","./__vite-browser-external-d053bc6e.js"],import.meta.url).then(i=>{he(this,Ei,i.default)})}_parseFeatures(n){var i;return(i=S(this,Ei))==null?void 0:i.parseStringSync(n.join(`
`),{parseSequences:!1})}}Ei=new WeakMap;function xS(t,e){if(lp(t))return new tS(t,e);if(nS(t))return new rS(t,e);if(iS(t))return new sS(t,e);if(yS(t))return FS(t.lazy,e);throw new Error("Cannot figure out the data source type: "+JSON.stringify(t))}function yS(t){return"lazy"in t}function bS(t){return(t==null?void 0:t.type)=="axisTicks"}function AS(t){return(t==null?void 0:t.type)=="axisGenome"}function wS(t){return(t==null?void 0:t.type)=="indexedFasta"}function vS(t){return(t==null?void 0:t.type)=="bigwig"}function ES(t){return(t==null?void 0:t.type)=="bigbed"}function CS(t){return(t==null?void 0:t.type)=="bam"}function SS(t){return(t==null?void 0:t.type)=="gff3"}function FS(t,e){if(bS(t))return new oS(t,e);if(AS(t))return new aS(t,e);if(wS(t))return new lS(t,e);if(vS(t))return new fS(t,e);if(ES(t))return new dS(t,e);if(CS(t))return new pS(t,e);if(SS(t))return new gS(t,e);throw new Error("Cannot figure out the data source type: "+JSON.stringify(t))}function TS(t){const e=Object.keys(t).filter(r=>typeof r=="string"),n=new Function("source","return { "+e.map(r=>JSON.stringify(r)).map(r=>`${r}: source[${r}]`).join(`,
`)+" };");return n.properties=e,n}class Ys extends X{get behavior(){return ut}constructor(){super();const e=n=>{const r=TS(n);this.handle=i=>this._propagate(r(i)),this.handle(n)};this.handle=e,this.beginBatch=n=>{Ud(n)&&(this.handle=e),super.beginBatch(n)}}}function DS(t){return"name"in t}var Ci;class fp extends Zi{constructor(n,r,i){super();M(this,Ci,void 0);this.provider=i,this.params=n}get identifier(){return this.params.name}updateDynamicData(n){he(this,Ci,n),this.loadSynchronously()}loadSynchronously(){const n=S(this,Ci)??this.provider(this.params.name)??[];let r=i=>i;if(Array.isArray(n))n.length>0&&(r=up(n[0]));else throw new Error(`Named data "${this.params.name}" is not an array!`);this.reset(),this.beginBatch({type:"file"});for(const i of n)this._propagate(r(i));this.complete()}async load(){this.loadSynchronously()}}Ci=new WeakMap;class hp{constructor(){this._dataSourcesByHost=new Map,this._collectorsByHost=new Map,this._observers=new Map}get dataSources(){return[...new Set(this._dataSourcesByHost.values()).values()]}get collectors(){return[...this._collectorsByHost.values()]}addObserver(e,n){let r=this._observers.get(n);r||(r=[],this._observers.set(n,r)),r.push(e)}_relayObserverCallback(e,n){const r=this._observers.get(n);if(r)for(const i of r)i(e)}addDataSource(e,n){this._dataSourcesByHost.set(n,e)}findDataSourceByKey(e){return this._dataSourcesByHost.get(e)}findNamedDataSource(e){let n,r=[];for(const[i,s]of this._dataSourcesByHost.entries())if(s instanceof fp&&e==s.identifier){if(n&&n!==s)throw new Error(`Found multiple instances of named data: ${e}. Data flow optimization is broken (it's a bug).`);n=s,r.push(i)}if(n)return{dataSource:n,hosts:r}}addCollector(e,n){this._collectorsByHost.set(n,e),e.observers.push(r=>this._relayObserverCallback(r,n))}findCollectorByKey(e){return this._collectorsByHost.get(e)}initialize(){for(const e of this.dataSources)e.visit(n=>n.initialize())}}function IS(t,e){const n=new Map,r=[];for(const i of t)n.set(i,{ref:i,children:[]});for(const i of n.values()){const s=n.get(e(i.ref));s?s.children.push(i):r.push(i)}return r}function dp(t,e,n){var i,s;const r=(i=e.preOrder)==null?void 0:i.call(e,t);if(r)return r;for(const o of n(t)){const a=dp(o,e,n);if(a==="stop")return a}return(s=e.postOrder)==null?void 0:s.call(e,t)}function _S(t,e){return dp(t,e,n=>n.children)}function RS(t,e){const n=[];let r;const i=e??new hp,s=[];function o(l,h=()=>{}){if(!r)throw h()||new Error("Cannot append data flow node, no parent exist!");return r.addChild(l),r=l,l}function a(l,h){return o(l,()=>new Error(`Cannot append a transform because no (inherited) data are available! ${h?JSON.stringify(h):""}`))}function c(l,h){for(const p of l){let d;try{d=JC(p,h)}catch(m){throw console.warn(m),new Error(`Cannot initialize "${p.type}" transform: ${m}`)}d.behavior&Xt&&a(new Ys),a(d)}}const u=l=>{if(n.push(r),l.spec.data){const h=DS(l.spec.data)?new fp(l.spec.data,l,l.context.getNamedDataFromProvider):xS(l.spec.data,l);r=h,i.addDataSource(h,l)}if(l.spec.transform&&c(l.spec.transform,l),l instanceof Ne){if(!r)throw new Error(`A unit view (${l.getPathString()}) has no (inherited) data source`);const h=MS(l);if(h){s.push(h.rewrite);for(const d of h.transforms)a(d)}l.mark.isPickingParticipant()&&(a(new Ys),a(new ap({type:"identifier"})));const p=new ip({type:"collect",groupby:l.getFacetFields(),sort:BS(l,h==null?void 0:h.rewrittenEncoding)});o(p),i.addCollector(p,l)}},f=IS(t.getDescendants(),l=>l.dataParent);for(const l of f)_S(l,{preOrder:h=>u(h.ref),postOrder:()=>{r=n.pop()}});return s.forEach(l=>l()),i}function MS(t){var s;const e=[],n={},r=[];for(const[o,a]of Object.entries(t.getEncoding())){const c=o;li(c)&&S0(a)&&r.push({channel:c,chromPosDef:a})}const i=uo(r,o=>_n(o.channel),o=>o.chromPosDef.chrom);for(const[o,a]of i.entries())for(const[c,u]of a.entries()){const f=[],l=[],h=[];for(const{channel:p,chromPosDef:d}of u){const m=b=>b.replace(/[^A-Za-z0-9_]/g,""),g=["_linearized_",m(d.chrom),"_",m(d.pos)].join(""),x={...((s=t.spec.encoding)==null?void 0:s[p])??t.getEncoding()[p]??{},field:g};delete x.chrom,delete x.pos,!x.type&&d.type&&(x.type=d.type),n[p]=x,f.push(d.pos),h.push(d.offset??0),l.push(g)}e.push(new Ys),e.push(new sp({type:"linearizeGenomicCoordinate",channel:o,chrom:c,pos:f,offset:h,as:l},t))}return e.length?{transforms:e,rewrittenEncoding:n,rewrite:()=>{t.spec.encoding={...t.spec.encoding,...n},Bd(t.mark,"encoding")}}:void 0}function BS(t,e){var r;const n={...t.getEncoding(),...e}.x;if(De(n)&&(r=t.getScaleResolution("x"))!=null&&r.isZoomable()){if(qi(n))return{field:n.field};if(!Wi(n))throw new Error("A zoomable x channel must be mapped to a field.")}}function pp(t,e=void 0){if(t.parent!==e)return!1;for(const n of t.children)if(!pp(n,t))return!1;return!0}function yc(t,e=!1){if(t.behavior&Tu&&(e=!0),t instanceof Ys)if(e)e=!1;else{const n=t.children[0];t.excise(),n&&yc(n,e);return}t.behavior&ut&&(e=!1);for(let n=0,r=t.children.length;n<r;n++)yc(t.children[n],e||r>1)}function kS(t){const e=[...t._dataSourcesByHost.entries()],n=new Map;for(const r of e){const i=r[1];i.identifier&&!n.has(i.identifier)&&n.set(i.identifier,i)}t._dataSourcesByHost.clear();for(let[r,i]of e){const s=n.get(i.identifier);s&&(s.adoptChildrenOf(i),i=s),t.addDataSource(i,r)}}function OS(t){if(yc(t),!pp(t))throw new Error("Encountered a bug! There's a problem in the data flow structure.")}function PS(t){for(const e of t.dataSources)OS(e);kS(t)}function LS(t){const e=new Set;t.visit(n=>{for(const r of Object.values(n.resolutions.scale)){const i=r.name;if(i&&e.has(i))throw new Error(`The same scale name "${i}" occurs in multiple scale resolutions!`);e.add(i)}})}function NS(t){for(const e of br){const n=t.getScaleResolution(e);n&&!n.name&&n.isZoomable()&&(n.name=`${e}_at_root`)}}async function zS(t,e,n){var o;if(!t.import.url)throw new Error("Cannot import, not an import spec: "+JSON.stringify(t));const r=xo({baseURL:e}),i=t.import.url,s=JSON.parse(await r.load(i).catch(a=>{throw new Error(`Could not load imported view spec: ${i} 
Reason: ${a.message}`)}));if(n.isViewSpec(s))return s.baseUrl=(o=i.match(/^[^?#]*\//))==null?void 0:o[0],s;throw new Error(`The imported spec "${i}" is not a view spec: ${JSON.stringify(t)}`)}function US(t){const e=t.getSize().addPadding(t.getOverhang()),n=r=>r.grow>0?void 0:r.px;return{width:n(e.width),height:n(e.height)}}function ht(t){return()=>t}const qe=class qe{static create(e,n,r,i){return new qe(ht(e),ht(n),ht(r),ht(i))}_offset(e,n){const r=this["_"+e];if(n===0)return r;switch(typeof n){case"number":return()=>r()+n;case"function":return()=>r()+n();default:throw new Error("Not a number of function")}}_passThrough(e){return this._offset(e,0)}constructor(e,n,r,i){this._x=e,this._y=n,this._width=r,this._height=i}get x(){return this._x()}get y(){return this._y()}get width(){return this._width()}get height(){return this._height()}get x2(){return this._x()+this._width()}get y2(){return this._y()+this._height()}equals(e){return e?this===e||this.x===e.x&&this.y===e.y&&this.width===e.width&&this.height===e.height:!1}modify(e){if(!Object.keys(e).length)return this;const n=r=>{const i=e[r];return typeof i=="number"?ht(i):typeof i=="function"?i:this._passThrough(r)};return new qe(n("x"),n("y"),n("width"),n("height"))}translate(e,n){return e===0&&n===0?this:new qe(this._offset("x",e),this._offset("y",n),this._passThrough("width"),this._passThrough("height"))}translateBy(e){return this.translate(e.x,e.y)}expand(e,n=1){return e.left==0&&e.top==0&&e.right==0&&e.bottom==0?this:new qe(e.left?this._offset("x",-e.left*n):this._passThrough("x"),e.top?this._offset("y",-e.top*n):this._passThrough("y"),e.width?this._offset("width",e.width*n):this._passThrough("width"),e.height?this._offset("height",e.height*n):this._passThrough("height"))}shrink(e){return this.expand(e,-1)}intersect(e){return this===e||e==null?this:new qe(()=>Math.max(this.x,e.x),()=>Math.max(this.y,e.y),()=>Math.min(this.x2,e.x2)-Math.max(this.x,e.x),()=>Math.min(this.y2,e.y2)-Math.max(this.y,e.y))}union(e){return this===e||e==null?this:new qe(()=>Math.min(this.x,e.x),()=>Math.min(this.y,e.y),()=>Math.max(this.x2,e.x2)-Math.min(this.x,e.x),()=>Math.max(this.y2,e.y2)-Math.min(this.y,e.y))}isDefined(){return this.width>=0&&this.height>=0}flatten(){return new qe(ht(this.x),ht(this.y),ht(this.width),ht(this.height))}containsPoint(e,n){return e>=this.x&&e<this.x2&&n>=this.y&&n<this.y2}normalizePoint(e,n){return{x:(e-this.x)/this.width,y:(n-this.y)/this.height}}toString(){return`Rectangle: x: ${this.x}, y: ${this.y}, width: ${this.width}, height: ${this.height}`}toRoundedString(){return`Rectangle: x: ${Math.round(this.x)}, y: ${Math.round(this.y)}, width: ${Math.round(this.width)}, height: ${Math.round(this.height)}`}};fe(qe,"ZERO",qe.create(0,0,0,0));let vt=qe;class mp{constructor(e){this.globalOptions=e}pushView(e,n){}popView(e){}renderMark(e,n){}}class wf extends mp{constructor(e,n){super(e),this.webGLHelper=n,this.buffer=[],this.coords=void 0,this.views=new Set}pushView(e,n){this.views.add(e),this.coords=n}renderMark(e,n){if(this.globalOptions.picking&&!e.isPickingParticipant())return;const r=e.render(n);r&&this.buffer.push({mark:e,callback:r,coords:this.coords,clipRect:n.clipRect})}render(){if(this.batch||this._buildBatch(),this.batch.length==0)return;const e=this.webGLHelper.gl,n=this.globalOptions.picking;e.bindFramebuffer(e.FRAMEBUFFER,n?this.webGLHelper._pickingBufferInfo.framebuffer:null),this.webGLHelper.clearAll();for(const r of this.views)r.onBeforeRender();for(const r of this.batch)r();n&&e.bindFramebuffer(e.FRAMEBUFFER,null)}_buildBatch(){this.batch=[];let e=!0,n=!0;const r=o=>()=>{e&&o()},i=o=>()=>{e&&n&&o()},s=uo(this.buffer.reverse(),o=>o.mark);for(const[o,a]of[...s.entries()].reverse()){if(!o.isReady())continue;this.batch.push(()=>{e=o.unitView.getEffectiveOpacity()>0}),this.batch.push(...o.prepareRender(this.globalOptions).map(u=>r(u)));let c;for(const u of a){const f=u.coords;f.equals(c)||this.batch.push(r(()=>{n=o.setViewport(f,u.clipRect)})),this.batch.push(i(u.callback)),c=u.coords}}}}class $S extends mp{constructor(...e){super({}),this.contexts=e}pushView(e,n){for(const r of this.contexts)r.pushView(e,n)}popView(e){for(const n of this.contexts)n.popView(e)}renderMark(e,n){for(const r of this.contexts)r.renderMark(e,n)}}class VS{constructor(e,n){this.point=e,this.uiEvent=n,this.stopped=!1,this.target=void 0}stopPropagation(){this.stopped=!0}get type(){return this.uiEvent.type}}class GS{constructor(e,n){this.x=e,this.y=n}equals(e){return e?e===this||e.x===this.x&&e.y===this.y:!1}}const HS=t=>new Promise(e=>setTimeout(e,t));function qS(t){const e=t.requestAnimationFrame||window.requestAnimationFrame,n=t.signal,r=()=>new Promise((i,s)=>{if(n!=null&&n.aborted)return s("aborted");const o=performance.now(),a=o+(t.duration||1e3),c=typeof t.from=="number"?t.from:0,u=typeof t.to=="number"?t.to:1,f=t.easingFunction||(m=>m),l=m=>(m-o)/(a-o),h=m=>m*(u-c)+c,p=m=>Math.max(0,Math.min(1,m)),d=m=>{n!=null&&n.aborted?s("aborted"):(t.onUpdate(h(f(p(l(m))))),m<a?e(d):(t.onUpdate(h(f(1))),i()))};e(d)});return t.delay?n!=null&&n.aborted?Promise.reject("aborted"):HS(t.delay).then(r):r()}class WS{constructor(e){this._renderCallback=e,this._renderRequested=!1,this._warn=!1,this.transitions=[]}requestTransition(e){this.cancelTransition(e),this.transitions.push(e),this.requestRender()}cancelTransition(e){const n=this.transitions.indexOf(e);n>=0&&this.transitions.splice(n,1)}requestRender(){this._renderRequested?this._warn&&console.warn("Render already requested!"):(this._renderRequested=!0,window.requestAnimationFrame(e=>{this._renderRequested=!1;const n=this.transitions;this.transitions=[];let r;for(;r=n.shift();)r(e);this._renderCallback(e)}))}transition(e){return qS({requestAnimationFrame:n=>this.requestTransition(n),...e})}}class jS{constructor(e){this.genomes=new Map,this.baseUrl=e}async initialize(e){const n=new cC(e);return this.genomes.set(n.name,n),Promise.all([...this.genomes.values()].map(r=>r.load(this.baseUrl)))}getGenome(e){if(!this.genomes.size)throw new Error("No genomes have been configured!");if(e){const n=this.genomes.get(e);if(!n)throw new Error(`No genome with the name ${e} has been configured!`);return n}else{if(this.genomes.size>1)throw new Error("Cannot pick a default genome! More than one have been configured!");return this.genomes.values().next().value}}}const YS=""+new URL("Lato-Regular-e459d1f9.png",import.meta.url).href,XS={thin:100,light:300,regular:400,normal:400,medium:500,bold:700,black:900};class KS{constructor(e){this._webGLHelper=e,this.fontRepository="https://raw.githubusercontent.com/etiennepinchon/aframe-fonts/master/fonts/",this._fonts=new Sn([],JSON.stringify),this._metadataPromises=new Map,this._fontPromises=new Map,this._promises=[],this._defaultFontEntry={metrics:oc(op),texture:e?this._createTextureNow(YS):void 0}}async waitUntilReady(){await Promise.all(this._promises)}getFont(e,n="normal",r="regular"){if(V(r)&&(r=XS[r.toLowerCase()],!r))throw new Error("Unknown font weight: "+r);const i={family:e,style:n,weight:r};let s=this._fonts.get(i);return s||(s={metrics:void 0,texture:void 0},this._fonts.set(i,s),this._promises.push(this._loadFontEntry(s,i))),s}async _loadFontEntry(e,n){try{const r=await this._loadMetadata(n.family),i=ZS(r,n),s=this.fontRepository+vf(n.family)+"/"+i.replace(/\.\w+/,""),o=this._createTexture(s+".png"),a=this._loadFont(s+".json");e.texture=await o,e.metrics=await a}catch(r){console.log("Cannot load font. Using default.",r),e.metrics=this._defaultFontEntry.metrics,e.texture=this._defaultFontEntry.texture}}_loadFont(e){let n=this._fontPromises.get(e);return n||(n=fetch(e).then(r=>{if(!r.ok)throw new Error("Could not load font: "+r.status);return r}).then(r=>r.json()).then(r=>oc(r)),this._fontPromises.set(e,n)),n}_loadMetadata(e){const n=vf(e);let r=this._metadataPromises.get(n);return r||(r=fetch(this.fontRepository+n+"/METADATA.pb").then(i=>{if(!i.ok)throw new Error("Could not load font metadata: "+i.status);return i}).then(i=>i.text()).then(i=>JS(i)).catch(i=>{console.warn(i)}),this._metadataPromises.set(n,r)),r}getDefaultFont(){return this._defaultFontEntry}_createTexture(e){const n=this._webGLHelper.gl;return new Promise((r,i)=>{di(n,{src:e,min:n.LINEAR},(s,o,a)=>{s?i(s):r(o)})})}_createTextureNow(e){const n=this._webGLHelper.gl;let r;const i=new Promise((s,o)=>{r=di(n,{src:e,min:n.LINEAR},(a,c,u)=>{a?o(a):s(c)})});return this._promises.push(i),r}}function vf(t){return t.toLowerCase().replaceAll(/[^\w]/g,"")}function JS(t){const e=t.split(`
`),n=[];let r;for(const i of e)if(i.startsWith("fonts {")&&(r={name:void 0,style:void 0,weight:void 0,filename:void 0,post_script_name:void 0,full_name:void 0,copyright:void 0}),i.startsWith("}")&&(n.push(r),r=void 0),r){let s=i.match(/^\s*([A-Za-z_]+):[ ]?"(.*)"$/);if(s){const o=s[1];r[o]=s[2]}if(s=i.match(/^\s*([A-Za-z_]+):[ ]?(\d+)$/),s){const o=s[1];r[o]=+s[2]}}return n}function ZS(t,e){let n,r=Number.POSITIVE_INFINITY;for(const i of t)if(e.family.localeCompare(i.name,void 0,{sensitivity:"accent"})==0&&e.style==i.style){const s=Math.abs(e.weight-i.weight);s<r&&(r=s,n=i)}return n==null?void 0:n.filename}function QS(t,e){const n=[];let r;for(const i of t.split(`
`))if(i.startsWith(">"))r={identifier:i.match(/>(\S+)/)[1],sequence:""},n.push(r);else if(r)r.sequence+=i.trim();else throw new Error("Invalid fasta file!");return n}class e3{constructor(e,n){this.animator=e,this.disabled=!!n,this.damping=.015,this.acceleration=.3,this.accelerationThreshold=100,this.lowerLimit=.5,this.loop=!1,this.momentum=0,this.timestamp=0,this.callback=null,this._transitionCallback=this.animate.bind(this),this.clear()}clear(){this.momentum=0,this.timestamp=null,this.loop=null,this.callback=null}cancel(){this.loop&&(this.animator.cancelTransition(this._transitionCallback),this.clear())}setMomentum(e,n){if(this.disabled){n(e);return}e*this.momentum<0?this.momentum=0:Math.abs(e)>this.accelerationThreshold?this.momentum=jf([this.momentum,e],this.acceleration):this.momentum=e,this.callback=n,this.loop||this.animate()}animate(e){this.callback(this.momentum);const n=e-this.timestamp||0;this.timestamp=e;const r=Math.abs(this.momentum);this.momentum=Math.sign(this.momentum)*Math.max(0,r-((r*this.damping)**1.5+.04)*n),Math.abs(this.momentum)>this.lowerLimit?(this.loop=!0,this.animator.requestTransition(this._transitionCallback)):this.clear()}}function t3(t){const e={},n=["string","number","boolean"],r=["wheelDelta","wheelDeltaX","wheelDeltaY"];for(const i in t){const s=i;!r.includes(i)&&n.includes(typeof t[s])&&(e[s]=t[s])}return e}const Ef=new Map;async function n3(t,e,n){const r=t.symbol;let i=Ef.get(r)??await s3(t.symbol);return i?(Ef.set(r,i),te`<div class="title"><strong>${i.name}</strong> ${i.description}</div><p class="summary">${i.summary}</p><p class="source">Source: NCBI RefSeq Gene</p>`):null}async function r3(t){console.log("Searching: "+t);const e={mode:"cors"},r=(await fetch(`https://eutils.ncbi.nlm.nih.gov/entrez/eutils/esearch.fcgi?db=gene&term=${t}[GENE]&sort=relevance&retmode=json`,e).then(i=>i.json())).esearchresult.idlist[0];return r?(await fetch(`https://eutils.ncbi.nlm.nih.gov/entrez/eutils/esummary.fcgi?db=gene&id=${r}&retmode=json`,e).then(o=>o.json())).result[r]:null}const i3=Wo(r3,500);function s3(t){return i3(t)}const o3=ue(".4~r"),a3=ue(".4~e");function gp(t){return t==null?te`<span class="na">NA</span>`:V(t)?t.substring(0,30):Number.isInteger(t)?""+t:be(t)?Math.abs(t)>Math.pow(10,8)||Math.abs(t)<Math.pow(10,-8)?a3(t):o3(t):_i(t)?t?"True":"False":Me(t)?te`${t.map((e,n)=>[gp(e),n<t.length-1?", ":J])}`:"?"+typeof t+" "+t}async function c3(t,e,n){const r=(c,u)=>{var f;for(const[l,h]of Object.entries(e.encoders))if((f=h==null?void 0:h.accessor)!=null&&f.fields.includes(c))switch(l){case"color":case"fill":case"stroke":return te`<span class="color-legend" style="${`background-color: ${h(u)}`}"></span>`}return""},i=Object.entries(t).filter(([c,u])=>!c.startsWith("_"));if(i.length===0)return;const s=te`<table class="attributes">${i.map(([c,u])=>te`<tr><th>${c}</th><td>${gp(u)} ${r(c,t)}</td></tr>`)}</table>`,o=e.unitView.getTitleText(),a=o?te`<div class="title"><strong>${o}</strong></div>`:"";return te`${a}${s}`}var gt;class ts extends Mn{constructor(n,r,i,s,o,a){super(n,r,i,s,o,a);M(this,gt,[]);this.spec=n,this.needsAxes={x:!0,y:!0}}async initializeChildren(){he(this,gt,await Promise.all(this.spec.layer.map((n,r)=>this.context.createOrImportView(n,this,this,"grid"+r,i=>{if(!Cc(i)&&!Ec(i))throw new vn("LayerView accepts only unit or layer specs as children!",this)}))))}get children(){return S(this,gt).slice()}*[Symbol.iterator](){for(const n of S(this,gt))yield n}render(n,r,i={}){if(this.isConfiguredVisible()){n.pushView(this,r);for(const s of S(this,gt))s.render(n,r,i);n.popView(this)}}propagateInteractionEvent(n){this.handleInteractionEvent(void 0,n,!0);for(let r=S(this,gt).length-1;r>=0;r--)if(S(this,gt)[r].propagateInteractionEvent(n),n.stopped)return;this.handleInteractionEvent(void 0,n,!1)}}gt=new WeakMap;class Cf{constructor(e,n){this.n=e,this.maxCols=n??1/0}get nRows(){return this.maxCols==1/0?1:Math.ceil(this.n/this.maxCols)}get nCols(){return Math.min(this.n,this.maxCols)}get rowIndices(){const e=[],n=this.nCols,r=this.nRows;for(let i=0;i<r;i++){const s=[];e.push(s);for(let o=0;o<n;o++){const a=i*n+o;a<this.n&&s.push(a)}}return e}get colIndices(){const e=[],n=this.nCols,r=this.nRows;for(let i=0;i<n;i++){const s=[];e.push(s);for(let o=0;o<r;o++){const a=o*n+i;a<this.n&&s.push(a)}}return e}getCellIndex(e,n){let r=0;if(this.maxCols==1/0)r=n==0?e:void 0;else{if(e>=this.maxCols)return;r=n*this.nCols+e}return r<this.n?r:void 0}getCellCoords(e){if(!(e<0||e>=this.n))return[e%this.nCols,Math.floor(e/this.nCols)]}}const u3="chromosome_ticks_and_labels",l3={x:"width",y:"height"};function bc(t){return t=="x"?"y":"x"}const Xs={x:["bottom","top"],y:["left","right"]},_u=Object.fromEntries(Object.entries(Xs).map(([t,e])=>e.map(n=>[n,t])).flat(1));function zt(t){return _u[t]}class xp extends ts{constructor(e,n,r,i,s,o){const a=n=="locus",c={...a?h3:yp,...f3(n,e),...e};super(a?d3(c,n):bp(c,n),r,i,s,`axis_${e.orient}`,{blockEncodingInheritance:!0,contributesToScaleDomain:!1,...o}),this.axisProps=c}getSize(){const e={px:this.getPerpendicularSize()},n={grow:1};return _u[this.axisProps.orient]=="x"?new Nt(n,e):new Nt(e,n)}getPerpendicularSize(){return Ru(this.axisProps)}isPickingSupported(){return!1}}function Ru(t){const e=zt(t.orient);let n=t.ticks&&t.tickSize||0;return t.labels&&(n+=t.labelPadding,e=="x"?n+=t.labelFontSize:n+=30),t.title&&(n+=t.titlePadding+t.titleFontSize),n=Math.min(t.maxExtent||1/0,Math.max(t.minExtent||0,n)),n}const yp={values:null,minExtent:20,maxExtent:1/0,offset:0,domain:!0,domainWidth:1,domainColor:"gray",domainDash:null,domainDashOffset:0,domainCap:"square",ticks:!0,tickSize:5,tickWidth:1,tickColor:"gray",tickDash:null,tickDashOffset:0,tickCap:"square",tickCount:null,tickMinStep:null,labels:!0,labelAlign:"center",labelBaseline:"middle",labelPadding:4,labelFontSize:10,labelLimit:180,labelColor:"black",format:null,titleColor:"black",titleFont:"sans-serif",titleFontSize:10,titlePadding:3};function f3(t,e){const n=e.orient,r=t=="nominal"||t=="ordinal";let i="center",s="middle",o=e.labelAngle??((n=="top"||n=="bottom")&&r?-90:0);switch(n){case"left":i="right";break;case"right":i="left";break;case"top":case"bottom":Math.abs(o)>30?(i=o>0==(n=="bottom")?"left":"right",s="middle"):s=n=="top"?"alphabetic":"top";break}return{labelAlign:i,labelAngle:o,labelBaseline:s}}function bp(t,e){const n={...t,extent:Ru(t)},r=zt(n.orient),i=bc(r),s=n.orient=="bottom"||n.orient=="right"?1:-1,o=n.orient=="bottom"||n.orient=="left"?1:0,a=()=>({name:"domain",data:{values:[0]},mark:{type:"rule",clip:!1,strokeDash:n.domainDash,strokeCap:n.domainCap,color:n.domainColor,[i]:o,size:n.domainWidth}}),c=()=>({name:"labels",mark:{type:"text",clip:!1,align:n.labelAlign,angle:n.labelAngle,baseline:n.labelBaseline,[i+"Offset"]:(n.tickSize+n.labelPadding)*s,[i]:o,size:n.labelFontSize,color:n.labelColor,minBufferSize:1500},encoding:{[r]:{field:"value",type:e},text:{field:"label"}}}),u=()=>({name:"ticks",mark:{type:"rule",clip:!1,strokeDash:n.tickDash,strokeCap:n.tickCap,color:n.tickColor,size:n.tickWidth,minBufferSize:300},encoding:{[i]:{value:o},[i+"2"]:{value:o-n.tickSize/n.extent*(o?1:-1)}}}),f=()=>({name:"title",data:{values:[0]},mark:{type:"text",clip:!1,align:"center",baseline:n.orient=="bottom"?"bottom":"top",angle:[0,90,0,-90][["top","right","bottom","left"].indexOf(n.orient)],text:n.title,color:n.titleColor,[r]:.5,[i]:1-o}}),l=()=>{const p={name:"ticks_and_labels",encoding:{[r]:{field:"value",type:e}},layer:[]};return n.ticks&&p.layer.push(u()),n.labels&&p.layer.push(c()),p},h={resolve:{scale:{[r]:"forced"}},[l3[bc(r)]]:n.extent,data:{lazy:{type:"axisTicks",channel:r,axis:t}},layer:[]};return n.domain&&h.layer.push(a()),(n.ticks||n.labels)&&h.layer.push(l()),n.title&&h.layer.push(f()),h}const h3={...yp,chromTicks:!0,chromTickSize:18,chromTickWidth:1,chromTickColor:"#989898",chromTickDash:[4,2],chromTickDashOffset:1,chromLabels:!0,chromLabelFontSize:13,chromLabelFontWeight:"normal",chromLabelFontStyle:"normal",chromLabelColor:"black",chromLabelAlign:"left",chromLabelPadding:7};function d3(t,e){const n={...t,extent:Ru(t)},r=zt(n.orient),i=bc(r),s=n.orient=="bottom"||n.orient=="left"?1:0,o=()=>({name:"chromosome_ticks",mark:{type:"rule",strokeDash:t.chromTickDash,strokeDashOffset:t.chromTickDashOffset,[i]:s,[i+"2"]:s-n.chromTickSize/n.extent*(s?1:-1),color:t.chromTickColor,size:n.chromTickWidth}}),a=()=>{let f;switch(n.orient){case"top":f={y:0,angle:0,paddingX:4,dy:-n.chromLabelPadding,viewportEdgeFadeWidthLeft:20,viewportEdgeFadeWidthRight:20,viewportEdgeFadeDistanceRight:-10,viewportEdgeFadeDistanceLeft:-20};break;case"bottom":f={y:1,angle:0,paddingX:4,dy:n.chromLabelPadding+n.chromLabelFontSize*.73,viewportEdgeFadeWidthLeft:20,viewportEdgeFadeWidthRight:20,viewportEdgeFadeDistanceRight:-10,viewportEdgeFadeDistanceLeft:-20};break;case"left":f={x:1,angle:-90,paddingY:4,dy:-n.chromLabelPadding,viewportEdgeFadeWidthBottom:20,viewportEdgeFadeWidthTop:20,viewportEdgeFadeDistanceBottom:-20,viewportEdgeFadeDistanceTop:-10};break;case"right":f={x:0,angle:90,align:"right",paddingY:4,dy:-n.chromLabelPadding};break;default:f={}}return{name:"chromosome_labels",mark:{type:"text",size:n.chromLabelFontSize,font:n.chromLabelFont,fontWeight:n.chromLabelFontWeight,fontStyle:n.chromLabelFontStyle,color:n.chromLabelColor,align:t.chromLabelAlign,baseline:"alphabetic",clip:!1,...f},encoding:{[r+"2"]:{field:"continuousEnd",type:e},text:{field:"name"}}}};let c;switch(n.orient){case"bottom":case"top":c={};break;case"left":c={labelAngle:-90,labelAlign:"center",labelPadding:6};break;case"right":c={labelAngle:90,labelAlign:"center",labelPadding:6};break;default:c={}}const u=bp({...t,...c},e);if(t.chromTicks||t.chromLabels){const f={name:u3,data:{lazy:{type:"axisGenome",channel:zt(n.orient)}},encoding:{[r]:{field:"continuousStart",type:e,band:0}},layer:[]};if(t.chromTicks&&f.layer.push(o()),t.chromLabels){f.layer.push(a());let l;u.layer.filter(h=>h.name=="ticks_and_labels").forEach(h=>h.layer.filter(p=>p.name=="labels").forEach(p=>{l=p.mark})),l&&(n.orient=="top"||n.orient=="bottom"?(l.viewportEdgeFadeWidthLeft=30,l.viewportEdgeFadeDistanceLeft=40):(l.viewportEdgeFadeWidthBottom=30,l.viewportEdgeFadeDistanceBottom=40))}u.layer.push(f)}return u}class p3 extends ts{constructor(e,n,r,i,s,o){const c={...n=="locus"?m3:Ap,...e};super(b3(c,n),r,i,s,`axisGrid_${e.orient}`,{blockEncodingInheritance:!0,contributesToScaleDomain:!1,...o}),this.axisProps=c}getOrient(){return this.axisProps.orient}isPickingSupported(){return!1}}const Ap={values:null,grid:!1,gridCap:"butt",gridColor:"lightgray",gridDash:null,gridOpacity:1,gridWidth:1,tickCount:null,tickMinStep:null},m3={...Ap,chromGrid:!1,chromGridCap:"butt",chromGridColor:"gray",chromGridDash:[1,5],chromGridOpacity:1,chromGridWidth:1};function g3(t,e){const n=t,r=zt(n.orient);return{name:"grid_lines",data:{lazy:{type:"axisTicks",channel:r,axis:t}},mark:{type:"rule",strokeDash:n.gridDash,strokeCap:n.gridCap,color:n.gridColor,size:n.gridWidth,opacity:n.gridOpacity,minBufferSize:300},encoding:{[r]:{field:"value",type:e}}}}function x3(t,e){const n=t,r=zt(n.orient);return{name:"chromosome_lines",data:{lazy:{type:"axisGenome",channel:r}},mark:{type:"rule",strokeDash:n.chromGridDash,strokeCap:n.chromGridCap,color:n.chromGridColor,size:n.chromGridWidth,opacity:n.chromGridOpacity},encoding:{[r]:{field:"continuousStart",type:e,band:0}}}}function y3(t,e){const n=t,r=zt(n.orient);return{name:"chromosome_fill",data:{lazy:{type:"axisGenome",channel:r}},mark:{type:"rect"},encoding:{[r]:{field:"continuousStart",type:e,band:0},[r+"2"]:{field:"continuousEnd",band:0},fill:{field:"odd",type:"nominal",scale:{domain:[!1,!0],range:[n.chromGridFillEven??"white",n.chromGridFillOdd??"white"]}},opacity:{field:"odd",type:"nominal",scale:{type:"ordinal",domain:[!1,!0],range:[n.chromGridFillEven?1:0,n.chromGridFillOdd?1:0]}}}}}function b3(t,e){const n={...t},r=[];return n.chromGrid&&(n.chromGridFillOdd||n.chromGridFillEven)&&r.push(y3(n,e)),n.chromGrid&&n.chromGridOpacity>0&&r.push(x3(n,e)),n.grid&&n.gridOpacity>0&&r.push(g3(n,e)),{name:"grid_layers",configurableVisibility:!1,resolve:{scale:{[zt(t.orient)]:"forced",fill:"independent",opacity:"independent"}},layer:r}}const Sf={anchor:"middle",frame:"group",offset:10,orient:"top",align:void 0,angle:0,baseline:"alphabetic",dx:0,dy:0,color:void 0,font:void 0,fontSize:12,fontStyle:"normal",fontWeight:"normal"},A3={orient:"left",anchor:"middle",align:"right",baseline:"middle",angle:0,fontSize:12},w3={orient:"top",anchor:"start",align:"left",baseline:"top",offset:-10,dx:10,fontSize:12},v3={start:0,middle:.5,end:1},E3={start:"left",middle:"center",end:"right"};function C3(t){if(!t)return;const e=V(t)?{text:t}:t;if(!e.text||e.orient=="none")return;const n={"track-title":A3,overlay:w3}[e.style]??{},r={...Sf,...n,...e};let i={},s={x:0,y:0};const o=v3[r.anchor??"middle"];switch(r.orient){case"top":s={x:o,y:1},i={baseline:"alphabetic",angle:0};break;case"right":s={x:1,y:1-o},i={baseline:"alphabetic",angle:90};break;case"bottom":s={x:o,y:0},i={baseline:"top",angle:0};break;case"left":s={x:0,y:o},i={baseline:"alphabetic",angle:-90};break}const a={...Sf,...i,...n,...e},c={xOffset:0,yOffset:0};switch(r.orient){case"top":c.yOffset=-a.offset;break;case"right":c.xOffset=a.offset;break;case"bottom":c.yOffset=a.offset;break;case"left":c.xOffset=-a.offset;break}return{configurableVisibility:!1,data:{values:[{}]},mark:{type:"text",tooltip:null,clip:!1,...s,...c,text:a.text,align:a.align??E3[a.anchor],angle:a.angle,baseline:a.baseline,dx:a.dx,dy:a.dy,color:a.color,font:a.font,size:a.fontSize,fontStyle:a.fontStyle,fontWeight:a.fontWeight}}}function S3(t,e,n,r){if(t.type=="wheel"){t.uiEvent.preventDefault();const i=t.uiEvent,s=i.deltaMode?120:1;let{x:o,y:a}=t.point;if(r){const c=r.mark.encoders;c.x&&!c.x2&&!c.x.constantValue&&(o=+c.x(r.datum)*e.width+e.x),c.y&&!c.y2&&!c.y.constantValue&&(a=(1-+c.y(r.datum))*e.height+e.y)}Math.abs(i.deltaX)<Math.abs(i.deltaY)?n({x:o,y:a,xDelta:0,yDelta:0,zDelta:i.deltaY*s/300}):n({x:o,y:a,xDelta:-i.deltaX*s,yDelta:0,zDelta:0})}else if(t.type=="mousedown"&&t.uiEvent.button===0){const i=t.uiEvent;i.preventDefault();let s=i;const o=c=>{n({x:s.clientX,y:s.clientY,xDelta:c.clientX-s.clientX,yDelta:c.clientY-s.clientY,zDelta:0}),s=c},a=c=>{document.removeEventListener("mousemove",o),document.removeEventListener("mouseup",a)};document.addEventListener("mouseup",a,!1),document.addEventListener("mousemove",o,!1)}}var Zn,Qn,Le,dn,er,xt,sn,eo,wp,pn,Or,Si,Ac,Fi,wc,Ti,vc,to,vp,tr,vs,no,Ep;class F3 extends Mn{constructor(n,r,i,s,o,a,c){super(n,r,i,s,o,c);M(this,xt);M(this,eo);M(this,pn);M(this,Si);M(this,Fi);M(this,Ti);M(this,to);M(this,tr);M(this,no);M(this,Zn,1/0);M(this,Qn,10);M(this,Le,[]);M(this,dn,{});M(this,er,0);this.spec=n,he(this,Qn,n.spacing??10),he(this,Zn,a),he(this,Le,[]),this.wrappingFacet=!1}appendChild(n){n.layoutParent??(n.layoutParent=this),S(this,Le).push(new Tf(n,this,S(this,er))),Ou(this,er)._++}setChildren(n){he(this,Le,[]);for(const r of n)this.appendChild(r)}replaceChild(n,r){const i=S(this,Le).findIndex(s=>s.view==n);if(i>=0)S(this,Le)[i]=new Tf(r,this,S(this,er));else throw new Error("Not my child view!")}get children(){return S(this,Le).map(n=>n.view)}get childCount(){return S(this,Le).length}async createAxes(){const n=[];for(const r of br){const i=this.resolutions.axis[r];if(i){const s=i.getAxisProps();if(s){const o={title:i.getTitle(),orient:Xs[r][0],...s},a=new xp(o,i.scaleResolution.type,this.context,this,this);n.push(a.initializeChildren()),S(this,dn)[r]=a}}}return Promise.all([...n,...S(this,Le).map(r=>r.createAxes())])}*[Symbol.iterator](){for(const n of S(this,Le))yield*n.getChildren();for(const n of Object.values(S(this,dn)))yield n}getOverhang(){return I(this,to,vp).call(this).union(I(this,tr,vs).call(this))}getSize(){return this._cache("size",()=>new Nt(I(this,Fi,wc).call(this,"column"),I(this,Fi,wc).call(this,"row")).addPadding(I(this,tr,vs).call(this)))}render(n,r,i={}){if(!this.isConfiguredVisible())return;this.layoutParent||(r=r.shrink(this.getPadding())),r=r.shrink(I(this,tr,vs).call(this)),n.pushView(this,r);const s={devicePixelRatio:this.context.devicePixelRatio},o=cf(I(this,Si,Ac).call(this,"column"),r.width,s),a=cf(I(this,Si,Ac).call(this,"row"),r.height,s),c=new Cf(S(this,xt,sn).length,S(this,Zn)??1/0),u=f=>Math.round(f*devicePixelRatio)/devicePixelRatio;for(const[f,l]of S(this,xt,sn).entries()){const{view:h,axes:p,gridLines:d,background:m,backgroundStroke:g,title:x}=l,[b,A]=c.getCellCoords(f),E=o[I(this,Ti,vc).call(this,"column",b)],F=a[I(this,Ti,vc).call(this,"row",A)],C=h.getViewportSize(),w=h.getSize(),L=h.getOverhang(),Y=E.location-L.left,j=F.location-L.top,_=(oe,Ze)=>(oe[Ze].grow?(Ze=="width"?E:F).size:oe[Ze].px)+L[Ze],ee=_(C,"width"),le=_(C,"height"),Ve=_(w,"width"),Kt=_(w,"height"),lt=l.scrollbars.horizontal,ft=l.scrollbars.vertical,Tt=lt?()=>u(lt.viewportOffset):()=>0,Be=ft?()=>u(ft.viewportOffset):()=>0,ke=new vt(()=>r.x+Y,()=>r.y+j,()=>ee,()=>le),ns=h.isScrollable(),Jt=ns?new vt(()=>r.x+Y-Tt(),()=>r.y+j-Be(),()=>Ve,()=>Kt):ke;l.coords=ke;const Er=i.clipRect?ke.intersect(i.clipRect):ke;m==null||m.render(n,Er,{...i,clipRect:void 0});for(const oe of Object.values(d))oe.render(n,ke,i);const rs=_3(h)||ns;rs&&h.render(n,Jt,{...i,clipRect:Er}),g==null||g.render(n,Er,{...i,clipRect:void 0});for(const[oe,Ze]of Object.entries(p)){const Ge=oe=="left"||oe=="right"?"vertical":"horizontal",Cr=l.scrollbars[Ge],T=Cr?ke.modify(Ge=="vertical"?{y:()=>Jt.y,height:Kt}:{x:()=>Jt.x,width:Ve}):ke,B=Ff(T,oe,Ze);let k=i.clipRect;Cr&&(k=B.intersect(k).intersect(Cr?ke.modify(Ge=="vertical"?{x:-1e5,width:2e5}:{y:-1e5,height:2e5}):void 0)),Ze.render(n,B,{...i,clipRect:k})}for(const oe of Object.values(S(this,dn))){const Ge=oe.axisProps.orient;(Ge=="left"&&b==0||Ge=="right"&&b==c.nCols-1||Ge=="top"&&A==0||Ge=="bottom"&&A==c.nRows-1)&&oe.render(n,Ff(ke.shrink(l.view.getOverhang()),Ge,oe),i)}rs||h.render(n,Jt,i);for(const oe of Object.values(l.scrollbars))oe.updateScrollbar(ke,Jt),oe.render(n,r,i);x==null||x.render(n,ke,i)}n.popView(this)}propagateInteractionEvent(n){if(this.handleInteractionEvent(void 0,n,!0),n.stopped)return;const r=S(this,xt,sn).find(s=>s.coords.containsPoint(n.point.x,n.point.y));for(const s of Object.values((r==null?void 0:r.scrollbars)??{}))if(s.coords.containsPoint(n.point.x,n.point.y)&&(s.propagateInteractionEvent(n),n.stopped))return;const i=r==null?void 0:r.view;i&&(i.propagateInteractionEvent(n),(i instanceof Ne||i instanceof ts)&&S3(n,r.coords,s=>I(this,no,Ep).call(this,r.coords,r.view,s),this.context.getCurrentHover())),!n.stopped&&this.handleInteractionEvent(void 0,n,!1)}getDefaultResolution(n,r){return"independent"}}Zn=new WeakMap,Qn=new WeakMap,Le=new WeakMap,dn=new WeakMap,er=new WeakMap,xt=new WeakSet,sn=function(){return S(this,Le).filter(n=>n.view.isConfiguredVisible())},eo=new WeakSet,wp=function(){return new Cf(S(this,xt,sn).length,S(this,Zn)??1/0)},pn=new WeakSet,Or=function(n){const r=n=="column"?"width":"height",i=(s,o)=>s.map(a=>{const u=S(this,xt,sn)[a].getOverhangAndPadding();return n=="column"?o?u.right:u.left:o?u.bottom:u.top}).reduce((a,c)=>Math.max(a,c),0);return this._cache(`size/directionSizes/${n}`,()=>S(this,eo,wp)[n=="column"?"colIndices":"rowIndices"].map(s=>({axisBefore:i(s,0),axisAfter:i(s,1),view:DE(s.map(o=>S(this,xt,sn)[o].view.getViewportSize()[r]))})))},Si=new WeakSet,Ac=function(n){const r=I(this,pn,Or).call(this,n),i=[];i.push(Ur);for(const[s,o]of r.entries())s>0&&i.push({px:S(this,Qn),grow:0}),(s==0||this.wrappingFacet)&&i.push(Ur),i.push({px:o.axisBefore,grow:0}),i.push(o.view),i.push({px:o.axisAfter,grow:0}),(s==r.length-1||this.wrappingFacet)&&i.push(Ur);return i},Fi=new WeakSet,wc=function(n){let r=0,i=0;const s=n=="row"?this.spec.height:this.spec.width;if(s||s===0)return Vd(s);const o=I(this,pn,Or).call(this,n);for(const[a,c]of o.entries())a>0&&(i+=S(this,Qn)),(a==0||this.wrappingFacet)&&(i+=0),i+=c.axisBefore,i+=c.view.px??0,r+=c.view.grow??0,i+=c.axisAfter,(a==o.length-1||this.wrappingFacet)&&(i+=0);return{px:i,grow:r}},Ti=new WeakSet,vc=function(n,r){return n=="row"&&this.wrappingFacet?1+6*r+2:2+4*r+1},to=new WeakSet,vp=function(){const n=I(this,pn,Or).call(this,"column"),r=I(this,pn,Or).call(this,"row");return!n.length||!r.length?pe.zero():new pe(r.at(0).axisBefore,n.at(-1).axisAfter,r.at(-1).axisAfter,n.at(0).axisBefore)},tr=new WeakSet,vs=function(){const n=r=>{const i=_u[r],s=S(this,dn)[i];return(s==null?void 0:s.axisProps.orient)!==r?0:Math.max(s.getPerpendicularSize()+s.axisProps.offset,0)};return new pe(n("top"),n("right"),n("bottom"),n("left"))},no=new WeakSet,Ep=function(n,r,i){for(const[s,o]of Object.entries(I3(r))){if(o.size<=0)continue;const a=n.normalizePoint(i.x,i.y),c=n.normalizePoint(i.x+i.xDelta,i.y+i.yDelta),u={x:c.x-a.x,y:c.y-a.y};for(const f of o)f.zoom(2**i.zDelta,s=="y"?1-a[s]:a[s],s=="x"?u.x:-u.y)}this.context.animator.requestRender()};function T3(t){if(!(!t||!t.fill||t.fillOpacity===0))return{configurableVisibility:!1,data:{values:[{}]},mark:{color:t.fill,opacity:t.fillOpacity??1,type:"rect",clip:!1,tooltip:null,minHeight:1,minOpacity:0}}}function D3(t){if(!(!t||!t.stroke||t.strokeWidth===0||t.strokeOpacity===0))return{configurableVisibility:!1,resolve:{scale:{x:"excluded",y:"excluded"},axis:{x:"excluded",y:"excluded"}},data:{values:[{x:0,y:0,x2:1,y2:0},{x:1,y:0,x2:1,y2:1},{x:1,y:1,x2:0,y2:1},{x:0,y:1,x2:0,y2:0}]},mark:{size:t.strokeWidth??1,color:t.stroke??"lightgray",strokeCap:"square",strokeOpacity:t.strokeOpacity??1,type:"rule",clip:!1,tooltip:null},encoding:{x:{field:"x",type:"quantitative",scale:null},y:{field:"y",type:"quantitative",scale:null},x2:{field:"x2"},y2:{field:"y2"}}}}function I3(t){const e={x:new Set,y:new Set};return t.visit(n=>{for(const[r,i]of Object.entries(e)){const s=n.getScaleResolution(r);s&&s.isZoomable()&&i.add(s)}}),e}function _3(t){let e=!0;return t.visit(n=>{n instanceof Ne&&e&&(e=n.mark.properties.clip===!0)}),e}function Ff(t,e,n){const r=n.axisProps,i=n.getPerpendicularSize();if(e=="bottom")return t.translate(0,t.height+r.offset).modify({height:i});if(e=="top")return t.translate(0,-i-r.offset).modify({height:i});if(e=="left")return t.translate(-i-r.offset,0).modify({width:i});if(e=="right")return t.translate(t.width+r.offset,0).modify({width:i})}class Tf{constructor(e,n,r){if(this.layoutParent=n,this.view=e,this.serial=r,this.background=void 0,this.backgroundStroke=void 0,this.axes={},this.gridLines={},this.scrollbars={},this.title=void 0,this.coords=vt.ZERO,e.needsAxes.x||e.needsAxes.y){const i=e.spec,s="view"in i?i==null?void 0:i.view:void 0,o=T3(s);o&&(this.background=new Ne(o,n.context,n,e,"background"+r,{blockEncodingInheritance:!0}));const a=D3(s);a&&(this.backgroundStroke=new Ne(a,n.context,n,e,"backgroundStroke"+r,{blockEncodingInheritance:!0}));const c=C3(e.spec.title);if(c){const u=new Ne(c,n.context,n,e,"title"+r,{blockEncodingInheritance:!0});this.title=u}}e.spec.viewportWidth!=null&&(this.scrollbars.horizontal=new Df(this,"horizontal")),e.spec.viewportHeight!=null&&(this.scrollbars.vertical=new Df(this,"vertical"))}*getChildren(){this.background&&(yield this.background),this.backgroundStroke&&(yield this.backgroundStroke),this.title&&(yield this.title),yield*Object.values(this.axes),yield*Object.values(this.gridLines),yield this.view,yield*Object.values(this.scrollbars)}async createAxes(){const{view:e,axes:n,gridLines:r}=this,i=(a,c)=>{const u=a.getAxisProps();if(u===null)return;const f=u?{...u}:{};if(!f.orient){for(const l of Xs[c])if(!n[l]){f.orient=l;break}if(!f.orient)throw new Error("No slots available for an axis! Perhaps a LayerView has more than two children?")}if(f.title??(f.title=a.getTitle()),!Xs[c].includes(f.orient))throw new Error(`Invalid axis orientation "${f.orient}" on channel "${c}"!`);return f},s=async(a,c,u)=>{const f=i(a,c);if(f){if(n[f.orient])throw new Error(`An axis with the orient "${f.orient}" already exists!`);const l=new xp(f,a.scaleResolution.type,this.layoutParent.context,this.layoutParent,u);n[f.orient]=l,await l.initializeChildren()}},o=async(a,c,u)=>{const f=i(a,c);if(f&&(f.grid||f.chromGrid)){const l=new p3(f,a.scaleResolution.type,this.layoutParent.context,this.layoutParent,u);r[f.orient]=l,await l.initializeChildren()}};for(const a of["x","y"])if(e.needsAxes[a]){const c=e.resolutions.axis[a];if(!c)continue;await s(c,a,e)}for(const a of["x","y"])if(e.needsAxes[a]){const c=e.getAxisResolution(a);if(!c)continue;await o(c,a,e)}if(e instanceof ts){for(const a of e)for(const[c,u]of Object.entries(a.resolutions.axis)){const f=u.getAxisProps();f&&f.orient&&await s(u,c,a)}for(const a of e)for(const[c,u]of Object.entries(a.resolutions.axis)){const f=u.getAxisProps();f&&!f.orient&&await s(u,c,a)}}[...Object.values(n),...Object.values(r)].forEach(a=>a.visit(c=>{c instanceof Ne&&c.resolve("scale")}))}getOverhang(){const e=n=>{const r=this.axes[n];return r?Math.max(r.getPerpendicularSize()+r.axisProps.offset,0):0};return new pe(e("top"),e("right"),e("bottom"),e("left")).add(this.view.getOverhang())}getOverhangAndPadding(){return this.getOverhang().add(this.view.getPadding())}}class Df extends Ne{constructor(e,n){const r={scrollbarSize:8,scrollbarPadding:2};super({data:{values:[{}]},mark:{type:"rect",fill:"#b0b0b0",fillOpacity:.6,stroke:"white",strokeWidth:1,strokeOpacity:1,cornerRadius:5,clip:!1},configurableVisibility:!1},e.layoutParent.context,e.layoutParent,e.view,"scrollbar-"+n,{blockEncodingInheritance:!0}),this.config=r,this.scrollDirection=n,this.viewportOffset=0,this.maxScrollOffset=0,this.scrollbarCoords=vt.ZERO,this.addInteractionEventListener("mousedown",(i,s)=>{if(s.stopPropagation(),this.maxScrollOffset<=0)return;const o=h=>n=="vertical"?h.clientY:h.clientX,a=s.uiEvent;a.preventDefault();const c=this.getScrollOffset(),u=o(a),f=h=>{const p=ai(o(h)-u+c,0,this.maxScrollOffset);this.viewportOffset=p/this.maxScrollOffset*this.maxViewportOffset,this.context.animator.requestRender()},l=()=>{document.removeEventListener("mousemove",f),document.removeEventListener("mouseup",l)};document.addEventListener("mouseup",l,!1),document.addEventListener("mousemove",f,!1)})}getScrollOffset(){return this.viewportOffset/this.maxViewportOffset*this.maxScrollOffset}render(e,n,r){super.render(e,this.scrollbarCoords,r)}updateScrollbar(e,n){const r=this.config.scrollbarPadding,i=this.config.scrollbarSize,s=this.scrollDirection=="horizontal"?"width":"height",o=Math.min(1,e[s]/n[s]),a=e[s]-2*r,c=o*a;this.maxScrollOffset=a-c,this.maxViewportOffset=n[s]-e[s],this.viewportOffset=ai(this.viewportOffset,0,this.maxViewportOffset),this.scrollbarCoords=this.scrollDirection=="vertical"?new vt(()=>e.x+e.width-i-r,()=>e.y+r+this.getScrollOffset(),()=>i,()=>c):new vt(()=>e.x+r+this.getScrollOffset(),()=>e.y+e.height-i-r,()=>c,()=>i)}}class Ca extends F3{constructor(e,n,r,i,s){super(e,n,r,i,s,Sc(e)?e.columns:Es(e)?1:1/0),this.spec=e}async initializeChildren(){const e=this.spec,n=Sc(e)?e.concat:Es(e)?e.vconcat:e.hconcat;this.setChildren(await Promise.all(n.map((r,i)=>this.context.createOrImportView(r,this,this,"grid"+i)))),await this.createAxes()}getDefaultResolution(e,n){return n=="axis"?"independent":Es(this.spec)&&e==="x"||Sp(this.spec)&&e==="y"?"shared":"independent"}}const Cp="viewRoot";var nr;class R3{constructor(e={}){M(this,nr,new Map);this.options={allowImport:!0,wrapRoot:!0,...e};const n=r=>(i,s,o,a,c)=>new r(i,s,o,a,i.name??c);this.addViewType(Cc,n(ts)),this.addViewType(Ec,n(Ne)),this.addViewType(Es,n(Ca)),this.addViewType(Sp,n(Ca)),this.addViewType(Sc,n(Ca)),this.addViewType(B3,()=>{throw new Error("SampleView is not supported by the @genome-spy/core package. Use @genome-spy/app instead!")})}addViewType(e,n){S(this,nr).set(e,n)}createView(e,n,r,i,s){for(const[o,a]of S(this,nr))if(o(e))return a(e,n,r,i,s);throw new Error("Invalid spec, cannot figure out the view type from the properties: "+JSON.stringify([...Object.keys(e)]))}isViewSpec(e){const n=[...S(this,nr).keys()].filter(r=>r(e));if(n.length>1)throw new Error("Ambiguous spec. Cannot create a view!");return n.length==1}async createOrImportView(e,n,r,i,s,o){let a;if(M3(e))if(this.options.allowImport)a=await zS(e,i.getBaseUrl(),n),o&&o(a);else throw new vn("Importing views is not allowed!",r);else a=e;!i&&this.options.wrapRoot&&(Ec(a)||Cc(a))&&s===Cp&&(a={name:"implicitRoot",vconcat:[a]});const c=this.createView(a,n,r,i,s);return c instanceof Mn&&await c.initializeChildren(),c}}nr=new WeakMap;function Ec(t){return"mark"in t&&(V(t.mark)||Re(t.mark))}function Cc(t){return"layer"in t&&Re(t.layer)}function M3(t){return"import"in t}function Es(t){return"vconcat"in t&&Me(t.vconcat)}function Sp(t){return"hconcat"in t&&Me(t.hconcat)}function Sc(t){return"concat"in t&&Me(t.concat)}function B3(t){return"samples"in t&&Re(t.samples)&&"spec"in t&&Re(t.spec)}var rr,mn,Di,gn;class k3{constructor(){M(this,rr,void 0);M(this,mn,void 0);M(this,Di,void 0);M(this,gn,void 0);he(this,rr,new Map),he(this,mn,new Set),he(this,gn,new Map),he(this,Di,new Proxy(S(this,rr),{get(e,n){return V(n)?e.get(n):void 0}}))}allocateSetter(e){if(S(this,mn).has(e))throw new Error("Setter already allocated for parameter: "+e);return S(this,mn).add(e),n=>{S(this,rr).set(e,n);const r=S(this,gn).get(e);if(r)for(const i of r)i()}}createExpression(e){const n=vo(e,S(this,Di));for(const r of n.globals)if(!S(this,mn).has(r))throw new Error(`Unknown variable "${r}" in expression: ${e}`);return n.addListener=r=>{for(const i of n.globals){const s=S(this,gn).get(i)??new Set;S(this,gn).set(i,s),s.add(r)}},n}}rr=new WeakMap,mn=new WeakMap,Di=new WeakMap,gn=new WeakMap;gh("fasta",QS);class O3{constructor(e,n,r={}){this.container=e;const i=document.createElement("style");i.innerHTML=V1,e.appendChild(i),this.spec=n,this.accessorFactory=new Bb,this.viewFactory=new R3,this.namedDataProviders=[],this.animator=new WS(()=>this.renderAll()),this.genomeStore=void 0,this.viewVisibilityPredicate=s=>s.isVisibleInSpec(),this._renderingContext=void 0,this._pickingContext=void 0,this._dirtyPickingBuffer=!1,this._currentHover=void 0,this._wheelInertia=new e3(this.animator),this._keyboardListeners=new Map,this._eventListeners=new Map,this._extraBroadcastListeners=new Map,this.tooltipHandlers={default:c3,refseqgene:n3,...r.tooltipHandlers??{}},this.viewRoot=void 0,this._paramBroker=new k3}registerNamedDataProvider(e){this.namedDataProviders.unshift(e)}getNamedDataFromProvider(e){for(const n of this.namedDataProviders){const r=n(e);if(r)return r}}updateNamedData(e,n){const r=this.viewRoot.context.dataFlow.findNamedDataSource(e);if(!r)throw new Error("No such named data source: "+e);r.dataSource.updateDynamicData(n),xc(r.hosts),this.animator.requestRender()}broadcast(e,n){var i;const r={type:e,payload:n};this.viewRoot.visit(s=>s.handleBroadcast(r)),(i=this._extraBroadcastListeners.get(e))==null||i.forEach(s=>s(r))}_prepareContainer(){this.container.classList.add("genome-spy"),this.container.classList.add("loading"),this._glHelper=new Xv(this.container,()=>this.viewRoot?US(this.viewRoot):{width:void 0,height:void 0},this.spec.background),this.loadingMessageElement=document.createElement("div"),this.loadingMessageElement.className="loading-message",this.loadingMessageElement.innerHTML='<div class="message">Loading<span class="ellipsis">...</span></div>',this.container.appendChild(this.loadingMessageElement),this.tooltip=new H1(this.container),this.loadingMessageElement.querySelector(".message").addEventListener("transitionend",()=>{this.loadingMessageElement.style.display="none"})}destroy(){this.container.classList.remove("genome-spy"),this.container.classList.remove("loading");for(const[e,n]of this._keyboardListeners)for(const r of n)document.removeEventListener(e,r);for(this._glHelper.finalize();this.container.firstChild;)this.container.firstChild.remove()}async _prepareViewsAndData(){this.spec.genome&&(this.genomeStore=new jS(this.spec.baseUrl),await this.genomeStore.initialize(this.spec.genome));const e=this,n={dataFlow:new hp,accessorFactory:this.accessorFactory,glHelper:this._glHelper,animator:this.animator,genomeStore:this.genomeStore,fontManager:new KS(this._glHelper),get devicePixelRatio(){return e._glHelper.dpr},paramBroker:this._paramBroker,requestLayoutReflow:()=>{},updateTooltip:this.updateTooltip.bind(this),getNamedDataFromProvider:this.getNamedDataFromProvider.bind(this),getCurrentHover:()=>this._currentHover,addKeyboardListener:(c,u)=>{document.addEventListener(c,u);let f=this._keyboardListeners.get(c);f||(f=[],this._keyboardListeners.set(c,f)),f.push(u)},addBroadcastListener(c,u){const f=e._extraBroadcastListeners;let l=f.get(c);l||(l=new Set,f.set(c,l)),l.add(u)},removeBroadcastListener(c,u){var l;(l=e._extraBroadcastListeners.get(c))==null||l.delete(u)},isViewConfiguredVisible:e.viewVisibilityPredicate,isViewSpec:c=>e.viewFactory.isViewSpec(c),createView:function(c,u,f,l){return e.viewFactory.createView(c,n,u,f,l)},createOrImportView:async function(c,u,f,l,h){return e.viewFactory.createOrImportView(c,n,u,f,l,h)}},r=this.spec;r.datasets&&this.registerNamedDataProvider(c=>r.datasets[c]),this.viewRoot=await n.createOrImportView(r,null,null,Cp),LS(this.viewRoot),NS(this.viewRoot);const i=this.viewRoot.getDescendants();i.forEach(c=>c.configureViewOpacity()),this._glHelper.invalidateSize();const s=i.filter(c=>c instanceof Ne),o=RS(this.viewRoot,n.dataFlow);PS(o),this.broadcast("dataFlowBuilt",o),s.forEach(c=>c.mark.initializeEncoders());const a=Promise.all(s.map(c=>c.mark.initializeGraphics()));for(const c of s)o.addObserver(u=>{c.mark.initializeData(),c.mark.updateGraphicsData()},c);await n.fontManager.waitUntilReady(),o.initialize(),await Promise.all(o.dataSources.map(c=>c.load())),xc(this.viewRoot),this.broadcast("dataLoaded"),await a,this.viewRoot.visit(c=>{for(const u of Object.values(c.resolutions.scale))this._glHelper.createRangeTexture(u)});for(const c of s)c.mark.finalizeGraphicsInitialization();n.requestLayoutReflow=this.computeLayout.bind(this),this.viewRoot.visit(c=>As(c,"size")),this._glHelper.invalidateSize()}async launch(){try{return this._prepareContainer(),await this._prepareViewsAndData(),this.registerMouseEvents(),this.computeLayout(),this.animator.requestRender(),this._glHelper.addEventListener("resize",()=>{this.computeLayout(),this.renderAll()}),!0}catch(e){const n=`${e.view?`At "${e.view.getPathString()}": `:""}${e.toString()}`;return console.error(e.stack),P3(this.container,n),!1}finally{this.container.classList.remove("loading"),window.setTimeout(()=>{this.loadingMessageElement.style.display="none"},2e3)}}registerMouseEvents(){const e=this._glHelper.canvas,n=r=>{var i;if(r instanceof MouseEvent){r.type=="mousemove"&&(this.tooltip.handleMouseMove(r),this._tooltipUpdateRequested=!1,r.buttons==0&&this.renderPickingFramebuffer());const s=e.getBoundingClientRect(),o=new GS(r.clientX-s.left-e.clientLeft,r.clientY-s.top-e.clientTop),a=c=>{this.viewRoot.propagateInteractionEvent(new VS(o,c)),this._tooltipUpdateRequested||this.tooltip.clear()};if(r.type!="wheel"&&this._wheelInertia.cancel(),r.type=="mousemove")this._handlePicking(o.x,o.y);else if(r.type=="mousedown"||r.type=="mouseup")this.renderPickingFramebuffer();else if(r.type=="wheel"){this._tooltipUpdateRequested=!1;const c=r;if(Math.abs(c.deltaX)>Math.abs(c.deltaY))this._currentHover=null,this._wheelInertia.cancel();else{const u=t3(c);this._wheelInertia.setMomentum(c.deltaY*(c.deltaMode?80:1),f=>{const l=new WheelEvent("wheel",{...u,deltaMode:0,deltaX:0,deltaY:f});a(l)}),c.preventDefault();return}}if(r.type=="click"){const c=this._currentHover?{type:r.type,viewPath:this._currentHover.mark.unitView.getLayoutAncestors().map(u=>u.name).reverse(),datum:this._currentHover.datum}:{type:r.type,viewPath:null,datum:null};(i=this._eventListeners.get("click"))==null||i.forEach(u=>u(c))}a(r)}};["mousedown","mouseup","wheel","click","mousemove","gesturechange","contextmenu"].forEach(r=>e.addEventListener(r,n)),e.addEventListener("mousedown",()=>{document.addEventListener("mouseup",()=>this.tooltip.popEnabledState(),{once:!0}),this.tooltip.pushEnabledState(!1)}),e.addEventListener("dragstart",r=>r.stopPropagation())}_handlePicking(e,n){var s;const r=this._glHelper.readPickingPixel(e,n),i=r[0]|r[1]<<8|r[2]<<16;if(i==0){this._currentHover=null;return}if(i!==((s=this._currentHover)==null?void 0:s.uniqueId)&&(this._currentHover=null),this._currentHover||this.viewRoot.visit(o=>{if(o instanceof Ne){if(o.mark.isPickingParticipant()){const a=o.mark.encoders.uniqueId.accessor;o.getCollector().visitData(c=>{a(c)==i&&(this._currentHover={mark:o.mark,datum:c,uniqueId:i})})}if(this._currentHover)return $r}}),this._currentHover){const o=this._currentHover.mark;this.updateTooltip(this._currentHover.datum,async a=>{if(!o.isPickingParticipant())return;const c=o.properties.tooltip;if(c!==null){const u=(c==null?void 0:c.handler)??"default",f=this.tooltipHandlers[u];if(!f)throw new Error("No such tooltip handler: "+u);return f(a,o,c==null?void 0:c.params)}})}}updateTooltip(e,n){if(!this._tooltipUpdateRequested||!e)this.tooltip.updateWithDatum(e,n),this._tooltipUpdateRequested=!0;else throw new Error("Tooltip has already been updated! Duplicate event handler?")}computeLayout(){const e=this.viewRoot;if(!e)return;this.broadcast("layout");const n=this._glHelper.getLogicalCanvasSize();if(isNaN(n.width)||isNaN(n.height)){console.log(`NaN in canvas size: ${n.width}x${n.height}. Skipping computeLayout().`);return}this._renderingContext=new wf({picking:!1},this._glHelper),this._pickingContext=new wf({picking:!0},this._glHelper),e.render(new $S(this._renderingContext,this._pickingContext),vt.create(0,0,n.width,n.height)),this.broadcast("layoutComputed")}renderAll(){var e;(e=this._renderingContext)==null||e.render(),this._dirtyPickingBuffer=!0}renderPickingFramebuffer(){this._dirtyPickingBuffer&&(this._pickingContext.render(),this._dirtyPickingBuffer=!1)}getSearchableViews(){const e=[];return this.viewRoot.visit(n=>{n instanceof Ne&&n.getAccessor("search")&&e.push(n)}),e}getNamedScaleResolutions(){const e=new Map;return this.viewRoot.visit(n=>{for(const r of Object.values(n.resolutions.scale))r.name&&e.set(r.name,r)}),e}}function P3(t,e){const n=document.createElement("div");n.className="message-box";const r=document.createElement("div");r.textContent=e,n.appendChild(r),t.appendChild(n)}async function L3(t,e,n={}){let r;if(V(t)){if(r=document.querySelector(t),!r)throw new Error(`No such element: ${t}`)}else if(t instanceof HTMLElement)r=t;else throw new Error(`Invalid element: ${t}`);let i;try{const s=Re(e)?e:await z3(e);if(s.baseUrl??(s.baseUrl=""),s.width??(s.width="container"),s.padding??(s.padding=10),r==document.body){const o=document.createElement("div");o.style.position="fixed",o.style.inset="0",o.style.overflow="hidden",r.appendChild(o),r=o}i=new O3(r,s,n),N3(i,n),await i.launch()}catch(s){r.innerText=s.toString(),console.error(s)}return{finalize(){for(i.destroy();r.firstChild;)r.firstChild.remove()},addEventListener(s,o){const a=i._eventListeners;let c=a.get(s);c||(c=new Set,a.set(s,c)),c.add(o)},removeEventListener(s,o){var c;(c=i._eventListeners.get(s))==null||c.delete(o)},getScaleResolutionByName(s){return i.getNamedScaleResolutions().get(s)},updateNamedData:i.updateNamedData.bind(i)}}function N3(t,e){e.namedDataProvider&&t.registerNamedDataProvider(e.namedDataProvider)}async function z3(t){let e;try{e=JSON.parse(await xo().load(t))}catch(n){throw new Error(`Could not load or parse configuration: ${t}, reason: ${n.message}`)}if(!e.baseUrl){const n=t.match(/^[^?#]*\//);e.baseUrl=n&&n[0]||"./"}return e}function*U3(t){const r=t.length;let i=0,s=i;for(;i<r;){const o=t.charCodeAt(i++);let a;if(o===10?a=t.substring(s,i-1):o===13?(a=t.substring(s,i-1),t.charCodeAt(i+1)===10&&i++):i===r&&(a=t.substring(s,i-1)),a!==void 0&&(yield a,a=void 0,s=i,i>=r))return a}}function $3(t){return new Promise((e,n)=>{let r=new FileReader;r.onload=()=>e(r.result),r.onerror=n,r.readAsText(t)})}function If(){return new Promise((t,e)=>window.requestAnimationFrame(()=>window.requestAnimationFrame(t)))}async function Fp(t){return{name:t.name,size:t.size,textContent:await $3(t)}}async function V3(t){const n=await(await fetch(t)).text();return{name:t.match(/[^/]*$/)[0],size:n.length,textContent:n}}const ge={HETS:{name:"HETS",title:"Allelic counts",example:"tumor.hets.tsv",column:"REF_COUNT"},CR:{name:"CR",title:"Denoised copy ratios",example:"tumor.denoisedCR.tsv",column:"LOG2_COPY_RATIO"},SEG:{name:"SEG",title:"Modeled segments",example:"tumor.modelFinal.seg",column:"LOG2_COPY_RATIO_POSTERIOR_50"},DICT:{name:"DICT",title:"Sequence dictionary",example:"GRCh38.d1.vd1.fa.dict",column:void 0}};function G3(t){const e=H3(t);if(typeof e=="string"&&e!==""){const n=e.split("	");for(const r of Object.values(ge))if(r.column&&n.includes(r.column))return r}else if(t[0]==="@")return ge.DICT}function H3(t,e="@"){for(const n of U3(t))if(typeof e=="string"&&n[0]!==e)return n}const Sa=t=>t!==""?+t:null,q3={[ge.HETS.name]:t=>{const e=+t.ALT_COUNT,n=+t.REF_COUNT;return{contig:t.CONTIG,pos:+t.POSITION,baf:e/(n+e)}},[ge.CR.name]:t=>{const e=+t.START,n=+t.END;return{contig:t.CONTIG,start:e,end:n,pos:(e-1+n)/2,logR:Sa(t.LOG2_COPY_RATIO)}},[ge.SEG.name]:t=>({contig:t.CONTIG,start:+t.START,end:+t.END,NUM_POINTS_COPY_RATIO:+t.NUM_POINTS_COPY_RATIO,NUM_POINTS_ALLELE_FRACTION:+t.NUM_POINTS_ALLELE_FRACTION,LOG2_COPY_RATIO_POSTERIOR_10:+t.LOG2_COPY_RATIO_POSTERIOR_10,LOG2_COPY_RATIO_POSTERIOR_50:Sa(t.LOG2_COPY_RATIO_POSTERIOR_50),LOG2_COPY_RATIO_POSTERIOR_90:+t.LOG2_COPY_RATIO_POSTERIOR_90,MINOR_ALLELE_FRACTION_POSTERIOR_10:+t.MINOR_ALLELE_FRACTION_POSTERIOR_10,MINOR_ALLELE_FRACTION_POSTERIOR_50:Sa(t.MINOR_ALLELE_FRACTION_POSTERIOR_50),MINOR_ALLELE_FRACTION_POSTERIOR_90:+t.MINOR_ALLELE_FRACTION_POSTERIOR_90})},W3=t=>({name:"ideogram-track",view:{stroke:"black"},height:24,data:{url:`https://genomespy.app/data/genomes/${t}/cytoBand.${t}.tsv`},transform:[{type:"filter",expr:"!test(/_/, datum.chrom)"}],encoding:{x:{chrom:"chrom",pos:"chromStart",type:"locus",axis:null},x2:{chrom:"chrom",pos:"chromEnd"}},resolve:{scale:{color:"independent"}},layer:[{title:"Cytoband",mark:"rect",encoding:{color:{field:"gieStain",type:"nominal",scale:{domain:["gneg","gpos25","gpos50","gpos75","gpos100","acen","stalk","gvar"],range:["#f0f0f0","#e0e0e0","#d0d0d0","#c0c0c0","#a0a0a0","#cc4444","#338833","#000000"]}},squeeze:{expr:"datum.gieStain == 'acen' ? (test(/^p/, datum.name) ? 'p' : 'q') : null",type:"nominal",scale:{domain:["p","q"],range:["right","left"]}}}},{mark:{type:"text",align:"center",baseline:"middle",paddingX:4,tooltip:null},encoding:{color:{field:"gieStain",type:"nominal",scale:{domain:["gneg","gpos25","gpos50","gpos75","gpos100","acen","stalk","gvar"],range:["black","black","black","black","black","black","white","white"]}},text:{field:"name",type:"nominal"}}},{transform:[{type:"filter",expr:"datum.chromStart == 0 && datum.chrom != 'chr1'"}],encoding:{x2:null},mark:{type:"rule",color:"#a0a0a0",strokeDash:[3,3],strokeDashOffset:2}}]}),j3=t=>({description:"Windowed GC content computed from the reference genome. Extracted with GATK AnnotateIntervals",height:50,view:{fill:fn.BACKGROUD,stroke:"gray"},data:{url:`https://genomespy.app/tracks/gc-content/gc-intervals.${t}.tsv`},mark:{type:"rect",minWidth:.5,minOpacity:1},encoding:{x:{chrom:"CONTIG",pos:"START",offset:-1,type:"locus"},x2:{chrom:"CONTIG",pos:"END"},y:{field:"GC_CONTENT",type:"quantitative",scale:{domain:[.3,.7]},title:"GC cont.",axis:{maxExtent:40}}}}),Y3=t=>({name:"refseq-track",height:{step:23},data:{url:`https://genomespy.app/data/genomes/${t}/refSeq_genes_scored_compressed.${t}.tsv`,format:{parse:{symbol:"string",chrom:"string",start:"integer",length:"integer",strand:"string",score:"integer",exons:"string"}}},transform:[{type:"linearizeGenomicCoordinate",chrom:"chrom",pos:"start",as:"_start"},{type:"formula",expr:"datum._start + datum.length",as:"_end"},{type:"formula",expr:"datum._start + datum.length / 2",as:"_centroid"},{type:"collect",sort:{field:["_start"]}},{type:"pileup",start:"_start",end:"_end",as:"_lane",preference:"strand",preferredOrder:["-","+"]},{type:"filter",expr:"datum._lane < 3"}],encoding:{y:{field:"_lane",type:"ordinal",scale:{type:"index",align:0,paddingInner:.4,paddingOuter:.2,domain:[0,3],reverse:!0,zoom:!1},axis:null}},layer:[{name:"transcripts",opacity:{unitsPerPixel:[1e5,4e4],values:[0,1]},encoding:{color:{value:"#909090"}},layer:[{name:"exons",transform:[{type:"project",fields:["_lane","_start","exons"]},{type:"flattenCompressedExons",start:"_start"}],mark:{type:"rect",minOpacity:.2,minWidth:.5,tooltip:null},encoding:{x:{field:"exonStart",type:"locus"},x2:{field:"exonEnd"}}},{name:"bodies",title:"Gene annotations",mark:{type:"rule",minLength:.5,size:1,tooltip:null},encoding:{x:{field:"_start",type:"locus",axis:null},x2:{field:"_end"},search:{field:"symbol"}}}]},{name:"symbols",transform:[{type:"measureText",fontSize:11,field:"symbol",as:"_textWidth"},{type:"filterScoredLabels",lane:"_lane",score:"score",width:"_textWidth",pos:"_centroid",padding:5}],layer:[{name:"labels",mark:{type:"text",size:11,yOffset:7,tooltip:{handler:"refseqgene"}},encoding:{x:{field:"_centroid",type:"locus"},text:{field:"symbol"}}},{name:"arrows",opacity:{unitsPerPixel:[1e5,4e4],values:[0,1]},mark:{type:"point",yOffset:7,size:50,tooltip:null},encoding:{x:{field:"_centroid",type:"locus"},dx:{expr:"(datum._textWidth / 2 + 5) * (datum.strand == '-' ? -1 : 1)",type:"quantitative",scale:null},color:{value:"black"},shape:{field:"strand",type:"nominal",scale:{domain:["-","+"],range:["triangle-left","triangle-right"]}}}}]}]}),fn={INTERVAL:"#f70",RULE:"black",POINT:"#49A0F2",BACKGROUD:"#f8f8f8"};function Fa(t,{lower:e,upper:n}){const r=[];return e&&n&&r.push({mark:{type:"rect",minWidth:2,minOpacity:1},encoding:{y:{field:e,type:"quantitative",title:null},y2:{field:n},color:{value:fn.INTERVAL},opacity:{value:.3}}}),r.push({mark:{type:"rule",size:3,minLength:3},encoding:{y:{field:t,type:"quantitative",title:null},color:{value:fn.RULE}}}),r}function _f(t){return Math.max(0,Math.log((t-1e3)/4)/Math.log(3))||0}function X3(t,e){const n=c=>{const u=t.get(c),f=u?u.data:[];if(/^hg\d+/.test(e)){let l;const h=p=>{const d=p.contig;return d===l?!0:/^(chr)?(\d{1,2}|[XY])$/.test(d)?(l=d,!0):(l="",!1)};return f.filter(h)}return f},r=e?{name:e}:{contigs:t.get(ge.DICT).data},[i,s,o]=[ge.SEG,ge.CR,ge.HETS].map(n),a=(c,u)=>c?[u(c)]:[];return{genome:r,data:{values:i},resolve:{scale:{x:"shared"},axis:{x:"independent"}},vconcat:[...a(e,W3),{resolve:{scale:{x:"shared"},axis:{x:"shared"}},encoding:{x:{chrom:"contig",pos:"start",type:"locus",offset:-1,axis:{title:null}},x2:{chrom:"contig",pos:"end"}},vconcat:[...a(e,j3),{name:"logRTrack",view:{fill:fn.BACKGROUD,stroke:"gray"},layer:[{data:{values:s},transform:[{type:"filter",expr:"!isNaN(datum.logR) && datum.logR > -3"}],mark:{type:"point",tooltip:null,geometricZoomBound:_f(s.length)},encoding:{x:{chrom:"contig",pos:"pos",type:"locus",axis:{grid:!0,gridDash:[1,5],chromGrid:!0}},y:{field:"logR",type:"quantitative",title:"Log2 copy ratio",scale:{},axis:{maxExtent:40}},color:{value:fn.POINT},size:{value:150},opacity:{value:.25},strokeWidth:{value:0}}},{transform:[{type:"filter",expr:"datum.LOG2_COPY_RATIO_POSTERIOR_50 > -3"}],layer:Fa("LOG2_COPY_RATIO_POSTERIOR_50",{lower:"LOG2_COPY_RATIO_POSTERIOR_10",upper:"LOG2_COPY_RATIO_POSTERIOR_90"})}]},{name:"bafTrack",view:{fill:fn.BACKGROUD,stroke:"gray"},layer:[{data:{values:o},mark:{type:"point",tooltip:null,geometricZoomBound:_f(o.length)},encoding:{x:{chrom:"contig",pos:"pos",offset:-.5,type:"locus",axis:{grid:!0,gridDash:[1,5],chromGrid:!0}},y:{field:"baf",type:"quantitative",title:"Minor allele fraction",scale:{domain:[0,1]},axis:{maxExtent:40}},color:{value:fn.POINT},size:{value:150},opacity:{value:.3},strokeWidth:{value:0}}},{layer:[{layer:Fa("MINOR_ALLELE_FRACTION_POSTERIOR_50",{lower:"MINOR_ALLELE_FRACTION_POSTERIOR_10",upper:"MINOR_ALLELE_FRACTION_POSTERIOR_90"})},{transform:[10,50,90].map(c=>`MINOR_ALLELE_FRACTION_POSTERIOR_${c}`).map(c=>({type:"formula",expr:`1 - datum.${c}`,as:c})),layer:Fa("MINOR_ALLELE_FRACTION_POSTERIOR_50",{lower:"MINOR_ALLELE_FRACTION_POSTERIOR_10",upper:"MINOR_ALLELE_FRACTION_POSTERIOR_90"})}]}]}]},...a(e,Y3)]}}const K3="data:image/gif;base64,R0lGODlhIAAgAPMAAP///wAAAMbGxoSEhLa2tpqamjY2NlZWVtjY2OTk5Ly8vB4eHgQEBAAAAAAAAAAAACH/C05FVFNDQVBFMi4wAwEAAAAh/hpDcmVhdGVkIHdpdGggYWpheGxvYWQuaW5mbwAh+QQJCgAAACwAAAAAIAAgAAAE5xDISWlhperN52JLhSSdRgwVo1ICQZRUsiwHpTJT4iowNS8vyW2icCF6k8HMMBkCEDskxTBDAZwuAkkqIfxIQyhBQBFvAQSDITM5VDW6XNE4KagNh6Bgwe60smQUB3d4Rz1ZBApnFASDd0hihh12BkE9kjAJVlycXIg7CQIFA6SlnJ87paqbSKiKoqusnbMdmDC2tXQlkUhziYtyWTxIfy6BE8WJt5YJvpJivxNaGmLHT0VnOgSYf0dZXS7APdpB309RnHOG5gDqXGLDaC457D1zZ/V/nmOM82XiHRLYKhKP1oZmADdEAAAh+QQJCgAAACwAAAAAIAAgAAAE6hDISWlZpOrNp1lGNRSdRpDUolIGw5RUYhhHukqFu8DsrEyqnWThGvAmhVlteBvojpTDDBUEIFwMFBRAmBkSgOrBFZogCASwBDEY/CZSg7GSE0gSCjQBMVG023xWBhklAnoEdhQEfyNqMIcKjhRsjEdnezB+A4k8gTwJhFuiW4dokXiloUepBAp5qaKpp6+Ho7aWW54wl7obvEe0kRuoplCGepwSx2jJvqHEmGt6whJpGpfJCHmOoNHKaHx61WiSR92E4lbFoq+B6QDtuetcaBPnW6+O7wDHpIiK9SaVK5GgV543tzjgGcghAgAh+QQJCgAAACwAAAAAIAAgAAAE7hDISSkxpOrN5zFHNWRdhSiVoVLHspRUMoyUakyEe8PTPCATW9A14E0UvuAKMNAZKYUZCiBMuBakSQKG8G2FzUWox2AUtAQFcBKlVQoLgQReZhQlCIJesQXI5B0CBnUMOxMCenoCfTCEWBsJColTMANldx15BGs8B5wlCZ9Po6OJkwmRpnqkqnuSrayqfKmqpLajoiW5HJq7FL1Gr2mMMcKUMIiJgIemy7xZtJsTmsM4xHiKv5KMCXqfyUCJEonXPN2rAOIAmsfB3uPoAK++G+w48edZPK+M6hLJpQg484enXIdQFSS1u6UhksENEQAAIfkECQoAAAAsAAAAACAAIAAABOcQyEmpGKLqzWcZRVUQnZYg1aBSh2GUVEIQ2aQOE+G+cD4ntpWkZQj1JIiZIogDFFyHI0UxQwFugMSOFIPJftfVAEoZLBbcLEFhlQiqGp1Vd140AUklUN3eCA51C1EWMzMCezCBBmkxVIVHBWd3HHl9JQOIJSdSnJ0TDKChCwUJjoWMPaGqDKannasMo6WnM562R5YluZRwur0wpgqZE7NKUm+FNRPIhjBJxKZteWuIBMN4zRMIVIhffcgojwCF117i4nlLnY5ztRLsnOk+aV+oJY7V7m76PdkS4trKcdg0Zc0tTcKkRAAAIfkECQoAAAAsAAAAACAAIAAABO4QyEkpKqjqzScpRaVkXZWQEximw1BSCUEIlDohrft6cpKCk5xid5MNJTaAIkekKGQkWyKHkvhKsR7ARmitkAYDYRIbUQRQjWBwJRzChi9CRlBcY1UN4g0/VNB0AlcvcAYHRyZPdEQFYV8ccwR5HWxEJ02YmRMLnJ1xCYp0Y5idpQuhopmmC2KgojKasUQDk5BNAwwMOh2RtRq5uQuPZKGIJQIGwAwGf6I0JXMpC8C7kXWDBINFMxS4DKMAWVWAGYsAdNqW5uaRxkSKJOZKaU3tPOBZ4DuK2LATgJhkPJMgTwKCdFjyPHEnKxFCDhEAACH5BAkKAAAALAAAAAAgACAAAATzEMhJaVKp6s2nIkolIJ2WkBShpkVRWqqQrhLSEu9MZJKK9y1ZrqYK9WiClmvoUaF8gIQSNeF1Er4MNFn4SRSDARWroAIETg1iVwuHjYB1kYc1mwruwXKC9gmsJXliGxc+XiUCby9ydh1sOSdMkpMTBpaXBzsfhoc5l58Gm5yToAaZhaOUqjkDgCWNHAULCwOLaTmzswadEqggQwgHuQsHIoZCHQMMQgQGubVEcxOPFAcMDAYUA85eWARmfSRQCdcMe0zeP1AAygwLlJtPNAAL19DARdPzBOWSm1brJBi45soRAWQAAkrQIykShQ9wVhHCwCQCACH5BAkKAAAALAAAAAAgACAAAATrEMhJaVKp6s2nIkqFZF2VIBWhUsJaTokqUCoBq+E71SRQeyqUToLA7VxF0JDyIQh/MVVPMt1ECZlfcjZJ9mIKoaTl1MRIl5o4CUKXOwmyrCInCKqcWtvadL2SYhyASyNDJ0uIiRMDjI0Fd30/iI2UA5GSS5UDj2l6NoqgOgN4gksEBgYFf0FDqKgHnyZ9OX8HrgYHdHpcHQULXAS2qKpENRg7eAMLC7kTBaixUYFkKAzWAAnLC7FLVxLWDBLKCwaKTULgEwbLA4hJtOkSBNqITT3xEgfLpBtzE/jiuL04RGEBgwWhShRgQExHBAAh+QQJCgAAACwAAAAAIAAgAAAE7xDISWlSqerNpyJKhWRdlSAVoVLCWk6JKlAqAavhO9UkUHsqlE6CwO1cRdCQ8iEIfzFVTzLdRAmZX3I2SfZiCqGk5dTESJeaOAlClzsJsqwiJwiqnFrb2nS9kmIcgEsjQydLiIlHehhpejaIjzh9eomSjZR+ipslWIRLAgMDOR2DOqKogTB9pCUJBagDBXR6XB0EBkIIsaRsGGMMAxoDBgYHTKJiUYEGDAzHC9EACcUGkIgFzgwZ0QsSBcXHiQvOwgDdEwfFs0sDzt4S6BK4xYjkDOzn0unFeBzOBijIm1Dgmg5YFQwsCMjp1oJ8LyIAACH5BAkKAAAALAAAAAAgACAAAATwEMhJaVKp6s2nIkqFZF2VIBWhUsJaTokqUCoBq+E71SRQeyqUToLA7VxF0JDyIQh/MVVPMt1ECZlfcjZJ9mIKoaTl1MRIl5o4CUKXOwmyrCInCKqcWtvadL2SYhyASyNDJ0uIiUd6GGl6NoiPOH16iZKNlH6KmyWFOggHhEEvAwwMA0N9GBsEC6amhnVcEwavDAazGwIDaH1ipaYLBUTCGgQDA8NdHz0FpqgTBwsLqAbWAAnIA4FWKdMLGdYGEgraigbT0OITBcg5QwPT4xLrROZL6AuQAPUS7bxLpoWidY0JtxLHKhwwMJBTHgPKdEQAACH5BAkKAAAALAAAAAAgACAAAATrEMhJaVKp6s2nIkqFZF2VIBWhUsJaTokqUCoBq+E71SRQeyqUToLA7VxF0JDyIQh/MVVPMt1ECZlfcjZJ9mIKoaTl1MRIl5o4CUKXOwmyrCInCKqcWtvadL2SYhyASyNDJ0uIiUd6GAULDJCRiXo1CpGXDJOUjY+Yip9DhToJA4RBLwMLCwVDfRgbBAaqqoZ1XBMHswsHtxtFaH1iqaoGNgAIxRpbFAgfPQSqpbgGBqUD1wBXeCYp1AYZ19JJOYgH1KwA4UBvQwXUBxPqVD9L3sbp2BNk2xvvFPJd+MFCN6HAAIKgNggY0KtEBAAh+QQJCgAAACwAAAAAIAAgAAAE6BDISWlSqerNpyJKhWRdlSAVoVLCWk6JKlAqAavhO9UkUHsqlE6CwO1cRdCQ8iEIfzFVTzLdRAmZX3I2SfYIDMaAFdTESJeaEDAIMxYFqrOUaNW4E4ObYcCXaiBVEgULe0NJaxxtYksjh2NLkZISgDgJhHthkpU4mW6blRiYmZOlh4JWkDqILwUGBnE6TYEbCgevr0N1gH4At7gHiRpFaLNrrq8HNgAJA70AWxQIH1+vsYMDAzZQPC9VCNkDWUhGkuE5PxJNwiUK4UfLzOlD4WvzAHaoG9nxPi5d+jYUqfAhhykOFwJWiAAAIfkECQoAAAAsAAAAACAAIAAABPAQyElpUqnqzaciSoVkXVUMFaFSwlpOCcMYlErAavhOMnNLNo8KsZsMZItJEIDIFSkLGQoQTNhIsFehRww2CQLKF0tYGKYSg+ygsZIuNqJksKgbfgIGepNo2cIUB3V1B3IvNiBYNQaDSTtfhhx0CwVPI0UJe0+bm4g5VgcGoqOcnjmjqDSdnhgEoamcsZuXO1aWQy8KAwOAuTYYGwi7w5h+Kr0SJ8MFihpNbx+4Erq7BYBuzsdiH1jCAzoSfl0rVirNbRXlBBlLX+BP0XJLAPGzTkAuAOqb0WT5AH7OcdCm5B8TgRwSRKIHQtaLCwg1RAAAOwAAAAAAAAAAAA==";const Tp=["hg38","hg19"],mr=new Map;let En=Tp[0],Vr,Ks=!1,Js=!1,Gr=!1;St();function J3(){const t=r=>{const i=mr.get(r);return te`<tr><td>${r.title}</td>${i?te`<td class="status okay"><span class="icon">✔</span></td><td>${i.name}</td><td>${i.data?`${i.data.length} records`:"Parsing..."}</td>`:te`<td class="status"><span class="icon">✗</span></td><td>Missing. <span class="example-file">Example: ${r.example}</span></td><td></td>`}</tr>`},e=()=>te`<div class="btn-group" role="group">${Tp.map(r=>te`<button type="button" @click="${()=>Rf(r)}" class="btn btn-secondary ${En===r?"active":""}">${r}</button>`)} <button type="button" @click="${()=>Rf(void 0)}" class="btn btn-secondary ${En?"":"active"}">.dict file</button></div>`;return te`${(()=>te`<div @dragenter="${Ta}" @dragover="${Ta}" @dragleave="${Ta}" @drop="${Q3}" class="${Vu({"drop-zone":!0,dragging:Ks,"active-panel":!Js})}"><div class="file-box"><h2>1. Choose a genome assembly or a sequence dictionary</h2><p>Choosing a genome assembly instead of a sequence dictionary activates cytoband, GC content, and RefSeq gene tracks.</p>${e()}<h2>2. Select files</h2><p>Please provide at least one of the following files to start visualizing. File types are detected from the TSV header row.</p><p>N.B. All data processing takes place in your web browser. Nothing is uploaded anywhere.</p><table class="file-table">${Object.values(ge).filter(r=>r!==ge.DICT||!En).map(t)}</table><input type="file" multiple="multiple" accept=".tsv,.seg" id="fileInput" @change="${eF}" style="display:none"><div class="upload-button-wrapper"><button class="btn" style="margin-right:1em" @click="${r=>{document.getElementById("fileInput").click(),r.preventDefault(),r.stopPropagation()}}">Choose files</button> or drag and drop here.</div><h3>No files to play with?</h3><p>Try the example data sets:</p><div class="example-data-buttons"><button class="btn" ?disabled="${Gr}" @click="${()=>Mf("sample-subset")}">Load small data set</button> <button class="btn" ?disabled="${Gr}" @click="${()=>Mf("sample")}">Load full data set</button> ${Gr?te`<span class="loading"><img src="${K3}" alt="" width="16" height="16"> <span>Loading...</span></span>`:""}</div><h2>3. Explore the data</h2>Zoom with the mouse wheel or touchpad, pan by dragging or with the touchpad. Hover an item to get details.<div class="buttons"><button ?disabled="${!Dp()}" @click="${Ip}" class="btn btn-lg">Let's visualize!</button></div></div></div>`)()}<div id="genome-spy-container" class="${Vu({"active-panel":!!Js})}"></div>`}function Z3(){return te`<div class="buttons ${Vr?"visible":"hidden"}"><button @click="${_p}">⇐ Back to files</button></div>`}function Ta(t){t.stopPropagation(),t.preventDefault(),t.type==="dragleave"?Ks=!1:Ks=!0,St()}async function Q3(t){t.stopPropagation(),t.preventDefault(),Ks=!1;const n=[...t.dataTransfer.files];Mu(await Promise.all(n.map(Fp)))}function Dp(){const t=new Map([...mr.entries()].filter(e=>e[0]!==ge.DICT));return t.size>0&&[...t.values()].every(e=>e.data)&&(En||mr.has(ge.DICT))}function St(){Ss(J3(),document.querySelector("main")),Ss(Z3(),document.querySelector("header .toolbar"))}async function Ip(){_p();const t=X3(mr,En);Js=!0,St(),Vr=await L3(document.querySelector("#genome-spy-container"),t),St()}function _p(){Vr&&(Vr.finalize(),Vr=void 0),Js=!1,St()}function Rf(t){En=t,St()}async function eF(t){const e=[...t.target.files];Mu(await Promise.all(e.map(Fp)))}async function Mf(t){const e="https://data.genomespy.app/sample-data/segment-model-spy/";Gr=!0,St();const r=[".hets.tsv",".denoisedCR.tsv",".modelFinal.seg"].map(i=>e+t+i);try{Mu(await Promise.all(r.map(V3)))}catch{alert("Failed to load example data. Please try again later.")}Gr=!1}async function Mu(t){const e=[];for(const n of t){const r=n.textContent,i=G3(r);i?(e.push({file:n,textContent:r,type:i}),mr.set(i,{name:n.name,data:null})):alert(`Cannot recognise this file: ${n.name}.`),i===ge.DICT&&(En=void 0)}for(const n of e){St(),await If();let r=[];n.type!==ge.DICT?r=zf("	",{comment:"@"}).parse(n.textContent,q3[n.type.name]):r=tF(n.textContent),mr.set(n.type,{name:n.file.name,data:r})}await If(),St(),new Set(e.filter(n=>n.type!==ge.DICT)).size===3&&Dp()&&Ip()}function tF(t){throw new Error("Function not implemented.")}
