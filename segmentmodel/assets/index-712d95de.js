import{b as J}from"./index-462333f7.js";import{_ as Yn,L as Kn}from"./index-d89cadd6.js";import{L as nr}from"./__vite-browser-external-d053bc6e.js";import{R as ir}from"./remoteFile-1948951e.js";import"./_commonjsHelpers-de833af9.js";const lt=BigInt(32);function rr(e,n,t){const i=+!!t,a=+!t;return BigInt(e.getInt32(n,t)*a+e.getInt32(n+4,t)*i)<<lt|BigInt(e.getUint32(n,t)*i+e.getUint32(n+4,t)*a)}function ar(e,n,t){const i=e.getUint32(n,t),a=e.getUint32(n+4,t),r=+!!t,o=+!t;return BigInt(i*o+a*r)<<lt|BigInt(i*r+a*o)}function or(e,n,t,i){const a=Number(t>>lt),r=Number(t&BigInt(4294967295));i?(e.setInt32(n+4,a,i),e.setUint32(n,r,i)):(e.setInt32(n,a,i),e.setUint32(n+4,r,i))}function sr(e,n,t,i){const a=Number(t>>lt),r=Number(t&BigInt(4294967295));i?(e.setUint32(n+4,a,i),e.setUint32(n,r,i)):(e.setUint32(n,a,i),e.setUint32(n+4,r,i))}"getBigInt64"in DataView||(DataView.prototype.getBigInt64=function(e,n){return rr(this,e,n)});"getBigUint64"in DataView||(DataView.prototype.getBigUint64=function(e,n){return ar(this,e,n)});"setBigInt64"in DataView||(DataView.prototype.setBigInt64=function(e,n,t){or(this,e,n,t)});"setBigUint64"in DataView||(DataView.prototype.setBigUint64=function(e,n,t){sr(this,e,n,t)});class fr{constructor(n,t){this.code="",this.scopes=[["vars"]],this.bitFields=[],this.tmpVariableCount=0,this.references=new Map,this.imports=[],this.reverseImports=new Map,this.useContextVariables=!1,this.importPath=n,this.useContextVariables=t}generateVariable(n){const t=[...this.scopes[this.scopes.length-1]];return n&&t.push(n),t.join(".")}generateOption(n){switch(typeof n){case"number":return n.toString();case"string":return this.generateVariable(n);case"function":return`${this.addImport(n)}.call(${this.generateVariable()}, vars)`}}generateError(n){this.pushCode(`throw new Error(${n});`)}generateTmpVariable(){return"$tmp"+this.tmpVariableCount++}pushCode(n){this.code+=n+`
`}pushPath(n){n&&this.scopes[this.scopes.length-1].push(n)}popPath(n){n&&this.scopes[this.scopes.length-1].pop()}pushScope(n){this.scopes.push([n])}popScope(){this.scopes.pop()}addImport(n){if(!this.importPath)return`(${n})`;let t=this.reverseImports.get(n);return t||(t=this.imports.push(n)-1,this.reverseImports.set(n,t)),`${this.importPath}[${t}]`}addReference(n){this.references.has(n)||this.references.set(n,{resolved:!1,requested:!1})}markResolved(n){const t=this.references.get(n);t&&(t.resolved=!0)}markRequested(n){n.forEach(t=>{const i=this.references.get(t);i&&(i.requested=!0)})}getUnresolvedReferences(){return Array.from(this.references).filter(([n,t])=>!t.resolved&&!t.requested).map(([n,t])=>n)}}const Z=new Map,ae="___parser_",M={uint8:1,uint16le:2,uint16be:2,uint32le:4,uint32be:4,int8:1,int16le:2,int16be:2,int32le:4,int32be:4,int64be:8,int64le:8,uint64be:8,uint64le:8,floatle:4,floatbe:4,doublele:8,doublebe:8},Ye={uint8:"Uint8",uint16le:"Uint16",uint16be:"Uint16",uint32le:"Uint32",uint32be:"Uint32",int8:"Int8",int16le:"Int16",int16be:"Int16",int32le:"Int32",int32be:"Int32",int64be:"BigInt64",int64le:"BigInt64",uint64be:"BigUint64",uint64le:"BigUint64",floatle:"Float32",floatbe:"Float32",doublele:"Float64",doublebe:"Float64"},Ke={uint8:!1,uint16le:!0,uint16be:!1,uint32le:!0,uint32be:!1,int8:!1,int16le:!0,int16be:!1,int32le:!0,int32be:!1,int64be:!1,int64le:!0,uint64be:!1,uint64le:!0,floatle:!0,floatbe:!1,doublele:!0,doublebe:!1};class S{constructor(){this.varName="",this.type="",this.options={},this.endian="be",this.useContextVariables=!1}static start(){return new S}primitiveGenerateN(n,t){const i=Ye[n],a=Ke[n];t.pushCode(`${t.generateVariable(this.varName)} = dataView.get${i}(offset, ${a});`),t.pushCode(`offset += ${M[n]};`)}primitiveN(n,t,i){return this.setNextParser(n,t,i)}useThisEndian(n){return n+this.endian.toLowerCase()}uint8(n,t={}){return this.primitiveN("uint8",n,t)}uint16(n,t={}){return this.primitiveN(this.useThisEndian("uint16"),n,t)}uint16le(n,t={}){return this.primitiveN("uint16le",n,t)}uint16be(n,t={}){return this.primitiveN("uint16be",n,t)}uint32(n,t={}){return this.primitiveN(this.useThisEndian("uint32"),n,t)}uint32le(n,t={}){return this.primitiveN("uint32le",n,t)}uint32be(n,t={}){return this.primitiveN("uint32be",n,t)}int8(n,t={}){return this.primitiveN("int8",n,t)}int16(n,t={}){return this.primitiveN(this.useThisEndian("int16"),n,t)}int16le(n,t={}){return this.primitiveN("int16le",n,t)}int16be(n,t={}){return this.primitiveN("int16be",n,t)}int32(n,t={}){return this.primitiveN(this.useThisEndian("int32"),n,t)}int32le(n,t={}){return this.primitiveN("int32le",n,t)}int32be(n,t={}){return this.primitiveN("int32be",n,t)}bigIntVersionCheck(){if(!DataView.prototype.getBigInt64)throw new Error("BigInt64 is unsupported on this runtime")}int64(n,t={}){return this.bigIntVersionCheck(),this.primitiveN(this.useThisEndian("int64"),n,t)}int64be(n,t={}){return this.bigIntVersionCheck(),this.primitiveN("int64be",n,t)}int64le(n,t={}){return this.bigIntVersionCheck(),this.primitiveN("int64le",n,t)}uint64(n,t={}){return this.bigIntVersionCheck(),this.primitiveN(this.useThisEndian("uint64"),n,t)}uint64be(n,t={}){return this.bigIntVersionCheck(),this.primitiveN("uint64be",n,t)}uint64le(n,t={}){return this.bigIntVersionCheck(),this.primitiveN("uint64le",n,t)}floatle(n,t={}){return this.primitiveN("floatle",n,t)}floatbe(n,t={}){return this.primitiveN("floatbe",n,t)}doublele(n,t={}){return this.primitiveN("doublele",n,t)}doublebe(n,t={}){return this.primitiveN("doublebe",n,t)}bitN(n,t,i){return i.length=n,this.setNextParser("bit",t,i)}bit1(n,t={}){return this.bitN(1,n,t)}bit2(n,t={}){return this.bitN(2,n,t)}bit3(n,t={}){return this.bitN(3,n,t)}bit4(n,t={}){return this.bitN(4,n,t)}bit5(n,t={}){return this.bitN(5,n,t)}bit6(n,t={}){return this.bitN(6,n,t)}bit7(n,t={}){return this.bitN(7,n,t)}bit8(n,t={}){return this.bitN(8,n,t)}bit9(n,t={}){return this.bitN(9,n,t)}bit10(n,t={}){return this.bitN(10,n,t)}bit11(n,t={}){return this.bitN(11,n,t)}bit12(n,t={}){return this.bitN(12,n,t)}bit13(n,t={}){return this.bitN(13,n,t)}bit14(n,t={}){return this.bitN(14,n,t)}bit15(n,t={}){return this.bitN(15,n,t)}bit16(n,t={}){return this.bitN(16,n,t)}bit17(n,t={}){return this.bitN(17,n,t)}bit18(n,t={}){return this.bitN(18,n,t)}bit19(n,t={}){return this.bitN(19,n,t)}bit20(n,t={}){return this.bitN(20,n,t)}bit21(n,t={}){return this.bitN(21,n,t)}bit22(n,t={}){return this.bitN(22,n,t)}bit23(n,t={}){return this.bitN(23,n,t)}bit24(n,t={}){return this.bitN(24,n,t)}bit25(n,t={}){return this.bitN(25,n,t)}bit26(n,t={}){return this.bitN(26,n,t)}bit27(n,t={}){return this.bitN(27,n,t)}bit28(n,t={}){return this.bitN(28,n,t)}bit29(n,t={}){return this.bitN(29,n,t)}bit30(n,t={}){return this.bitN(30,n,t)}bit31(n,t={}){return this.bitN(31,n,t)}bit32(n,t={}){return this.bitN(32,n,t)}namely(n){return Z.set(n,this),this.alias=n,this}skip(n,t={}){return this.seek(n,t)}seek(n,t={}){if(t.assert)throw new Error("assert option on seek is not allowed.");return this.setNextParser("seek","",{length:n})}string(n,t){if(!t.zeroTerminated&&!t.length&&!t.greedy)throw new Error("One of length, zeroTerminated, or greedy must be defined for string.");if((t.zeroTerminated||t.length)&&t.greedy)throw new Error("greedy is mutually exclusive with length and zeroTerminated for string.");if(t.stripNull&&!(t.length||t.greedy))throw new Error("length or greedy must be defined if stripNull is enabled.");return t.encoding=t.encoding||"utf8",this.setNextParser("string",n,t)}buffer(n,t){if(!t.length&&!t.readUntil)throw new Error("length or readUntil must be defined for buffer.");return this.setNextParser("buffer",n,t)}wrapped(n,t){if(typeof t!="object"&&typeof n=="object"&&(t=n,n=""),!t||!t.wrapper||!t.type)throw new Error("Both wrapper and type must be defined for wrapped.");if(!t.length&&!t.readUntil)throw new Error("length or readUntil must be defined for wrapped.");return this.setNextParser("wrapper",n,t)}array(n,t){if(!t.readUntil&&!t.length&&!t.lengthInBytes)throw new Error("One of readUntil, length and lengthInBytes must be defined for array.");if(!t.type)throw new Error("type is required for array.");if(typeof t.type=="string"&&!Z.has(t.type)&&!(t.type in M))throw new Error(`Array element type "${t.type}" is unkown.`);return this.setNextParser("array",n,t)}choice(n,t){if(typeof t!="object"&&typeof n=="object"&&(t=n,n=""),!t)throw new Error("tag and choices are are required for choice.");if(!t.tag)throw new Error("tag is requird for choice.");if(!t.choices)throw new Error("choices is required for choice.");for(const i in t.choices){const a=parseInt(i,10),r=t.choices[a];if(isNaN(a))throw new Error(`Choice key "${i}" is not a number.`);if(typeof r=="string"&&!Z.has(r)&&!(r in M))throw new Error(`Choice type "${r}" is unkown.`)}return this.setNextParser("choice",n,t)}nest(n,t){if(typeof t!="object"&&typeof n=="object"&&(t=n,n=""),!t||!t.type)throw new Error("type is required for nest.");if(!(t.type instanceof S)&&!Z.has(t.type))throw new Error("type must be a known parser name or a Parser object.");if(!(t.type instanceof S)&&!n)throw new Error("type must be a Parser object if the variable name is omitted.");return this.setNextParser("nest",n,t)}pointer(n,t){if(!t.offset)throw new Error("offset is required for pointer.");if(!t.type)throw new Error("type is required for pointer.");if(typeof t.type=="string"&&!(t.type in M)&&!Z.has(t.type))throw new Error(`Pointer type "${t.type}" is unkown.`);return this.setNextParser("pointer",n,t)}saveOffset(n,t={}){return this.setNextParser("saveOffset",n,t)}endianness(n){switch(n.toLowerCase()){case"little":this.endian="le";break;case"big":this.endian="be";break;default:throw new Error('endianness must be one of "little" or "big"')}return this}endianess(n){return this.endianness(n)}useContextVars(n=!0){return this.useContextVariables=n,this}create(n){if(!(n instanceof Function))throw new Error("Constructor must be a Function object.");return this.constructorFn=n,this}getContext(n){const t=new fr(n,this.useContextVariables);return t.pushCode("var dataView = new DataView(buffer.buffer, buffer.byteOffset, buffer.length);"),this.alias?(this.addAliasedCode(t),t.pushCode(`return ${ae+this.alias}(0).result;`)):this.addRawCode(t),t}getCode(){const n="imports";return this.getContext(n).code}addRawCode(n){n.pushCode("var offset = 0;"),n.pushCode(`var vars = ${this.constructorFn?"new constructorFn()":"{}"};`),n.pushCode("vars.$parent = null;"),n.pushCode("vars.$root = vars;"),this.generate(n),this.resolveReferences(n),n.pushCode("delete vars.$parent;"),n.pushCode("delete vars.$root;"),n.pushCode("return vars;")}addAliasedCode(n){return n.pushCode(`function ${ae+this.alias}(offset, context) {`),n.pushCode(`var vars = ${this.constructorFn?"new constructorFn()":"{}"};`),n.pushCode("var ctx = Object.assign({$parent: null, $root: vars}, context || {});"),n.pushCode("vars = Object.assign(vars, ctx);"),this.generate(n),n.markResolved(this.alias),this.resolveReferences(n),n.pushCode("Object.keys(ctx).forEach(function (item) { delete vars[item]; });"),n.pushCode("return { offset: offset, result: vars };"),n.pushCode("}"),n}resolveReferences(n){const t=n.getUnresolvedReferences();n.markRequested(t),t.forEach(i=>{var a;(a=Z.get(i))===null||a===void 0||a.addAliasedCode(n)})}compile(){const n="imports",t=this.getContext(n);this.compiled=new Function(n,"TextDecoder",`return function (buffer, constructorFn) { ${t.code} };`)(t.imports,TextDecoder)}sizeOf(){let n=NaN;if(Object.keys(M).indexOf(this.type)>=0)n=M[this.type];else if(this.type==="string"&&typeof this.options.length=="number")n=this.options.length;else if(this.type==="buffer"&&typeof this.options.length=="number")n=this.options.length;else if(this.type==="array"&&typeof this.options.length=="number"){let t=NaN;typeof this.options.type=="string"?t=M[this.options.type]:this.options.type instanceof S&&(t=this.options.type.sizeOf()),n=this.options.length*t}else this.type==="seek"?n=this.options.length:this.type==="nest"?n=this.options.type.sizeOf():this.type||(n=0);return this.next&&(n+=this.next.sizeOf()),n}parse(n){return this.compiled||this.compile(),this.compiled(n,this.constructorFn)}setNextParser(n,t,i){const a=new S;return a.type=n,a.varName=t,a.options=i,a.endian=this.endian,this.head?this.head.next=a:this.next=a,this.head=a,this}generate(n){if(this.type){switch(this.type){case"uint8":case"uint16le":case"uint16be":case"uint32le":case"uint32be":case"int8":case"int16le":case"int16be":case"int32le":case"int32be":case"int64be":case"int64le":case"uint64be":case"uint64le":case"floatle":case"floatbe":case"doublele":case"doublebe":this.primitiveGenerateN(this.type,n);break;case"bit":this.generateBit(n);break;case"string":this.generateString(n);break;case"buffer":this.generateBuffer(n);break;case"seek":this.generateSeek(n);break;case"nest":this.generateNest(n);break;case"array":this.generateArray(n);break;case"choice":this.generateChoice(n);break;case"pointer":this.generatePointer(n);break;case"saveOffset":this.generateSaveOffset(n);break;case"wrapper":this.generateWrapper(n);break}this.type!=="bit"&&this.generateAssert(n)}const t=n.generateVariable(this.varName);return this.options.formatter&&this.type!=="bit"&&this.generateFormatter(n,t,this.options.formatter),this.generateNext(n)}generateAssert(n){if(!this.options.assert)return;const t=n.generateVariable(this.varName);switch(typeof this.options.assert){case"function":{const i=n.addImport(this.options.assert);n.pushCode(`if (!${i}.call(vars, ${t})) {`)}break;case"number":n.pushCode(`if (${this.options.assert} !== ${t}) {`);break;case"string":n.pushCode(`if (${JSON.stringify(this.options.assert)} !== ${t}) {`);break;default:throw new Error("assert option must be a string, number or a function.")}n.generateError(`"Assertion error: ${t} is " + ${JSON.stringify(this.options.assert.toString())}`),n.pushCode("}")}generateNext(n){return this.next&&(n=this.next.generate(n)),n}generateBit(n){const t=JSON.parse(JSON.stringify(this));if(t.options=this.options,t.generateAssert=this.generateAssert.bind(this),t.generateFormatter=this.generateFormatter.bind(this),t.varName=n.generateVariable(t.varName),n.bitFields.push(t),!this.next||this.next&&["bit","nest"].indexOf(this.next.type)<0){const i=n.generateTmpVariable();n.pushCode(`var ${i} = 0;`);const a=(l=0)=>{let p=0;for(let c=l;c<n.bitFields.length;c++){const h=n.bitFields[c].options.length;if(p+h>32)break;p+=h}return p},r=l=>(l<=8?(n.pushCode(`${i} = dataView.getUint8(offset);`),l=8):l<=16?(n.pushCode(`${i} = dataView.getUint16(offset);`),l=16):l<=24?(n.pushCode(`${i} = (dataView.getUint16(offset) << 8) | dataView.getUint8(offset + 2);`),l=24):(n.pushCode(`${i} = dataView.getUint32(offset);`),l=32),n.pushCode(`offset += ${l/8};`),l);let o=0;const f=this.endian==="be";let u=0,s=0;n.bitFields.forEach((l,p)=>{let c=l.options.length;if(c>s){if(s){const g=-1>>>32-s;n.pushCode(`${l.varName} = (${i} & 0x${g.toString(16)}) << ${c-s};`),c-=s}o=0,s=u=r(a(p)-s)}const h=f?u-o-c:o,_=-1>>>32-c;n.pushCode(`${l.varName} ${c<l.options.length?"|=":"="} ${i} >> ${h} & 0x${_.toString(16)};`),l.options.length===32&&n.pushCode(`${l.varName} >>>= 0`),l.options.assert&&l.generateAssert(n),l.options.formatter&&l.generateFormatter(n,l.varName,l.options.formatter),o+=c,s-=c}),n.bitFields=[]}}generateSeek(n){const t=n.generateOption(this.options.length);n.pushCode(`offset += ${t};`)}generateString(n){const t=n.generateVariable(this.varName),i=n.generateTmpVariable(),a=this.options.encoding,r=a.toLowerCase()==="hex",o='b => b.toString(16).padStart(2, "0")';if(this.options.length&&this.options.zeroTerminated){const f=this.options.length;n.pushCode(`var ${i} = offset;`),n.pushCode(`while(dataView.getUint8(offset++) !== 0 && offset - ${i} < ${f});`);const u=`offset - ${i} < ${f} ? offset - 1 : offset`;n.pushCode(r?`${t} = Array.from(buffer.subarray(${i}, ${u}), ${o}).join('');`:`${t} = new TextDecoder('${a}').decode(buffer.subarray(${i}, ${u}));`)}else if(this.options.length){const f=n.generateOption(this.options.length);n.pushCode(r?`${t} = Array.from(buffer.subarray(offset, offset + ${f}), ${o}).join('');`:`${t} = new TextDecoder('${a}').decode(buffer.subarray(offset, offset + ${f}));`),n.pushCode(`offset += ${f};`)}else this.options.zeroTerminated?(n.pushCode(`var ${i} = offset;`),n.pushCode("while(dataView.getUint8(offset++) !== 0);"),n.pushCode(r?`${t} = Array.from(buffer.subarray(${i}, offset - 1), ${o}).join('');`:`${t} = new TextDecoder('${a}').decode(buffer.subarray(${i}, offset - 1));`)):this.options.greedy&&(n.pushCode(`var ${i} = offset;`),n.pushCode("while(buffer.length > offset++);"),n.pushCode(r?`${t} = Array.from(buffer.subarray(${i}, offset), ${o}).join('');`:`${t} = new TextDecoder('${a}').decode(buffer.subarray(${i}, offset));`));this.options.stripNull&&n.pushCode(`${t} = ${t}.replace(/\\x00+$/g, '')`)}generateBuffer(n){const t=n.generateVariable(this.varName);if(typeof this.options.readUntil=="function"){const i=this.options.readUntil,a=n.generateTmpVariable(),r=n.generateTmpVariable();n.pushCode(`var ${a} = offset;`),n.pushCode(`var ${r} = 0;`),n.pushCode("while (offset < buffer.length) {"),n.pushCode(`${r} = dataView.getUint8(offset);`);const o=n.addImport(i);n.pushCode(`if (${o}.call(${n.generateVariable()}, ${r}, buffer.subarray(offset))) break;`),n.pushCode("offset += 1;"),n.pushCode("}"),n.pushCode(`${t} = buffer.subarray(${a}, offset);`)}else if(this.options.readUntil==="eof")n.pushCode(`${t} = buffer.subarray(offset);`);else{const i=n.generateOption(this.options.length);n.pushCode(`${t} = buffer.subarray(offset, offset + ${i});`),n.pushCode(`offset += ${i};`)}this.options.clone&&n.pushCode(`${t} = buffer.constructor.from(${t});`)}generateArray(n){const t=n.generateOption(this.options.length),i=n.generateOption(this.options.lengthInBytes),a=this.options.type,r=n.generateTmpVariable(),o=n.generateVariable(this.varName),f=n.generateTmpVariable(),u=this.options.key,s=typeof u=="string";if(s?n.pushCode(`${o} = {};`):n.pushCode(`${o} = [];`),typeof this.options.readUntil=="function"?n.pushCode("do {"):this.options.readUntil==="eof"?n.pushCode(`for (var ${r} = 0; offset < buffer.length; ${r}++) {`):i!==void 0?n.pushCode(`for (var ${r} = offset + ${i}; offset < ${r}; ) {`):n.pushCode(`for (var ${r} = ${t}; ${r} > 0; ${r}--) {`),typeof a=="string")if(Z.get(a)){const l=n.generateTmpVariable();if(n.pushCode(`var ${l} = ${ae+a}(offset, {`),n.useContextVariables){const p=n.generateVariable();n.pushCode(`$parent: ${p},`),n.pushCode(`$root: ${p}.$root,`),!this.options.readUntil&&i===void 0&&n.pushCode(`$index: ${t} - ${r},`)}n.pushCode("});"),n.pushCode(`var ${f} = ${l}.result; offset = ${l}.offset;`),a!==this.alias&&n.addReference(a)}else{const l=Ye[a],p=Ke[a];n.pushCode(`var ${f} = dataView.get${l}(offset, ${p});`),n.pushCode(`offset += ${M[a]};`)}else if(a instanceof S){n.pushCode(`var ${f} = {};`);const l=n.generateVariable();n.pushScope(f),n.useContextVariables&&(n.pushCode(`${f}.$parent = ${l};`),n.pushCode(`${f}.$root = ${l}.$root;`),!this.options.readUntil&&i===void 0&&n.pushCode(`${f}.$index = ${t} - ${r};`)),a.generate(n),n.useContextVariables&&(n.pushCode(`delete ${f}.$parent;`),n.pushCode(`delete ${f}.$root;`),n.pushCode(`delete ${f}.$index;`)),n.popScope()}if(s?n.pushCode(`${o}[${f}.${u}] = ${f};`):n.pushCode(`${o}.push(${f});`),n.pushCode("}"),typeof this.options.readUntil=="function"){const l=this.options.readUntil,p=n.addImport(l);n.pushCode(`while (!${p}.call(${n.generateVariable()}, ${f}, buffer.subarray(offset)));`)}}generateChoiceCase(n,t,i){if(typeof i=="string"){const a=n.generateVariable(this.varName);if(Z.has(i)){const r=n.generateTmpVariable();n.pushCode(`var ${r} = ${ae+i}(offset, {`),n.useContextVariables&&(n.pushCode(`$parent: ${a}.$parent,`),n.pushCode(`$root: ${a}.$root,`)),n.pushCode("});"),n.pushCode(`${a} = ${r}.result; offset = ${r}.offset;`),i!==this.alias&&n.addReference(i)}else{const r=Ye[i],o=Ke[i];n.pushCode(`${a} = dataView.get${r}(offset, ${o});`),n.pushCode(`offset += ${M[i]}`)}}else i instanceof S&&(n.pushPath(t),i.generate(n),n.popPath(t))}generateChoice(n){const t=n.generateOption(this.options.tag),i=n.generateVariable(this.varName);if(this.varName&&(n.pushCode(`${i} = {};`),n.useContextVariables)){const a=n.generateVariable();n.pushCode(`${i}.$parent = ${a};`),n.pushCode(`${i}.$root = ${a}.$root;`)}n.pushCode(`switch(${t}) {`);for(const a in this.options.choices){const r=parseInt(a,10),o=this.options.choices[r];n.pushCode(`case ${r}:`),this.generateChoiceCase(n,this.varName,o),n.pushCode("break;")}n.pushCode("default:"),this.options.defaultChoice?this.generateChoiceCase(n,this.varName,this.options.defaultChoice):n.generateError(`"Met undefined tag value " + ${t} + " at choice"`),n.pushCode("}"),this.varName&&n.useContextVariables&&(n.pushCode(`delete ${i}.$parent;`),n.pushCode(`delete ${i}.$root;`))}generateNest(n){const t=n.generateVariable(this.varName);if(this.options.type instanceof S){if(this.varName&&(n.pushCode(`${t} = {};`),n.useContextVariables)){const i=n.generateVariable();n.pushCode(`${t}.$parent = ${i};`),n.pushCode(`${t}.$root = ${i}.$root;`)}n.pushPath(this.varName),this.options.type.generate(n),n.popPath(this.varName),this.varName&&n.useContextVariables&&n.useContextVariables&&(n.pushCode(`delete ${t}.$parent;`),n.pushCode(`delete ${t}.$root;`))}else if(Z.has(this.options.type)){const i=n.generateTmpVariable();if(n.pushCode(`var ${i} = ${ae+this.options.type}(offset, {`),n.useContextVariables){const a=n.generateVariable();n.pushCode(`$parent: ${a},`),n.pushCode(`$root: ${a}.$root,`)}n.pushCode("});"),n.pushCode(`${t} = ${i}.result; offset = ${i}.offset;`),this.options.type!==this.alias&&n.addReference(this.options.type)}}generateWrapper(n){const t=n.generateVariable(this.varName),i=n.generateTmpVariable();if(typeof this.options.readUntil=="function"){const u=this.options.readUntil,s=n.generateTmpVariable(),l=n.generateTmpVariable();n.pushCode(`var ${s} = offset;`),n.pushCode(`var ${l} = 0;`),n.pushCode("while (offset < buffer.length) {"),n.pushCode(`${l} = dataView.getUint8(offset);`);const p=n.addImport(u);n.pushCode(`if (${p}.call(${n.generateVariable()}, ${l}, buffer.subarray(offset))) break;`),n.pushCode("offset += 1;"),n.pushCode("}"),n.pushCode(`${i} = buffer.subarray(${s}, offset);`)}else if(this.options.readUntil==="eof")n.pushCode(`${i} = buffer.subarray(offset);`);else{const u=n.generateOption(this.options.length);n.pushCode(`${i} = buffer.subarray(offset, offset + ${u});`),n.pushCode(`offset += ${u};`)}this.options.clone&&n.pushCode(`${i} = buffer.constructor.from(${i});`);const a=n.generateTmpVariable(),r=n.generateTmpVariable(),o=n.generateTmpVariable(),f=n.addImport(this.options.wrapper);if(n.pushCode(`${i} = ${f}.call(this, ${i}).subarray(0);`),n.pushCode(`var ${a} = buffer;`),n.pushCode(`var ${r} = offset;`),n.pushCode(`var ${o} = dataView;`),n.pushCode(`buffer = ${i};`),n.pushCode("offset = 0;"),n.pushCode("dataView = new DataView(buffer.buffer, buffer.byteOffset, buffer.length);"),this.options.type instanceof S)this.varName&&n.pushCode(`${t} = {};`),n.pushPath(this.varName),this.options.type.generate(n),n.popPath(this.varName);else if(Z.has(this.options.type)){const u=n.generateTmpVariable();n.pushCode(`var ${u} = ${ae+this.options.type}(0);`),n.pushCode(`${t} = ${u}.result;`),this.options.type!==this.alias&&n.addReference(this.options.type)}n.pushCode(`buffer = ${a};`),n.pushCode(`dataView = ${o};`),n.pushCode(`offset = ${r};`)}generateFormatter(n,t,i){if(typeof i=="function"){const a=n.addImport(i);n.pushCode(`${t} = ${a}.call(${n.generateVariable()}, ${t});`)}}generatePointer(n){const t=this.options.type,i=n.generateOption(this.options.offset),a=n.generateTmpVariable(),r=n.generateVariable(this.varName);if(n.pushCode(`var ${a} = offset;`),n.pushCode(`offset = ${i};`),this.options.type instanceof S){if(n.pushCode(`${r} = {};`),n.useContextVariables){const o=n.generateVariable();n.pushCode(`${r}.$parent = ${o};`),n.pushCode(`${r}.$root = ${o}.$root;`)}n.pushPath(this.varName),this.options.type.generate(n),n.popPath(this.varName),n.useContextVariables&&(n.pushCode(`delete ${r}.$parent;`),n.pushCode(`delete ${r}.$root;`))}else if(Z.has(this.options.type)){const o=n.generateTmpVariable();if(n.pushCode(`var ${o} = ${ae+this.options.type}(offset, {`),n.useContextVariables){const f=n.generateVariable();n.pushCode(`$parent: ${f},`),n.pushCode(`$root: ${f}.$root,`)}n.pushCode("});"),n.pushCode(`${r} = ${o}.result; offset = ${o}.offset;`),this.options.type!==this.alias&&n.addReference(this.options.type)}else if(Object.keys(M).indexOf(this.options.type)>=0){const o=Ye[t],f=Ke[t];n.pushCode(`${r} = dataView.get${o}(offset, ${f});`),n.pushCode(`offset += ${M[t]};`)}n.pushCode(`offset = ${a};`)}generateSaveOffset(n){const t=n.generateVariable(this.varName);n.pushCode(`${t} = offset`)}}class pe{constructor(n){this.ranges=n}get min(){return this.ranges[0].min}get max(){return this.ranges[this.ranges.length-1].max}contains(n){for(const t of this.ranges)if(t.min<=n&&t.max>=n)return!0;return!1}isContiguous(){return this.ranges.length>1}getRanges(){return this.ranges.map(n=>new pe([{min:n.min,max:n.max}]))}toString(){return this.ranges.map(n=>`[${n.min}-${n.max}]`).join(",")}union(n){const t=[...this.getRanges(),...n.getRanges()].sort((r,o)=>r.min<o.min?-1:r.min>o.min?1:r.max<o.max?-1:o.max>r.max?1:0),i=[];let a=t[0];for(const r of t)r.min>a.max+1?(i.push(a),a=r):r.max>a.max&&(a=new pe([{min:a.min,max:r.max}]));return i.push(a),i.length===1?i[0]:new pe(i)}}/*! pako 2.1.0 https://github.com/nodeca/pako @license (MIT AND Zlib) */const lr=4,en=0,tn=1,ur=2;function ye(e){let n=e.length;for(;--n>=0;)e[n]=0}const hr=0,Wn=1,cr=2,dr=3,pr=258,Zt=29,Pe=256,Ae=Pe+1+Zt,_e=30,Mt=19,Xn=2*Ae+1,oe=15,dt=16,_r=7,Ht=256,qn=16,Jn=17,Qn=18,At=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),nt=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),br=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),ei=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),gr=512,W=new Array((Ae+2)*2);ye(W);const xe=new Array(_e*2);ye(xe);const Oe=new Array(gr);ye(Oe);const ze=new Array(pr-dr+1);ye(ze);const jt=new Array(Zt);ye(jt);const it=new Array(_e);ye(it);function pt(e,n,t,i,a){this.static_tree=e,this.extra_bits=n,this.extra_base=t,this.elems=i,this.max_length=a,this.has_stree=e&&e.length}let ti,ni,ii;function _t(e,n){this.dyn_tree=e,this.max_code=0,this.stat_desc=n}const ri=e=>e<256?Oe[e]:Oe[256+(e>>>7)],Re=(e,n)=>{e.pending_buf[e.pending++]=n&255,e.pending_buf[e.pending++]=n>>>8&255},U=(e,n,t)=>{e.bi_valid>dt-t?(e.bi_buf|=n<<e.bi_valid&65535,Re(e,e.bi_buf),e.bi_buf=n>>dt-e.bi_valid,e.bi_valid+=t-dt):(e.bi_buf|=n<<e.bi_valid&65535,e.bi_valid+=t)},j=(e,n,t)=>{U(e,t[n*2],t[n*2+1])},ai=(e,n)=>{let t=0;do t|=e&1,e>>>=1,t<<=1;while(--n>0);return t>>>1},wr=e=>{e.bi_valid===16?(Re(e,e.bi_buf),e.bi_buf=0,e.bi_valid=0):e.bi_valid>=8&&(e.pending_buf[e.pending++]=e.bi_buf&255,e.bi_buf>>=8,e.bi_valid-=8)},mr=(e,n)=>{const t=n.dyn_tree,i=n.max_code,a=n.stat_desc.static_tree,r=n.stat_desc.has_stree,o=n.stat_desc.extra_bits,f=n.stat_desc.extra_base,u=n.stat_desc.max_length;let s,l,p,c,h,_,g=0;for(c=0;c<=oe;c++)e.bl_count[c]=0;for(t[e.heap[e.heap_max]*2+1]=0,s=e.heap_max+1;s<Xn;s++)l=e.heap[s],c=t[t[l*2+1]*2+1]+1,c>u&&(c=u,g++),t[l*2+1]=c,!(l>i)&&(e.bl_count[c]++,h=0,l>=f&&(h=o[l-f]),_=t[l*2],e.opt_len+=_*(c+h),r&&(e.static_len+=_*(a[l*2+1]+h)));if(g!==0){do{for(c=u-1;e.bl_count[c]===0;)c--;e.bl_count[c]--,e.bl_count[c+1]+=2,e.bl_count[u]--,g-=2}while(g>0);for(c=u;c!==0;c--)for(l=e.bl_count[c];l!==0;)p=e.heap[--s],!(p>i)&&(t[p*2+1]!==c&&(e.opt_len+=(c-t[p*2+1])*t[p*2],t[p*2+1]=c),l--)}},oi=(e,n,t)=>{const i=new Array(oe+1);let a=0,r,o;for(r=1;r<=oe;r++)a=a+t[r-1]<<1,i[r]=a;for(o=0;o<=n;o++){let f=e[o*2+1];f!==0&&(e[o*2]=ai(i[f]++,f))}},yr=()=>{let e,n,t,i,a;const r=new Array(oe+1);for(t=0,i=0;i<Zt-1;i++)for(jt[i]=t,e=0;e<1<<At[i];e++)ze[t++]=i;for(ze[t-1]=i,a=0,i=0;i<16;i++)for(it[i]=a,e=0;e<1<<nt[i];e++)Oe[a++]=i;for(a>>=7;i<_e;i++)for(it[i]=a<<7,e=0;e<1<<nt[i]-7;e++)Oe[256+a++]=i;for(n=0;n<=oe;n++)r[n]=0;for(e=0;e<=143;)W[e*2+1]=8,e++,r[8]++;for(;e<=255;)W[e*2+1]=9,e++,r[9]++;for(;e<=279;)W[e*2+1]=7,e++,r[7]++;for(;e<=287;)W[e*2+1]=8,e++,r[8]++;for(oi(W,Ae+1,r),e=0;e<_e;e++)xe[e*2+1]=5,xe[e*2]=ai(e,5);ti=new pt(W,At,Pe+1,Ae,oe),ni=new pt(xe,nt,0,_e,oe),ii=new pt(new Array(0),br,0,Mt,_r)},si=e=>{let n;for(n=0;n<Ae;n++)e.dyn_ltree[n*2]=0;for(n=0;n<_e;n++)e.dyn_dtree[n*2]=0;for(n=0;n<Mt;n++)e.bl_tree[n*2]=0;e.dyn_ltree[Ht*2]=1,e.opt_len=e.static_len=0,e.sym_next=e.matches=0},fi=e=>{e.bi_valid>8?Re(e,e.bi_buf):e.bi_valid>0&&(e.pending_buf[e.pending++]=e.bi_buf),e.bi_buf=0,e.bi_valid=0},nn=(e,n,t,i)=>{const a=n*2,r=t*2;return e[a]<e[r]||e[a]===e[r]&&i[n]<=i[t]},bt=(e,n,t)=>{const i=e.heap[t];let a=t<<1;for(;a<=e.heap_len&&(a<e.heap_len&&nn(n,e.heap[a+1],e.heap[a],e.depth)&&a++,!nn(n,i,e.heap[a],e.depth));)e.heap[t]=e.heap[a],t=a,a<<=1;e.heap[t]=i},rn=(e,n,t)=>{let i,a,r=0,o,f;if(e.sym_next!==0)do i=e.pending_buf[e.sym_buf+r++]&255,i+=(e.pending_buf[e.sym_buf+r++]&255)<<8,a=e.pending_buf[e.sym_buf+r++],i===0?j(e,a,n):(o=ze[a],j(e,o+Pe+1,n),f=At[o],f!==0&&(a-=jt[o],U(e,a,f)),i--,o=ri(i),j(e,o,t),f=nt[o],f!==0&&(i-=it[o],U(e,i,f)));while(r<e.sym_next);j(e,Ht,n)},Ot=(e,n)=>{const t=n.dyn_tree,i=n.stat_desc.static_tree,a=n.stat_desc.has_stree,r=n.stat_desc.elems;let o,f,u=-1,s;for(e.heap_len=0,e.heap_max=Xn,o=0;o<r;o++)t[o*2]!==0?(e.heap[++e.heap_len]=u=o,e.depth[o]=0):t[o*2+1]=0;for(;e.heap_len<2;)s=e.heap[++e.heap_len]=u<2?++u:0,t[s*2]=1,e.depth[s]=0,e.opt_len--,a&&(e.static_len-=i[s*2+1]);for(n.max_code=u,o=e.heap_len>>1;o>=1;o--)bt(e,t,o);s=r;do o=e.heap[1],e.heap[1]=e.heap[e.heap_len--],bt(e,t,1),f=e.heap[1],e.heap[--e.heap_max]=o,e.heap[--e.heap_max]=f,t[s*2]=t[o*2]+t[f*2],e.depth[s]=(e.depth[o]>=e.depth[f]?e.depth[o]:e.depth[f])+1,t[o*2+1]=t[f*2+1]=s,e.heap[1]=s++,bt(e,t,1);while(e.heap_len>=2);e.heap[--e.heap_max]=e.heap[1],mr(e,n),oi(t,u,e.bl_count)},an=(e,n,t)=>{let i,a=-1,r,o=n[0*2+1],f=0,u=7,s=4;for(o===0&&(u=138,s=3),n[(t+1)*2+1]=65535,i=0;i<=t;i++)r=o,o=n[(i+1)*2+1],!(++f<u&&r===o)&&(f<s?e.bl_tree[r*2]+=f:r!==0?(r!==a&&e.bl_tree[r*2]++,e.bl_tree[qn*2]++):f<=10?e.bl_tree[Jn*2]++:e.bl_tree[Qn*2]++,f=0,a=r,o===0?(u=138,s=3):r===o?(u=6,s=3):(u=7,s=4))},on=(e,n,t)=>{let i,a=-1,r,o=n[0*2+1],f=0,u=7,s=4;for(o===0&&(u=138,s=3),i=0;i<=t;i++)if(r=o,o=n[(i+1)*2+1],!(++f<u&&r===o)){if(f<s)do j(e,r,e.bl_tree);while(--f!==0);else r!==0?(r!==a&&(j(e,r,e.bl_tree),f--),j(e,qn,e.bl_tree),U(e,f-3,2)):f<=10?(j(e,Jn,e.bl_tree),U(e,f-3,3)):(j(e,Qn,e.bl_tree),U(e,f-11,7));f=0,a=r,o===0?(u=138,s=3):r===o?(u=6,s=3):(u=7,s=4)}},vr=e=>{let n;for(an(e,e.dyn_ltree,e.l_desc.max_code),an(e,e.dyn_dtree,e.d_desc.max_code),Ot(e,e.bl_desc),n=Mt-1;n>=3&&e.bl_tree[ei[n]*2+1]===0;n--);return e.opt_len+=3*(n+1)+5+5+4,n},kr=(e,n,t,i)=>{let a;for(U(e,n-257,5),U(e,t-1,5),U(e,i-4,4),a=0;a<i;a++)U(e,e.bl_tree[ei[a]*2+1],3);on(e,e.dyn_ltree,n-1),on(e,e.dyn_dtree,t-1)},$r=e=>{let n=4093624447,t;for(t=0;t<=31;t++,n>>>=1)if(n&1&&e.dyn_ltree[t*2]!==0)return en;if(e.dyn_ltree[9*2]!==0||e.dyn_ltree[10*2]!==0||e.dyn_ltree[13*2]!==0)return tn;for(t=32;t<Pe;t++)if(e.dyn_ltree[t*2]!==0)return tn;return en};let sn=!1;const Er=e=>{sn||(yr(),sn=!0),e.l_desc=new _t(e.dyn_ltree,ti),e.d_desc=new _t(e.dyn_dtree,ni),e.bl_desc=new _t(e.bl_tree,ii),e.bi_buf=0,e.bi_valid=0,si(e)},li=(e,n,t,i)=>{U(e,(hr<<1)+(i?1:0),3),fi(e),Re(e,t),Re(e,~t),t&&e.pending_buf.set(e.window.subarray(n,n+t),e.pending),e.pending+=t},Cr=e=>{U(e,Wn<<1,3),j(e,Ht,W),wr(e)},Sr=(e,n,t,i)=>{let a,r,o=0;e.level>0?(e.strm.data_type===ur&&(e.strm.data_type=$r(e)),Ot(e,e.l_desc),Ot(e,e.d_desc),o=vr(e),a=e.opt_len+3+7>>>3,r=e.static_len+3+7>>>3,r<=a&&(a=r)):a=r=t+5,t+4<=a&&n!==-1?li(e,n,t,i):e.strategy===lr||r===a?(U(e,(Wn<<1)+(i?1:0),3),rn(e,W,xe)):(U(e,(cr<<1)+(i?1:0),3),kr(e,e.l_desc.max_code+1,e.d_desc.max_code+1,o+1),rn(e,e.dyn_ltree,e.dyn_dtree)),si(e),i&&fi(e)},Nr=(e,n,t)=>(e.pending_buf[e.sym_buf+e.sym_next++]=n,e.pending_buf[e.sym_buf+e.sym_next++]=n>>8,e.pending_buf[e.sym_buf+e.sym_next++]=t,n===0?e.dyn_ltree[t*2]++:(e.matches++,n--,e.dyn_ltree[(ze[t]+Pe+1)*2]++,e.dyn_dtree[ri(n)*2]++),e.sym_next===e.sym_end);var xr=Er,Ir=li,Tr=Sr,Ar=Nr,Or=Cr,zr={_tr_init:xr,_tr_stored_block:Ir,_tr_flush_block:Tr,_tr_tally:Ar,_tr_align:Or};const Rr=(e,n,t,i)=>{let a=e&65535|0,r=e>>>16&65535|0,o=0;for(;t!==0;){o=t>2e3?2e3:t,t-=o;do a=a+n[i++]|0,r=r+a|0;while(--o);a%=65521,r%=65521}return a|r<<16|0};var Be=Rr;const Br=()=>{let e,n=[];for(var t=0;t<256;t++){e=t;for(var i=0;i<8;i++)e=e&1?3988292384^e>>>1:e>>>1;n[t]=e}return n},Ur=new Uint32Array(Br()),Dr=(e,n,t,i)=>{const a=Ur,r=i+t;e^=-1;for(let o=i;o<r;o++)e=e>>>8^a[(e^n[o])&255];return e^-1};var z=Dr,ge={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},Ze={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8};const{_tr_init:Vr,_tr_stored_block:zt,_tr_flush_block:Lr,_tr_tally:ee,_tr_align:Fr}=zr,{Z_NO_FLUSH:te,Z_PARTIAL_FLUSH:Pr,Z_FULL_FLUSH:Zr,Z_FINISH:L,Z_BLOCK:fn,Z_OK:R,Z_STREAM_END:ln,Z_STREAM_ERROR:G,Z_DATA_ERROR:Mr,Z_BUF_ERROR:gt,Z_DEFAULT_COMPRESSION:Hr,Z_FILTERED:jr,Z_HUFFMAN_ONLY:We,Z_RLE:Gr,Z_FIXED:Yr,Z_DEFAULT_STRATEGY:Kr,Z_UNKNOWN:Wr,Z_DEFLATED:ut}=Ze,Xr=9,qr=15,Jr=8,Qr=29,ea=256,Rt=ea+1+Qr,ta=30,na=19,ia=2*Rt+1,ra=15,I=3,Q=258,Y=Q+I+1,aa=32,we=42,Gt=57,Bt=69,Ut=73,Dt=91,Vt=103,se=113,Se=666,B=1,ve=2,le=3,ke=4,oa=3,fe=(e,n)=>(e.msg=ge[n],n),un=e=>e*2-(e>4?9:0),q=e=>{let n=e.length;for(;--n>=0;)e[n]=0},sa=e=>{let n,t,i,a=e.w_size;n=e.hash_size,i=n;do t=e.head[--i],e.head[i]=t>=a?t-a:0;while(--n);n=a,i=n;do t=e.prev[--i],e.prev[i]=t>=a?t-a:0;while(--n)};let fa=(e,n,t)=>(n<<e.hash_shift^t)&e.hash_mask,ne=fa;const D=e=>{const n=e.state;let t=n.pending;t>e.avail_out&&(t=e.avail_out),t!==0&&(e.output.set(n.pending_buf.subarray(n.pending_out,n.pending_out+t),e.next_out),e.next_out+=t,n.pending_out+=t,e.total_out+=t,e.avail_out-=t,n.pending-=t,n.pending===0&&(n.pending_out=0))},V=(e,n)=>{Lr(e,e.block_start>=0?e.block_start:-1,e.strstart-e.block_start,n),e.block_start=e.strstart,D(e.strm)},T=(e,n)=>{e.pending_buf[e.pending++]=n},Ce=(e,n)=>{e.pending_buf[e.pending++]=n>>>8&255,e.pending_buf[e.pending++]=n&255},Lt=(e,n,t,i)=>{let a=e.avail_in;return a>i&&(a=i),a===0?0:(e.avail_in-=a,n.set(e.input.subarray(e.next_in,e.next_in+a),t),e.state.wrap===1?e.adler=Be(e.adler,n,a,t):e.state.wrap===2&&(e.adler=z(e.adler,n,a,t)),e.next_in+=a,e.total_in+=a,a)},ui=(e,n)=>{let t=e.max_chain_length,i=e.strstart,a,r,o=e.prev_length,f=e.nice_match;const u=e.strstart>e.w_size-Y?e.strstart-(e.w_size-Y):0,s=e.window,l=e.w_mask,p=e.prev,c=e.strstart+Q;let h=s[i+o-1],_=s[i+o];e.prev_length>=e.good_match&&(t>>=2),f>e.lookahead&&(f=e.lookahead);do if(a=n,!(s[a+o]!==_||s[a+o-1]!==h||s[a]!==s[i]||s[++a]!==s[i+1])){i+=2,a++;do;while(s[++i]===s[++a]&&s[++i]===s[++a]&&s[++i]===s[++a]&&s[++i]===s[++a]&&s[++i]===s[++a]&&s[++i]===s[++a]&&s[++i]===s[++a]&&s[++i]===s[++a]&&i<c);if(r=Q-(c-i),i=c-Q,r>o){if(e.match_start=n,o=r,r>=f)break;h=s[i+o-1],_=s[i+o]}}while((n=p[n&l])>u&&--t!==0);return o<=e.lookahead?o:e.lookahead},me=e=>{const n=e.w_size;let t,i,a;do{if(i=e.window_size-e.lookahead-e.strstart,e.strstart>=n+(n-Y)&&(e.window.set(e.window.subarray(n,n+n-i),0),e.match_start-=n,e.strstart-=n,e.block_start-=n,e.insert>e.strstart&&(e.insert=e.strstart),sa(e),i+=n),e.strm.avail_in===0)break;if(t=Lt(e.strm,e.window,e.strstart+e.lookahead,i),e.lookahead+=t,e.lookahead+e.insert>=I)for(a=e.strstart-e.insert,e.ins_h=e.window[a],e.ins_h=ne(e,e.ins_h,e.window[a+1]);e.insert&&(e.ins_h=ne(e,e.ins_h,e.window[a+I-1]),e.prev[a&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=a,a++,e.insert--,!(e.lookahead+e.insert<I)););}while(e.lookahead<Y&&e.strm.avail_in!==0)},hi=(e,n)=>{let t=e.pending_buf_size-5>e.w_size?e.w_size:e.pending_buf_size-5,i,a,r,o=0,f=e.strm.avail_in;do{if(i=65535,r=e.bi_valid+42>>3,e.strm.avail_out<r||(r=e.strm.avail_out-r,a=e.strstart-e.block_start,i>a+e.strm.avail_in&&(i=a+e.strm.avail_in),i>r&&(i=r),i<t&&(i===0&&n!==L||n===te||i!==a+e.strm.avail_in)))break;o=n===L&&i===a+e.strm.avail_in?1:0,zt(e,0,0,o),e.pending_buf[e.pending-4]=i,e.pending_buf[e.pending-3]=i>>8,e.pending_buf[e.pending-2]=~i,e.pending_buf[e.pending-1]=~i>>8,D(e.strm),a&&(a>i&&(a=i),e.strm.output.set(e.window.subarray(e.block_start,e.block_start+a),e.strm.next_out),e.strm.next_out+=a,e.strm.avail_out-=a,e.strm.total_out+=a,e.block_start+=a,i-=a),i&&(Lt(e.strm,e.strm.output,e.strm.next_out,i),e.strm.next_out+=i,e.strm.avail_out-=i,e.strm.total_out+=i)}while(o===0);return f-=e.strm.avail_in,f&&(f>=e.w_size?(e.matches=2,e.window.set(e.strm.input.subarray(e.strm.next_in-e.w_size,e.strm.next_in),0),e.strstart=e.w_size,e.insert=e.strstart):(e.window_size-e.strstart<=f&&(e.strstart-=e.w_size,e.window.set(e.window.subarray(e.w_size,e.w_size+e.strstart),0),e.matches<2&&e.matches++,e.insert>e.strstart&&(e.insert=e.strstart)),e.window.set(e.strm.input.subarray(e.strm.next_in-f,e.strm.next_in),e.strstart),e.strstart+=f,e.insert+=f>e.w_size-e.insert?e.w_size-e.insert:f),e.block_start=e.strstart),e.high_water<e.strstart&&(e.high_water=e.strstart),o?ke:n!==te&&n!==L&&e.strm.avail_in===0&&e.strstart===e.block_start?ve:(r=e.window_size-e.strstart,e.strm.avail_in>r&&e.block_start>=e.w_size&&(e.block_start-=e.w_size,e.strstart-=e.w_size,e.window.set(e.window.subarray(e.w_size,e.w_size+e.strstart),0),e.matches<2&&e.matches++,r+=e.w_size,e.insert>e.strstart&&(e.insert=e.strstart)),r>e.strm.avail_in&&(r=e.strm.avail_in),r&&(Lt(e.strm,e.window,e.strstart,r),e.strstart+=r,e.insert+=r>e.w_size-e.insert?e.w_size-e.insert:r),e.high_water<e.strstart&&(e.high_water=e.strstart),r=e.bi_valid+42>>3,r=e.pending_buf_size-r>65535?65535:e.pending_buf_size-r,t=r>e.w_size?e.w_size:r,a=e.strstart-e.block_start,(a>=t||(a||n===L)&&n!==te&&e.strm.avail_in===0&&a<=r)&&(i=a>r?r:a,o=n===L&&e.strm.avail_in===0&&i===a?1:0,zt(e,e.block_start,i,o),e.block_start+=i,D(e.strm)),o?le:B)},wt=(e,n)=>{let t,i;for(;;){if(e.lookahead<Y){if(me(e),e.lookahead<Y&&n===te)return B;if(e.lookahead===0)break}if(t=0,e.lookahead>=I&&(e.ins_h=ne(e,e.ins_h,e.window[e.strstart+I-1]),t=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),t!==0&&e.strstart-t<=e.w_size-Y&&(e.match_length=ui(e,t)),e.match_length>=I)if(i=ee(e,e.strstart-e.match_start,e.match_length-I),e.lookahead-=e.match_length,e.match_length<=e.max_lazy_match&&e.lookahead>=I){e.match_length--;do e.strstart++,e.ins_h=ne(e,e.ins_h,e.window[e.strstart+I-1]),t=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart;while(--e.match_length!==0);e.strstart++}else e.strstart+=e.match_length,e.match_length=0,e.ins_h=e.window[e.strstart],e.ins_h=ne(e,e.ins_h,e.window[e.strstart+1]);else i=ee(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++;if(i&&(V(e,!1),e.strm.avail_out===0))return B}return e.insert=e.strstart<I-1?e.strstart:I-1,n===L?(V(e,!0),e.strm.avail_out===0?le:ke):e.sym_next&&(V(e,!1),e.strm.avail_out===0)?B:ve},ce=(e,n)=>{let t,i,a;for(;;){if(e.lookahead<Y){if(me(e),e.lookahead<Y&&n===te)return B;if(e.lookahead===0)break}if(t=0,e.lookahead>=I&&(e.ins_h=ne(e,e.ins_h,e.window[e.strstart+I-1]),t=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),e.prev_length=e.match_length,e.prev_match=e.match_start,e.match_length=I-1,t!==0&&e.prev_length<e.max_lazy_match&&e.strstart-t<=e.w_size-Y&&(e.match_length=ui(e,t),e.match_length<=5&&(e.strategy===jr||e.match_length===I&&e.strstart-e.match_start>4096)&&(e.match_length=I-1)),e.prev_length>=I&&e.match_length<=e.prev_length){a=e.strstart+e.lookahead-I,i=ee(e,e.strstart-1-e.prev_match,e.prev_length-I),e.lookahead-=e.prev_length-1,e.prev_length-=2;do++e.strstart<=a&&(e.ins_h=ne(e,e.ins_h,e.window[e.strstart+I-1]),t=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart);while(--e.prev_length!==0);if(e.match_available=0,e.match_length=I-1,e.strstart++,i&&(V(e,!1),e.strm.avail_out===0))return B}else if(e.match_available){if(i=ee(e,0,e.window[e.strstart-1]),i&&V(e,!1),e.strstart++,e.lookahead--,e.strm.avail_out===0)return B}else e.match_available=1,e.strstart++,e.lookahead--}return e.match_available&&(i=ee(e,0,e.window[e.strstart-1]),e.match_available=0),e.insert=e.strstart<I-1?e.strstart:I-1,n===L?(V(e,!0),e.strm.avail_out===0?le:ke):e.sym_next&&(V(e,!1),e.strm.avail_out===0)?B:ve},la=(e,n)=>{let t,i,a,r;const o=e.window;for(;;){if(e.lookahead<=Q){if(me(e),e.lookahead<=Q&&n===te)return B;if(e.lookahead===0)break}if(e.match_length=0,e.lookahead>=I&&e.strstart>0&&(a=e.strstart-1,i=o[a],i===o[++a]&&i===o[++a]&&i===o[++a])){r=e.strstart+Q;do;while(i===o[++a]&&i===o[++a]&&i===o[++a]&&i===o[++a]&&i===o[++a]&&i===o[++a]&&i===o[++a]&&i===o[++a]&&a<r);e.match_length=Q-(r-a),e.match_length>e.lookahead&&(e.match_length=e.lookahead)}if(e.match_length>=I?(t=ee(e,1,e.match_length-I),e.lookahead-=e.match_length,e.strstart+=e.match_length,e.match_length=0):(t=ee(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++),t&&(V(e,!1),e.strm.avail_out===0))return B}return e.insert=0,n===L?(V(e,!0),e.strm.avail_out===0?le:ke):e.sym_next&&(V(e,!1),e.strm.avail_out===0)?B:ve},ua=(e,n)=>{let t;for(;;){if(e.lookahead===0&&(me(e),e.lookahead===0)){if(n===te)return B;break}if(e.match_length=0,t=ee(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++,t&&(V(e,!1),e.strm.avail_out===0))return B}return e.insert=0,n===L?(V(e,!0),e.strm.avail_out===0?le:ke):e.sym_next&&(V(e,!1),e.strm.avail_out===0)?B:ve};function H(e,n,t,i,a){this.good_length=e,this.max_lazy=n,this.nice_length=t,this.max_chain=i,this.func=a}const Ne=[new H(0,0,0,0,hi),new H(4,4,8,4,wt),new H(4,5,16,8,wt),new H(4,6,32,32,wt),new H(4,4,16,16,ce),new H(8,16,32,32,ce),new H(8,16,128,128,ce),new H(8,32,128,256,ce),new H(32,128,258,1024,ce),new H(32,258,258,4096,ce)],ha=e=>{e.window_size=2*e.w_size,q(e.head),e.max_lazy_match=Ne[e.level].max_lazy,e.good_match=Ne[e.level].good_length,e.nice_match=Ne[e.level].nice_length,e.max_chain_length=Ne[e.level].max_chain,e.strstart=0,e.block_start=0,e.lookahead=0,e.insert=0,e.match_length=e.prev_length=I-1,e.match_available=0,e.ins_h=0};function ca(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=ut,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(ia*2),this.dyn_dtree=new Uint16Array((2*ta+1)*2),this.bl_tree=new Uint16Array((2*na+1)*2),q(this.dyn_ltree),q(this.dyn_dtree),q(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(ra+1),this.heap=new Uint16Array(2*Rt+1),q(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(2*Rt+1),q(this.depth),this.sym_buf=0,this.lit_bufsize=0,this.sym_next=0,this.sym_end=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const Me=e=>{if(!e)return 1;const n=e.state;return!n||n.strm!==e||n.status!==we&&n.status!==Gt&&n.status!==Bt&&n.status!==Ut&&n.status!==Dt&&n.status!==Vt&&n.status!==se&&n.status!==Se?1:0},ci=e=>{if(Me(e))return fe(e,G);e.total_in=e.total_out=0,e.data_type=Wr;const n=e.state;return n.pending=0,n.pending_out=0,n.wrap<0&&(n.wrap=-n.wrap),n.status=n.wrap===2?Gt:n.wrap?we:se,e.adler=n.wrap===2?0:1,n.last_flush=-2,Vr(n),R},di=e=>{const n=ci(e);return n===R&&ha(e.state),n},da=(e,n)=>Me(e)||e.state.wrap!==2?G:(e.state.gzhead=n,R),pi=(e,n,t,i,a,r)=>{if(!e)return G;let o=1;if(n===Hr&&(n=6),i<0?(o=0,i=-i):i>15&&(o=2,i-=16),a<1||a>Xr||t!==ut||i<8||i>15||n<0||n>9||r<0||r>Yr||i===8&&o!==1)return fe(e,G);i===8&&(i=9);const f=new ca;return e.state=f,f.strm=e,f.status=we,f.wrap=o,f.gzhead=null,f.w_bits=i,f.w_size=1<<f.w_bits,f.w_mask=f.w_size-1,f.hash_bits=a+7,f.hash_size=1<<f.hash_bits,f.hash_mask=f.hash_size-1,f.hash_shift=~~((f.hash_bits+I-1)/I),f.window=new Uint8Array(f.w_size*2),f.head=new Uint16Array(f.hash_size),f.prev=new Uint16Array(f.w_size),f.lit_bufsize=1<<a+6,f.pending_buf_size=f.lit_bufsize*4,f.pending_buf=new Uint8Array(f.pending_buf_size),f.sym_buf=f.lit_bufsize,f.sym_end=(f.lit_bufsize-1)*3,f.level=n,f.strategy=r,f.method=t,di(e)},pa=(e,n)=>pi(e,n,ut,qr,Jr,Kr),_a=(e,n)=>{if(Me(e)||n>fn||n<0)return e?fe(e,G):G;const t=e.state;if(!e.output||e.avail_in!==0&&!e.input||t.status===Se&&n!==L)return fe(e,e.avail_out===0?gt:G);const i=t.last_flush;if(t.last_flush=n,t.pending!==0){if(D(e),e.avail_out===0)return t.last_flush=-1,R}else if(e.avail_in===0&&un(n)<=un(i)&&n!==L)return fe(e,gt);if(t.status===Se&&e.avail_in!==0)return fe(e,gt);if(t.status===we&&t.wrap===0&&(t.status=se),t.status===we){let a=ut+(t.w_bits-8<<4)<<8,r=-1;if(t.strategy>=We||t.level<2?r=0:t.level<6?r=1:t.level===6?r=2:r=3,a|=r<<6,t.strstart!==0&&(a|=aa),a+=31-a%31,Ce(t,a),t.strstart!==0&&(Ce(t,e.adler>>>16),Ce(t,e.adler&65535)),e.adler=1,t.status=se,D(e),t.pending!==0)return t.last_flush=-1,R}if(t.status===Gt){if(e.adler=0,T(t,31),T(t,139),T(t,8),t.gzhead)T(t,(t.gzhead.text?1:0)+(t.gzhead.hcrc?2:0)+(t.gzhead.extra?4:0)+(t.gzhead.name?8:0)+(t.gzhead.comment?16:0)),T(t,t.gzhead.time&255),T(t,t.gzhead.time>>8&255),T(t,t.gzhead.time>>16&255),T(t,t.gzhead.time>>24&255),T(t,t.level===9?2:t.strategy>=We||t.level<2?4:0),T(t,t.gzhead.os&255),t.gzhead.extra&&t.gzhead.extra.length&&(T(t,t.gzhead.extra.length&255),T(t,t.gzhead.extra.length>>8&255)),t.gzhead.hcrc&&(e.adler=z(e.adler,t.pending_buf,t.pending,0)),t.gzindex=0,t.status=Bt;else if(T(t,0),T(t,0),T(t,0),T(t,0),T(t,0),T(t,t.level===9?2:t.strategy>=We||t.level<2?4:0),T(t,oa),t.status=se,D(e),t.pending!==0)return t.last_flush=-1,R}if(t.status===Bt){if(t.gzhead.extra){let a=t.pending,r=(t.gzhead.extra.length&65535)-t.gzindex;for(;t.pending+r>t.pending_buf_size;){let f=t.pending_buf_size-t.pending;if(t.pending_buf.set(t.gzhead.extra.subarray(t.gzindex,t.gzindex+f),t.pending),t.pending=t.pending_buf_size,t.gzhead.hcrc&&t.pending>a&&(e.adler=z(e.adler,t.pending_buf,t.pending-a,a)),t.gzindex+=f,D(e),t.pending!==0)return t.last_flush=-1,R;a=0,r-=f}let o=new Uint8Array(t.gzhead.extra);t.pending_buf.set(o.subarray(t.gzindex,t.gzindex+r),t.pending),t.pending+=r,t.gzhead.hcrc&&t.pending>a&&(e.adler=z(e.adler,t.pending_buf,t.pending-a,a)),t.gzindex=0}t.status=Ut}if(t.status===Ut){if(t.gzhead.name){let a=t.pending,r;do{if(t.pending===t.pending_buf_size){if(t.gzhead.hcrc&&t.pending>a&&(e.adler=z(e.adler,t.pending_buf,t.pending-a,a)),D(e),t.pending!==0)return t.last_flush=-1,R;a=0}t.gzindex<t.gzhead.name.length?r=t.gzhead.name.charCodeAt(t.gzindex++)&255:r=0,T(t,r)}while(r!==0);t.gzhead.hcrc&&t.pending>a&&(e.adler=z(e.adler,t.pending_buf,t.pending-a,a)),t.gzindex=0}t.status=Dt}if(t.status===Dt){if(t.gzhead.comment){let a=t.pending,r;do{if(t.pending===t.pending_buf_size){if(t.gzhead.hcrc&&t.pending>a&&(e.adler=z(e.adler,t.pending_buf,t.pending-a,a)),D(e),t.pending!==0)return t.last_flush=-1,R;a=0}t.gzindex<t.gzhead.comment.length?r=t.gzhead.comment.charCodeAt(t.gzindex++)&255:r=0,T(t,r)}while(r!==0);t.gzhead.hcrc&&t.pending>a&&(e.adler=z(e.adler,t.pending_buf,t.pending-a,a))}t.status=Vt}if(t.status===Vt){if(t.gzhead.hcrc){if(t.pending+2>t.pending_buf_size&&(D(e),t.pending!==0))return t.last_flush=-1,R;T(t,e.adler&255),T(t,e.adler>>8&255),e.adler=0}if(t.status=se,D(e),t.pending!==0)return t.last_flush=-1,R}if(e.avail_in!==0||t.lookahead!==0||n!==te&&t.status!==Se){let a=t.level===0?hi(t,n):t.strategy===We?ua(t,n):t.strategy===Gr?la(t,n):Ne[t.level].func(t,n);if((a===le||a===ke)&&(t.status=Se),a===B||a===le)return e.avail_out===0&&(t.last_flush=-1),R;if(a===ve&&(n===Pr?Fr(t):n!==fn&&(zt(t,0,0,!1),n===Zr&&(q(t.head),t.lookahead===0&&(t.strstart=0,t.block_start=0,t.insert=0))),D(e),e.avail_out===0))return t.last_flush=-1,R}return n!==L?R:t.wrap<=0?ln:(t.wrap===2?(T(t,e.adler&255),T(t,e.adler>>8&255),T(t,e.adler>>16&255),T(t,e.adler>>24&255),T(t,e.total_in&255),T(t,e.total_in>>8&255),T(t,e.total_in>>16&255),T(t,e.total_in>>24&255)):(Ce(t,e.adler>>>16),Ce(t,e.adler&65535)),D(e),t.wrap>0&&(t.wrap=-t.wrap),t.pending!==0?R:ln)},ba=e=>{if(Me(e))return G;const n=e.state.status;return e.state=null,n===se?fe(e,Mr):R},ga=(e,n)=>{let t=n.length;if(Me(e))return G;const i=e.state,a=i.wrap;if(a===2||a===1&&i.status!==we||i.lookahead)return G;if(a===1&&(e.adler=Be(e.adler,n,t,0)),i.wrap=0,t>=i.w_size){a===0&&(q(i.head),i.strstart=0,i.block_start=0,i.insert=0);let u=new Uint8Array(i.w_size);u.set(n.subarray(t-i.w_size,t),0),n=u,t=i.w_size}const r=e.avail_in,o=e.next_in,f=e.input;for(e.avail_in=t,e.next_in=0,e.input=n,me(i);i.lookahead>=I;){let u=i.strstart,s=i.lookahead-(I-1);do i.ins_h=ne(i,i.ins_h,i.window[u+I-1]),i.prev[u&i.w_mask]=i.head[i.ins_h],i.head[i.ins_h]=u,u++;while(--s);i.strstart=u,i.lookahead=I-1,me(i)}return i.strstart+=i.lookahead,i.block_start=i.strstart,i.insert=i.lookahead,i.lookahead=0,i.match_length=i.prev_length=I-1,i.match_available=0,e.next_in=o,e.input=f,e.avail_in=r,i.wrap=a,R};var wa=pa,ma=pi,ya=di,va=ci,ka=da,$a=_a,Ea=ba,Ca=ga,Sa="pako deflate (from Nodeca project)",Ie={deflateInit:wa,deflateInit2:ma,deflateReset:ya,deflateResetKeep:va,deflateSetHeader:ka,deflate:$a,deflateEnd:Ea,deflateSetDictionary:Ca,deflateInfo:Sa};const Na=(e,n)=>Object.prototype.hasOwnProperty.call(e,n);var xa=function(e){const n=Array.prototype.slice.call(arguments,1);for(;n.length;){const t=n.shift();if(t){if(typeof t!="object")throw new TypeError(t+"must be non-object");for(const i in t)Na(t,i)&&(e[i]=t[i])}}return e},Ia=e=>{let n=0;for(let i=0,a=e.length;i<a;i++)n+=e[i].length;const t=new Uint8Array(n);for(let i=0,a=0,r=e.length;i<r;i++){let o=e[i];t.set(o,a),a+=o.length}return t},ht={assign:xa,flattenChunks:Ia};let _i=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{_i=!1}const Ue=new Uint8Array(256);for(let e=0;e<256;e++)Ue[e]=e>=252?6:e>=248?5:e>=240?4:e>=224?3:e>=192?2:1;Ue[254]=Ue[254]=1;var Ta=e=>{if(typeof TextEncoder=="function"&&TextEncoder.prototype.encode)return new TextEncoder().encode(e);let n,t,i,a,r,o=e.length,f=0;for(a=0;a<o;a++)t=e.charCodeAt(a),(t&64512)===55296&&a+1<o&&(i=e.charCodeAt(a+1),(i&64512)===56320&&(t=65536+(t-55296<<10)+(i-56320),a++)),f+=t<128?1:t<2048?2:t<65536?3:4;for(n=new Uint8Array(f),r=0,a=0;r<f;a++)t=e.charCodeAt(a),(t&64512)===55296&&a+1<o&&(i=e.charCodeAt(a+1),(i&64512)===56320&&(t=65536+(t-55296<<10)+(i-56320),a++)),t<128?n[r++]=t:t<2048?(n[r++]=192|t>>>6,n[r++]=128|t&63):t<65536?(n[r++]=224|t>>>12,n[r++]=128|t>>>6&63,n[r++]=128|t&63):(n[r++]=240|t>>>18,n[r++]=128|t>>>12&63,n[r++]=128|t>>>6&63,n[r++]=128|t&63);return n};const Aa=(e,n)=>{if(n<65534&&e.subarray&&_i)return String.fromCharCode.apply(null,e.length===n?e:e.subarray(0,n));let t="";for(let i=0;i<n;i++)t+=String.fromCharCode(e[i]);return t};var Oa=(e,n)=>{const t=n||e.length;if(typeof TextDecoder=="function"&&TextDecoder.prototype.decode)return new TextDecoder().decode(e.subarray(0,n));let i,a;const r=new Array(t*2);for(a=0,i=0;i<t;){let o=e[i++];if(o<128){r[a++]=o;continue}let f=Ue[o];if(f>4){r[a++]=65533,i+=f-1;continue}for(o&=f===2?31:f===3?15:7;f>1&&i<t;)o=o<<6|e[i++]&63,f--;if(f>1){r[a++]=65533;continue}o<65536?r[a++]=o:(o-=65536,r[a++]=55296|o>>10&1023,r[a++]=56320|o&1023)}return Aa(r,a)},za=(e,n)=>{n=n||e.length,n>e.length&&(n=e.length);let t=n-1;for(;t>=0&&(e[t]&192)===128;)t--;return t<0||t===0?n:t+Ue[e[t]]>n?t:n},De={string2buf:Ta,buf2string:Oa,utf8border:za};function Ra(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}var bi=Ra;const gi=Object.prototype.toString,{Z_NO_FLUSH:Ba,Z_SYNC_FLUSH:Ua,Z_FULL_FLUSH:Da,Z_FINISH:Va,Z_OK:rt,Z_STREAM_END:La,Z_DEFAULT_COMPRESSION:Fa,Z_DEFAULT_STRATEGY:Pa,Z_DEFLATED:Za}=Ze;function Yt(e){this.options=ht.assign({level:Fa,method:Za,chunkSize:16384,windowBits:15,memLevel:8,strategy:Pa},e||{});let n=this.options;n.raw&&n.windowBits>0?n.windowBits=-n.windowBits:n.gzip&&n.windowBits>0&&n.windowBits<16&&(n.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new bi,this.strm.avail_out=0;let t=Ie.deflateInit2(this.strm,n.level,n.method,n.windowBits,n.memLevel,n.strategy);if(t!==rt)throw new Error(ge[t]);if(n.header&&Ie.deflateSetHeader(this.strm,n.header),n.dictionary){let i;if(typeof n.dictionary=="string"?i=De.string2buf(n.dictionary):gi.call(n.dictionary)==="[object ArrayBuffer]"?i=new Uint8Array(n.dictionary):i=n.dictionary,t=Ie.deflateSetDictionary(this.strm,i),t!==rt)throw new Error(ge[t]);this._dict_set=!0}}Yt.prototype.push=function(e,n){const t=this.strm,i=this.options.chunkSize;let a,r;if(this.ended)return!1;for(n===~~n?r=n:r=n===!0?Va:Ba,typeof e=="string"?t.input=De.string2buf(e):gi.call(e)==="[object ArrayBuffer]"?t.input=new Uint8Array(e):t.input=e,t.next_in=0,t.avail_in=t.input.length;;){if(t.avail_out===0&&(t.output=new Uint8Array(i),t.next_out=0,t.avail_out=i),(r===Ua||r===Da)&&t.avail_out<=6){this.onData(t.output.subarray(0,t.next_out)),t.avail_out=0;continue}if(a=Ie.deflate(t,r),a===La)return t.next_out>0&&this.onData(t.output.subarray(0,t.next_out)),a=Ie.deflateEnd(this.strm),this.onEnd(a),this.ended=!0,a===rt;if(t.avail_out===0){this.onData(t.output);continue}if(r>0&&t.next_out>0){this.onData(t.output.subarray(0,t.next_out)),t.avail_out=0;continue}if(t.avail_in===0)break}return!0};Yt.prototype.onData=function(e){this.chunks.push(e)};Yt.prototype.onEnd=function(e){e===rt&&(this.result=ht.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};const Xe=16209,Ma=16191;var Ha=function(n,t){let i,a,r,o,f,u,s,l,p,c,h,_,g,k,m,E,C,d,$,N,b,y,w,v;const x=n.state;i=n.next_in,w=n.input,a=i+(n.avail_in-5),r=n.next_out,v=n.output,o=r-(t-n.avail_out),f=r+(n.avail_out-257),u=x.dmax,s=x.wsize,l=x.whave,p=x.wnext,c=x.window,h=x.hold,_=x.bits,g=x.lencode,k=x.distcode,m=(1<<x.lenbits)-1,E=(1<<x.distbits)-1;e:do{_<15&&(h+=w[i++]<<_,_+=8,h+=w[i++]<<_,_+=8),C=g[h&m];t:for(;;){if(d=C>>>24,h>>>=d,_-=d,d=C>>>16&255,d===0)v[r++]=C&65535;else if(d&16){$=C&65535,d&=15,d&&(_<d&&(h+=w[i++]<<_,_+=8),$+=h&(1<<d)-1,h>>>=d,_-=d),_<15&&(h+=w[i++]<<_,_+=8,h+=w[i++]<<_,_+=8),C=k[h&E];n:for(;;){if(d=C>>>24,h>>>=d,_-=d,d=C>>>16&255,d&16){if(N=C&65535,d&=15,_<d&&(h+=w[i++]<<_,_+=8,_<d&&(h+=w[i++]<<_,_+=8)),N+=h&(1<<d)-1,N>u){n.msg="invalid distance too far back",x.mode=Xe;break e}if(h>>>=d,_-=d,d=r-o,N>d){if(d=N-d,d>l&&x.sane){n.msg="invalid distance too far back",x.mode=Xe;break e}if(b=0,y=c,p===0){if(b+=s-d,d<$){$-=d;do v[r++]=c[b++];while(--d);b=r-N,y=v}}else if(p<d){if(b+=s+p-d,d-=p,d<$){$-=d;do v[r++]=c[b++];while(--d);if(b=0,p<$){d=p,$-=d;do v[r++]=c[b++];while(--d);b=r-N,y=v}}}else if(b+=p-d,d<$){$-=d;do v[r++]=c[b++];while(--d);b=r-N,y=v}for(;$>2;)v[r++]=y[b++],v[r++]=y[b++],v[r++]=y[b++],$-=3;$&&(v[r++]=y[b++],$>1&&(v[r++]=y[b++]))}else{b=r-N;do v[r++]=v[b++],v[r++]=v[b++],v[r++]=v[b++],$-=3;while($>2);$&&(v[r++]=v[b++],$>1&&(v[r++]=v[b++]))}}else if(d&64){n.msg="invalid distance code",x.mode=Xe;break e}else{C=k[(C&65535)+(h&(1<<d)-1)];continue n}break}}else if(d&64)if(d&32){x.mode=Ma;break e}else{n.msg="invalid literal/length code",x.mode=Xe;break e}else{C=g[(C&65535)+(h&(1<<d)-1)];continue t}break}}while(i<a&&r<f);$=_>>3,i-=$,_-=$<<3,h&=(1<<_)-1,n.next_in=i,n.next_out=r,n.avail_in=i<a?5+(a-i):5-(i-a),n.avail_out=r<f?257+(f-r):257-(r-f),x.hold=h,x.bits=_};const de=15,hn=852,cn=592,dn=0,mt=1,pn=2,ja=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),Ga=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),Ya=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),Ka=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]),Wa=(e,n,t,i,a,r,o,f)=>{const u=f.bits;let s=0,l=0,p=0,c=0,h=0,_=0,g=0,k=0,m=0,E=0,C,d,$,N,b,y=null,w;const v=new Uint16Array(de+1),x=new Uint16Array(de+1);let re=null,Qt,je,Ge;for(s=0;s<=de;s++)v[s]=0;for(l=0;l<i;l++)v[n[t+l]]++;for(h=u,c=de;c>=1&&v[c]===0;c--);if(h>c&&(h=c),c===0)return a[r++]=1<<24|64<<16|0,a[r++]=1<<24|64<<16|0,f.bits=1,0;for(p=1;p<c&&v[p]===0;p++);for(h<p&&(h=p),k=1,s=1;s<=de;s++)if(k<<=1,k-=v[s],k<0)return-1;if(k>0&&(e===dn||c!==1))return-1;for(x[1]=0,s=1;s<de;s++)x[s+1]=x[s]+v[s];for(l=0;l<i;l++)n[t+l]!==0&&(o[x[n[t+l]]++]=l);if(e===dn?(y=re=o,w=20):e===mt?(y=ja,re=Ga,w=257):(y=Ya,re=Ka,w=0),E=0,l=0,s=p,b=r,_=h,g=0,$=-1,m=1<<h,N=m-1,e===mt&&m>hn||e===pn&&m>cn)return 1;for(;;){Qt=s-g,o[l]+1<w?(je=0,Ge=o[l]):o[l]>=w?(je=re[o[l]-w],Ge=y[o[l]-w]):(je=32+64,Ge=0),C=1<<s-g,d=1<<_,p=d;do d-=C,a[b+(E>>g)+d]=Qt<<24|je<<16|Ge|0;while(d!==0);for(C=1<<s-1;E&C;)C>>=1;if(C!==0?(E&=C-1,E+=C):E=0,l++,--v[s]===0){if(s===c)break;s=n[t+o[l]]}if(s>h&&(E&N)!==$){for(g===0&&(g=h),b+=p,_=s-g,k=1<<_;_+g<c&&(k-=v[_+g],!(k<=0));)_++,k<<=1;if(m+=1<<_,e===mt&&m>hn||e===pn&&m>cn)return 1;$=E&N,a[$]=h<<24|_<<16|b-r|0}}return E!==0&&(a[b+E]=s-g<<24|64<<16|0),f.bits=h,0};var Te=Wa;const Xa=0,wi=1,mi=2,{Z_FINISH:_n,Z_BLOCK:qa,Z_TREES:qe,Z_OK:ue,Z_STREAM_END:Ja,Z_NEED_DICT:Qa,Z_STREAM_ERROR:F,Z_DATA_ERROR:yi,Z_MEM_ERROR:vi,Z_BUF_ERROR:eo,Z_DEFLATED:bn}=Ze,ct=16180,gn=16181,wn=16182,mn=16183,yn=16184,vn=16185,kn=16186,$n=16187,En=16188,Cn=16189,at=16190,K=16191,yt=16192,Sn=16193,vt=16194,Nn=16195,xn=16196,In=16197,Tn=16198,Je=16199,Qe=16200,An=16201,On=16202,zn=16203,Rn=16204,Bn=16205,kt=16206,Un=16207,Dn=16208,A=16209,ki=16210,$i=16211,to=852,no=592,io=15,ro=io,Vn=e=>(e>>>24&255)+(e>>>8&65280)+((e&65280)<<8)+((e&255)<<24);function ao(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const he=e=>{if(!e)return 1;const n=e.state;return!n||n.strm!==e||n.mode<ct||n.mode>$i?1:0},Ei=e=>{if(he(e))return F;const n=e.state;return e.total_in=e.total_out=n.total=0,e.msg="",n.wrap&&(e.adler=n.wrap&1),n.mode=ct,n.last=0,n.havedict=0,n.flags=-1,n.dmax=32768,n.head=null,n.hold=0,n.bits=0,n.lencode=n.lendyn=new Int32Array(to),n.distcode=n.distdyn=new Int32Array(no),n.sane=1,n.back=-1,ue},Ci=e=>{if(he(e))return F;const n=e.state;return n.wsize=0,n.whave=0,n.wnext=0,Ei(e)},Si=(e,n)=>{let t;if(he(e))return F;const i=e.state;return n<0?(t=0,n=-n):(t=(n>>4)+5,n<48&&(n&=15)),n&&(n<8||n>15)?F:(i.window!==null&&i.wbits!==n&&(i.window=null),i.wrap=t,i.wbits=n,Ci(e))},Ni=(e,n)=>{if(!e)return F;const t=new ao;e.state=t,t.strm=e,t.window=null,t.mode=ct;const i=Si(e,n);return i!==ue&&(e.state=null),i},oo=e=>Ni(e,ro);let Ln=!0,$t,Et;const so=e=>{if(Ln){$t=new Int32Array(512),Et=new Int32Array(32);let n=0;for(;n<144;)e.lens[n++]=8;for(;n<256;)e.lens[n++]=9;for(;n<280;)e.lens[n++]=7;for(;n<288;)e.lens[n++]=8;for(Te(wi,e.lens,0,288,$t,0,e.work,{bits:9}),n=0;n<32;)e.lens[n++]=5;Te(mi,e.lens,0,32,Et,0,e.work,{bits:5}),Ln=!1}e.lencode=$t,e.lenbits=9,e.distcode=Et,e.distbits=5},xi=(e,n,t,i)=>{let a;const r=e.state;return r.window===null&&(r.wsize=1<<r.wbits,r.wnext=0,r.whave=0,r.window=new Uint8Array(r.wsize)),i>=r.wsize?(r.window.set(n.subarray(t-r.wsize,t),0),r.wnext=0,r.whave=r.wsize):(a=r.wsize-r.wnext,a>i&&(a=i),r.window.set(n.subarray(t-i,t-i+a),r.wnext),i-=a,i?(r.window.set(n.subarray(t-i,t),0),r.wnext=i,r.whave=r.wsize):(r.wnext+=a,r.wnext===r.wsize&&(r.wnext=0),r.whave<r.wsize&&(r.whave+=a))),0},fo=(e,n)=>{let t,i,a,r,o,f,u,s,l,p,c,h,_,g,k=0,m,E,C,d,$,N,b,y;const w=new Uint8Array(4);let v,x;const re=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(he(e)||!e.output||!e.input&&e.avail_in!==0)return F;t=e.state,t.mode===K&&(t.mode=yt),o=e.next_out,a=e.output,u=e.avail_out,r=e.next_in,i=e.input,f=e.avail_in,s=t.hold,l=t.bits,p=f,c=u,y=ue;e:for(;;)switch(t.mode){case ct:if(t.wrap===0){t.mode=yt;break}for(;l<16;){if(f===0)break e;f--,s+=i[r++]<<l,l+=8}if(t.wrap&2&&s===35615){t.wbits===0&&(t.wbits=15),t.check=0,w[0]=s&255,w[1]=s>>>8&255,t.check=z(t.check,w,2,0),s=0,l=0,t.mode=gn;break}if(t.head&&(t.head.done=!1),!(t.wrap&1)||(((s&255)<<8)+(s>>8))%31){e.msg="incorrect header check",t.mode=A;break}if((s&15)!==bn){e.msg="unknown compression method",t.mode=A;break}if(s>>>=4,l-=4,b=(s&15)+8,t.wbits===0&&(t.wbits=b),b>15||b>t.wbits){e.msg="invalid window size",t.mode=A;break}t.dmax=1<<t.wbits,t.flags=0,e.adler=t.check=1,t.mode=s&512?Cn:K,s=0,l=0;break;case gn:for(;l<16;){if(f===0)break e;f--,s+=i[r++]<<l,l+=8}if(t.flags=s,(t.flags&255)!==bn){e.msg="unknown compression method",t.mode=A;break}if(t.flags&57344){e.msg="unknown header flags set",t.mode=A;break}t.head&&(t.head.text=s>>8&1),t.flags&512&&t.wrap&4&&(w[0]=s&255,w[1]=s>>>8&255,t.check=z(t.check,w,2,0)),s=0,l=0,t.mode=wn;case wn:for(;l<32;){if(f===0)break e;f--,s+=i[r++]<<l,l+=8}t.head&&(t.head.time=s),t.flags&512&&t.wrap&4&&(w[0]=s&255,w[1]=s>>>8&255,w[2]=s>>>16&255,w[3]=s>>>24&255,t.check=z(t.check,w,4,0)),s=0,l=0,t.mode=mn;case mn:for(;l<16;){if(f===0)break e;f--,s+=i[r++]<<l,l+=8}t.head&&(t.head.xflags=s&255,t.head.os=s>>8),t.flags&512&&t.wrap&4&&(w[0]=s&255,w[1]=s>>>8&255,t.check=z(t.check,w,2,0)),s=0,l=0,t.mode=yn;case yn:if(t.flags&1024){for(;l<16;){if(f===0)break e;f--,s+=i[r++]<<l,l+=8}t.length=s,t.head&&(t.head.extra_len=s),t.flags&512&&t.wrap&4&&(w[0]=s&255,w[1]=s>>>8&255,t.check=z(t.check,w,2,0)),s=0,l=0}else t.head&&(t.head.extra=null);t.mode=vn;case vn:if(t.flags&1024&&(h=t.length,h>f&&(h=f),h&&(t.head&&(b=t.head.extra_len-t.length,t.head.extra||(t.head.extra=new Uint8Array(t.head.extra_len)),t.head.extra.set(i.subarray(r,r+h),b)),t.flags&512&&t.wrap&4&&(t.check=z(t.check,i,h,r)),f-=h,r+=h,t.length-=h),t.length))break e;t.length=0,t.mode=kn;case kn:if(t.flags&2048){if(f===0)break e;h=0;do b=i[r+h++],t.head&&b&&t.length<65536&&(t.head.name+=String.fromCharCode(b));while(b&&h<f);if(t.flags&512&&t.wrap&4&&(t.check=z(t.check,i,h,r)),f-=h,r+=h,b)break e}else t.head&&(t.head.name=null);t.length=0,t.mode=$n;case $n:if(t.flags&4096){if(f===0)break e;h=0;do b=i[r+h++],t.head&&b&&t.length<65536&&(t.head.comment+=String.fromCharCode(b));while(b&&h<f);if(t.flags&512&&t.wrap&4&&(t.check=z(t.check,i,h,r)),f-=h,r+=h,b)break e}else t.head&&(t.head.comment=null);t.mode=En;case En:if(t.flags&512){for(;l<16;){if(f===0)break e;f--,s+=i[r++]<<l,l+=8}if(t.wrap&4&&s!==(t.check&65535)){e.msg="header crc mismatch",t.mode=A;break}s=0,l=0}t.head&&(t.head.hcrc=t.flags>>9&1,t.head.done=!0),e.adler=t.check=0,t.mode=K;break;case Cn:for(;l<32;){if(f===0)break e;f--,s+=i[r++]<<l,l+=8}e.adler=t.check=Vn(s),s=0,l=0,t.mode=at;case at:if(t.havedict===0)return e.next_out=o,e.avail_out=u,e.next_in=r,e.avail_in=f,t.hold=s,t.bits=l,Qa;e.adler=t.check=1,t.mode=K;case K:if(n===qa||n===qe)break e;case yt:if(t.last){s>>>=l&7,l-=l&7,t.mode=kt;break}for(;l<3;){if(f===0)break e;f--,s+=i[r++]<<l,l+=8}switch(t.last=s&1,s>>>=1,l-=1,s&3){case 0:t.mode=Sn;break;case 1:if(so(t),t.mode=Je,n===qe){s>>>=2,l-=2;break e}break;case 2:t.mode=xn;break;case 3:e.msg="invalid block type",t.mode=A}s>>>=2,l-=2;break;case Sn:for(s>>>=l&7,l-=l&7;l<32;){if(f===0)break e;f--,s+=i[r++]<<l,l+=8}if((s&65535)!==(s>>>16^65535)){e.msg="invalid stored block lengths",t.mode=A;break}if(t.length=s&65535,s=0,l=0,t.mode=vt,n===qe)break e;case vt:t.mode=Nn;case Nn:if(h=t.length,h){if(h>f&&(h=f),h>u&&(h=u),h===0)break e;a.set(i.subarray(r,r+h),o),f-=h,r+=h,u-=h,o+=h,t.length-=h;break}t.mode=K;break;case xn:for(;l<14;){if(f===0)break e;f--,s+=i[r++]<<l,l+=8}if(t.nlen=(s&31)+257,s>>>=5,l-=5,t.ndist=(s&31)+1,s>>>=5,l-=5,t.ncode=(s&15)+4,s>>>=4,l-=4,t.nlen>286||t.ndist>30){e.msg="too many length or distance symbols",t.mode=A;break}t.have=0,t.mode=In;case In:for(;t.have<t.ncode;){for(;l<3;){if(f===0)break e;f--,s+=i[r++]<<l,l+=8}t.lens[re[t.have++]]=s&7,s>>>=3,l-=3}for(;t.have<19;)t.lens[re[t.have++]]=0;if(t.lencode=t.lendyn,t.lenbits=7,v={bits:t.lenbits},y=Te(Xa,t.lens,0,19,t.lencode,0,t.work,v),t.lenbits=v.bits,y){e.msg="invalid code lengths set",t.mode=A;break}t.have=0,t.mode=Tn;case Tn:for(;t.have<t.nlen+t.ndist;){for(;k=t.lencode[s&(1<<t.lenbits)-1],m=k>>>24,E=k>>>16&255,C=k&65535,!(m<=l);){if(f===0)break e;f--,s+=i[r++]<<l,l+=8}if(C<16)s>>>=m,l-=m,t.lens[t.have++]=C;else{if(C===16){for(x=m+2;l<x;){if(f===0)break e;f--,s+=i[r++]<<l,l+=8}if(s>>>=m,l-=m,t.have===0){e.msg="invalid bit length repeat",t.mode=A;break}b=t.lens[t.have-1],h=3+(s&3),s>>>=2,l-=2}else if(C===17){for(x=m+3;l<x;){if(f===0)break e;f--,s+=i[r++]<<l,l+=8}s>>>=m,l-=m,b=0,h=3+(s&7),s>>>=3,l-=3}else{for(x=m+7;l<x;){if(f===0)break e;f--,s+=i[r++]<<l,l+=8}s>>>=m,l-=m,b=0,h=11+(s&127),s>>>=7,l-=7}if(t.have+h>t.nlen+t.ndist){e.msg="invalid bit length repeat",t.mode=A;break}for(;h--;)t.lens[t.have++]=b}}if(t.mode===A)break;if(t.lens[256]===0){e.msg="invalid code -- missing end-of-block",t.mode=A;break}if(t.lenbits=9,v={bits:t.lenbits},y=Te(wi,t.lens,0,t.nlen,t.lencode,0,t.work,v),t.lenbits=v.bits,y){e.msg="invalid literal/lengths set",t.mode=A;break}if(t.distbits=6,t.distcode=t.distdyn,v={bits:t.distbits},y=Te(mi,t.lens,t.nlen,t.ndist,t.distcode,0,t.work,v),t.distbits=v.bits,y){e.msg="invalid distances set",t.mode=A;break}if(t.mode=Je,n===qe)break e;case Je:t.mode=Qe;case Qe:if(f>=6&&u>=258){e.next_out=o,e.avail_out=u,e.next_in=r,e.avail_in=f,t.hold=s,t.bits=l,Ha(e,c),o=e.next_out,a=e.output,u=e.avail_out,r=e.next_in,i=e.input,f=e.avail_in,s=t.hold,l=t.bits,t.mode===K&&(t.back=-1);break}for(t.back=0;k=t.lencode[s&(1<<t.lenbits)-1],m=k>>>24,E=k>>>16&255,C=k&65535,!(m<=l);){if(f===0)break e;f--,s+=i[r++]<<l,l+=8}if(E&&!(E&240)){for(d=m,$=E,N=C;k=t.lencode[N+((s&(1<<d+$)-1)>>d)],m=k>>>24,E=k>>>16&255,C=k&65535,!(d+m<=l);){if(f===0)break e;f--,s+=i[r++]<<l,l+=8}s>>>=d,l-=d,t.back+=d}if(s>>>=m,l-=m,t.back+=m,t.length=C,E===0){t.mode=Bn;break}if(E&32){t.back=-1,t.mode=K;break}if(E&64){e.msg="invalid literal/length code",t.mode=A;break}t.extra=E&15,t.mode=An;case An:if(t.extra){for(x=t.extra;l<x;){if(f===0)break e;f--,s+=i[r++]<<l,l+=8}t.length+=s&(1<<t.extra)-1,s>>>=t.extra,l-=t.extra,t.back+=t.extra}t.was=t.length,t.mode=On;case On:for(;k=t.distcode[s&(1<<t.distbits)-1],m=k>>>24,E=k>>>16&255,C=k&65535,!(m<=l);){if(f===0)break e;f--,s+=i[r++]<<l,l+=8}if(!(E&240)){for(d=m,$=E,N=C;k=t.distcode[N+((s&(1<<d+$)-1)>>d)],m=k>>>24,E=k>>>16&255,C=k&65535,!(d+m<=l);){if(f===0)break e;f--,s+=i[r++]<<l,l+=8}s>>>=d,l-=d,t.back+=d}if(s>>>=m,l-=m,t.back+=m,E&64){e.msg="invalid distance code",t.mode=A;break}t.offset=C,t.extra=E&15,t.mode=zn;case zn:if(t.extra){for(x=t.extra;l<x;){if(f===0)break e;f--,s+=i[r++]<<l,l+=8}t.offset+=s&(1<<t.extra)-1,s>>>=t.extra,l-=t.extra,t.back+=t.extra}if(t.offset>t.dmax){e.msg="invalid distance too far back",t.mode=A;break}t.mode=Rn;case Rn:if(u===0)break e;if(h=c-u,t.offset>h){if(h=t.offset-h,h>t.whave&&t.sane){e.msg="invalid distance too far back",t.mode=A;break}h>t.wnext?(h-=t.wnext,_=t.wsize-h):_=t.wnext-h,h>t.length&&(h=t.length),g=t.window}else g=a,_=o-t.offset,h=t.length;h>u&&(h=u),u-=h,t.length-=h;do a[o++]=g[_++];while(--h);t.length===0&&(t.mode=Qe);break;case Bn:if(u===0)break e;a[o++]=t.length,u--,t.mode=Qe;break;case kt:if(t.wrap){for(;l<32;){if(f===0)break e;f--,s|=i[r++]<<l,l+=8}if(c-=u,e.total_out+=c,t.total+=c,t.wrap&4&&c&&(e.adler=t.check=t.flags?z(t.check,a,c,o-c):Be(t.check,a,c,o-c)),c=u,t.wrap&4&&(t.flags?s:Vn(s))!==t.check){e.msg="incorrect data check",t.mode=A;break}s=0,l=0}t.mode=Un;case Un:if(t.wrap&&t.flags){for(;l<32;){if(f===0)break e;f--,s+=i[r++]<<l,l+=8}if(t.wrap&4&&s!==(t.total&4294967295)){e.msg="incorrect length check",t.mode=A;break}s=0,l=0}t.mode=Dn;case Dn:y=Ja;break e;case A:y=yi;break e;case ki:return vi;case $i:default:return F}return e.next_out=o,e.avail_out=u,e.next_in=r,e.avail_in=f,t.hold=s,t.bits=l,(t.wsize||c!==e.avail_out&&t.mode<A&&(t.mode<kt||n!==_n))&&xi(e,e.output,e.next_out,c-e.avail_out),p-=e.avail_in,c-=e.avail_out,e.total_in+=p,e.total_out+=c,t.total+=c,t.wrap&4&&c&&(e.adler=t.check=t.flags?z(t.check,a,c,e.next_out-c):Be(t.check,a,c,e.next_out-c)),e.data_type=t.bits+(t.last?64:0)+(t.mode===K?128:0)+(t.mode===Je||t.mode===vt?256:0),(p===0&&c===0||n===_n)&&y===ue&&(y=eo),y},lo=e=>{if(he(e))return F;let n=e.state;return n.window&&(n.window=null),e.state=null,ue},uo=(e,n)=>{if(he(e))return F;const t=e.state;return t.wrap&2?(t.head=n,n.done=!1,ue):F},ho=(e,n)=>{const t=n.length;let i,a,r;return he(e)||(i=e.state,i.wrap!==0&&i.mode!==at)?F:i.mode===at&&(a=1,a=Be(a,n,t,0),a!==i.check)?yi:(r=xi(e,n,t,t),r?(i.mode=ki,vi):(i.havedict=1,ue))};var co=Ci,po=Si,_o=Ei,bo=oo,go=Ni,wo=fo,mo=lo,yo=uo,vo=ho,ko="pako inflate (from Nodeca project)",X={inflateReset:co,inflateReset2:po,inflateResetKeep:_o,inflateInit:bo,inflateInit2:go,inflate:wo,inflateEnd:mo,inflateGetHeader:yo,inflateSetDictionary:vo,inflateInfo:ko};function $o(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}var Eo=$o;const Ii=Object.prototype.toString,{Z_NO_FLUSH:Co,Z_FINISH:So,Z_OK:Ve,Z_STREAM_END:Ct,Z_NEED_DICT:St,Z_STREAM_ERROR:No,Z_DATA_ERROR:Fn,Z_MEM_ERROR:xo}=Ze;function He(e){this.options=ht.assign({chunkSize:1024*64,windowBits:15,to:""},e||{});const n=this.options;n.raw&&n.windowBits>=0&&n.windowBits<16&&(n.windowBits=-n.windowBits,n.windowBits===0&&(n.windowBits=-15)),n.windowBits>=0&&n.windowBits<16&&!(e&&e.windowBits)&&(n.windowBits+=32),n.windowBits>15&&n.windowBits<48&&(n.windowBits&15||(n.windowBits|=15)),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new bi,this.strm.avail_out=0;let t=X.inflateInit2(this.strm,n.windowBits);if(t!==Ve)throw new Error(ge[t]);if(this.header=new Eo,X.inflateGetHeader(this.strm,this.header),n.dictionary&&(typeof n.dictionary=="string"?n.dictionary=De.string2buf(n.dictionary):Ii.call(n.dictionary)==="[object ArrayBuffer]"&&(n.dictionary=new Uint8Array(n.dictionary)),n.raw&&(t=X.inflateSetDictionary(this.strm,n.dictionary),t!==Ve)))throw new Error(ge[t])}He.prototype.push=function(e,n){const t=this.strm,i=this.options.chunkSize,a=this.options.dictionary;let r,o,f;if(this.ended)return!1;for(n===~~n?o=n:o=n===!0?So:Co,Ii.call(e)==="[object ArrayBuffer]"?t.input=new Uint8Array(e):t.input=e,t.next_in=0,t.avail_in=t.input.length;;){for(t.avail_out===0&&(t.output=new Uint8Array(i),t.next_out=0,t.avail_out=i),r=X.inflate(t,o),r===St&&a&&(r=X.inflateSetDictionary(t,a),r===Ve?r=X.inflate(t,o):r===Fn&&(r=St));t.avail_in>0&&r===Ct&&t.state.wrap>0&&e[t.next_in]!==0;)X.inflateReset(t),r=X.inflate(t,o);switch(r){case No:case Fn:case St:case xo:return this.onEnd(r),this.ended=!0,!1}if(f=t.avail_out,t.next_out&&(t.avail_out===0||r===Ct))if(this.options.to==="string"){let u=De.utf8border(t.output,t.next_out),s=t.next_out-u,l=De.buf2string(t.output,u);t.next_out=s,t.avail_out=i-s,s&&t.output.set(t.output.subarray(u,u+s),0),this.onData(l)}else this.onData(t.output.length===t.next_out?t.output:t.output.subarray(0,t.next_out));if(!(r===Ve&&f===0)){if(r===Ct)return r=X.inflateEnd(this.strm),this.onEnd(r),this.ended=!0,!0;if(t.avail_in===0)break}}return!0};He.prototype.onData=function(e){this.chunks.push(e)};He.prototype.onEnd=function(e){e===Ve&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=ht.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};function Kt(e,n){const t=new He(n);if(t.push(e),t.err)throw t.msg||ge[t.err];return t.result}function Io(e,n){return n=n||{},n.raw=!0,Kt(e,n)}var To=He,Ao=Kt,Oo=Io,zo=Kt,Ro=Ze,Bo={Inflate:To,inflate:Ao,inflateRaw:Oo,ungzip:zo,constants:Ro};const{Inflate:Us,inflate:Ds,inflateRaw:Uo,ungzip:Vs}=Bo;var Do=Uo;function Vo(e){return Do(e.subarray(2))}class Lo extends Error{constructor(n){super(n),this.code="ERR_ABORTED"}}function Fo(e){e.sort((a,r)=>Number(a.offset)-Number(r.offset));const n=[];let t,i;for(const a of e)t&&i&&Number(a.offset)-i<=2e3?(t.length=BigInt(Number(t.length)+Number(a.length)-i+Number(a.offset)),t.blocks.push(a)):n.push(t={blocks:[a],length:a.length,offset:a.offset}),i=Number(t.offset)+Number(t.length);return n}function et(e){if(e&&e.aborted)if(typeof DOMException>"u"){const n=new Lo("aborted");throw n.code="ERR_ABORTED",n}else throw new DOMException("aborted","AbortError")}const Po=1,Zo=2,Mo=3;function Nt(e,n,t,i){return e<i&&n>=t}function Ho(e){const n=e?"big":"little",t=new S().endianess(n).uint32("chromId").uint32("start").uint32("end").uint32("validCnt").floatle("minScore").floatle("maxScore").floatle("sumData").floatle("sumSqData").saveOffset("offset"),i=new S().endianess(n).uint8("isLeaf").skip(1).uint16("cnt").choice({tag:"isLeaf",choices:{1:new S().endianess(n).array("blocksToFetch",{length:"cnt",type:new S().endianess(n).uint32("startChrom").uint32("startBase").uint32("endChrom").uint32("endBase").uint64("blockOffset").uint64("blockSize").saveOffset("offset")}),0:new S().array("recurOffsets",{length:"cnt",type:new S().endianess(n).uint32("startChrom").uint32("startBase").uint32("endChrom").uint32("endBase").uint64("blockOffset").saveOffset("offset")})}}),a=new S().endianess(n).uint32("chromId").int32("start").int32("end").string("rest",{zeroTerminated:!0}).saveOffset("offset");return{bigWigParser:new S().endianess(n).skip(4).int32("blockStart").skip(4).uint32("itemStep").uint32("itemSpan").uint8("blockType").skip(1).uint16("itemCount").choice({tag:"blockType",choices:{[Mo]:new S().array("items",{length:"itemCount",type:new S().floatle("score")}),[Zo]:new S().array("items",{length:"itemCount",type:new S().endianess(n).int32("start").floatle("score")}),[Po]:new S().array("items",{length:"itemCount",type:new S().endianess(n).int32("start").int32("end").floatle("score")})}}),bigBedParser:a,summaryParser:t,leafParser:i}}class Ti{constructor(n,t,i,a,r,o){if(this.bbi=n,this.refsByName=t,this.cirTreeOffset=i,this.isBigEndian=a,this.isCompressed=r,this.blockType=o,this.featureCache=new Yn({cache:new Kn({maxSize:1e3}),fill:async(u,s)=>{const l=Number(u.length),p=Number(u.offset),{buffer:c}=await this.bbi.read(J.Buffer.alloc(l),0,l,p,{signal:s});return c}}),!(i>=0))throw new Error("invalid cirTreeOffset!");const f=Ho(a);this.leafParser=f.leafParser,this.bigBedParser=f.bigBedParser}async readWigData(n,t,i,a,r){try{const{refsByName:o,bbi:f,cirTreeOffset:u,isBigEndian:s}=this,l=o[n];l===void 0&&a.complete();const p={chrId:l,start:t,end:i};this.cirTreePromise||(this.cirTreePromise=f.read(J.Buffer.alloc(48),0,48,Number(u),r));const{buffer:c}=await this.cirTreePromise,h=s?c.readUInt32BE(4):c.readUInt32LE(4);let _=[],g=0;const k=(d,$,N)=>{try{const b=d.subarray($),y=this.leafParser.parse(b);if(y.blocksToFetch&&(_=_.concat(y.blocksToFetch.filter(w=>m(w)).map(w=>({offset:w.blockOffset,length:w.blockSize})))),y.recurOffsets){const w=y.recurOffsets.filter(v=>m(v)).map(v=>Number(v.blockOffset));w.length>0&&C(w,N+1)}}catch(b){a.error(b)}},m=d=>{const{startChrom:$,startBase:N,endChrom:b,endBase:y}=d;return($<l||$===l&&N<=i)&&(b>l||b===l&&y>=t)},E=async(d,$,N)=>{try{const b=$.max-$.min,y=$.min,w=await this.featureCache.get(`${b}_${y}`,{length:b,offset:y},r==null?void 0:r.signal);for(const v of d)$.contains(v)&&(k(w,v-y,N),g-=1,g===0&&this.readFeatures(a,_,{...r,request:p}).catch(x=>a.error(x)))}catch(b){a.error(b)}},C=(d,$)=>{try{g+=d.length;const N=4+Number(h)*32;let b=new pe([{min:d[0],max:d[0]+N}]);for(let y=1;y<d.length;y+=1){const w=new pe([{min:d[y],max:d[y]+N}]);b=b.union(w)}b.getRanges().map(y=>E(d,y,$))}catch(N){a.error(N)}};return C([Number(u)+48],1)}catch(o){a.error(o)}}parseSummaryBlock(n,t,i){const a=[];let r=t;const o=new DataView(n.buffer,n.byteOffset,n.length);for(;r<n.byteLength;){const f=o.getUint32(r,!0);r+=4;const u=o.getUint32(r,!0);r+=4;const s=o.getUint32(r,!0);r+=4;const l=o.getUint32(r,!0);r+=4;const p=o.getFloat32(r,!0);r+=4;const c=o.getFloat32(r,!0);r+=4;const h=o.getFloat32(r,!0);r+=4,r+=4,(!i||f===i.chrId&&Nt(u,s,i.start,i.end))&&a.push({start:u,end:s,maxScore:c,minScore:p,summary:!0,score:h/(l||1)})}return a}parseBigBedBlock(n,t,i,a){const r=[];let o=t;for(;o<n.byteLength;){const f=this.bigBedParser.parse(n.subarray(o));f.uniqueId=`bb-${i+o}`,r.push(f),o+=f.offset}return a?r.filter(f=>Nt(f.start,f.end,a.start,a.end)):r}parseBigWigBlock(n,t,i){const a=n.subarray(t),r=new DataView(a.buffer,a.byteOffset,a.length);let o=0;o+=4;const f=r.getInt32(o,!0);o+=8;const u=r.getUint32(o,!0);o+=4;const s=r.getUint32(o,!0);o+=4;const l=r.getUint8(o);o+=2;const p=r.getUint16(o,!0);o+=2;const c=new Array(p);switch(l){case 1:{for(let h=0;h<p;h++){const _=r.getInt32(o,!0);o+=4;const g=r.getInt32(o,!0);o+=4;const k=r.getFloat32(o,!0);o+=4,c[h]={start:_,end:g,score:k}}break}case 2:{for(let h=0;h<p;h++){const _=r.getInt32(o,!0);o+=4;const g=r.getFloat32(o,!0);o+=4,c[h]={score:g,start:_,end:_+s}}break}case 3:{for(let h=0;h<p;h++){const _=r.getFloat32(o,!0);o+=4;const g=f+h*u;c[h]={score:_,start:g,end:g+s}}break}}return i?c.filter(h=>Nt(h.start,h.end,i.start,i.end)):c}async readFeatures(n,t,i={}){try{const{blockType:a,isCompressed:r}=this,{signal:o,request:f}=i,u=Fo(t);et(o),await Promise.all(u.map(async s=>{et(o);const{length:l,offset:p}=s,c=await this.featureCache.get(`${l}_${p}`,s,o);for(const h of s.blocks){et(o);let _=Number(h.offset)-Number(s.offset),g=c;switch(r&&(g=Vo(c.subarray(_)),_=0),et(o),a){case"summary":{n.next(this.parseSummaryBlock(g,_,f));break}case"bigwig":{n.next(this.parseBigWigBlock(g,_,f));break}case"bigbed":{n.next(this.parseBigBedBlock(g,_,Number(h.offset)*256,f));break}default:console.warn(`Don't know what to do with ${a}`)}}})),n.complete()}catch(a){n.error(a)}}}var Ft=function(e,n){return Ft=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,i){t.__proto__=i}||function(t,i){for(var a in i)Object.prototype.hasOwnProperty.call(i,a)&&(t[a]=i[a])},Ft(e,n)};function Wt(e,n){if(typeof n!="function"&&n!==null)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");Ft(e,n);function t(){this.constructor=e}e.prototype=n===null?Object.create(n):(t.prototype=n.prototype,new t)}function jo(e,n,t,i){function a(r){return r instanceof t?r:new t(function(o){o(r)})}return new(t||(t=Promise))(function(r,o){function f(l){try{s(i.next(l))}catch(p){o(p)}}function u(l){try{s(i.throw(l))}catch(p){o(p)}}function s(l){l.done?r(l.value):a(l.value).then(f,u)}s((i=i.apply(e,n||[])).next())})}function Ai(e,n){var t={label:0,sent:function(){if(r[0]&1)throw r[1];return r[1]},trys:[],ops:[]},i,a,r,o;return o={next:f(0),throw:f(1),return:f(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function f(s){return function(l){return u([s,l])}}function u(s){if(i)throw new TypeError("Generator is already executing.");for(;o&&(o=0,s[0]&&(t=0)),t;)try{if(i=1,a&&(r=s[0]&2?a.return:s[0]?a.throw||((r=a.return)&&r.call(a),0):a.next)&&!(r=r.call(a,s[1])).done)return r;switch(a=0,r&&(s=[s[0]&2,r.value]),s[0]){case 0:case 1:r=s;break;case 4:return t.label++,{value:s[1],done:!1};case 5:t.label++,a=s[1],s=[0];continue;case 7:s=t.ops.pop(),t.trys.pop();continue;default:if(r=t.trys,!(r=r.length>0&&r[r.length-1])&&(s[0]===6||s[0]===2)){t=0;continue}if(s[0]===3&&(!r||s[1]>r[0]&&s[1]<r[3])){t.label=s[1];break}if(s[0]===6&&t.label<r[1]){t.label=r[1],r=s;break}if(r&&t.label<r[2]){t.label=r[2],t.ops.push(s);break}r[2]&&t.ops.pop(),t.trys.pop();continue}s=n.call(e,t)}catch(l){s=[6,l],a=0}finally{i=r=0}if(s[0]&5)throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}}function Le(e){var n=typeof Symbol=="function"&&Symbol.iterator,t=n&&e[n],i=0;if(t)return t.call(e);if(e&&typeof e.length=="number")return{next:function(){return e&&i>=e.length&&(e=void 0),{value:e&&e[i++],done:!e}}};throw new TypeError(n?"Object is not iterable.":"Symbol.iterator is not defined.")}function ot(e,n){var t=typeof Symbol=="function"&&e[Symbol.iterator];if(!t)return e;var i=t.call(e),a,r=[],o;try{for(;(n===void 0||n-- >0)&&!(a=i.next()).done;)r.push(a.value)}catch(f){o={error:f}}finally{try{a&&!a.done&&(t=i.return)&&t.call(i)}finally{if(o)throw o.error}}return r}function st(e,n,t){if(t||arguments.length===2)for(var i=0,a=n.length,r;i<a;i++)(r||!(i in n))&&(r||(r=Array.prototype.slice.call(n,0,i)),r[i]=n[i]);return e.concat(r||Array.prototype.slice.call(n))}function be(e){return this instanceof be?(this.v=e,this):new be(e)}function Go(e,n,t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var i=t.apply(e,n||[]),a,r=[];return a={},o("next"),o("throw"),o("return"),a[Symbol.asyncIterator]=function(){return this},a;function o(c){i[c]&&(a[c]=function(h){return new Promise(function(_,g){r.push([c,h,_,g])>1||f(c,h)})})}function f(c,h){try{u(i[c](h))}catch(_){p(r[0][3],_)}}function u(c){c.value instanceof be?Promise.resolve(c.value.v).then(s,l):p(r[0][2],c)}function s(c){f("next",c)}function l(c){f("throw",c)}function p(c,h){c(h),r.shift(),r.length&&f(r[0][0],r[0][1])}}function Yo(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var n=e[Symbol.asyncIterator],t;return n?n.call(e):(e=typeof Le=="function"?Le(e):e[Symbol.iterator](),t={},i("next"),i("throw"),i("return"),t[Symbol.asyncIterator]=function(){return this},t);function i(r){t[r]=e[r]&&function(o){return new Promise(function(f,u){o=e[r](o),a(f,u,o.done,o.value)})}}function a(r,o,f,u){Promise.resolve(u).then(function(s){r({value:s,done:f})},o)}}function O(e){return typeof e=="function"}function Oi(e){var n=function(i){Error.call(i),i.stack=new Error().stack},t=e(n);return t.prototype=Object.create(Error.prototype),t.prototype.constructor=t,t}var xt=Oi(function(e){return function(t){e(this),this.message=t?t.length+` errors occurred during unsubscription:
`+t.map(function(i,a){return a+1+") "+i.toString()}).join(`
  `):"",this.name="UnsubscriptionError",this.errors=t}});function Pn(e,n){if(e){var t=e.indexOf(n);0<=t&&e.splice(t,1)}}var Xt=function(){function e(n){this.initialTeardown=n,this.closed=!1,this._parentage=null,this._finalizers=null}return e.prototype.unsubscribe=function(){var n,t,i,a,r;if(!this.closed){this.closed=!0;var o=this._parentage;if(o)if(this._parentage=null,Array.isArray(o))try{for(var f=Le(o),u=f.next();!u.done;u=f.next()){var s=u.value;s.remove(this)}}catch(g){n={error:g}}finally{try{u&&!u.done&&(t=f.return)&&t.call(f)}finally{if(n)throw n.error}}else o.remove(this);var l=this.initialTeardown;if(O(l))try{l()}catch(g){r=g instanceof xt?g.errors:[g]}var p=this._finalizers;if(p){this._finalizers=null;try{for(var c=Le(p),h=c.next();!h.done;h=c.next()){var _=h.value;try{Zn(_)}catch(g){r=r??[],g instanceof xt?r=st(st([],ot(r)),ot(g.errors)):r.push(g)}}}catch(g){i={error:g}}finally{try{h&&!h.done&&(a=c.return)&&a.call(c)}finally{if(i)throw i.error}}}if(r)throw new xt(r)}},e.prototype.add=function(n){var t;if(n&&n!==this)if(this.closed)Zn(n);else{if(n instanceof e){if(n.closed||n._hasParent(this))return;n._addParent(this)}(this._finalizers=(t=this._finalizers)!==null&&t!==void 0?t:[]).push(n)}},e.prototype._hasParent=function(n){var t=this._parentage;return t===n||Array.isArray(t)&&t.includes(n)},e.prototype._addParent=function(n){var t=this._parentage;this._parentage=Array.isArray(t)?(t.push(n),t):t?[t,n]:n},e.prototype._removeParent=function(n){var t=this._parentage;t===n?this._parentage=null:Array.isArray(t)&&Pn(t,n)},e.prototype.remove=function(n){var t=this._finalizers;t&&Pn(t,n),n instanceof e&&n._removeParent(this)},e.EMPTY=function(){var n=new e;return n.closed=!0,n}(),e}();Xt.EMPTY;function zi(e){return e instanceof Xt||e&&"closed"in e&&O(e.remove)&&O(e.add)&&O(e.unsubscribe)}function Zn(e){O(e)?e():e.unsubscribe()}var Ri={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1},Pt={setTimeout:function(e,n){for(var t=[],i=2;i<arguments.length;i++)t[i-2]=arguments[i];var a=Pt.delegate;return a!=null&&a.setTimeout?a.setTimeout.apply(a,st([e,n],ot(t))):setTimeout.apply(void 0,st([e,n],ot(t)))},clearTimeout:function(e){var n=Pt.delegate;return((n==null?void 0:n.clearTimeout)||clearTimeout)(e)},delegate:void 0};function Bi(e){Pt.setTimeout(function(){throw e})}function Mn(){}function Ko(e){e()}var qt=function(e){Wt(n,e);function n(t){var i=e.call(this)||this;return i.isStopped=!1,t?(i.destination=t,zi(t)&&t.add(i)):i.destination=Jo,i}return n.create=function(t,i,a){return new ft(t,i,a)},n.prototype.next=function(t){this.isStopped||this._next(t)},n.prototype.error=function(t){this.isStopped||(this.isStopped=!0,this._error(t))},n.prototype.complete=function(){this.isStopped||(this.isStopped=!0,this._complete())},n.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,e.prototype.unsubscribe.call(this),this.destination=null)},n.prototype._next=function(t){this.destination.next(t)},n.prototype._error=function(t){try{this.destination.error(t)}finally{this.unsubscribe()}},n.prototype._complete=function(){try{this.destination.complete()}finally{this.unsubscribe()}},n}(Xt),Wo=Function.prototype.bind;function It(e,n){return Wo.call(e,n)}var Xo=function(){function e(n){this.partialObserver=n}return e.prototype.next=function(n){var t=this.partialObserver;if(t.next)try{t.next(n)}catch(i){tt(i)}},e.prototype.error=function(n){var t=this.partialObserver;if(t.error)try{t.error(n)}catch(i){tt(i)}else tt(n)},e.prototype.complete=function(){var n=this.partialObserver;if(n.complete)try{n.complete()}catch(t){tt(t)}},e}(),ft=function(e){Wt(n,e);function n(t,i,a){var r=e.call(this)||this,o;if(O(t)||!t)o={next:t??void 0,error:i??void 0,complete:a??void 0};else{var f;r&&Ri.useDeprecatedNextContext?(f=Object.create(t),f.unsubscribe=function(){return r.unsubscribe()},o={next:t.next&&It(t.next,f),error:t.error&&It(t.error,f),complete:t.complete&&It(t.complete,f)}):o=t}return r.destination=new Xo(o),r}return n}(qt);function tt(e){Bi(e)}function qo(e){throw e}var Jo={closed:!0,next:Mn,error:qo,complete:Mn},Jt=function(){return typeof Symbol=="function"&&Symbol.observable||"@@observable"}();function Ui(e){return e}function Qo(e){return e.length===0?Ui:e.length===1?e[0]:function(t){return e.reduce(function(i,a){return a(i)},t)}}var P=function(){function e(n){n&&(this._subscribe=n)}return e.prototype.lift=function(n){var t=new e;return t.source=this,t.operator=n,t},e.prototype.subscribe=function(n,t,i){var a=this,r=ts(n)?n:new ft(n,t,i);return Ko(function(){var o=a,f=o.operator,u=o.source;r.add(f?f.call(r,u):u?a._subscribe(r):a._trySubscribe(r))}),r},e.prototype._trySubscribe=function(n){try{return this._subscribe(n)}catch(t){n.error(t)}},e.prototype.forEach=function(n,t){var i=this;return t=Hn(t),new t(function(a,r){var o=new ft({next:function(f){try{n(f)}catch(u){r(u),o.unsubscribe()}},error:r,complete:a});i.subscribe(o)})},e.prototype._subscribe=function(n){var t;return(t=this.source)===null||t===void 0?void 0:t.subscribe(n)},e.prototype[Jt]=function(){return this},e.prototype.pipe=function(){for(var n=[],t=0;t<arguments.length;t++)n[t]=arguments[t];return Qo(n)(this)},e.prototype.toPromise=function(n){var t=this;return n=Hn(n),new n(function(i,a){var r;t.subscribe(function(o){return r=o},function(o){return a(o)},function(){return i(r)})})},e.create=function(n){return new e(n)},e}();function Hn(e){var n;return(n=e??Ri.Promise)!==null&&n!==void 0?n:Promise}function es(e){return e&&O(e.next)&&O(e.error)&&O(e.complete)}function ts(e){return e&&e instanceof qt||es(e)&&zi(e)}function ns(e){return O(e==null?void 0:e.lift)}function $e(e){return function(n){if(ns(n))return n.lift(function(t){try{return e(t,this)}catch(i){this.error(i)}});throw new TypeError("Unable to lift unknown Observable type")}}function Fe(e,n,t,i,a){return new is(e,n,t,i,a)}var is=function(e){Wt(n,e);function n(t,i,a,r,o,f){var u=e.call(this,t)||this;return u.onFinalize=o,u.shouldUnsubscribe=f,u._next=i?function(s){try{i(s)}catch(l){t.error(l)}}:e.prototype._next,u._error=r?function(s){try{r(s)}catch(l){t.error(l)}finally{this.unsubscribe()}}:e.prototype._error,u._complete=a?function(){try{a()}catch(s){t.error(s)}finally{this.unsubscribe()}}:e.prototype._complete,u}return n.prototype.unsubscribe=function(){var t;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){var i=this.closed;e.prototype.unsubscribe.call(this),!i&&((t=this.onFinalize)===null||t===void 0||t.call(this))}},n}(qt),rs=new P(function(e){return e.complete()});function as(e){return e&&O(e.schedule)}function Di(e){return e[e.length-1]}function os(e){return as(Di(e))?e.pop():void 0}function ss(e,n){return typeof Di(e)=="number"?e.pop():n}var Vi=function(e){return e&&typeof e.length=="number"&&typeof e!="function"};function Li(e){return O(e==null?void 0:e.then)}function Fi(e){return O(e[Jt])}function Pi(e){return Symbol.asyncIterator&&O(e==null?void 0:e[Symbol.asyncIterator])}function Zi(e){return new TypeError("You provided "+(e!==null&&typeof e=="object"?"an invalid object":"'"+e+"'")+" where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.")}function fs(){return typeof Symbol!="function"||!Symbol.iterator?"@@iterator":Symbol.iterator}var Mi=fs();function Hi(e){return O(e==null?void 0:e[Mi])}function ji(e){return Go(this,arguments,function(){var t,i,a,r;return Ai(this,function(o){switch(o.label){case 0:t=e.getReader(),o.label=1;case 1:o.trys.push([1,,9,10]),o.label=2;case 2:return[4,be(t.read())];case 3:return i=o.sent(),a=i.value,r=i.done,r?[4,be(void 0)]:[3,5];case 4:return[2,o.sent()];case 5:return[4,be(a)];case 6:return[4,o.sent()];case 7:return o.sent(),[3,2];case 8:return[3,10];case 9:return t.releaseLock(),[7];case 10:return[2]}})})}function Gi(e){return O(e==null?void 0:e.getReader)}function Ee(e){if(e instanceof P)return e;if(e!=null){if(Fi(e))return ls(e);if(Vi(e))return us(e);if(Li(e))return hs(e);if(Pi(e))return Yi(e);if(Hi(e))return cs(e);if(Gi(e))return ds(e)}throw Zi(e)}function ls(e){return new P(function(n){var t=e[Jt]();if(O(t.subscribe))return t.subscribe(n);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}function us(e){return new P(function(n){for(var t=0;t<e.length&&!n.closed;t++)n.next(e[t]);n.complete()})}function hs(e){return new P(function(n){e.then(function(t){n.closed||(n.next(t),n.complete())},function(t){return n.error(t)}).then(null,Bi)})}function cs(e){return new P(function(n){var t,i;try{for(var a=Le(e),r=a.next();!r.done;r=a.next()){var o=r.value;if(n.next(o),n.closed)return}}catch(f){t={error:f}}finally{try{r&&!r.done&&(i=a.return)&&i.call(a)}finally{if(t)throw t.error}}n.complete()})}function Yi(e){return new P(function(n){ps(e,n).catch(function(t){return n.error(t)})})}function ds(e){return Yi(ji(e))}function ps(e,n){var t,i,a,r;return jo(this,void 0,void 0,function(){var o,f;return Ai(this,function(u){switch(u.label){case 0:u.trys.push([0,5,6,11]),t=Yo(e),u.label=1;case 1:return[4,t.next()];case 2:if(i=u.sent(),!!i.done)return[3,4];if(o=i.value,n.next(o),n.closed)return[2];u.label=3;case 3:return[3,1];case 4:return[3,11];case 5:return f=u.sent(),a={error:f},[3,11];case 6:return u.trys.push([6,,9,10]),i&&!i.done&&(r=t.return)?[4,r.call(t)]:[3,8];case 7:u.sent(),u.label=8;case 8:return[3,10];case 9:if(a)throw a.error;return[7];case 10:return[7];case 11:return n.complete(),[2]}})})}function ie(e,n,t,i,a){i===void 0&&(i=0),a===void 0&&(a=!1);var r=n.schedule(function(){t(),a?e.add(this.schedule(null,i)):this.unsubscribe()},i);if(e.add(r),!a)return r}function Ki(e,n){return n===void 0&&(n=0),$e(function(t,i){t.subscribe(Fe(i,function(a){return ie(i,e,function(){return i.next(a)},n)},function(){return ie(i,e,function(){return i.complete()},n)},function(a){return ie(i,e,function(){return i.error(a)},n)}))})}function Wi(e,n){return n===void 0&&(n=0),$e(function(t,i){i.add(e.schedule(function(){return t.subscribe(i)},n))})}function _s(e,n){return Ee(e).pipe(Wi(n),Ki(n))}function bs(e,n){return Ee(e).pipe(Wi(n),Ki(n))}function gs(e,n){return new P(function(t){var i=0;return n.schedule(function(){i===e.length?t.complete():(t.next(e[i++]),t.closed||this.schedule())})})}function ws(e,n){return new P(function(t){var i;return ie(t,n,function(){i=e[Mi](),ie(t,n,function(){var a,r,o;try{a=i.next(),r=a.value,o=a.done}catch(f){t.error(f);return}o?t.complete():t.next(r)},0,!0)}),function(){return O(i==null?void 0:i.return)&&i.return()}})}function Xi(e,n){if(!e)throw new Error("Iterable cannot be null");return new P(function(t){ie(t,n,function(){var i=e[Symbol.asyncIterator]();ie(t,n,function(){i.next().then(function(a){a.done?t.complete():t.next(a.value)})},0,!0)})})}function ms(e,n){return Xi(ji(e),n)}function ys(e,n){if(e!=null){if(Fi(e))return _s(e,n);if(Vi(e))return gs(e,n);if(Li(e))return bs(e,n);if(Pi(e))return Xi(e,n);if(Hi(e))return ws(e,n);if(Gi(e))return ms(e,n)}throw Zi(e)}function vs(e,n){return n?ys(e,n):Ee(e)}var ks=Oi(function(e){return function(){e(this),this.name="EmptyError",this.message="no elements in sequence"}});function qi(e,n){var t=typeof n=="object";return new Promise(function(i,a){var r=new ft({next:function(o){i(o),r.unsubscribe()},error:a,complete:function(){t?i(n.defaultValue):a(new ks)}});e.subscribe(r)})}function Ji(e,n){return $e(function(t,i){var a=0;t.subscribe(Fe(i,function(r){i.next(e.call(n,r,a++))}))})}function $s(e,n,t,i,a,r,o,f){var u=[],s=0,l=0,p=!1,c=function(){p&&!u.length&&!s&&n.complete()},h=function(g){return s<i?_(g):u.push(g)},_=function(g){r&&n.next(g),s++;var k=!1;Ee(t(g,l++)).subscribe(Fe(n,function(m){a==null||a(m),r?h(m):n.next(m)},function(){k=!0},void 0,function(){if(k)try{s--;for(var m=function(){var E=u.shift();o?ie(n,o,function(){return _(E)}):_(E)};u.length&&s<i;)m();c()}catch(E){n.error(E)}}))};return e.subscribe(Fe(n,h,function(){p=!0,c()})),function(){f==null||f()}}function Qi(e,n,t){return t===void 0&&(t=1/0),O(n)?Qi(function(i,a){return Ji(function(r,o){return n(i,r,a,o)})(Ee(e(i,a)))},t):(typeof n=="number"&&(t=n),$e(function(i,a){return $s(i,a,e,t)}))}function Es(e){return e===void 0&&(e=1/0),Qi(Ui,e)}function Cs(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];var t=os(e),i=ss(e,1/0),a=e;return a.length?a.length===1?Ee(a[0]):Es(i)(vs(a,t)):rs}function Ss(e,n,t,i,a){return function(r,o){var f=t,u=n,s=0;r.subscribe(Fe(o,function(l){var p=s++;u=f?e(u,l,p):(f=!0,l),i&&o.next(u)},a&&function(){f&&o.next(u),o.complete()}))}}function er(e,n){return $e(Ss(e,n,arguments.length>=2,!1,!0))}var Ns=function(e,n){return e.push(n),e};function xs(){return $e(function(e,n){er(Ns,[])(e).subscribe(n)})}const jn=-2003829722,Tt=-2021002517;function Is(e){return new TextDecoder().decode(e)}function Gn(e){const n=e?"big":"little",t=new S().endianess(n).int32("magic").uint16("version").uint16("numZoomLevels").uint64("chromTreeOffset").uint64("unzoomedDataOffset").uint64("unzoomedIndexOffset").uint16("fieldCount").uint16("definedFieldCount").uint64("asOffset").uint64("totalSummaryOffset").uint32("uncompressBufSize").uint64("extHeaderOffset").array("zoomLevels",{length:"numZoomLevels",type:new S().endianess(n).uint32("reductionLevel").uint32("reserved").uint64("dataOffset").uint64("indexOffset")}),i=new S().endianess(n).uint64("basesCovered").doublele("scoreMin").doublele("scoreMax").doublele("scoreSum").doublele("scoreSumSquares"),a=new S().endianess(n).uint32("magic").uint32("blockSize").uint32("keySize").uint32("valSize").uint64("itemCount"),r=new S().endianess(n).uint8("isLeafNode").skip(1).uint16("cnt").saveOffset("offset");return{chromTreeParser:a,totalSummaryParser:i,headerParser:t,isLeafNode:r}}class tr{getHeader(n){return this.headerP||(this.headerP=this._getHeader(n).catch(t=>{throw this.headerP=void 0,t})),this.headerP}constructor(n){const{filehandle:t,renameRefSeqs:i=o=>o,path:a,url:r}=n;if(this.renameRefSeqs=i,t)this.bbi=t;else if(r)this.bbi=new ir(r);else if(a)this.bbi=new nr(a);else throw new Error("no file given")}async _getHeader(n){const t=await this._getMainHeader(n),i=await this._readChromTree(t,n);return{...t,...i}}async _getMainHeader(n,t=2e3){const{buffer:i}=await this.bbi.read(J.Buffer.alloc(t),0,t,0,n),a=this._isBigEndian(i),r=Gn(a),o=r.headerParser.parse(i),{magic:f,asOffset:u,totalSummaryOffset:s}=o;if(o.fileType=f===Tt?"bigbed":"bigwig",u>t||s>t)return this._getMainHeader(n,t*2);if(u){const l=Number(o.asOffset);o.autoSql=Is(i.subarray(l,i.indexOf(0,l)))}if(o.totalSummaryOffset>t-8*5)return this._getMainHeader(n,t*2);if(o.totalSummaryOffset){const l=i.subarray(Number(o.totalSummaryOffset)),p=r.totalSummaryParser.parse(l);o.totalSummary={...p,basesCovered:Number(p.basesCovered)}}return{...o,isBigEndian:a}}_isBigEndian(n){let t=n.readInt32LE(0);if(t===jn||t===Tt)return!1;if(t=n.readInt32BE(0),t===jn||t===Tt)return!0;throw new Error("not a BigWig/BigBed file")}async _readChromTree(n,t){const i=n.isBigEndian,a=i?"big":"little",r=[],o={};let f=Number(n.unzoomedDataOffset);const u=Number(n.chromTreeOffset);for(;f%4!==0;)f+=1;const s=f-u,{buffer:l}=await this.bbi.read(J.Buffer.alloc(s),0,s,Number(u),t),p=Gn(i),{keySize:c}=p.chromTreeParser.parse(l),h=new S().endianess(a).string("key",{stripNull:!0,length:c}).uint32("refId").uint32("refSize").saveOffset("offset"),_=new S().endianess(a).skip(c).uint64("childOffset").saveOffset("offset"),g=32,k=async m=>{let E=m;if(E>=l.length)throw new Error("reading beyond end of buffer");const C=p.isLeafNode.parse(l.subarray(E)),{isLeafNode:d,cnt:$}=C;if(E+=C.offset,d)for(let N=0;N<$;N+=1){const b=h.parse(l.subarray(E));E+=b.offset;const{key:y,refId:w,refSize:v}=b,x={name:y,id:w,length:v};o[this.renameRefSeqs(y)]=w,r[w]=x}else{const N=[];for(let b=0;b<$;b+=1){const y=_.parse(l.subarray(E)),{childOffset:w}=y;E+=y.offset,N.push(k(Number(w)-Number(u)))}await Promise.all(N)}};return await k(g),{refsByName:o,refsByNumber:r}}async getUnzoomedView(n){const{unzoomedIndexOffset:t,refsByName:i,uncompressBufSize:a,isBigEndian:r,fileType:o}=await this.getHeader(n);return new Ti(this.bbi,i,t,r,a>0,o)}async getFeatureStream(n,t,i,a){await this.getHeader(a);const r=this.renameRefSeqs(n);let o;const{basesPerSpan:f,scale:u}=a||{};return f?o=await this.getView(1/f,a):u?o=await this.getView(u,a):o=await this.getView(1,a),new P(s=>{o.readWigData(r,t,i,s,a).catch(l=>s.error(l))})}async getFeatures(n,t,i,a){const r=await this.getFeatureStream(n,t,i,a);return(await qi(r.pipe(xs()))).flat()}}class Ls extends tr{async getView(n,t){const{zoomLevels:i,refsByName:a,fileSize:r,isBigEndian:o,uncompressBufSize:f}=await this.getHeader(t),u=1/n;let s=i.length;r||(s-=1);for(let l=s;l>=0;l-=1){const p=i[l];if(p&&p.reductionLevel<=2*u){const c=Number(p.indexOffset);return new Ti(this.bbi,a,c,o,f>0,"summary")}}return this.getUnzoomedView(t)}}function Ts(e){return e.filter(n=>!!n)}class Fs extends tr{constructor(){super(...arguments),this.readIndicesCache=new Yn({cache:new Kn({maxSize:1}),fill:(n,t)=>this._readIndices({...n,signal:t})})}readIndices(n={}){const{signal:t,...i}=n;return this.readIndicesCache.get(JSON.stringify(i),n,t)}async getView(n,t){return this.getUnzoomedView(t)}async _readIndices(n){const{extHeaderOffset:t,isBigEndian:i}=await this.getHeader(n),{buffer:a}=await this.bbi.read(J.Buffer.alloc(64),0,64,Number(t)),r=i?"big":"little",o=new S().endianess(r).uint16("size").uint16("count").uint64("offset").parse(a),{count:f,offset:u}=o;if(f===0)return[];const s=20,l=s*f,{buffer:p}=await this.bbi.read(J.Buffer.alloc(l),0,l,Number(u)),c=new S().endianess(r).int16("type").int16("fieldcount").uint64("offset").skip(4).int16("field"),h=[];for(let _=0;_<f;_+=1)h.push(c.parse(p.subarray(_*s)));return h}async searchExtraIndexBlocks(n,t={}){const{isBigEndian:i}=await this.getHeader(t),a=await this.readIndices(t);if(a.length===0)return[];const r=a.map(async o=>{const{offset:f,field:u}=o,{buffer:s}=await this.bbi.read(J.Buffer.alloc(32),0,32,Number(f),t),l=i?"big":"little",p=new S().endianess(l).int32("magic").int32("blockSize").int32("keySize").int32("valSize").uint64("itemCount"),{blockSize:c,keySize:h,valSize:_}=p.parse(s),g=new S().endianess(l).int8("nodeType").skip(1).int16("cnt").choice({tag:"nodeType",choices:{0:new S().array("leafkeys",{length:"cnt",type:new S().endianess(l).string("key",{length:h,stripNull:!0}).uint64("offset")}),1:new S().array("keys",{length:"cnt",type:new S().endianess(l).string("key",{length:h,stripNull:!0}).uint64("offset").uint32("length").uint32("reserved")})}}),k=async E=>{const C=Number(E),d=4+c*(h+_),{buffer:$}=await this.bbi.read(J.Buffer.alloc(d),0,d,C,t),N=g.parse($);if(N.leafkeys){let b;for(const{key:y,offset:w}of N.leafkeys){if(n.localeCompare(y)<0&&b)return k(b);b=w}return k(b)}for(const b of N.keys)if(b.key===n)return{...b,field:u}},m=32;return k(Number(f)+m)});return Ts(await Promise.all(r))}async searchExtraIndex(n,t={}){const i=await this.searchExtraIndexBlocks(n,t);if(i.length===0)return[];const a=await this.getUnzoomedView(t),r=i.map(f=>new P(u=>{a.readFeatures(u,[f],t).catch(s=>u.error(s))}).pipe(er((u,s)=>u.concat(s)),Ji(u=>{for(const s of u)s.field=f.field;return u})));return(await qi(Cs(...r))).filter(f=>{var u;return((u=f.rest)===null||u===void 0?void 0:u.split("	")[(f.field||0)-3])===n})}}export{Fs as BigBed,Ls as BigWig};
