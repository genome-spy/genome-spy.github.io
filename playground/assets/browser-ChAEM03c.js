class d{constructor(e){this.blob=e,this.size=e.size}async read(e,r=0){if(!e)return new Uint8Array(0);const t=r,a=t+e;return new Uint8Array(await this.blob.slice(t,a).arrayBuffer())}async readFile(e){const r=typeof e=="string"?e:e==null?void 0:e.encoding;if(r==="utf8")return this.blob.text();if(r)throw new Error(`unsupported encoding: ${r}`);return new Uint8Array(await this.blob.arrayBuffer())}async stat(){return{size:this.size}}async close(){}}function h(n){return(typeof n=="object"&&n!==null&&"message"in n?n.message:`${n}`).replace(/\.$/,"")}class u{constructor(e,r={}){this.baseOverrides={},this.url=e;const t=r.fetch||globalThis.fetch.bind(globalThis);r.overrides&&(this.baseOverrides=r.overrides),this.fetchImplementation=t}async fetch(e,r){let t;try{t=await this.fetchImplementation(e,r)}catch(a){if(`${a}`.includes("Failed to fetch")){console.warn(`generic-filehandle: refetching ${e} to attempt to work around chrome CORS header caching bug`);try{t=await this.fetchImplementation(e,{...r,cache:"reload"})}catch(i){throw new Error(`${h(i)} fetching ${e}`,{cause:i})}}else throw new Error(`${h(a)} fetching ${e}`,{cause:a})}return t}async read(e,r,t={}){const{headers:a={},signal:i,overrides:c={}}=t;e<1/0?a.range=`bytes=${r}-${r+e}`:e===1/0&&r!==0&&(a.range=`bytes=${r}-`);const s=await this.fetch(this.url,{...this.baseOverrides,...c,headers:{...a,...c.headers,...this.baseOverrides.headers},method:"GET",redirect:"follow",mode:"cors",signal:i});if(!s.ok)throw new Error(`HTTP ${s.status} fetching ${this.url}`);if(s.status===200&&r===0||s.status===206){const l=await s.arrayBuffer(),f=s.headers.get("content-range"),o=/\/(\d+)$/.exec(f||"");return o!=null&&o[1]&&(this._stat={size:parseInt(o[1],10)}),new Uint8Array(l.slice(0,e))}throw s.status===200?new Error(`${this.url} fetch returned status 200, expected 206`):new Error(`HTTP ${s.status} fetching ${this.url}`)}async readFile(e={}){let r,t;typeof e=="string"?(r=e,t={}):(r=e.encoding,t=e,delete t.encoding);const{headers:a={},signal:i,overrides:c={}}=t,s=await this.fetch(this.url,{headers:a,method:"GET",redirect:"follow",mode:"cors",signal:i,...this.baseOverrides,...c});if(s.status!==200)throw new Error(`HTTP ${s.status} fetching ${this.url}`);if(r==="utf8")return s.text();if(r)throw new Error(`unsupported encoding: ${r}`);return new Uint8Array(await s.arrayBuffer())}async stat(){if(!this._stat&&(await this.read(10,0),!this._stat))throw new Error(`unable to determine size of file at ${this.url}`);return this._stat}async close(){}}class w{readFile(){throw new Error("unimplemented")}read(){throw new Error("unimplemented")}close(){throw new Error("unimplemented")}}export{d as BlobFile,w as LocalFile,u as RemoteFile};
